// Copyright 2015 Olaf Frohn https://github.com/ofrohn, see LICENSE
!function(){function t(t,e){var r=a(t.map(function(t){return t*f}),e);return r.map(function(t){return t/f})}function a(t,a){var e,r,n,i,o,l,f,u,d,g,p=1e-5;return a?(l=t[0],0>l&&(l+=s),f=t[1],l-=a[0],i=a[1],o=a[2],e=Math.sin(f)*Math.sin(i)-Math.cos(f)*Math.cos(i)*Math.cos(l),Math.abs(e)<p&&(e=-Math.cos(f+i)+Math.cos(f)*Math.cos(i)*(1-Math.cos(l))),r=-Math.cos(f)*Math.sin(l),u=0!==e||0!==r?Math.atan2(r,e):l-Math.PI,d=o+u,d>Math.PI&&(d-=s),l%Math.PI===0?(g=f+Math.cos(l)*i,g>c&&(g=Math.PI-g),-c>g&&(g=-Math.PI-g)):(n=Math.sin(f)*Math.cos(i)+Math.cos(f)*Math.sin(i)*Math.cos(l),Math.abs(n)>.99?(g=Math.abs(Math.acos(Math.sqrt(e*e+r*r))),0>n&&(g*=-1)):g=Math.asin(n)),[d,g]):t}function e(t){return document.getElementById(t)}function r(t){return t+"px"}function n(t,a){return null!==t&&hasOwnProperty.call(t,a)}var i={version:"0.4.3",svg:null,data:[]};i.display=function(t){function a(){if(!(x.width&&x.width>0)){D=j(),G=D/C;var t=S.scale*D/1024;I.attr("width",D).attr("height",G),Y.scale([t]),H.translate([D/2,G/2]).scale([t]),Q.translate([D/2,G/2]),_&&(_.style.height=r(G)),m()}}function s(t){return S.clip&&d3.geo.distance(R,t)>c?0:1}function f(t){return"translate("+H(t)+")"}function u(t){var a=s(t);return"stroke-opacity:"+a+";fill-opacity:"+a}function m(){var t=H.rotate();Q.scale(H.scale()),x.adaptable&&(W=Math.sqrt(H.scale()/O)),N=x.stars.size*W,R=[-t[0],-t[1]],I.selectAll(".outline").attr("d",K),I.selectAll(".star").attr("d",J.pointRadius(function(t){return t.properties?z(t.properties.mag):1})),I.selectAll(".starname").attr("transform",function(t){return f(t.geometry.coordinates)}).style("fill-opacity",function(t){return s(t.geometry.coordinates)}),I.selectAll(".dso").attr("transform",function(t){return f(t.geometry.coordinates)}).attr("d",function(t){return v(t.properties)}).attr("style",function(t){return u(t.geometry.coordinates)}),I.selectAll(".dsoname").attr("transform",function(t){return f(t.geometry.coordinates)}).attr("style",function(t){return u(t.geometry.coordinates)}),I.selectAll(".constname").attr("transform",function(t){return f(t.geometry.coordinates)}).style("fill-opacity",function(t){return s(t.geometry.coordinates)}),I.selectAll(".constline").attr("d",J),I.selectAll(".boundaryline").attr("d",J),I.selectAll(".mw").attr("d",J),I.selectAll(".ecliptic").attr("d",J),I.selectAll(".equatorial").attr("d",J),I.selectAll(".galactic").attr("d",J),I.selectAll(".supergalactic").attr("d",J),I.selectAll(".gridline").attr("d",J),i.data.length>0&&i.data.forEach(function(t){t.redraw()})}function v(t){var a=y(t.mag,t.dim)||9,e=M(t.type);return-1!==d3.svg.symbolTypes.indexOf(e)?d3.svg.symbol().type(e).size(a)():d3.svg.customSymbol().type(e).size(a)()}function M(t){return t&&n(g,t)?g[t]:"circle"}function y(t,a){return t&&999!=t?Math.pow(2*N-t,1.4):Math.pow(parseInt(a)*N/7,.5)}function b(t){return""!==t.name?x.dsos.desig&&t.desig?t.desig:t.name:void 0}function w(t){return x.stars.desig!==!1||""!==t.name?x.stars.proper&&""!==t.name?t.name:x.stars.desig?t.desig:void 0:void 0}function z(t){if(null===t)return.1;var a=N*Math.exp(T*(t+2));return Math.max(a,.1)}function k(t){return!x.stars.colors||isNaN(t.bv)?x.stars.color:p(t.bv)}function j(){return x.width&&x.width>0?x.width:_?_.clientWidth-16:window.innerWidth-24}function q(t){var a=o[F],e=0;return t&&"equatorial"===F?[a[0]-t[0],a[1]-t[1],a[2]]:(("equatorial"===F||"ecliptic"===F)&&(e=180),[a[0]-e,a[1],a[2]])}var A,P,I=i.svg,x=d.set(t);x.stars.size=x.stars.size||7;var _=e(x.container);if(_){P="#"+x.container;var E=window.getComputedStyle(_,null);E.width||x.width||(_.style.width=r(_.parentNode.clientWidth))}else P="body",_=null;if(n(h,x.projection)){var S=h[x.projection],F=x.transform||"equatorial",C=S.ratio||2,D=j(),G=D/C,O=S.scale*D/1024,N=x.stars.size,T=-.3,W=1,B=q(x.center),R=[-B[0],-B[1]],$=x.datapath||"";$=$.replace(/([^\/]$)/,"$1/"),"body"!=P&&(e(x.container).style.height=r(G));var H=i.projection(x.projection).rotate(B).translate([D/2,G/2]).scale([O]),Q=i.projection(x.projection).translate([D/2,G/2]).scale([O]);S.clip&&(H.clipAngle(90),A=d3.geo.circle().angle([90]));var Y=d3.geo.zoom().projection(H).center([D/2,G/2]).scaleExtent([O,5*O]).on("zoom.redraw",m),Z=d3.geo.graticule().minorStep([15,10]),J=d3.geo.path().projection(H),K=d3.geo.path().projection(Q);I?I.selectAll("*").remove():I=d3.select(P).append("svg"),I.attr("width",D).attr("height",G),x.interactive?I.call(Y):I.attr("style","cursor: default!important"),A?I.append("path").datum(A).attr("class","outline").attr("d",K).style("fill",x.background):I.append("path").datum(Z.outline).attr("class","outline").attr("d",K).style("fill",x.background),x.lines.graticule&&("equatorial"==F?I.append("path").datum(Z).attr("class","gridline").attr("d",J):i.graticule(I,J,F));for(var L in x.lines)n(x.lines,L)&&"graticule"!=L&&x.lines[L]!==!1&&I.append("path").datum(d3.geo.circle().angle([90]).origin(l[L])).attr("class",L).attr("d",J);x.mw.show&&d3.json($+"mw.json",function(t,a){return t?(window.alert("Your Browser doesn't support local file loading or the file doesn't exist. See readme.md"),console.warn(t)):void I.selectAll(".mway").data(a.features).enter().append("path").attr("class","mw").attr("d",J)}),x.constellations.show&&(d3.json($+"constellations.json",function(t,a){return t?console.warn(t):void I.selectAll(".constnames").data(a.features).enter().append("text").attr("class","constname").attr("transform",function(t){return f(t.geometry.coordinates)}).text(function(t){return x.constellations.names?x.constellations.desig?t.properties.desig:t.properties.name:void 0}).style("fill-opacity",function(t){return s(t.geometry.coordinates)})}),x.constellations.bounds&&d3.json($+"constellations.bounds.json",function(t,a){return t?console.warn(t):void I.selectAll(".bounds").data(a.features).enter().append("path").attr("class","boundaryline").attr("d",J)}),x.constellations.lines&&d3.json($+"constellations.lines.json",function(t,a){return t?console.warn(t):void I.selectAll(".lines").data(a.features).enter().append("path").attr("class","constline").attr("d",J)})),x.stars.show&&d3.json($+x.stars.data,function(t,a){return t?console.warn(t):(I.selectAll(".stars").data(a.features.filter(function(t){return t.properties.mag<=x.stars.limit})).enter().append("path").attr("class","star").attr("d",J.pointRadius(function(t){return t.properties?z(t.properties.mag):1})).style("fill",function(t){return k(t.properties)}),void(x.stars.names&&I.selectAll(".starnames").data(a.features.filter(function(t){return t.properties.mag<=x.stars.namelimit})).enter().append("text").attr("transform",function(t){return f(t.geometry.coordinates)}).text(function(t){return w(t.properties)}).attr({dy:"-.5em",dx:".35em","class":"starname"}).style("fill-opacity",function(t){return s(t.geometry.coordinates)})))}),x.dsos.show&&d3.json($+x.dsos.data,function(t,a){return t?console.warn(t):(I.selectAll(".dsos").data(a.features.filter(function(t){return 999==t.properties.mag&&Math.sqrt(parseInt(t.properties.dim))>x.dsos.limit||999!=t.properties.mag&&t.properties.mag<=x.dsos.limit})).enter().append("path").attr("class",function(t){return"dso "+t.properties.type}).attr("transform",function(t){return f(t.geometry.coordinates)}).attr("d",function(t){return v(t.properties)}).attr("style",function(t){return u(t.geometry.coordinates)}),void(x.dsos.names&&I.selectAll(".dsonames").data(a.features.filter(function(t){return 999==t.properties.mag&&Math.sqrt(parseInt(t.properties.dim))>x.dsos.namelimit||999!=t.properties.mag&&t.properties.mag<=x.dsos.namelimit})).enter().append("text").attr("class",function(t){return"dsoname "+t.properties.type}).attr("transform",function(t){return f(t.geometry.coordinates)}).text(function(t){return b(t.properties)}).attr({dy:"-.5em",dx:".35em"}).attr("style",function(t){return u(t.geometry.coordinates)})))}),this.data.length>0&&this.data.forEach(function(t){n(t,"file")?d3.json(t.file,t.callback):setTimeout(t.callback,0)},this),d3.select(window).on("resize",a),this.svg=I,this.clip=s,this.point=f,this.opacity=u,this.map=J,this.mapProjection=H,this.resize=function(){a()}}},i.projection=function(t){var a,e,r;if(!n(h,t))throw new Error("Projection not supported: "+t);return a=h[t],e=null!==a.arg?d3.geo[t].raw(a.arg):d3.geo[t].raw,r=function(t,a){var r=e(-t,a);return r},r.invert=function(t,a){var r=e.invert(t,a);return r[0]*=-1,r},d3.geo.projection(r)};var o={equatorial:[0,0,0],ecliptic:[0,0,23.4393],galactic:[93.5949,28.9362,-58.5988],supergalactic:[137.31,59.5283,57.7303]},l={equatorial:[0,90],ecliptic:[-90,66.5607],galactic:[-167.1405,27.1283],supergalactic:[-76.2458,15.7089]};i.eulerAngles=function(){return o},i.poles=function(){return l};var s=2*Math.PI,c=Math.PI/2,f=Math.PI/180;i.graticule=function(a,e,r){var n;if(r&&"equatorial"!=r){for(n=10;170>=n;n+=10)a.append("path").datum(d3.geo.circle().angle([n]).origin(l[r])).attr("class","gridline").attr("d",e);for(n=10;180>=n;n+=10)a.append("path").datum(d3.geo.circle().angle([90]).origin(t([n,0],u["inverse "+r]))).attr("class","gridline").attr("d",e)}};var u={ecliptic:[-90,23.4393,90],"inverse ecliptic":[90,23.4393,-90],galactic:[-167.1405,62.8717,122.9319],"inverse galactic":[122.9319,62.8717,-167.1405],supergalactic:[283.7542,74.2911,26.4504],"inverse supergalactic":[26.4504,74.2911,283.7542],init:function(){for(var t in this)this[t].constructor==Array&&(this[t]=this[t].map(function(t){return t*f}))},add:function(t,a){return a&&t&&3===a.length&&!this.hasOwnProperty(t)?(this[t]=a.map(function(t){return t*f}),this[t]):void 0}};u.init(),i.euler=function(){return u},i.add=function(t){var a={};return n(t,"type")?"dso"!==t.type||n(t,"file")&&n(t,"callback")?"line"!==t.type||n(t,"callback")?(n(t,"file")&&(a.file=t.file),a.type=t.type,n(t,"callback")&&(a.callback=t.callback),n(t,"redraw")&&(a.redraw=t.redraw),void i.data.push(a)):console.log("Can't add line"):console.log("Can't add data file"):console.log("Missing type")};var d={width:0,projection:"aitoff",transform:"equatorial",center:null,background:"#000000",adaptable:!0,interactive:!0,container:"map",datapath:"data/",stars:{show:!0,limit:6,colors:!0,color:"#ffffff",names:!0,proper:!1,desig:!0,namelimit:2.5,size:7,data:"stars.6.json"},dsos:{show:!0,limit:6,names:!0,desig:!0,namelimit:4,data:"dsos.bright.json"},constellations:{show:!0,names:!0,desig:!0,lines:!0,bounds:!1},mw:{show:!0},lines:{graticule:!0,equatorial:!0,ecliptic:!0,galactic:!1,supergalactic:!1,mars:!1},set:function(t){var a,e,r={};if(!t)return this;for(a in this)if(n(this,a)&&"function"!=typeof this[a])if(n(t,a)&&null!==t[a])if(null===this[a]||this[a].constructor!=Object)r[a]=t[a];else{r[a]={};for(e in this[a])r[a][e]=n(t[a],e)?t[a][e]:this[a][e]}else r[a]=this[a];return r}};i.settings=function(){return d};var g={gg:"circle",g:"ellipse",s:"ellipse",s0:"ellipse",sd:"ellipse",e:"ellipse",i:"ellipse",oc:"circle",gc:"circle",en:"square",bn:"square",sfr:"square",rn:"square",pn:"diamond",snr:"diamond",dn:"square",pos:"marker"},p=d3.scale.quantize().domain([3.347,-.335]).range(["#ff4700","#ff4b00","#ff4f00","#ff5300","#ff5600","#ff5900","#ff5b00","#ff5d00","#ff6000","#ff6300","#ff6500","#ff6700","#ff6900","#ff6b00","#ff6d00","#ff7000","#ff7300","#ff7500","#ff7800","#ff7a00","#ff7c00","#ff7e00","#ff8100","#ff8300","#ff8506","#ff870a","#ff8912","#ff8b1a","#ff8e21","#ff9127","#ff932c","#ff9631","#ff9836","#ff9a3c","#ff9d3f","#ffa148","#ffa34b","#ffa54f","#ffa753","#ffa957","#ffab5a","#ffad5e","#ffb165","#ffb269","#ffb46b","#ffb872","#ffb975","#ffbb78","#ffbe7e","#ffc184","#ffc489","#ffc78f","#ffc892","#ffc994","#ffcc99","#ffce9f","#ffd1a3","#ffd3a8","#ffd5ad","#ffd7b1","#ffd9b6","#ffdbba","#ffddbe","#ffdfc2","#ffe1c6","#ffe3ca","#ffe4ce","#ffe8d5","#ffe9d9","#ffebdc","#ffece0","#ffefe6","#fff0e9","#fff2ec","#fff4f2","#fff5f5","#fff6f8","#fff9fd","#fef9ff","#f9f6ff","#f6f4ff","#f3f2ff","#eff0ff","#ebeeff","#e9edff","#e6ebff","#e3e9ff","#e0e7ff","#dee6ff","#dce5ff","#d9e3ff","#d7e2ff","#d3e0ff","#c9d9ff","#bfd3ff","#b7ceff","#afc9ff","#a9c5ff","#a4c2ff","#9fbfff","#9bbcff"]),h={airy:{arg:Math.PI/2,scale:360,ratio:1,clip:!0},aitoff:{arg:null,scale:162},armadillo:{arg:0,scale:250},august:{arg:null,scale:94,ratio:1.4},azimuthalEqualArea:{arg:null,scale:340,ratio:1,clip:!0},azimuthalEquidistant:{arg:null,scale:320,ratio:1,clip:!0},baker:{arg:null,scale:160,ratio:1.4},berghaus:{arg:1,scale:320,ratio:1,clip:!0},boggs:{arg:null,scale:170},bonne:{arg:Math.PI/4,scale:230,ratio:.88},bromley:{arg:null,scale:162},collignon:{arg:null,scale:100,ratio:2.6},craig:{arg:0,scale:310,ratio:1.5,clip:!0},craster:{arg:null,scale:160},cylindricalEqualArea:{arg:Math.PI/6,scale:190,ratio:2.3},cylindricalStereographic:{arg:Math.PI/4,scale:230,ratio:1.3},eckert1:{arg:null,scale:175},eckert2:{arg:null,scale:175},eckert3:{arg:null,scale:190},eckert4:{arg:null,scale:190},eckert5:{arg:null,scale:182},eckert6:{arg:null,scale:182},eisenlohr:{arg:null,scale:102},equirectangular:{arg:null,scale:165},fahey:{arg:null,scale:196,ratio:1.4},foucaut:{arg:null,scale:142},ginzburg4:{arg:null,scale:180,ratio:1.7},ginzburg5:{arg:null,scale:196,ratio:1.55},ginzburg6:{arg:null,scale:190,ratio:1.4},ginzburg8:{arg:null,scale:205,ratio:1.3},ginzburg9:{arg:null,scale:190,ratio:1.4},hammer:{arg:2,scale:180},hatano:{arg:null,scale:186},healpix:{arg:1,scale:320,ratio:1.2},hill:{arg:2,scale:195,ratio:1.5},homolosine:{arg:null,scale:160,ratio:2.2},kavrayskiy7:{arg:null,scale:185,ratio:1.75},lagrange:{arg:Math.PI/4,scale:88,ratio:2,clip:!1},larrivee:{arg:null,scale:160,ratio:1.25},laskowski:{arg:null,scale:165,ratio:1.7},loximuthal:{arg:Math.PI/4,scale:175,ratio:1.8},mercator:{arg:null,scale:160,ratio:1.3},miller:{arg:null,scale:160,ratio:1.5},mollweide:{arg:null,scale:180},mtFlatPolarParabolic:{arg:null,scale:175},mtFlatPolarQuartic:{arg:null,scale:230,ratio:1.65},mtFlatPolarSinusoidal:{arg:null,scale:175,ratio:1.9},naturalEarth:{arg:null,scale:185,ratio:1.85},nellHammer:{arg:null,scale:160,ratio:2.6},orthographic:{arg:null,scale:480,ratio:1,clip:!0},patterson:{arg:null,scale:160,ratio:1.75},polyconic:{arg:null,scale:160,ratio:1.3},rectangularPolyconic:{arg:0,scale:160,ratio:1.65},robinson:{arg:null,scale:160},sinusoidal:{arg:null,scale:160,ratio:2},stereographic:{arg:null,scale:500,ratio:1,clip:!0},times:{arg:null,scale:210,ratio:1.4},twoPointEquidistant:{arg:Math.PI/2,scale:320,ratio:1.15,clip:!0},vanDerGrinten:{arg:null,scale:160,ratio:1},vanDerGrinten2:{arg:null,scale:160,ratio:1},vanDerGrinten3:{arg:null,scale:160,ratio:1},vanDerGrinten4:{arg:null,scale:160,ratio:1.6},wagner4:{arg:null,scale:185},wagner6:{arg:null,scale:160},wagner7:{arg:null,scale:190,ratio:1.8},wiechel:{arg:null,scale:360,ratio:1,clip:!0},winkel3:{arg:null,scale:196,ratio:1.7}};i.projections=function(){return h};var m=d3.map({ellipse:function(t){var a=Math.sqrt(t),e=.666*a,r=a/3;return"M"+-e+","+-r+" m"+-e+",0 a"+e+","+r+" 0 1,0"+2*e+",0 a"+e+","+r+" 0 1,0"+-(2*e)+",0"},marker:function(t){var a=t>48?t/4:12,e=a/2,r=e-3;return"M "+-e+" 0 h "+r+" M 0 "+-e+" v "+r+" M "+e+" 0 h "+-r+" M 0 "+e+" v "+-r},"cross-circle":function(t){var a=Math.sqrt(t),e=a/2;return"M"+-e+","+-e+" m"+-e+",0 a"+e+","+e+" 0 1,0"+2*e+",0 a"+e+","+e+" 0 1,0"+-(2*e)+",0 M"+-e+" 0 h "+a+" M 0 "+-e+" v "+a},"stroke-circle":function(t){var a=Math.sqrt(t),e=a/2;return"M"+-e+","+-e+" m"+-e+",0 a"+e+","+e+" 0 1,0"+2*e+",0 a"+e+","+e+" 0 1,0"+-(2*e)+",0 M"+(-a-2)+","+(-a-2)+" l"+(a+4)+","+(a+4)}});d3.svg.customSymbol=function(){function t(t,r){return m.get(a.call(this,t,r))(e.call(this,t,r))}var a,e=64;return t.type=function(e){return arguments.length?(a=d3.functor(e),t):a},t.size=function(a){return arguments.length?(e=d3.functor(a),t):e},t},function(){function t(t,a,e){var r=t.translate(),n=Math.atan2(a[1]-r[1],a[0]-r[0])-Math.atan2(e[1]-r[1],e[0]-r[0]);return[Math.cos(n/2),0,0,Math.sin(n/2)]}function a(t,a){var e=t.invert(a);return e&&isFinite(e[0])&&isFinite(e[1])&&l(e)}function e(t){var a=.5*t[0]*u,e=.5*t[1]*u,r=.5*t[2]*u,n=Math.sin(a),i=Math.cos(a),o=Math.sin(e),l=Math.cos(e),s=Math.sin(r),c=Math.cos(r);return[i*l*c+n*o*s,n*l*c-i*o*s,i*o*c+n*l*s,i*l*s-n*o*c]}function r(t,a){var e=t[0],r=t[1],n=t[2],i=t[3],o=a[0],l=a[1],s=a[2],c=a[3];return[e*o-r*l-n*s-i*c,e*l+r*o+n*c-i*s,e*s-r*c+n*o+i*l,e*c+r*s-n*l+i*o]}function n(t,a){if(t&&a){var e=c(t,a),r=Math.sqrt(s(e,e)),n=.5*Math.acos(Math.max(-1,Math.min(1,s(t,a)))),i=Math.sin(n)/r;return r&&[Math.cos(n),e[2]*i,-e[1]*i,e[0]*i]}}function i(t,a){var e=Math.max(-1,Math.min(1,s(t,a))),r=0>e?-1:1,n=Math.acos(r*e),i=Math.sin(n);return i?function(e){var o=r*Math.sin((1-e)*n)/i,l=Math.sin(e*n)/i;return[t[0]*o+a[0]*l,t[1]*o+a[1]*l,t[2]*o+a[2]*l,t[3]*o+a[3]*l]}:function(){return t}}function o(t){return[Math.atan2(2*(t[0]*t[1]+t[2]*t[3]),1-2*(t[1]*t[1]+t[2]*t[2]))*d,Math.asin(Math.max(-1,Math.min(1,2*(t[0]*t[2]-t[3]*t[1]))))*d,Math.atan2(2*(t[0]*t[3]+t[1]*t[2]),1-2*(t[2]*t[2]+t[3]*t[3]))*d]}function l(t){var a=t[0]*u,e=t[1]*u,r=Math.cos(e);return[r*Math.cos(a),r*Math.sin(a),Math.sin(e)]}function s(t,a){for(var e=0,r=t.length,n=0;r>e;++e)n+=t[e]*a[e];return n}function c(t,a){return[t[1]*a[2]-t[2]*a[1],t[2]*a[0]-t[0]*a[2],t[0]*a[1]-t[1]*a[0]]}function f(t){for(var a=0,e=arguments.length,r=[];++a<e;)r.push(arguments[a]);var n=d3.dispatch.apply(null,r);return n.of=function(a,e){return function(r){try{var i=r.sourceEvent=d3.event;r.target=t,d3.event=r,n[r.type].apply(a,e)}finally{d3.event=i}}},n}var u=Math.PI/180,d=180/Math.PI;d3.geo.zoom=function(){function s(t){h++||t({type:"zoomstart"})}function c(t){t({type:"zoom"})}function u(t){--h||t({type:"zoomend"})}var d,g,p,h=0,m=f(v,"zoomstart","zoom","zoomend"),v=d3.behavior.zoom().on("zoomstart",function(){var i=d3.mouse(this),l=e(d.rotate()),f=a(d,i);f&&(p=f),M.call(v,"zoom",function(){d.scale(y.k=d3.event.scale);var e=d3.mouse(this),s=n(p,a(d,e));d.rotate(y.r=o(l=s?r(l,s):r(t(d,i,e),l))),i=e,c(m.of(this,arguments))}),s(m.of(this,arguments))}).on("zoomend",function(){M.call(v,"zoom",null),u(m.of(this,arguments))}),M=v.on,y={r:[0,0,0],k:1};return v.rotateTo=function(t){var a=n(l(t),l([-y.r[0],-y.r[1]]));return o(r(e(y.r),a))},v.projection=function(t){return arguments.length?(d=t,y={r:d.rotate(),k:d.scale()},v.scale(y.k)):d},v.duration=function(t){return arguments.length?(g=t,v):g},v.event=function(t){t.each(function(){var t=d3.select(this),a=m.of(this,arguments),r=y,n=d3.transition(t);if(n!==t){n.each("start.zoom",function(){this.__chart__&&(y=this.__chart__),d.rotate(y.r).scale(y.k),s(a)}).tween("zoom:zoom",function(){var t=v.size()[0],l=i(e(y.r),e(r.r)),s=d3.geo.distance(y.r,r.r),f=d3.interpolateZoom([0,0,t/y.k],[s,0,t/r.k]);return g&&n.duration(g(.001*f.duration)),function(e){var r=f(e);this.__chart__=y={r:o(l(r[0]/s)),k:t/r[2]},d.rotate(y.r).scale(y.k),v.scale(y.k),c(a)}}).each("end.zoom",function(){u(a)});try{n.each("interrupt.zoom",function(){u(a)})}catch(l){console.log(l)}}else this.__chart__=y,s(a),c(a),u(a)})},d3.rebind(v,m,"on")}}(),this.Celestial=i}();