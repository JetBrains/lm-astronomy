{"ast":null,"code":"// Copyright 2015-2020 Olaf Frohn https://github.com/ofrohn, see LICENSE\n!function () {\n  var Celestial = {\n    version: '0.7.35',\n    container: null,\n    data: []\n  };\n  var ANIMDISTANCE = 0.035,\n    // Rotation animation threshold, ~2deg in radians\n    ANIMSCALE = 1.4,\n    // Zoom animation threshold, scale factor\n    ANIMINTERVAL_R = 2000,\n    // Rotation duration scale in ms\n    ANIMINTERVAL_P = 2500,\n    // Projection duration in ms\n    ANIMINTERVAL_Z = 1500,\n    // Zoom duration scale in ms\n    zoomextent = 10,\n    // Default maximum extent of zoom (max/min)\n    zoomlevel = 1; // Default zoom level, 1 = 100%\n\n  var cfg,\n    mapProjection,\n    parentElement,\n    zoom,\n    map,\n    circle,\n    daylight,\n    starnames = {},\n    dsonames = {};\n\n  // Show it all, with the given config, otherwise with default settings\n  Celestial.display = function (config) {\n    var animationID,\n      container = Celestial.container,\n      animations = [],\n      current = 0,\n      repeat = false;\n\n    //Mash config with default settings, todo: if globalConfig exists, make another one\n    cfg = settings.set(config).applyDefaults(config);\n    if (isNumber(cfg.zoomextend)) zoomextent = cfg.zoomextend;\n    if (isNumber(cfg.zoomlevel)) zoomlevel = cfg.zoomlevel;\n    //if (cfg.disableAnimations) ANIMDISTANCE = Infinity;\n\n    var parent = document.getElementById(cfg.container);\n    if (parent) {\n      parentElement = \"#\" + cfg.container;\n      var st = window.getComputedStyle(parent, null);\n      if (!parseInt(st.width) && !cfg.width) parent.style.width = px(parent.parentNode.clientWidth);\n    } else {\n      parentElement = \"body\";\n      parent = null;\n    }\n    var margin = [16, 16],\n      width = getWidth(),\n      canvaswidth = isNumber(cfg.background.width) ? width + cfg.background.width : width,\n      pixelRatio = window.devicePixelRatio || 1,\n      projectionSetting = getProjection(cfg.projection, cfg.projectionRatio);\n    if (!projectionSetting) return;\n    if (cfg.lines.graticule.lat && cfg.lines.graticule.lat.pos[0] === \"outline\") projectionSetting.scale -= 2;\n    var ratio = projectionSetting.ratio,\n      height = Math.round(width / ratio),\n      canvasheight = Math.round(canvaswidth / ratio),\n      scale = projectionSetting.scale * width / 1024,\n      starbase = cfg.stars.size,\n      dsobase = cfg.dsos.size || starbase,\n      starexp = cfg.stars.exponent,\n      dsoexp = cfg.dsos.exponent || starexp,\n      //Object size base & exponent\n      adapt = 1,\n      rotation = getAngles(cfg.center),\n      path = cfg.datapath;\n    if (parentElement !== \"body\") parent.style.height = px(canvasheight);\n    mapProjection = Celestial.projection(cfg.projection).rotate(rotation).translate([canvaswidth / 2, canvasheight / 2]).scale(scale * zoomlevel);\n    zoom = d3.geo.zoom().projection(mapProjection).center([canvaswidth / 2, canvasheight / 2]).scaleExtent([scale, scale * zoomextent]).on(\"zoom.redraw\", redraw);\n    // Set initial zoom level\n    scale *= zoomlevel;\n    var canvas = d3.select(parentElement).selectAll(\"canvas\"),\n      culture = cfg.culture !== \"\" && cfg.culture !== \"iau\" ? cfg.culture : \"\";\n    if (canvas[0].length === 0) canvas = d3.select(parentElement).append(\"canvas\");\n    //canvas.attr(\"width\", width).attr(\"height\", height);\n    canvas.style(\"width\", px(canvaswidth)).style(\"height\", px(canvasheight)).attr(\"width\", canvaswidth * pixelRatio).attr(\"height\", canvasheight * pixelRatio);\n    var context = canvas.node().getContext(\"2d\");\n    context.setTransform(pixelRatio, 0, 0, pixelRatio, 0, 0);\n    var graticule = d3.geo.graticule().minorStep([15, 10]);\n    map = d3.geo.path().projection(mapProjection).context(context);\n\n    //parent div with id #celestial-map or body\n    if (container) container.selectAll(parentElement + \" *\").remove();else container = d3.select(parentElement).append(\"container\");\n    if (cfg.interactive) {\n      canvas.call(zoom);\n      d3.select(parentElement).on('dblclick', function () {\n        zoomBy(1.5625);\n        return false;\n      });\n    } else {\n      canvas.attr(\"style\", \"cursor: default!important\");\n    }\n    setClip(projectionSetting.clip);\n    d3.select(window).on('resize', resize);\n    if (cfg.interactive === true && cfg.controls === true && $(\"celestial-zoomin\") === null) {\n      d3.select(parentElement).append(\"input\").attr(\"type\", \"button\").attr(\"id\", \"celestial-zoomin\").attr(\"value\", \"\\u002b\").on(\"click\", function () {\n        zoomBy(1.25);\n        return false;\n      });\n      d3.select(parentElement).append(\"input\").attr(\"type\", \"button\").attr(\"id\", \"celestial-zoomout\").attr(\"value\", \"\\u2212\").on(\"click\", function () {\n        zoomBy(0.8);\n        return false;\n      });\n    }\n    circle = d3.geo.circle().angle([90]);\n    daylight = d3.geo.circle().angle([179.9]);\n    form(cfg);\n    if ($(\"error\") === null) d3.select(\"body\").append(\"div\").attr(\"id\", \"error\");\n    if ($(\"loc\") === null) geo(cfg);else if (cfg.location === true && cfg.follow === \"zenith\") rotate({\n      center: Celestial.zenith()\n    });\n    if (cfg.location === true || cfg.formFields.location === true) {\n      d3.select(parentElement + \" #location\").style(\"display\", \"inline-block\");\n      fldEnable(\"horizon-show\", projectionSetting.clip);\n      fldEnable(\"daylight-show\", !projectionSetting.clip);\n    }\n    function load() {\n      //Background\n      setClip(projectionSetting.clip);\n      container.append(\"path\").datum(graticule.outline).attr(\"class\", \"outline\");\n      container.append(\"path\").datum(circle).attr(\"class\", \"horizon\");\n      container.append(\"path\").datum(daylight).attr(\"class\", \"daylight\");\n      //Celestial planes\n      if (cfg.transform === \"equatorial\") graticule.minorStep([15, 10]);else graticule.minorStep([10, 10]);\n      for (var key in cfg.lines) {\n        if (!has(cfg.lines, key)) continue;\n        if (key === \"graticule\") {\n          container.append(\"path\").datum(graticule).attr(\"class\", \"graticule\");\n          if (has(cfg.lines.graticule, \"lon\") && cfg.lines.graticule.lon.pos.length > 0) container.selectAll(parentElement + \" .gridvalues_lon\").data(getGridValues(\"lon\", cfg.lines.graticule.lon.pos)).enter().append(\"path\").attr(\"class\", \"graticule_lon\");\n          if (has(cfg.lines.graticule, \"lat\") && cfg.lines.graticule.lat.pos.length > 0) container.selectAll(parentElement + \" .gridvalues_lat\").data(getGridValues(\"lat\", cfg.lines.graticule.lat.pos)).enter().append(\"path\").attr(\"class\", \"graticule_lat\");\n        } else {\n          container.append(\"path\").datum(d3.geo.circle().angle([90]).origin(transformDeg(poles[key], euler[cfg.transform]))).attr(\"class\", key);\n        }\n      }\n\n      //Milky way outline\n      d3.json(path + \"mw.json\", function (error, json) {\n        if (error) {\n          window.alert(\"Data file could not be loaded or doesn't exist. See readme.md\");\n          return console.warn(error);\n        }\n        var mw = getData(json, cfg.transform);\n        var mw_back = getMwbackground(mw);\n        container.selectAll(parentElement + \" .mway\").data(mw.features).enter().append(\"path\").attr(\"class\", \"mw\");\n        container.selectAll(parentElement + \" .mwaybg\").data(mw_back.features).enter().append(\"path\").attr(\"class\", \"mwbg\");\n        redraw();\n      });\n\n      //Constellation names or designation\n      d3.json(path + filename(\"constellations\"), function (error, json) {\n        if (error) return console.warn(error);\n        var con = getData(json, cfg.transform);\n        container.selectAll(parentElement + \" .constnames\").data(con.features).enter().append(\"text\").attr(\"class\", \"constname\");\n        Celestial.constellations = getConstellationList(con);\n        redraw();\n      });\n\n      //Constellation boundaries\n      d3.json(path + filename(\"constellations\", \"borders\"), function (error, json) {\n        if (error) return console.warn(error);\n\n        //var cb = getData(topojson.feature(json, json.objects.constellations_bounds), cfg.transform);\n        var cb = getData(json, cfg.transform);\n        container.selectAll(parentElement + \" .bounds\").data(cb.features).enter().append(\"path\").attr(\"class\", \"boundaryline\");\n        redraw();\n      });\n\n      //Constellation lines\n      d3.json(path + filename(\"constellations\", \"lines\"), function (error, json) {\n        if (error) return console.warn(error);\n        var conl = getData(json, cfg.transform);\n        container.selectAll(parentElement + \" .lines\").data(conl.features).enter().append(\"path\").attr(\"class\", \"constline\");\n        listConstellations();\n        redraw();\n      });\n\n      //Stars\n      d3.json(path + cfg.stars.data, function (error, json) {\n        if (error) return console.warn(error);\n        var st = getData(json, cfg.transform);\n        container.selectAll(parentElement + \" .stars\").data(st.features).enter().append(\"path\").attr(\"class\", \"star\");\n        redraw();\n      });\n\n      //Star names\n      d3.json(path + filename(\"starnames\"), function (error, json) {\n        if (error) return console.warn(error);\n        Object.assign(starnames, json);\n        redraw();\n      });\n\n      //Deep space objects\n      d3.json(path + cfg.dsos.data, function (error, json) {\n        if (error) return console.warn(error);\n        var ds = getData(json, cfg.transform);\n        container.selectAll(parentElement + \" .dsos\").data(ds.features).enter().append(\"path\").attr(\"class\", \"dso\");\n        redraw();\n      });\n\n      //DSO names\n      d3.json(path + filename(\"dsonames\"), function (error, json) {\n        if (error) return console.warn(error);\n        Object.assign(dsonames, json);\n        redraw();\n      });\n\n      //Planets, Sun & Moon\n      d3.json(path + filename(\"planets\"), function (error, json) {\n        if (error) return console.warn(error);\n        var pl = getPlanets(json, cfg.transform);\n        container.selectAll(parentElement + \" .planets\").data(pl).enter().append(\"path\").attr(\"class\", \"planet\");\n        redraw();\n      });\n      if (Celestial.data.length > 0) {\n        Celestial.data.forEach(function (d) {\n          if (has(d, \"file\")) d3.json(d.file, d.callback);else setTimeout(d.callback, 0);\n        }, this);\n      }\n      if (cfg.lang && cfg.lang != \"\") apply(Celestial.setLanguage(cfg.lang));\n      //redraw();\n    }\n\n    // Zoom by factor; >1 larger <1 smaller \n    function zoomBy(factor) {\n      if (!factor || factor === 1) return;\n      var sc0 = mapProjection.scale(),\n        sc1 = sc0 * factor,\n        ext = zoom.scaleExtent(),\n        interval = ANIMINTERVAL_Z * Math.sqrt(Math.abs(1 - factor));\n      if (sc1 < ext[0]) sc1 = ext[0];\n      if (sc1 > ext[1]) sc1 = ext[1];\n      if (cfg.disableAnimations === true) {\n        mapProjection.scale(sc1);\n        zoom.scale(sc1);\n        redraw();\n        return 0;\n      }\n      var zTween = d3.interpolateNumber(sc0, sc1);\n      d3.select({}).transition().duration(interval).tween(\"scale\", function () {\n        return function (t) {\n          var z = zTween(t);\n          mapProjection.scale(z);\n          redraw();\n        };\n      }).transition().duration(0).tween(\"scale\", function () {\n        zoom.scale(sc1);\n        redraw();\n      });\n      return interval;\n    }\n    function apply(config) {\n      cfg = settings.set(config);\n      redraw();\n    }\n    function rotate(config) {\n      var cFrom = cfg.center,\n        rot = mapProjection.rotate(),\n        sc = mapProjection.scale(),\n        interval = ANIMINTERVAL_R,\n        keep = false,\n        cTween,\n        zTween,\n        oTween,\n        oof = cfg.orientationfixed;\n      if (Round(rot[1], 1) === -Round(config.center[1], 1)) keep = true; //keep lat fixed if equal\n      cfg = cfg.set(config);\n      var d = Round(d3.geo.distance(cFrom, cfg.center), 2);\n      var o = d3.geo.distance([cFrom[2], 0], [cfg.center[2], 0]);\n      if (d < ANIMDISTANCE && o < ANIMDISTANCE || cfg.disableAnimations === true) {\n        rotation = getAngles(cfg.center);\n        mapProjection.rotate(rotation);\n        redraw();\n        return 0;\n      }\n      // Zoom interpolator\n      if (sc > scale * ANIMSCALE) zTween = d3.interpolateNumber(sc, scale);else zTween = function () {\n        return sc;\n      };\n      // Orientation interpolator\n      if (o === 0) oTween = function () {\n        return rot[2];\n      };else oTween = interpolateAngle(cFrom[2], cfg.center[2]);\n      if (d > 3.14) cfg.center[0] -= 0.01; //180deg turn doesn't work well\n      cfg.orientationfixed = false;\n      // Rotation interpolator\n      if (d === 0) cTween = function () {\n        return cfg.center;\n      };else cTween = d3.geo.interpolate(cFrom, cfg.center);\n      interval = d !== 0 ? interval * d : interval * o; // duration scaled by ang. distance\n      d3.select({}).transition().duration(interval).tween(\"center\", function () {\n        return function (t) {\n          var c = getAngles(cTween(t));\n          c[2] = oTween(t);\n          var z = t < 0.5 ? zTween(t) : zTween(1 - t);\n          if (keep) c[1] = rot[1];\n          mapProjection.scale(z);\n          mapProjection.rotate(c);\n          redraw();\n        };\n      }).transition().duration(0).tween(\"center\", function () {\n        cfg.orientationfixed = oof;\n        rotation = getAngles(cfg.center);\n        mapProjection.rotate(rotation);\n        redraw();\n      });\n      return interval;\n    }\n    function resize(set) {\n      width = getWidth();\n      if (cfg.width === width && !set) return;\n      height = width / ratio;\n      canvaswidth = isNumber(cfg.background.width) ? width + cfg.background.width : width;\n      canvasheight = Math.round(canvaswidth / ratio);\n      scale = projectionSetting.scale * width / 1024;\n      //canvas.attr(\"width\", width).attr(\"height\", height);\n      canvas.style(\"width\", px(canvaswidth)).style(\"height\", px(canvasheight)).attr(\"width\", canvaswidth * pixelRatio).attr(\"height\", canvasheight * pixelRatio);\n      zoom.scaleExtent([scale, scale * zoomextent]).scale(scale * zoomlevel);\n      mapProjection.translate([canvaswidth / 2, canvasheight / 2]).scale(scale * zoomlevel);\n      if (parent) parent.style.height = px(height);\n      scale *= zoomlevel;\n      redraw();\n    }\n    function reproject(config) {\n      var prj = getProjection(config.projection, config.projectionRatio);\n      if (!prj) return;\n      var rot = mapProjection.rotate(),\n        ctr = mapProjection.center(),\n        sc = mapProjection.scale(),\n        ext = zoom.scaleExtent(),\n        clip = [],\n        prjFrom = Celestial.projection(cfg.projection).center(ctr).translate([canvaswidth / 2, canvasheight / 2]).scale([ext[0]]),\n        interval = ANIMINTERVAL_P,\n        delay = 0,\n        clipTween = null,\n        rTween = d3.interpolateNumber(ratio, prj.ratio);\n      if (projectionSetting.clip != prj.clip || cfg.disableAnimations === true) {\n        interval = 0; // Different clip = no transition\n      }\n      /*if (projectionSetting.clip !== prj.clip) {\r\n        clipTween = d3.interpolateNumber(projectionSetting.clip ? 90 : 180, prj.clip ? 90 : 180); // Clipangle from - to\r\n      } else*/\n      setClip(prj.clip);\n      var prjTo = Celestial.projection(config.projection).center(ctr).translate([canvaswidth / 2, canvaswidth / prj.ratio / 2]).scale([prj.scale * width / 1024]);\n      var bAdapt = cfg.adaptable;\n      if (sc > ext[0]) {\n        delay = zoomBy(0.1);\n        setTimeout(reproject, delay, config);\n        return delay + interval;\n      }\n      if (cfg.location || cfg.formFields.location) {\n        fldEnable(\"horizon-show\", prj.clip);\n        fldEnable(\"daylight-show\", !prj.clip);\n      }\n      mapProjection = projectionTween(prjFrom, prjTo);\n      cfg.adaptable = false;\n      d3.select({}).transition().duration(interval).tween(\"projection\", function () {\n        return function (_) {\n          mapProjection.alpha(_).rotate(rot);\n          map.projection(mapProjection);\n          /*if (clipTween) mapProjection.clipAngle(clipTween(_));\r\n          else*/\n          setClip(prj.clip);\n          ratio = rTween(_);\n          height = width / ratio;\n          //canvas.attr(\"width\", width).attr(\"height\", height);\n          canvas.style(\"width\", px(canvaswidth)).style(\"height\", px(canvasheight)).attr(\"width\", canvaswidth * pixelRatio).attr(\"height\", canvasheight * pixelRatio);\n          if (parent) parent.style.height = px(canvasheight);\n          redraw();\n        };\n      }).transition().duration(0).tween(\"projection\", function () {\n        projectionSetting = prj;\n        ratio = projectionSetting.ratio;\n        height = width / projectionSetting.ratio;\n        canvasheight = isNumber(cfg.background.width) ? height + cfg.background.width : height;\n        scale = projectionSetting.scale * width / 1024;\n        //canvas.attr(\"width\", width).attr(\"height\", height);\n        canvas.style(\"width\", px(canvaswidth)).style(\"height\", px(canvasheight)).attr(\"width\", canvaswidth * pixelRatio).attr(\"height\", canvasheight * pixelRatio);\n        if (parent) parent.style.height = px(canvasheight);\n        cfg.projection = config.projection;\n        mapProjection = Celestial.projection(config.projection).rotate(rot).translate([canvaswidth / 2, canvasheight / 2]).scale(scale * zoomlevel);\n        map.projection(mapProjection);\n        setClip(projectionSetting.clip);\n        zoom.projection(mapProjection).scaleExtent([scale, scale * zoomextent]).scale(scale * zoomlevel);\n        cfg.adaptable = bAdapt;\n        scale *= zoomlevel;\n        redraw();\n      });\n      return interval;\n    }\n    function redraw() {\n      var rot = mapProjection.rotate();\n      context.setTransform(pixelRatio, 0, 0, pixelRatio, 0, 0);\n      if (cfg.adaptable) adapt = Math.sqrt(mapProjection.scale() / scale);\n      if (!adapt) adapt = 1;\n      starbase = cfg.stars.size;\n      starexp = cfg.stars.exponent;\n      dsobase = cfg.dsos.size || starbase;\n      dsoexp = cfg.dsos.exponent;\n      if (cfg.orientationfixed && cfg.center.length > 2) {\n        rot[2] = cfg.center[2];\n        mapProjection.rotate(rot);\n      }\n      cfg.center = [-rot[0], -rot[1], rot[2]];\n      setCenter(cfg.center, cfg.transform);\n      clear();\n      drawOutline();\n\n      //Draw all types of objects on the canvas\n      if (cfg.mw.show) {\n        container.selectAll(parentElement + \" .mw\").each(function (d) {\n          setStyle(cfg.mw.style);\n          map(d);\n          context.fill();\n        });\n        // paint mw-outside in background color\n        if (cfg.transform !== \"supergalactic\" && cfg.background.opacity > 0.95) container.selectAll(parentElement + \" .mwbg\").each(function (d) {\n          setStyle(cfg.background);\n          map(d);\n          context.fill();\n        });\n      }\n      for (var key in cfg.lines) {\n        if (!has(cfg.lines, key)) continue;\n        if (cfg.lines[key].show !== true) continue;\n        setStyle(cfg.lines[key]);\n        container.selectAll(parentElement + \" .\" + key).attr(\"d\", map);\n        context.stroke();\n      }\n      if (has(cfg.lines.graticule, \"lon\")) {\n        setTextStyle(cfg.lines.graticule.lon);\n        container.selectAll(parentElement + \" .graticule_lon\").each(function (d, i) {\n          if (clip(d.geometry.coordinates)) {\n            var pt = mapProjection(d.geometry.coordinates);\n            gridOrientation(pt, d.properties.orientation);\n            context.fillText(d.properties.value, pt[0], pt[1]);\n          }\n        });\n      }\n      if (has(cfg.lines.graticule, \"lat\")) {\n        setTextStyle(cfg.lines.graticule.lat);\n        container.selectAll(parentElement + \" .graticule_lat\").each(function (d, i) {\n          if (clip(d.geometry.coordinates)) {\n            var pt = mapProjection(d.geometry.coordinates);\n            gridOrientation(pt, d.properties.orientation);\n            context.fillText(d.properties.value, pt[0], pt[1]);\n          }\n        });\n      }\n      if (cfg.constellations.bounds) {\n        container.selectAll(parentElement + \" .boundaryline\").each(function (d) {\n          setStyle(cfg.constellations.boundStyle);\n          if (Celestial.constellation) {\n            var re = new RegExp(\"\\\\b\" + Celestial.constellation + \"\\\\b\");\n            if (d.ids.search(re) !== -1) {\n              context.lineWidth *= 1.5;\n              context.globalAlpha = 1;\n              context.setLineDash([]);\n            }\n          }\n          map(d);\n          context.stroke();\n        });\n        context.setLineDash([]);\n      }\n      if (cfg.constellations.lines) {\n        container.selectAll(parentElement + \" .constline\").each(function (d) {\n          setStyleA(d.properties.rank, cfg.constellations.lineStyle);\n          map(d);\n          context.stroke();\n        });\n      }\n      drawOutline(true);\n      if (cfg.constellations.names) {\n        //setTextStyle(cfg.constellations.nameStyle);\n        container.selectAll(parentElement + \" .constname\").each(function (d) {\n          if (clip(d.geometry.coordinates)) {\n            setStyleA(d.properties.rank, cfg.constellations.nameStyle);\n            var pt = mapProjection(d.geometry.coordinates);\n            context.fillText(constName(d), pt[0], pt[1]);\n          }\n        });\n      }\n      if (cfg.stars.show) {\n        setStyle(cfg.stars.style);\n        container.selectAll(parentElement + \" .star\").each(function (d) {\n          if (clip(d.geometry.coordinates) && d.properties.mag <= cfg.stars.limit) {\n            var pt = mapProjection(d.geometry.coordinates),\n              r = starSize(d);\n            context.fillStyle = starColor(d);\n            context.beginPath();\n            context.arc(pt[0], pt[1], r, 0, 2 * Math.PI);\n            context.closePath();\n            context.fill();\n            if (cfg.stars.designation && d.properties.mag <= cfg.stars.designationLimit * adapt) {\n              setTextStyle(cfg.stars.designationStyle);\n              context.fillText(starDesignation(d.id), pt[0] + r, pt[1]);\n            }\n            if (cfg.stars.propername && d.properties.mag <= cfg.stars.propernameLimit * adapt) {\n              setTextStyle(cfg.stars.propernameStyle);\n              context.fillText(starPropername(d.id), pt[0] - r, pt[1]);\n            }\n          }\n        });\n      }\n      if (cfg.dsos.show) {\n        container.selectAll(parentElement + \" .dso\").each(function (d) {\n          if (clip(d.geometry.coordinates) && dsoDisplay(d.properties, cfg.dsos.limit)) {\n            var pt = mapProjection(d.geometry.coordinates),\n              type = d.properties.type;\n            if (cfg.dsos.colors === true) setStyle(cfg.dsos.symbols[type]);else setStyle(cfg.dsos.style);\n            var r = dsoSymbol(d, pt);\n            if (has(cfg.dsos.symbols[type], \"stroke\")) context.stroke();else context.fill();\n            if (cfg.dsos.names && dsoDisplay(d.properties, cfg.dsos.nameLimit * adapt)) {\n              setTextStyle(cfg.dsos.nameStyle);\n              if (cfg.dsos.colors === true) context.fillStyle = cfg.dsos.symbols[type].fill;\n              context.fillText(dsoName(d), pt[0] + r, pt[1] - r);\n            }\n          }\n        });\n      }\n      if ((cfg.location || cfg.formFields.location) && cfg.planets.show && Celestial.origin) {\n        var dt = Celestial.date(),\n          o = Celestial.origin(dt).spherical();\n        container.selectAll(parentElement + \" .planet\").each(function (d) {\n          var id = d.id(),\n            r = 12 * adapt,\n            p = d(dt).equatorial(o),\n            pos = transformDeg(p.ephemeris.pos, euler[cfg.transform]); //transform; \n          if (clip(pos)) {\n            var pt = mapProjection(pos),\n              sym = cfg.planets.symbols[id];\n            if (cfg.planets.symbolType === \"letter\") {\n              setTextStyle(cfg.planets.symbolStyle);\n              context.fillStyle = sym.fill;\n              context.fillText(sym.letter, pt[0], pt[1]);\n            } else if (id === \"lun\") {\n              if (has(sym, \"size\") && isNumber(sym.size)) r = sym.size * adapt;\n              context.fillStyle = sym.fill;\n              Canvas.symbol().type(\"crescent\").size(r * r).age(p.ephemeris.age).position(pt)(context);\n            } else if (cfg.planets.symbolType === \"disk\") {\n              r = has(sym, \"size\") && isNumber(sym.size) ? sym.size * adapt : planetSize(p.ephemeris);\n              context.fillStyle = sym.fill;\n              Canvas.symbol().type(\"circle\").size(r * r).position(pt)(context);\n              context.fill();\n            } else if (cfg.planets.symbolType === \"symbol\") {\n              setTextStyle(cfg.planets.symbolStyle);\n              context.font = planetSymbol(cfg.planets.symbolStyle.font);\n              context.fillStyle = sym.fill;\n              context.fillText(sym[cfg.planets.symbolType], pt[0], pt[1]);\n            }\n            //name\n            if (cfg.planets.names) {\n              var name = p[cfg.planets.namesType];\n              setTextStyle(cfg.planets.nameStyle);\n              //context.direction = \"ltr\" || \"rtl\" ar il ir\n              context.fillStyle = sym.fill;\n              context.fillText(name, pt[0] - r / 2, pt[1] + r / 2);\n            }\n          }\n        });\n      }\n      if (Celestial.data.length > 0) {\n        Celestial.data.forEach(function (d) {\n          d.redraw();\n        });\n      }\n      if ((cfg.location || cfg.formFields.location) && cfg.daylight.show && projectionSetting.clip) {\n        var sol = getPlanet(\"sol\");\n        if (sol) {\n          var up = Celestial.zenith(),\n            solpos = sol.ephemeris.pos,\n            dist = d3.geo.distance(up, solpos),\n            pt = mapProjection(solpos);\n          daylight.origin(solpos);\n          setSkyStyle(dist, pt);\n          container.selectAll(parentElement + \" .daylight\").datum(daylight).attr(\"d\", map);\n          context.fill();\n          context.fillStyle = \"#fff\";\n          if (clip(solpos)) {\n            context.beginPath();\n            context.arc(pt[0], pt[1], 6, 0, 2 * Math.PI);\n            context.closePath();\n            context.fill();\n          }\n        }\n      }\n      if ((cfg.location || cfg.formFields.location) && cfg.horizon.show && !projectionSetting.clip) {\n        circle.origin(Celestial.nadir());\n        setStyle(cfg.horizon);\n        container.selectAll(parentElement + \" .horizon\").datum(circle).attr(\"d\", map);\n        context.fill();\n        if (cfg.horizon.stroke) context.stroke();\n      }\n      if (cfg.controls) {\n        zoomState(mapProjection.scale());\n      }\n      if (hasCallback) {\n        Celestial.runCallback();\n      }\n\n      //Celestial.updateForm();\n    }\n\n    function drawOutline(stroke) {\n      var rot = mapProjection.rotate(),\n        prj = getProjection(cfg.projection, config.projectionRatio);\n      mapProjection.rotate([0, 0]);\n      setStyle(cfg.background);\n      container.selectAll(parentElement + \" .outline\").attr(\"d\", map);\n      if (stroke === true) {\n        context.globalAlpha = 1;\n        context.stroke();\n      } else {\n        context.fill();\n      }\n      mapProjection.rotate(rot);\n    }\n\n    // Helper functions -------------------------------------------------\n\n    function clip(coords) {\n      return projectionSetting.clip && d3.geo.distance(cfg.center, coords) > halfπ ? 0 : 1;\n    }\n    function setStyle(s) {\n      context.fillStyle = s.fill || null;\n      context.strokeStyle = s.stroke || null;\n      context.lineWidth = s.width || null;\n      context.globalAlpha = s.opacity !== null ? s.opacity : 1;\n      context.font = s.font || null;\n      if (has(s, \"dash\")) context.setLineDash(s.dash);else context.setLineDash([]);\n      context.beginPath();\n    }\n    function setTextStyle(s) {\n      context.fillStyle = s.fill;\n      context.textAlign = s.align || \"left\";\n      context.textBaseline = s.baseline || \"bottom\";\n      context.globalAlpha = s.opacity !== null ? s.opacity : 1;\n      context.font = s.font;\n    }\n    function setStyleA(rank, s) {\n      rank = rank || 1;\n      context.fillStyle = isArray(s.fill) ? s.fill[rank - 1] : null;\n      context.strokeStyle = isArray(s.stroke) ? s.stroke[rank - 1] : null;\n      context.lineWidth = isArray(s.width) ? s.width[rank - 1] : null;\n      context.globalAlpha = isArray(s.opacity) ? s.opacity[rank - 1] : 1;\n      context.font = isArray(s.font) ? s.font[rank - 1] : null;\n      if (has(s, \"dash\")) context.setLineDash(s.dash);else context.setLineDash([]);\n      context.textAlign = s.align || \"left\";\n      context.textBaseline = s.baseline || \"bottom\";\n      context.beginPath();\n    }\n    function setSkyStyle(dist, pt) {\n      var factor,\n        color1,\n        color2,\n        color3,\n        upper = 1.36,\n        lower = 1.885;\n      if (dist > lower) {\n        context.fillStyle = \"transparent\";\n        context.globalAlpha = 0;\n        return;\n      }\n      if (dist <= upper) {\n        color1 = \"#daf1fa\";\n        color2 = \"#93d7f0\";\n        color3 = \"#57c0e8\";\n        factor = -(upper - dist) / 10;\n      } else {\n        factor = (dist - upper) / (lower - upper);\n        color1 = d3.interpolateLab(\"#daf1fa\", \"#e8c866\")(factor);\n        color2 = d3.interpolateLab(\"#93c7d0\", \"#ff854a\")(factor);\n        color3 = d3.interpolateLab(\"#57b0c8\", \"#6caae2\")(factor);\n      }\n      var grad = context.createRadialGradient(pt[0], pt[1], 0, pt[0], pt[1], 300);\n      grad.addColorStop(0, color1);\n      grad.addColorStop(0.2 + 0.4 * factor, color2);\n      grad.addColorStop(1, color3);\n      context.fillStyle = grad;\n      context.globalAlpha = 0.9 * (1 - skyTransparency(factor, 1.4));\n    }\n    function skyTransparency(t, a) {\n      return (Math.pow(Math.E, t * a) - 1) / (Math.pow(Math.E, a) - 1);\n    }\n    function zoomState(sc) {\n      var czi = $(\"celestial-zoomin\"),\n        czo = $(\"celestial-zoomout\"),\n        defscale = projectionSetting.scale * width / 1024;\n      if (!czi || !czo) return;\n      czi.disabled = sc >= defscale * zoomextent * 0.99;\n      czo.disabled = sc <= defscale;\n    }\n    function setClip(setit) {\n      if (setit) {\n        mapProjection.clipAngle(90);\n      } else {\n        mapProjection.clipAngle(null);\n      }\n    }\n    function filename(what, sub, ext) {\n      var cult = has(formats[what], culture) ? \".\" + culture : \"\";\n      ext = ext ? \".\" + ext : \".json\";\n      sub = sub ? \".\" + sub : \"\";\n      return what + sub + cult + ext;\n    }\n    function dsoDisplay(prop, limit) {\n      return prop.mag === 999 && Math.sqrt(parseInt(prop.dim)) > limit || prop.mag !== 999 && prop.mag <= limit;\n    }\n    function dsoSymbol(d, pt) {\n      var prop = d.properties;\n      var size = dsoSize(prop) || 9,\n        type = dsoShape(prop.type);\n      Canvas.symbol().type(type).size(size).position(pt)(context);\n      return Math.sqrt(size) / 2;\n    }\n    function dsoShape(type) {\n      if (!type || !has(cfg.dsos.symbols, type)) return \"circle\";else return cfg.dsos.symbols[type].shape;\n    }\n    function dsoSize(prop) {\n      if (!prop.mag || prop.mag === 999) return Math.pow(parseInt(prop.dim) * dsobase * adapt / 7, 0.5);\n      return Math.pow(2 * dsobase * adapt - prop.mag, dsoexp);\n    }\n    function dsoName(d) {\n      //return d.properties[cfg.dsos.namesType]; \n      var lang = cfg.dsos.namesType,\n        id = d.id;\n      if (lang === \"desig\" || !has(dsonames, id)) return d.properties.desig;\n      return has(dsonames[id], lang) ? dsonames[id][lang] : d.properties.desig;\n    }\n\n    /* Star designation  */\n    function starDesignation(id) {\n      if (!has(starnames, id)) return \"\";\n      return starnames[id][cfg.stars.designationType];\n    }\n    function starPropername(id) {\n      var lang = cfg.stars.propernameType;\n      if (!has(starnames, id)) return \"\";\n      return has(starnames[id], lang) ? starnames[id][lang] : starnames[id].name;\n    }\n    function starSize(d) {\n      var mag = d.properties.mag;\n      if (mag === null) return 0.1;\n      var r = starbase * adapt * Math.exp(starexp * (mag + 2));\n      return Math.max(r, 0.1);\n    }\n    function starColor(d) {\n      var bv = d.properties.bv;\n      if (!cfg.stars.colors || isNaN(bv)) {\n        return cfg.stars.style.fill;\n      }\n      return bvcolor(bv);\n    }\n    function constName(d) {\n      return d.properties[cfg.constellations.namesType];\n    }\n    function planetSize(d) {\n      var mag = d.mag;\n      if (mag === null) return 2;\n      var r = 4 * adapt * Math.exp(-0.05 * (mag + 2));\n      return Math.max(r, 2);\n    }\n    function planetSymbol(s) {\n      var size = s.replace(/(^\\D*)(\\d+)(\\D.+$)/i, '$2');\n      size = Math.round(adapt * size);\n      return s.replace(/(^\\D*)(\\d+)(\\D.+$)/i, '$1' + size + '$3');\n    }\n    function gridOrientation(pos, orient) {\n      var o = orient.split(\"\"),\n        h = \"center\",\n        v = \"middle\";\n      for (var i = o.length - 1; i >= 0; i--) {\n        switch (o[i]) {\n          case \"N\":\n            v = \"bottom\";\n            break;\n          case \"S\":\n            v = \"top\";\n            break;\n          case \"E\":\n            h = \"left\";\n            pos[0] += 2;\n            break;\n          case \"W\":\n            h = \"right\";\n            pos[0] -= 2;\n            break;\n        }\n      }\n      context.textAlign = h;\n      context.textBaseline = v;\n      return pos;\n    }\n    function clear() {\n      context.clearRect(0, 0, canvaswidth + margin[0], canvasheight + margin[1]);\n    }\n    function getWidth() {\n      var w = 0;\n      if (isNumber(cfg.width) && cfg.width > 0) w = cfg.width;else if (parent) w = parent.getBoundingClientRect().width - margin[0] * 2;else w = window.getBoundingClientRect().width - margin[0] * 2;\n      //if (isNumber(cfg.background.width)) w -= cfg.background.width;\n      return w;\n    }\n    function getProjection(p, ratioOverride) {\n      if (!has(projections, p)) return;\n      var res = projections[p];\n      if (!has(res, \"ratio\")) res.ratio = 2; // Default w/h ratio 2:1    \n      res.ratio = ratioOverride ? ratioOverride : res.ratio;\n      return res;\n    }\n    function animate() {\n      if (!animations || animations.length < 1) return;\n      var d,\n        a = animations[current];\n      switch (a.param) {\n        case \"projection\":\n          d = reproject({\n            projection: a.value\n          });\n          break;\n        case \"center\":\n          d = rotate({\n            center: a.value\n          });\n          break;\n        case \"zoom\":\n          d = zoomBy(a.value);\n      }\n      if (a.callback) setTimeout(a.callback, d);\n      current++;\n      if (repeat === true && current === animations.length) current = 0;\n      d = a.duration === 0 || a.duration < d ? d : a.duration;\n      if (current < animations.length) animationID = setTimeout(animate, d);\n    }\n    function stop() {\n      clearTimeout(animationID);\n      //current = 0;\n      //repeat = false;\n    }\n\n    // Exported objects and functions for adding data\n    this.container = container;\n    this.clip = clip;\n    this.map = map;\n    this.mapProjection = mapProjection;\n    this.context = context;\n    this.metrics = function () {\n      return {\n        \"width\": width,\n        \"height\": height,\n        \"margin\": margin,\n        \"scale\": mapProjection.scale()\n      };\n    };\n    this.setStyle = setStyle;\n    this.setTextStyle = setTextStyle;\n    this.setStyleA = setStyleA;\n    this.setConstStyle = function (rank, font) {\n      var f = arrayfy(font);\n      context.font = f[rank];\n    };\n    this.symbol = Canvas.symbol;\n    this.dsoSymbol = dsoSymbol;\n    this.redraw = redraw;\n    this.resize = function (config) {\n      if (config !== undefined) {\n        if (has(config, \"width\")) cfg.width = config.width;else if (isNumber(config)) cfg.width = config;\n      }\n      resize(true);\n      return cfg.width;\n    };\n    this.reload = function (config) {\n      var ctr;\n      //if (!config || !has(config, \"transform\")) return;\n      //cfg.transform = config.transform; \n      if (config) Object.assign(cfg, settings.set(config));\n      if (cfg.follow === \"center\" && has(cfg, \"center\")) {\n        ctr = getAngles(cfg.center);\n      } else if (cfg.follow === \"zenith\") {\n        ctr = getAngles(Celestial.zenith());\n      }\n      if (ctr) mapProjection.rotate(ctr);\n      container.selectAll(parentElement + \" *\").remove();\n      load();\n    };\n    this.apply = function (config) {\n      apply(config);\n    };\n    this.reproject = function (config) {\n      return reproject(config);\n    };\n    this.rotate = function (config) {\n      if (!config) return cfg.center;\n      return rotate(config);\n    };\n    this.zoomBy = function (factor) {\n      if (!factor) return mapProjection.scale() / scale;\n      return zoomBy(factor);\n    };\n    this.color = function (type) {\n      if (!type) return \"#000\";\n      if (has(cfg.dsos.symbols, type)) return cfg.dsos.symbols[type].fill;\n      return \"#000\";\n    };\n    this.starColor = starColor;\n    this.animate = function (anims, dorepeat) {\n      if (!anims) return;\n      animations = anims;\n      current = 0;\n      repeat = dorepeat ? true : false;\n      animate();\n    };\n    this.stop = function (wipe) {\n      stop();\n      if (wipe === true) animations = [];\n    };\n    this.go = function (index) {\n      if (animations.length < 1) return;\n      if (index && index < animations.length) current = index;\n      animate();\n    };\n\n    /* obsolete\r\n    if (!has(this, \"date\"))\r\n      this.date = function() { console.log(\"Celestial.date() needs config.location = true to work.\" ); };\r\n    */\n    load();\n  };\n\n  //Export entire object if invoked by require\n  if (typeof module === \"object\" && module.exports) {\n    var d3js = require('./lib/d3.js'),\n      d3_geo_projection = require('./lib/d3.geo.projection.js');\n    module.exports = {\n      Celestial: function () {\n        return Celestial;\n      },\n      d3: function () {\n        return d3js;\n      },\n      \"d3.geo.projection\": function () {\n        return d3_geo_projection;\n      }\n    };\n  }\n\n  //Flipped projection generated on the fly\n  Celestial.projection = function (projection) {\n    var p, raw, forward;\n    if (!has(projections, projection)) {\n      throw new Error(\"Projection not supported: \" + projection);\n    }\n    p = projections[projection];\n    if (p.arg !== null) {\n      raw = d3.geo[projection].raw(p.arg);\n    } else {\n      raw = d3.geo[projection].raw;\n    }\n    forward = function (λ, φ) {\n      var coords = raw(-λ, φ);\n      return coords;\n    };\n    forward.invert = function (x, y) {\n      try {\n        var coords = raw.invert(x, y);\n        coords[0] = coords && -coords[0];\n        return coords;\n      } catch (e) {\n        console.log(e);\n      }\n    };\n    return d3.geo.projection(forward);\n  };\n  function projectionTween(a, b) {\n    var prj = d3.geo.projection(raw).scale(1),\n      center = prj.center,\n      translate = prj.translate,\n      α;\n    function raw(λ, φ) {\n      var pa = a([λ *= 180 / Math.PI, φ *= 180 / Math.PI]),\n        pb = b([λ, φ]);\n      return [(1 - α) * pa[0] + α * pb[0], (α - 1) * pa[1] - α * pb[1]];\n    }\n    prj.alpha = function (_) {\n      if (!arguments.length) return α;\n      α = +_;\n      var ca = a.center(),\n        cb = b.center(),\n        ta = a.translate(),\n        tb = b.translate();\n      center([(1 - α) * ca[0] + α * cb[0], (1 - α) * ca[1] + α * cb[1]]);\n      translate([(1 - α) * ta[0] + α * tb[0], (1 - α) * ta[1] + α * tb[1]]);\n      return prj;\n    };\n    delete prj.translate;\n    delete prj.center;\n    return prj.alpha(0);\n  }\n  var eulerAngles = {\n    \"equatorial\": [0.0, 0.0, 0.0],\n    \"ecliptic\": [0.0, 0.0, 23.4393],\n    \"galactic\": [93.5949, 28.9362, -58.5988],\n    \"supergalactic\": [137.3100, 59.5283, 57.7303]\n    //  \"mars\": [97.5,23.5,29]\n  };\n\n  var poles = {\n    \"equatorial\": [0.0, 90.0],\n    \"ecliptic\": [-90.0, 66.5607],\n    \"galactic\": [-167.1405, 27.1283],\n    \"supergalactic\": [-76.2458, 15.7089]\n    //  \"mars\": [-42.3186, 52.8865]\n  };\n\n  Celestial.eulerAngles = function () {\n    return eulerAngles;\n  };\n  Celestial.poles = function () {\n    return poles;\n  };\n  var τ = Math.PI * 2,\n    halfπ = Math.PI / 2,\n    deg2rad = Math.PI / 180;\n\n  //Transform equatorial into any coordinates, degrees\n  function transformDeg(c, euler) {\n    var res = transform(c.map(function (d) {\n      return d * deg2rad;\n    }), euler);\n    return res.map(function (d) {\n      return d / deg2rad;\n    });\n  }\n\n  //Transform equatorial into any coordinates, radians\n  function transform(c, euler) {\n    var x,\n      y,\n      z,\n      β,\n      γ,\n      λ,\n      φ,\n      dψ,\n      ψ,\n      θ,\n      ε = 1.0e-5;\n    if (!euler) return c;\n    λ = c[0]; // celestial longitude 0..2pi\n    if (λ < 0) λ += τ;\n    φ = c[1]; // celestial latitude  -pi/2..pi/2\n\n    λ -= euler[0]; // celestial longitude - celestial coordinates of the native pole\n    β = euler[1]; // inclination between the poles (colatitude)\n    γ = euler[2]; // native coordinates of the celestial pole\n\n    x = Math.sin(φ) * Math.sin(β) - Math.cos(φ) * Math.cos(β) * Math.cos(λ);\n    if (Math.abs(x) < ε) {\n      x = -Math.cos(φ + β) + Math.cos(φ) * Math.cos(β) * (1 - Math.cos(λ));\n    }\n    y = -Math.cos(φ) * Math.sin(λ);\n    if (x !== 0 || y !== 0) {\n      dψ = Math.atan2(y, x);\n    } else {\n      dψ = λ - Math.PI;\n    }\n    ψ = γ + dψ;\n    if (ψ > Math.PI) ψ -= τ;\n    if (λ % Math.PI === 0) {\n      θ = φ + Math.cos(λ) * β;\n      if (θ > halfπ) θ = Math.PI - θ;\n      if (θ < -halfπ) θ = -Math.PI - θ;\n    } else {\n      z = Math.sin(φ) * Math.cos(β) + Math.cos(φ) * Math.sin(β) * Math.cos(λ);\n      if (Math.abs(z) > 0.99) {\n        θ = Math.abs(Math.acos(Math.sqrt(x * x + y * y)));\n        if (z < 0) θ *= -1;\n      } else {\n        θ = Math.asin(z);\n      }\n    }\n    return [ψ, θ];\n  }\n  function getAngles(coords) {\n    if (coords === null || coords.length <= 0) return [0, 0, 0];\n    var rot = eulerAngles.equatorial;\n    if (!coords[2]) coords[2] = 0;\n    return [rot[0] - coords[0], rot[1] - coords[1], rot[2] + coords[2]];\n  }\n  var euler = {\n    \"ecliptic\": [-90.0, 23.4393, 90.0],\n    \"inverse ecliptic\": [90.0, 23.4393, -90.0],\n    \"galactic\": [-167.1405, 62.8717, 122.9319],\n    \"inverse galactic\": [122.9319, 62.8717, -167.1405],\n    \"supergalactic\": [283.7542, 74.2911, 26.4504],\n    \"inverse supergalactic\": [26.4504, 74.2911, 283.7542],\n    \"init\": function () {\n      for (var key in this) {\n        if (this[key].constructor == Array) {\n          this[key] = this[key].map(function (val) {\n            return val * deg2rad;\n          });\n        }\n      }\n    },\n    \"add\": function (name, ang) {\n      if (!ang || !name || ang.length !== 3 || this.hasOwnProperty(name)) return;\n      this[name] = ang.map(function (val) {\n        return val * deg2rad;\n      });\n      return this[name];\n    }\n  };\n  euler.init();\n  Celestial.euler = function () {\n    return euler;\n  };\n  var horizontal = function (dt, pos, loc) {\n    //dt: datetime, pos: celestial coordinates [lat,lng], loc: location [lat,lng]  \n    var ha = getMST(dt, loc[1]) - pos[0];\n    if (ha < 0) ha = ha + 360;\n    ha = ha * deg2rad;\n    var dec = pos[1] * deg2rad;\n    var lat = loc[0] * deg2rad;\n    var alt = Math.asin(Math.sin(dec) * Math.sin(lat) + Math.cos(dec) * Math.cos(lat) * Math.cos(ha));\n    var az = Math.acos((Math.sin(dec) - Math.sin(alt) * Math.sin(lat)) / (Math.cos(alt) * Math.cos(lat)));\n    if (Math.sin(ha) > 0) az = Math.PI * 2 - az;\n    return [alt / deg2rad, az / deg2rad, 0];\n  };\n  horizontal.inverse = function (dt, hor, loc) {\n    var alt = hor[0] * deg2rad;\n    var az = hor[1] * deg2rad;\n    var lat = loc[0] * deg2rad;\n    var dec = Math.asin(Math.sin(alt) * Math.sin(lat) + Math.cos(alt) * Math.cos(lat) * Math.cos(az));\n    var ha = ((Math.sin(alt) - Math.sin(dec) * Math.sin(lat)) / (Math.cos(dec) * Math.cos(lat))).toFixed(6);\n    ha = Math.acos(ha);\n    ha = ha / deg2rad;\n    var ra = getMST(dt, loc[1]) - ha;\n    //if (ra < 0) ra = ra + 360;\n\n    return [ra, dec / deg2rad, 0];\n  };\n  function getMST(dt, lng) {\n    var yr = dt.getUTCFullYear();\n    var mo = dt.getUTCMonth() + 1;\n    var dy = dt.getUTCDate();\n    var h = dt.getUTCHours();\n    var m = dt.getUTCMinutes();\n    var s = dt.getUTCSeconds();\n    if (mo == 1 || mo == 2) {\n      yr = yr - 1;\n      mo = mo + 12;\n    }\n    var a = Math.floor(yr / 100);\n    var b = 2 - a + Math.floor(a / 4);\n    var c = Math.floor(365.25 * yr);\n    var d = Math.floor(30.6001 * (mo + 1));\n\n    // days since J2000.0\n    var jd = b + c + d - 730550.5 + dy + (h + m / 60.0 + s / 3600.0) / 24.0;\n\n    // julian centuries since J2000.0\n    var jt = jd / 36525.0;\n\n    // the mean sidereal time in degrees\n    var mst = 280.46061837 + 360.98564736629 * jd + 0.000387933 * jt * jt - jt * jt * jt / 38710000 + lng;\n\n    // in degrees modulo 360.0\n    if (mst > 0.0) while (mst > 360.0) mst = mst - 360.0;else while (mst < 0.0) mst = mst + 360.0;\n    return mst;\n  }\n  Celestial.horizontal = horizontal;\n  Celestial.ha = function (dt, lng, ra) {\n    var ha = getMST(dt, lng) - ra;\n    if (ha < 180) ha = ha + 360;\n    return ha;\n  };\n  //Add more JSON data to the map\n  var hasCallback = false;\n  Celestial.add = function (dat) {\n    var res = {};\n    //dat: {file: path, type:'json|raw', callback: func(), redraw: func()} \n    //or {file:file, size:null, shape:null, color:null}  TBI\n    //  with size,shape,color: \"prop=val:result;..\" || function(prop) { .. return res; } \n    if (!has(dat, \"type\")) return console.log(\"Missing type\");\n    if ((dat.type === \"dso\" || dat.type === \"json\") && (!has(dat, \"file\") || !has(dat, \"callback\"))) return console.log(\"Can't add data file\");\n    if ((dat.type === \"line\" || dat.type === \"raw\") && !has(dat, \"callback\")) return console.log(\"Can't add data\");\n    if (has(dat, \"file\")) res.file = dat.file;\n    res.type = dat.type;\n    if (has(dat, \"callback\")) res.callback = dat.callback;\n    if (has(dat, \"redraw\")) res.redraw = dat.redraw;\n    if (has(dat, \"save\")) res.save = dat.save;\n    Celestial.data.push(res);\n  };\n  Celestial.remove = function (i) {\n    if (i !== null && i < Celestial.data.length) {\n      return Celestial.data.splice(i, 1);\n    }\n  };\n  Celestial.clear = function () {\n    Celestial.data = [];\n  };\n  Celestial.addCallback = function (dat) {\n    Celestial.callback = dat;\n    hasCallback = dat !== null;\n  };\n  Celestial.runCallback = function (dat) {\n    hasCallback = false; // avoid recursion\n    Celestial.callback();\n    hasCallback = true;\n  };\n  //load data and transform coordinates\n\n  function getPoint(coords, trans) {\n    return transformDeg(coords, euler[trans]);\n  }\n  function getData(d, trans) {\n    if (trans === \"equatorial\") return d;\n    var leo = euler[trans],\n      f = d.features;\n    for (var i = 0; i < f.length; i++) f[i].geometry.coordinates = translate(f[i], leo);\n    return d;\n  }\n  function getPlanets(d) {\n    var res = [];\n    for (var key in d) {\n      if (!has(d, key)) continue;\n      if (cfg.planets.which.indexOf(key) === -1) continue;\n      var dat = Kepler().id(key);\n      if (has(d[key], \"parent\")) dat.parentBody(d[key].parent);\n      dat.elements(d[key].elements[0]).params(d[key]);\n      if (key === \"ter\") Celestial.origin = dat;else res.push(dat);\n    }\n    //res.push(Kepler().id(\"sol\"));\n    //res.push(Kepler().id(\"lun\"));\n    return res;\n  }\n  function getPlanet(id, dt) {\n    dt = dt || Celestial.date();\n    if (!Celestial.origin) return;\n    var o = Celestial.origin(dt).spherical(),\n      res;\n    Celestial.container.selectAll(\".planet\").each(function (d) {\n      if (id === d.id()) {\n        res = d(dt).equatorial(o);\n      }\n    });\n    return res;\n  }\n  function getConstellationList(d) {\n    var res = {},\n      f = d.features;\n    for (var i = 0; i < f.length; i++) {\n      res[f[i].id] = {\n        center: f[i].properties.display.slice(0, 2),\n        scale: f[i].properties.display[2]\n      };\n    }\n    return res;\n  }\n  function getMwbackground(d) {\n    // geoJson object to darken the mw-outside, prevent greying of whole map in some orientations \n    var res = {\n      'type': 'FeatureCollection',\n      'features': [{\n        'type': 'Feature',\n        'geometry': {\n          'type': 'MultiPolygon',\n          'coordinates': []\n        }\n      }]\n    };\n\n    // reverse the polygons, inside -> outside\n    var l1 = d.features[0].geometry.coordinates[0];\n    res.features[0].geometry.coordinates[0] = [];\n    for (var i = 0; i < l1.length; i++) {\n      res.features[0].geometry.coordinates[0][i] = l1[i].slice().reverse();\n    }\n    return res;\n  }\n  function getTimezones() {}\n  function translate(d, leo) {\n    var res = [];\n    switch (d.geometry.type) {\n      case \"Point\":\n        res = transformDeg(d.geometry.coordinates, leo);\n        break;\n      case \"LineString\":\n        res.push(transLine(d.geometry.coordinates, leo));\n        break;\n      case \"MultiLineString\":\n        res = transMultiLine(d.geometry.coordinates, leo);\n        break;\n      case \"Polygon\":\n        res.push(transLine(d.geometry.coordinates[0], leo));\n        break;\n      case \"MultiPolygon\":\n        res.push(transMultiLine(d.geometry.coordinates[0], leo));\n        break;\n    }\n    return res;\n  }\n  function getGridValues(type, loc) {\n    var lines = [];\n    if (!loc) return [];\n    if (!isArray(loc)) loc = [loc];\n    //center, outline, values\n    for (var i = 0; i < loc.length; i++) {\n      switch (loc[i]) {\n        case \"center\":\n          if (type === \"lat\") lines = lines.concat(getLine(type, cfg.center[0], \"N\"));else lines = lines.concat(getLine(type, cfg.center[1], \"S\"));\n          break;\n        case \"outline\":\n          if (type === \"lon\") {\n            lines = lines.concat(getLine(type, cfg.center[1] - 89.99, \"S\"));\n            lines = lines.concat(getLine(type, cfg.center[1] + 89.99, \"N\"));\n          } else {\n            // TODO: hemi\n            lines = lines.concat(getLine(type, cfg.center[0] - 179.99, \"E\"));\n            lines = lines.concat(getLine(type, cfg.center[0] + 179.99, \"W\"));\n          }\n          break;\n        default:\n          if (isNumber(loc[i])) {\n            if (type === \"lat\") lines = lines.concat(getLine(type, loc[i], \"N\"));else lines = lines.concat(getLine(type, loc[i], \"S\"));\n            break;\n          }\n      }\n    }\n    //return [{coordinates, value, orientation}, ...]\n    return jsonGridValues(lines);\n  }\n  function jsonGridValues(lines) {\n    var res = [];\n    for (var i = 0; i < lines.length; i++) {\n      var f = {\n        type: \"Feature\",\n        \"id\": i,\n        properties: {},\n        geometry: {\n          type: \"Point\"\n        }\n      };\n      f.properties.value = lines[i].value;\n      f.properties.orientation = lines[i].orientation;\n      f.geometry.coordinates = lines[i].coordinates;\n      res.push(f);\n    }\n    return res;\n  }\n  function getLine(type, loc, orient) {\n    var min,\n      max,\n      step,\n      val,\n      coord,\n      tp = type,\n      res = [],\n      lr = loc;\n    if (cfg.transform === \"equatorial\" && tp === \"lon\") tp = \"ra\";\n    if (tp === \"ra\") {\n      min = 0;\n      max = 23;\n      step = 1;\n    } else if (tp === \"lon\") {\n      min = 0;\n      max = 350;\n      step = 10;\n    } else {\n      min = -80;\n      max = 80;\n      step = 10;\n    }\n    for (var i = min; i <= max; i += step) {\n      var o = orient;\n      if (tp === \"lat\") {\n        coord = [lr, i];\n        val = i.toString() + \"\\u00b0\";\n        if (i < 0) o += \"S\";else o += \"N\";\n      } else if (tp === \"ra\") {\n        coord = [i * 15, lr];\n        val = i.toString() + \"\\u02b0\";\n      } else {\n        coord = [i, lr];\n        val = i.toString() + \"\\u00b0\";\n      }\n      res.push({\n        coordinates: coord,\n        value: val,\n        orientation: o\n      });\n    }\n    return res;\n  }\n  function transLine(c, leo) {\n    var line = [];\n    for (var i = 0; i < c.length; i++) line.push(transformDeg(c[i], leo));\n    return line;\n  }\n  function transMultiLine(c, leo) {\n    var lines = [];\n    for (var i = 0; i < c.length; i++) lines.push(transLine(c[i], leo));\n    return lines;\n  }\n  Celestial.getData = getData;\n  Celestial.getPoint = getPoint;\n  Celestial.getPlanet = getPlanet;\n\n  // Central configuration object\n  var globalConfig = {};\n\n  //Defaults\n  var settings = {\n    width: 0,\n    // Default width; height is determined by projection\n    projection: \"aitoff\",\n    // Map projection used: airy, aitoff, armadillo, august, azimuthalEqualArea, azimuthalEquidistant, baker, berghaus, boggs, bonne, bromley, collignon, craig, craster, cylindricalEqualArea, cylindricalStereographic, eckert1, eckert2, eckert3, eckert4, eckert5, eckert6, eisenlohr, equirectangular, fahey, foucaut, ginzburg4, ginzburg5, ginzburg6, ginzburg8, ginzburg9, gringorten, hammer, hatano, healpix, hill, homolosine, kavrayskiy7, lagrange, larrivee, laskowski, loximuthal, mercator, miller, mollweide, mtFlatPolarParabolic, mtFlatPolarQuartic, mtFlatPolarSinusoidal, naturalEarth, nellHammer, orthographic, patterson, polyconic, rectangularPolyconic, robinson, sinusoidal, stereographic, times, twoPointEquidistant, vanDerGrinten, vanDerGrinten2, vanDerGrinten3, vanDerGrinten4, wagner4, wagner6, wagner7, wiechel, winkel3\n    projectionRatio: null,\n    // Optional override for default projection ratio\n    transform: \"equatorial\",\n    // Coordinate transformation: equatorial (default), ecliptic, galactic, supergalactic\n    center: null,\n    // Initial center coordinates in equatorial transformation [hours, degrees, degrees], \n    // otherwise [degrees, degrees, degrees], 3rd parameter is orientation, null = default center\n    geopos: null,\n    // optional initial geographic position [lat,lon] in degrees, overrides center\n    follow: \"zenith\",\n    // on which coordinates to center the map, default: zenith, if location enabled, otherwise center\n    orientationfixed: true,\n    // Keep orientation angle the same as center[2]\n    zoomlevel: null,\n    // initial zoom level 0...zoomextend; 0|null = default, 1 = 100%, 0 < x <= zoomextend\n    zoomextend: 10,\n    // maximum zoom level\n    adaptable: true,\n    // Sizes are increased with higher zoom-levels\n    interactive: true,\n    // Enable zooming and rotation with mousewheel and dragging\n    disableAnimations: false,\n    // Disable all animations\n    form: false,\n    // Display settings form\n    location: false,\n    // Display location settings, deprecated, use formFields\n    // Set visiblity for each group of fields of the form\n    formFields: {\n      \"location\": true,\n      \"general\": true,\n      \"stars\": true,\n      \"dsos\": true,\n      \"constellations\": true,\n      \"lines\": true,\n      \"other\": true,\n      download: false\n    },\n    advanced: true,\n    // Display fewer form fields if false\n    daterange: [],\n    // Calender date range; null: displaydate-+10; [n<100]: displaydate-+n; [yr]: yr-+10; \n    // [yr, n<100]: [yr-n, yr+n]; [yr0, yr1]\n    settimezone: true,\n    // Automatcally set time zone when geolocation changes\n    timezoneid: \"AEFXZPQ3FDPF\",\n    // Account ID for TimeZoneDB service, please get your own\n    controls: true,\n    // Display zoom controls\n    lang: \"\",\n    // Global language override for names, any name setting that has the chosen language available\n    // Default: desig or empty string for designations, other languages as used anywhere else\n    culture: \"\",\n    // Constellation lines, default \"iau\"\n    container: \"celestial-map\",\n    // ID of parent element, e.g. div\n    datapath: \"data/\",\n    // Path/URL to data files, empty = subfolder 'data'\n    stars: {\n      show: true,\n      // Show stars\n      limit: 6,\n      // Show only stars brighter than limit magnitude\n      colors: true,\n      // Show stars in spectral colors, if not use fill-style\n      style: {\n        fill: \"#ffffff\",\n        opacity: 1\n      },\n      // Default style for stars\n      designation: true,\n      // Show star names (Bayer, Flamsteed, Variable star, Gliese or designation, \n      // i.e. whichever of the previous applies first); may vary with culture setting\n      designationType: \"desig\",\n      // Which kind of name is displayed as designation (fieldname in starnames.json)\n      designationStyle: {\n        fill: \"#ddddbb\",\n        font: \"11px 'Palatino Linotype', Georgia, Times, 'Times Roman', serif\",\n        align: \"left\",\n        baseline: \"top\"\n      },\n      designationLimit: 2.5,\n      // Show only names for stars brighter than nameLimit\n      propername: false,\n      // Show proper name (if present)\n      propernameType: \"name\",\n      // Field in starnames.json that contains proper name; may vary with culture setting\n      propernameStyle: {\n        fill: \"#ddddbb\",\n        font: \"13px 'Palatino Linotype', Georgia, Times, 'Times Roman', serif\",\n        align: \"right\",\n        baseline: \"bottom\"\n      },\n      propernameLimit: 1.5,\n      // Show proper names for stars brighter than propernameLimit\n      size: 7,\n      // Scale size (radius) of star circle in pixels\n      exponent: -0.28,\n      // Scale exponent for star size, larger = more linear\n      data: \"stars.6.json\" // Data source for stellar data\n    },\n\n    dsos: {\n      show: true,\n      // Show Deep Space Objects \n      limit: 6,\n      // Show only DSOs brighter than limit magnitude\n      colors: true,\n      // Show DSOs in symbol colors if true, use style setting below if false\n      style: {\n        fill: \"#cccccc\",\n        stroke: \"#cccccc\",\n        width: 2,\n        opacity: 1\n      },\n      // Default style for dsos\n      names: true,\n      // Show DSO names\n      namesType: \"desig\",\n      // Type of displayed name: desig, name, or 15 different language codes from dsonames.json\n      nameStyle: {\n        fill: \"#cccccc\",\n        font: \"11px 'Lucida Sans Unicode', 'DejaVu Sans', Helvetica, Arial, serif\",\n        align: \"left\",\n        baseline: \"bottom\"\n      },\n      nameLimit: 4,\n      // Show only names for DSOs brighter than nameLimit\n      size: null,\n      // Optional seperate scale size for DSOs, null = stars.size\n      exponent: 1.4,\n      // Scale exponent for DSO size, larger = more non-linear\n      data: \"dsos.bright.json\",\n      // Data source for DSOs\n      symbols: {\n        // DSO symbol styles\n        gg: {\n          shape: \"circle\",\n          fill: \"#ff0000\"\n        },\n        // Galaxy cluster\n        g: {\n          shape: \"ellipse\",\n          fill: \"#ff0000\"\n        },\n        // Generic galaxy\n        s: {\n          shape: \"ellipse\",\n          fill: \"#ff0000\"\n        },\n        // Spiral galaxy\n        s0: {\n          shape: \"ellipse\",\n          fill: \"#ff0000\"\n        },\n        // Lenticular galaxy\n        sd: {\n          shape: \"ellipse\",\n          fill: \"#ff0000\"\n        },\n        // Dwarf galaxy\n        e: {\n          shape: \"ellipse\",\n          fill: \"#ff0000\"\n        },\n        // Elliptical galaxy\n        i: {\n          shape: \"ellipse\",\n          fill: \"#ff0000\"\n        },\n        // Irregular galaxy\n        oc: {\n          shape: \"circle\",\n          fill: \"#ff9900\",\n          stroke: \"#ff9900\",\n          width: 2\n        },\n        // Open cluster\n        gc: {\n          shape: \"circle\",\n          fill: \"#ff9900\"\n        },\n        // Globular cluster\n        en: {\n          shape: \"square\",\n          fill: \"#ff00cc\"\n        },\n        // Emission nebula\n        bn: {\n          shape: \"square\",\n          fill: \"#ff00cc\"\n        },\n        // Generic bright nebula\n        sfr: {\n          shape: \"square\",\n          fill: \"#cc00ff\"\n        },\n        // Star forming region\n        rn: {\n          shape: \"square\",\n          fill: \"#0000ff\"\n        },\n        // Reflection nebula\n        pn: {\n          shape: \"diamond\",\n          fill: \"#00cccc\"\n        },\n        // Planetary nebula \n        snr: {\n          shape: \"diamond\",\n          fill: \"#ff00cc\"\n        },\n        // Supernova remnant\n        dn: {\n          shape: \"square\",\n          fill: \"#999999\",\n          stroke: \"#999999\",\n          width: 2\n        },\n        // Dark nebula \n        pos: {\n          shape: \"marker\",\n          fill: \"#cccccc\",\n          stroke: \"#cccccc\",\n          width: 1.5\n        } // Generic marker\n      }\n    },\n\n    constellations: {\n      show: true,\n      // Show constellations \n      names: true,\n      // Show constellation names \n      namesType: \"desig\",\n      // What kind of name to show (default 3 letter designations) all options: name, desig, \n      // lat, en, ar, cn, cz, ee, fi, fr, de, gr, il, it, jp, kr, in, ir, ru, es, tr \n      nameStyle: {\n        fill: \"#cccc99\",\n        align: \"center\",\n        baseline: \"middle\",\n        opacity: 0.8,\n        font: [\"14px 'Lucida Sans Unicode', 'DejaVu Sans', Helvetica, Arial, sans-serif\",\n        // Different fonts for brighter &\n        \"12px 'Lucida Sans Unicode', 'DejaVu Sans', Helvetica, Arial, sans-serif\",\n        // darker constellations\n        \"11px 'Lucida Sans Unicode', 'DejaVu Sans', Helvetica, Arial, sans-serif\"]\n      },\n      lines: true,\n      // Show constellation lines \n      lineStyle: {\n        stroke: \"#cccccc\",\n        width: 1.5,\n        opacity: 0.6\n      },\n      bounds: false,\n      // Show constellation boundaries \n      boundStyle: {\n        stroke: \"#ccff00\",\n        width: 1.0,\n        opacity: 0.8,\n        dash: [4, 4]\n      }\n    },\n    mw: {\n      show: true,\n      // Show Milky Way as filled polygons \n      style: {\n        fill: \"#ffffff\",\n        opacity: \"0.15\"\n      } // style for each MW-layer (5 on top of each other)\n    },\n\n    lines: {\n      graticule: {\n        show: true,\n        stroke: \"#cccccc\",\n        width: 0.6,\n        opacity: 0.8,\n        // Show graticule lines \n        // grid values: \"outline\", \"center\", or [lat,...] specific position\n        lon: {\n          pos: [],\n          fill: \"#eee\",\n          font: \"10px 'Lucida Sans Unicode', Helvetica, Arial, sans-serif\"\n        },\n        // grid values: \"outline\", \"center\", or [lon,...] specific position\n        lat: {\n          pos: [],\n          fill: \"#eee\",\n          font: \"10px 'Lucida Sans Unicode', Helvetica, Arial, sans-serif\"\n        }\n      },\n      equatorial: {\n        show: true,\n        stroke: \"#aaaaaa\",\n        width: 1.3,\n        opacity: 0.7\n      },\n      // Show equatorial plane \n      ecliptic: {\n        show: true,\n        stroke: \"#66cc66\",\n        width: 1.3,\n        opacity: 0.7\n      },\n      // Show ecliptic plane \n      galactic: {\n        show: false,\n        stroke: \"#cc6666\",\n        width: 1.3,\n        opacity: 0.7\n      },\n      // Show galactic plane \n      supergalactic: {\n        show: false,\n        stroke: \"#cc66cc\",\n        width: 1.3,\n        opacity: 0.7\n      } // Show supergalactic plane \n      //mars: { show: false, stroke:\"#cc0000\", width:1.3, opacity:.7 }\n    },\n\n    // Background style\n    background: {\n      fill: \"#000000\",\n      opacity: 1,\n      stroke: \"#000000\",\n      // Outline\n      width: 1.5\n    },\n    horizon: {\n      //Show horizon marker, if geo-position and date-time is set\n      show: false,\n      stroke: \"#cccccc\",\n      // Line\n      width: 1.0,\n      fill: \"#000000\",\n      // Area below horizon\n      opacity: 0.4\n    },\n    daylight: {\n      //Show approximate state of sky at selected time\n      show: false\n    },\n    planets: {\n      //Show planet locations, if date-time is set\n      show: false,\n      // 3-letter designations of all solar system objects that should be displayed\n      which: [\"sol\", \"mer\", \"ven\", \"ter\", \"lun\", \"mar\", \"jup\", \"sat\", \"ura\", \"nep\", \"cer\", \"plu\"],\n      // Symbols as unicode codepoints, letter abbreviations and colors to be displayed\n      symbols: {\n        \"sol\": {\n          symbol: \"\\u2609\",\n          letter: \"Su\",\n          fill: \"#ffff00\",\n          size: 12\n        },\n        \"mer\": {\n          symbol: \"\\u263f\",\n          letter: \"Me\",\n          fill: \"#cccccc\"\n        },\n        \"ven\": {\n          symbol: \"\\u2640\",\n          letter: \"V\",\n          fill: \"#eeeecc\"\n        },\n        \"ter\": {\n          symbol: \"\\u2295\",\n          letter: \"T\",\n          fill: \"#00ccff\"\n        },\n        \"lun\": {\n          symbol: \"\\u25cf\",\n          letter: \"L\",\n          fill: \"#ffffff\",\n          size: 12\n        },\n        \"mar\": {\n          symbol: \"\\u2642\",\n          letter: \"Ma\",\n          fill: \"#ff6600\"\n        },\n        \"cer\": {\n          symbol: \"\\u26b3\",\n          letter: \"C\",\n          fill: \"#cccccc\"\n        },\n        \"ves\": {\n          symbol: \"\\u26b6\",\n          letter: \"Ma\",\n          fill: \"#cccccc\"\n        },\n        \"jup\": {\n          symbol: \"\\u2643\",\n          letter: \"J\",\n          fill: \"#ffaa33\"\n        },\n        \"sat\": {\n          symbol: \"\\u2644\",\n          letter: \"Sa\",\n          fill: \"#ffdd66\"\n        },\n        \"ura\": {\n          symbol: \"\\u2645\",\n          letter: \"U\",\n          fill: \"#66ccff\"\n        },\n        \"nep\": {\n          symbol: \"\\u2646\",\n          letter: \"N\",\n          fill: \"#6666ff\"\n        },\n        \"plu\": {\n          symbol: \"\\u2647\",\n          letter: \"P\",\n          fill: \"#aaaaaa\"\n        },\n        \"eri\": {\n          symbol: \"\\u26aa\",\n          letter: \"E\",\n          fill: \"#eeeeee\"\n        }\n      },\n      // Style options for planetary symbols\n      symbolStyle: {\n        fill: \"#cccccc\",\n        opacity: 1,\n        font: \"bold 20px 'DejaVu Sans Mono', 'Arial Unicode MS', sans-serif\",\n        align: \"center\",\n        baseline: \"middle\"\n      },\n      symbolType: \"symbol\",\n      // Type of planetary symbol to be displayed: 'symbol', 'letter' or 'disk'\n      names: false,\n      // Show name next to symbol\n      // Style options for planetary names\n      nameStyle: {\n        fill: \"#cccccc\",\n        font: \"14px 'Lucida Sans Unicode', 'DejaVu Sans', sans-serif\",\n        align: \"right\",\n        baseline: \"top\"\n      },\n      namesType: \"en\" // Language in which the name is displayed, options desig, ar, cn, en, fr, de, gr, il, in, it, jp, lat, ru, es\n    },\n\n    set: function (cfg) {\n      // Override defaults with values of cfg\n      var prop,\n        key,\n        config = {},\n        res = {};\n      if (Object.entries(globalConfig).length === 0) Object.assign(config, this);else Object.assign(config, globalConfig);\n      if (!cfg) return config;\n      for (prop in config) {\n        if (!has(config, prop)) continue;\n        //if (typeof(config[prop]) === 'function'); \n        if (!has(cfg, prop) || cfg[prop] === null) {\n          res[prop] = config[prop];\n        } else if (config[prop] === null || config[prop].constructor != Object) {\n          res[prop] = cfg[prop];\n        } else {\n          res[prop] = {};\n          for (key in config[prop]) {\n            if (has(cfg[prop], key)) {\n              res[prop][key] = cfg[prop][key];\n            } else {\n              res[prop][key] = config[prop][key];\n            }\n          }\n        }\n      }\n      res.constellations.nameStyle.font = arrayfy(res.constellations.nameStyle.font);\n      res.constellations.nameStyle.opacity = arrayfy(res.constellations.nameStyle.opacity);\n      res.constellations.nameStyle.fill = arrayfy(res.constellations.nameStyle.fill);\n      res.constellations.lineStyle.width = arrayfy(res.constellations.lineStyle.width);\n      res.constellations.lineStyle.opacity = arrayfy(res.constellations.lineStyle.opacity);\n      res.constellations.lineStyle.stroke = arrayfy(res.constellations.lineStyle.stroke);\n      Object.assign(globalConfig, res);\n      return res;\n    },\n    applyDefaults: function (cfg) {\n      var res = {};\n      Object.assign(res, globalConfig);\n      // Nothing works without these\n      res.stars.size = res.stars.size || 7;\n      res.stars.exponent = res.stars.exponent || -0.28;\n      if (!res.center || res.center.length <= 0) res.center = [0, 0, 0];\n      res.datapath = res.datapath || \"\";\n      res.datapath = res.datapath.replace(/([^\\/]$)/, \"$1\\/\");\n      if (!res.transform || res.transform === \"\") res.transform = \"equatorial\";\n      // If no recognized language/culture settings, assume defaults\n      //if (!res.lang || res.lang.search(/^de|es$/) === -1) res.lang = \"name\";\n      //Set all poss. names to cfg.lang if not english\n      if (!res.culture || res.culture.search(/^cn$/) === -1) res.culture = \"iau\";\n      if (cfg) {\n        // Adapt legacy name parameters\n        if (has(cfg, \"stars\")) {\n          // names -> designation\n          if (has(cfg.stars, \"names\")) res.stars.designation = cfg.stars.names;\n          if (has(cfg.stars, \"namelimit\")) res.stars.designationLimit = cfg.stars.namelimit;\n          if (has(cfg.stars, \"namestyle\")) Object.assign(res.stars.designationStyle, cfg.stars.namestyle);\n          // proper -> propername\n          if (has(cfg.stars, \"proper\")) res.stars.propername = cfg.stars.proper;\n          if (has(cfg.stars, \"propernamelimit\")) res.stars.propernameLimit = cfg.stars.propernamelimit;\n          if (has(cfg.stars, \"propernamestyle\")) Object.assign(res.stars.propernameStyle, cfg.stars.propernamestyle);\n        }\n        if (has(cfg, \"dsos\")) {\n          // names, desig -> namesType\n          //if (has(cfg.dsos, \"names\") && cfg.dsos.names === true) res.dsos.namesType = \"name\";\n          if (has(cfg.dsos, \"desig\") && cfg.dsos.desig === true) res.dsos.namesType = \"desig\";\n          if (has(cfg.dsos, \"namelimit\")) res.dsos.nameLimit = cfg.dsos.namelimit;\n          if (has(cfg.dsos, \"namestyle\")) Object.assign(res.dsos.nameStyle, cfg.dsos.namestyle);\n        }\n        if (has(cfg, \"constellations\")) {\n          // names, desig -> namesType\n          if (has(cfg.constellations, \"show\") && cfg.constellations.show === true) res.constellations.names = true;\n          //if (has(cfg.constellations, \"names\") && cfg.constellations.names === true) res.constellations.namesType = \"name\";\n          if (has(cfg.constellations, \"desig\") && cfg.constellations.desig === true) res.constellations.namesType = \"desig\";\n          if (res.constellations.namesType === \"latin\") res.constellations.namesType = \"la\";\n          if (res.constellations.namesType === \"iau\") res.constellations.namesType = \"name\";\n          if (has(cfg.constellations, \"namestyle\")) Object.assign(res.constellations.nameStyle, cfg.constellations.namestyle);\n          if (has(cfg.constellations, \"linestyle\")) Object.assign(res.constellations.lineStyle, cfg.constellations.linestyle);\n          if (has(cfg.constellations, \"boundstyle\")) Object.assign(res.constellations.boundStyle, cfg.constellations.boundstyle);\n        }\n        if (has(cfg, \"planets\")) {\n          if (has(cfg.planets, \"style\")) Object.assign(res.planets.style, cfg.planets.symbolStyle);\n        }\n      }\n      //Assign default name types if none given\n      if (!res.stars.designationType || res.stars.designationType === \"\") res.stars.designationType = \"desig\";\n      if (!has(formats.starnames[res.culture].designation, res.stars.designationType)) res.designationType = \"desig\";\n      if (!res.stars.propernameType || res.stars.propernameType === \"\") res.stars.propernameType = \"name\";\n      if (!has(formats.starnames[res.culture].propername, res.stars.propernameType)) res.propernameType = \"name\";\n      if (!res.dsos.namesType || res.dsos.namesType === \"\") res.dsos.namesType = \"desig\";\n      if (!res.constellations.namesType || res.constellations.namesType === \"\") res.constellations.namesType = \"desig\";\n      if (!has(formats.constellations[res.culture].names, res.constellations.namesType)) res.constellations.namesType = \"name\";\n      if (!res.planets.symbolType || res.planets.symbolType === \"\") res.planets.symbolType = \"symbol\";\n      if (!res.planets.namesType || res.planets.namesType === \"\") res.planets.namesType = \"desig\";\n      if (!has(formats.planets[res.culture].names, res.planets.namesType)) res.planets.namesType = \"desig\";\n      //Expand all parameters that can be arrays into arrays, no need to test it later\n      res.constellations.nameStyle.font = arrayfy(res.constellations.nameStyle.font);\n      res.constellations.nameStyle.opacity = arrayfy(res.constellations.nameStyle.opacity);\n      res.constellations.nameStyle.fill = arrayfy(res.constellations.nameStyle.fill);\n      res.constellations.lineStyle.width = arrayfy(res.constellations.lineStyle.width);\n      res.constellations.lineStyle.opacity = arrayfy(res.constellations.lineStyle.opacity);\n      res.constellations.lineStyle.stroke = arrayfy(res.constellations.lineStyle.stroke);\n      Object.assign(globalConfig, res);\n      return res;\n    }\n  };\n  function arrayfy(o) {\n    var res;\n    if (!isArray(o)) return [o, o, o]; //It saves some work later, OK?\n    if (o.length >= 3) return o;\n    if (o.length === 1) return [o[0], o[0], o[0]];\n    if (o.length === 2) return [o[0], o[1], o[1]];\n  }\n  Celestial.settings = function () {\n    return settings;\n  };\n\n  //b-v color index to rgb color value scale\n  var bvcolor = d3.scale.quantize().domain([3.347, -0.335]) //main sequence <= 1.7\n  .range(['#ff4700', '#ff4b00', '#ff4f00', '#ff5300', '#ff5600', '#ff5900', '#ff5b00', '#ff5d00', '#ff6000', '#ff6300', '#ff6500', '#ff6700', '#ff6900', '#ff6b00', '#ff6d00', '#ff7000', '#ff7300', '#ff7500', '#ff7800', '#ff7a00', '#ff7c00', '#ff7e00', '#ff8100', '#ff8300', '#ff8506', '#ff870a', '#ff8912', '#ff8b1a', '#ff8e21', '#ff9127', '#ff932c', '#ff9631', '#ff9836', '#ff9a3c', '#ff9d3f', '#ffa148', '#ffa34b', '#ffa54f', '#ffa753', '#ffa957', '#ffab5a', '#ffad5e', '#ffb165', '#ffb269', '#ffb46b', '#ffb872', '#ffb975', '#ffbb78', '#ffbe7e', '#ffc184', '#ffc489', '#ffc78f', '#ffc892', '#ffc994', '#ffcc99', '#ffce9f', '#ffd1a3', '#ffd3a8', '#ffd5ad', '#ffd7b1', '#ffd9b6', '#ffdbba', '#ffddbe', '#ffdfc2', '#ffe1c6', '#ffe3ca', '#ffe4ce', '#ffe8d5', '#ffe9d9', '#ffebdc', '#ffece0', '#ffefe6', '#fff0e9', '#fff2ec', '#fff4f2', '#fff5f5', '#fff6f8', '#fff9fd', '#fef9ff', '#f9f6ff', '#f6f4ff', '#f3f2ff', '#eff0ff', '#ebeeff', '#e9edff', '#e6ebff', '#e3e9ff', '#e0e7ff', '#dee6ff', '#dce5ff', '#d9e3ff', '#d7e2ff', '#d3e0ff', '#c9d9ff', '#bfd3ff', '#b7ceff', '#afc9ff', '#a9c5ff', '#a4c2ff', '#9fbfff', '#9bbcff']);\n\n  /* Default parameters for each supported projection\r\n       arg: constructor argument, if any \r\n       scale: scale parameter so that they all have ~equal width, normalized to 1024 pixels\r\n       ratio: width/height ratio, 2.0 if none\r\n       clip: projection clipped to 90 degrees from center, otherwise to antimeridian\r\n  */\n  var projections = {\n    \"airy\": {\n      n: \"Airy’s Minimum Error\",\n      arg: Math.PI / 2,\n      scale: 360,\n      ratio: 1.0,\n      clip: true\n    },\n    \"aitoff\": {\n      n: \"Aitoff\",\n      arg: null,\n      scale: 162\n    },\n    \"armadillo\": {\n      n: \"Armadillo\",\n      arg: 0,\n      scale: 250\n    },\n    \"august\": {\n      n: \"August\",\n      arg: null,\n      scale: 94,\n      ratio: 1.4\n    },\n    \"azimuthalEqualArea\": {\n      n: \"Azimuthal Equal Area\",\n      arg: null,\n      scale: 340,\n      ratio: 1.0,\n      clip: true\n    },\n    \"azimuthalEquidistant\": {\n      n: \"Azimuthal Equidistant\",\n      arg: null,\n      scale: 320,\n      ratio: 1.0,\n      clip: true\n    },\n    \"baker\": {\n      n: \"Baker Dinomic\",\n      arg: null,\n      scale: 160,\n      ratio: 1.4\n    },\n    \"berghaus\": {\n      n: \"Berghaus Star\",\n      arg: 0,\n      scale: 320,\n      ratio: 1.0,\n      clip: true\n    },\n    \"boggs\": {\n      n: \"Boggs Eumorphic\",\n      arg: null,\n      scale: 170\n    },\n    \"bonne\": {\n      n: \"Bonne\",\n      arg: Math.PI / 2.5,\n      scale: 225,\n      ratio: 0.88\n    },\n    \"bromley\": {\n      n: \"Bromley\",\n      arg: null,\n      scale: 162\n    },\n    //  \"butterfly\": {n:\"Butterfly\", arg:null, scale:31, ratio:1.1, clip:true},\n    \"cassini\": {\n      n: \"Cassini\",\n      arg: null,\n      scale: 325,\n      ratio: 1.0,\n      clip: true\n    },\n    \"collignon\": {\n      n: \"Collignon\",\n      arg: null,\n      scale: 100,\n      ratio: 2.6\n    },\n    \"craig\": {\n      n: \"Craig Retroazimuthal\",\n      arg: 0,\n      scale: 310,\n      ratio: 1.5,\n      clip: true\n    },\n    \"craster\": {\n      n: \"Craster Parabolic\",\n      arg: null,\n      scale: 160\n    },\n    \"cylindricalEqualArea\": {\n      n: \"Cylindrical Equal Area\",\n      arg: Math.PI / 6,\n      scale: 190,\n      ratio: 2.3\n    },\n    \"cylindricalStereographic\": {\n      n: \"Cylindrical Stereographic\",\n      arg: Math.PI / 4,\n      scale: 230,\n      ratio: 1.3\n    },\n    \"eckert1\": {\n      n: \"Eckert I\",\n      arg: null,\n      scale: 175\n    },\n    \"eckert2\": {\n      n: \"Eckert II\",\n      arg: null,\n      scale: 175\n    },\n    \"eckert3\": {\n      n: \"Eckert III\",\n      arg: null,\n      scale: 190\n    },\n    \"eckert4\": {\n      n: \"Eckert IV\",\n      arg: null,\n      scale: 190\n    },\n    \"eckert5\": {\n      n: \"Eckert V\",\n      arg: null,\n      scale: 182\n    },\n    \"eckert6\": {\n      n: \"Eckert VI\",\n      arg: null,\n      scale: 182\n    },\n    \"eisenlohr\": {\n      n: \"Eisenlohr\",\n      arg: null,\n      scale: 102\n    },\n    \"equirectangular\": {\n      n: \"Equirectangular\",\n      arg: null,\n      scale: 165\n    },\n    \"fahey\": {\n      n: \"Fahey\",\n      arg: null,\n      scale: 196,\n      ratio: 1.4\n    },\n    \"mtFlatPolarParabolic\": {\n      n: \"Flat Polar Parabolic\",\n      arg: null,\n      scale: 175\n    },\n    \"mtFlatPolarQuartic\": {\n      n: \"Flat Polar Quartic\",\n      arg: null,\n      scale: 230,\n      ratio: 1.65\n    },\n    \"mtFlatPolarSinusoidal\": {\n      n: \"Flat Polar Sinusoidal\",\n      arg: null,\n      scale: 175,\n      ratio: 1.9\n    },\n    \"foucaut\": {\n      n: \"Foucaut\",\n      arg: null,\n      scale: 142\n    },\n    \"ginzburg4\": {\n      n: \"Ginzburg IV\",\n      arg: null,\n      scale: 180,\n      ratio: 1.7\n    },\n    \"ginzburg5\": {\n      n: \"Ginzburg V\",\n      arg: null,\n      scale: 196,\n      ratio: 1.55\n    },\n    \"ginzburg6\": {\n      n: \"Ginzburg VI\",\n      arg: null,\n      scale: 190,\n      ratio: 1.4\n    },\n    \"ginzburg8\": {\n      n: \"Ginzburg VIII\",\n      arg: null,\n      scale: 205,\n      ratio: 1.3\n    },\n    \"ginzburg9\": {\n      n: \"Ginzburg IX\",\n      arg: null,\n      scale: 190,\n      ratio: 1.4\n    },\n    //\"guyou\": {n:\"Guyou\", arg:null, scale:160, ratio:2, clip:true},\n    //\"bonne\": {n:\"Heart\", arg:Math.PI/2.5, scale:225, ratio:0.88},\n    \"homolosine\": {\n      n: \"Goode Homolosine\",\n      arg: null,\n      scale: 160,\n      ratio: 2.2\n    },\n    \"hammer\": {\n      n: \"Hammer\",\n      arg: 2,\n      scale: 180\n    },\n    \"hatano\": {\n      n: \"Hatano\",\n      arg: null,\n      scale: 186\n    },\n    \"healpix\": {\n      n: \"HEALPix\",\n      arg: 1,\n      scale: 320,\n      ratio: 1.2\n    },\n    \"hill\": {\n      n: \"Hill Eucyclic\",\n      arg: 2,\n      scale: 190,\n      ratio: 1.1\n    },\n    \"kavrayskiy7\": {\n      n: \"Kavrayskiy VII\",\n      arg: null,\n      scale: 185,\n      ratio: 1.75\n    },\n    \"lagrange\": {\n      n: \"Lagrange\",\n      arg: Math.PI / 4,\n      scale: 88,\n      ratio: 1.6,\n      clip: false\n    },\n    \"larrivee\": {\n      n: \"l'Arrivée\",\n      arg: null,\n      scale: 160,\n      ratio: 1.25\n    },\n    \"laskowski\": {\n      n: \"Laskowski Tri-Optimal\",\n      arg: null,\n      scale: 165,\n      ratio: 1.7\n    },\n    \"loximuthal\": {\n      n: \"Loximuthal\",\n      arg: Math.PI / 4,\n      scale: 175,\n      ratio: 1.8\n    },\n    \"mercator\": {\n      n: \"Mercator\",\n      arg: null,\n      scale: 160,\n      ratio: 1.3\n    },\n    \"miller\": {\n      n: \"Miller\",\n      arg: null,\n      scale: 160,\n      ratio: 1.5\n    },\n    \"mollweide\": {\n      n: \"Mollweide\",\n      arg: null,\n      scale: 180\n    },\n    \"naturalEarth\": {\n      n: \"Natural Earth\",\n      arg: null,\n      scale: 185,\n      ratio: 1.85\n    },\n    \"nellHammer\": {\n      n: \"Nell Hammer\",\n      arg: null,\n      scale: 160,\n      ratio: 2.6\n    },\n    \"orthographic\": {\n      n: \"Orthographic\",\n      arg: null,\n      scale: 480,\n      ratio: 1.0,\n      clip: true\n    },\n    \"patterson\": {\n      n: \"Patterson Cylindrical\",\n      arg: null,\n      scale: 160,\n      ratio: 1.75\n    },\n    \"polyconic\": {\n      n: \"Polyconic\",\n      arg: null,\n      scale: 160,\n      ratio: 1.3\n    },\n    \"quincuncial\": {\n      n: \"Quincuncial\",\n      arg: null,\n      scale: 160,\n      ratio: 1.3\n    },\n    \"rectangularPolyconic\": {\n      n: \"Rectangular Polyconic\",\n      arg: 0,\n      scale: 160,\n      ratio: 1.65\n    },\n    \"robinson\": {\n      n: \"Robinson\",\n      arg: null,\n      scale: 160\n    },\n    \"sinusoidal\": {\n      n: \"Sinusoidal\",\n      arg: null,\n      scale: 160,\n      ratio: 2\n    },\n    \"stereographic\": {\n      n: \"Stereographic\",\n      arg: null,\n      scale: 500,\n      ratio: 1.0,\n      clip: true\n    },\n    \"times\": {\n      n: \"Times\",\n      arg: null,\n      scale: 210,\n      ratio: 1.4\n    },\n    \"twoPointEquidistant\": {\n      n: \"Two-Point Equidistant\",\n      arg: Math.PI / 2,\n      scale: 320,\n      ratio: 1.15,\n      clip: true\n    },\n    \"vanDerGrinten\": {\n      n: \"van Der Grinten\",\n      arg: null,\n      scale: 160,\n      ratio: 1.0\n    },\n    \"vanDerGrinten2\": {\n      n: \"van Der Grinten II\",\n      arg: null,\n      scale: 160,\n      ratio: 1.0\n    },\n    \"vanDerGrinten3\": {\n      n: \"van Der Grinten III\",\n      arg: null,\n      scale: 160,\n      ratio: 1.0\n    },\n    \"vanDerGrinten4\": {\n      n: \"van Der Grinten IV\",\n      arg: null,\n      scale: 160,\n      ratio: 1.6\n    },\n    \"wagner4\": {\n      n: \"Wagner IV\",\n      arg: null,\n      scale: 185\n    },\n    \"wagner6\": {\n      n: \"Wagner VI\",\n      arg: null,\n      scale: 160\n    },\n    \"wagner7\": {\n      n: \"Wagner VII\",\n      arg: null,\n      scale: 190,\n      ratio: 1.8\n    },\n    \"wiechel\": {\n      n: \"Wiechel\",\n      arg: null,\n      scale: 360,\n      ratio: 1.0,\n      clip: true\n    },\n    \"winkel3\": {\n      n: \"Winkel Tripel\",\n      arg: null,\n      scale: 196,\n      ratio: 1.7\n    }\n  };\n  Celestial.projections = function () {\n    return projections;\n  };\n  var formats = {\n    \"starnames\": {\n      // \"name\":\"\",\"bayer\":\"\",\"flam\":\"\",\"var\":\"\",\"gl\":\"\",\"hd\":\"\",\"c\":\"\",\"desig\":\"\"\n      \"iau\": {\n        \"designation\": {\n          \"desig\": \"Designation\",\n          \"bayer\": \"Bayer\",\n          \"flam\": \"Flamsteed\",\n          \"var\": \"Variable\",\n          \"gl\": \"Gliese\",\n          \"hd\": \"Draper\",\n          \"hip\": \"Hipparcos\"\n        },\n        \"propername\": {\n          \"name\": \"IAU Name\",\n          \"ar\": \"Arabic\",\n          \"zh\": \"Chinese\",\n          \"en\": \"English\",\n          \"fi\": \"Finnish\",\n          \"fr\": \"French\",\n          \"de\": \"German\",\n          \"el\": \"Greek\",\n          \"he\": \"Hebrew\",\n          \"hi\": \"Hindi\",\n          \"it\": \"Italian\",\n          \"ja\": \"Japanese\",\n          \"ko\": \"Korean\",\n          \"la\": \"Latin\",\n          \"fa\": \"Persian\",\n          \"ru\": \"Russian\",\n          \"es\": \"Spanish\",\n          \"tr\": \"Turkish\"\n        }\n      },\n      \"cn\": {\n        \"propername\": {\n          \"name\": \"Proper name\",\n          \"en\": \"English\",\n          \"pinyin\": \"Pinyin\"\n        },\n        \"designation\": {\n          \"desig\": \"IAU Designation\"\n        }\n      }\n    },\n    \"constellations\": {\n      \"iau\": {\n        \"names\": {\n          \"desig\": \"Designation\",\n          \"name\": \"IAU Name\",\n          \"ar\": \"Arabic\",\n          \"zh\": \"Chinese\",\n          \"cz\": \"Czech\",\n          \"en\": \"English\",\n          \"ee\": \"Estonian\",\n          \"fi\": \"Finnish\",\n          \"fr\": \"French\",\n          \"de\": \"German\",\n          \"el\": \"Greek\",\n          \"he\": \"Hebrew\",\n          \"hi\": \"Hindi\",\n          \"it\": \"Italian\",\n          \"ja\": \"Japanese\",\n          \"sw\": \"Kiswahili\",\n          \"ko\": \"Korean\",\n          \"la\": \"Latin\",\n          \"fa\": \"Persian\",\n          \"ru\": \"Russian\",\n          \"es\": \"Spanish\",\n          \"tr\": \"Turkish\"\n        }\n      },\n      \"cn\": {\n        \"names\": {\n          \"name\": \"Proper name\",\n          \"en\": \"English\",\n          \"pinyin\": \"Pinyin\"\n        }\n      }\n    },\n    \"planets\": {\n      \"iau\": {\n        \"symbol\": {\n          \"symbol\": \"\\u263e Symbol\",\n          \"letter\": \"\\u216c Letter\",\n          \"disk\": \"\\u25cf Disk\"\n        },\n        \"names\": {\n          \"desig\": \"Designation\",\n          \"ar\": \"Arabic\",\n          \"zh\": \"Chinese\",\n          \"en\": \"English\",\n          \"fr\": \"French\",\n          \"de\": \"German\",\n          \"el\": \"Greek\",\n          \"he\": \"Hebrew\",\n          \"hi\": \"Hindi\",\n          \"it\": \"Italian\",\n          \"ja\": \"Japanese\",\n          \"ko\": \"Korean\",\n          \"la\": \"Latin\",\n          \"fa\": \"Persian\",\n          \"ru\": \"Russian\",\n          \"es\": \"Spanish\"\n        }\n      },\n      \"cn\": {\n        \"symbol\": {\n          \"symbol\": \"\\u263e Symbol\",\n          \"letter\": \"\\u216c Letter\",\n          \"disk\": \"\\u25cf Disk\"\n        },\n        \"names\": {\n          \"desig\": \"Designation\",\n          \"name\": \"Chinese\",\n          \"pinyin\": \"Pinyin\",\n          \"en\": \"English\"\n        }\n      }\n    },\n    \"dsonames\": {\n      \"iau\": {\n        \"names\": {\n          \"desig\": \"Designation\",\n          \"name\": \"English\",\n          \"ar\": \"Arabic\",\n          \"zh\": \"Chinese\",\n          \"fi\": \"Finnish\",\n          \"fr\": \"French\",\n          \"de\": \"German\",\n          \"el\": \"Greek\",\n          //\"he\": \"Hebrew\",\n          \"hi\": \"Hindi\",\n          \"it\": \"Italian\",\n          \"ja\": \"Japanese\",\n          \"ko\": \"Korean\",\n          \"la\": \"Latin\",\n          \"fa\": \"Persian\",\n          \"ru\": \"Russian\",\n          \"es\": \"Spanish\",\n          \"tr\": \"Turkish\"\n        }\n      },\n      \"cn\": {\n        \"names\": {\n          \"desig\": \"Designation\",\n          \"name\": \"Chinese\",\n          \"pinyin\": \"Pinyin\",\n          \"en\": \"English\"\n        }\n      }\n    }\n  };\n  var formats_all = {\n    \"iau\": Object.keys(formats.constellations.iau.names).concat(Object.keys(formats.planets.iau.names)).filter(function (value, index, self) {\n      return self.indexOf(value) === index;\n    }),\n    \"cn\": Object.keys(formats.constellations.cn.names).concat(Object.keys(formats.starnames.cn.propername)).filter(function (value, index, self) {\n      return self.indexOf(value) === index;\n    })\n  };\n  var Canvas = {};\n  Canvas.symbol = function () {\n    // parameters and default values\n    var type = d3.functor(\"circle\"),\n      size = d3.functor(64),\n      age = d3.functor(Math.PI),\n      //crescent shape 0..2Pi\n      color = d3.functor(\"#fff\"),\n      text = d3.functor(\"\"),\n      padding = d3.functor([2, 2]),\n      pos;\n    function canvas_symbol(context) {\n      draw_symbol[type()](context);\n    }\n    var draw_symbol = {\n      \"circle\": function (ctx) {\n        var s = Math.sqrt(size()),\n          r = s / 2;\n        ctx.arc(pos[0], pos[1], r, 0, 2 * Math.PI);\n        ctx.closePath();\n        return r;\n      },\n      \"square\": function (ctx) {\n        var s = Math.sqrt(size()),\n          r = s / 1.7;\n        ctx.moveTo(pos[0] - r, pos[1] - r);\n        ctx.lineTo(pos[0] + r, pos[1] - r);\n        ctx.lineTo(pos[0] + r, pos[1] + r);\n        ctx.lineTo(pos[0] - r, pos[1] + r);\n        ctx.closePath();\n        return r;\n      },\n      \"diamond\": function (ctx) {\n        var s = Math.sqrt(size()),\n          r = s / 1.5;\n        ctx.moveTo(pos[0], pos[1] - r);\n        ctx.lineTo(pos[0] + r, pos[1]);\n        ctx.lineTo(pos[0], pos[1] + r);\n        ctx.lineTo(pos[0] - r, pos[1]);\n        ctx.closePath();\n        return r;\n      },\n      \"triangle\": function (ctx) {\n        var s = Math.sqrt(size()),\n          r = s / Math.sqrt(3);\n        ctx.moveTo(pos[0], pos[1] - r);\n        ctx.lineTo(pos[0] + r, pos[1] + r);\n        ctx.lineTo(pos[0] - r, pos[1] + r);\n        ctx.closePath();\n        return r;\n      },\n      \"ellipse\": function (ctx) {\n        var s = Math.sqrt(size()),\n          r = s / 2;\n        ctx.save();\n        ctx.translate(pos[0], pos[1]);\n        ctx.scale(1.6, 0.8);\n        ctx.beginPath();\n        ctx.arc(0, 0, r, 0, 2 * Math.PI);\n        ctx.closePath();\n        ctx.restore();\n        return r;\n      },\n      \"marker\": function (ctx) {\n        var s = Math.sqrt(size()),\n          r = s / 2;\n        ctx.moveTo(pos[0], pos[1] - r);\n        ctx.lineTo(pos[0], pos[1] + r);\n        ctx.moveTo(pos[0] - r, pos[1]);\n        ctx.lineTo(pos[0] + r, pos[1]);\n        ctx.closePath();\n        return r;\n      },\n      \"cross-circle\": function (ctx) {\n        var s = Math.sqrt(size()),\n          r = s / 2;\n        ctx.moveTo(pos[0], pos[1] - s);\n        ctx.lineTo(pos[0], pos[1] + s);\n        ctx.moveTo(pos[0] - s, pos[1]);\n        ctx.lineTo(pos[0] + s, pos[1]);\n        ctx.stroke();\n        ctx.beginPath();\n        ctx.moveTo(pos[0], pos[1]);\n        ctx.arc(pos[0], pos[1], r, 0, 2 * Math.PI);\n        ctx.closePath();\n        return r;\n      },\n      \"stroke-circle\": function (ctx) {\n        var s = Math.sqrt(size()),\n          r = s / 2;\n        ctx.moveTo(pos[0], pos[1] - s);\n        ctx.lineTo(pos[0], pos[1] + s);\n        ctx.stroke();\n        ctx.beginPath();\n        ctx.moveTo(pos[0], pos[1]);\n        ctx.arc(pos[0], pos[1], r, 0, 2 * Math.PI);\n        ctx.closePath();\n        return r;\n      },\n      \"crescent\": function (ctx) {\n        var s = Math.sqrt(size()),\n          r = s / 2,\n          ag = age(),\n          ph = 0.5 * (1 - Math.cos(ag)),\n          e = 1.6 * Math.abs(ph - 0.5) + 0.01,\n          dir = ag > Math.PI,\n          termdir = Math.abs(ph) > 0.5 ? dir : !dir,\n          moonFill = ctx.fillStyle,\n          darkFill = ph < 0.157 ? \"#669\" : \"#557\";\n        ctx.save();\n        ctx.fillStyle = darkFill;\n        ctx.beginPath();\n        ctx.moveTo(pos[0], pos[1]);\n        ctx.arc(pos[0], pos[1], r, 0, 2 * Math.PI);\n        ctx.closePath();\n        ctx.fill();\n        ctx.fillStyle = moonFill;\n        ctx.beginPath();\n        ctx.moveTo(pos[0], pos[1]);\n        ctx.arc(pos[0], pos[1], r, -Math.PI / 2, Math.PI / 2, dir);\n        ctx.scale(e, 1);\n        ctx.arc(pos[0] / e, pos[1], r, Math.PI / 2, -Math.PI / 2, termdir);\n        ctx.closePath();\n        ctx.fill();\n        ctx.restore();\n        return r;\n      }\n    };\n    canvas_symbol.type = function (_) {\n      if (!arguments.length) return type;\n      type = d3.functor(_);\n      return canvas_symbol;\n    };\n    canvas_symbol.size = function (_) {\n      if (!arguments.length) return size;\n      size = d3.functor(_);\n      return canvas_symbol;\n    };\n    canvas_symbol.age = function (_) {\n      if (!arguments.length) return age;\n      age = d3.functor(_);\n      return canvas_symbol;\n    };\n    canvas_symbol.text = function (_) {\n      if (!arguments.length) return text;\n      text = d3.functor(_);\n      return canvas_symbol;\n    };\n    canvas_symbol.position = function (_) {\n      if (!arguments.length) return;\n      pos = _;\n      return canvas_symbol;\n    };\n    return canvas_symbol;\n  };\n  Celestial.Canvas = Canvas;\n\n  /*var color = \"#fff\", angle = 0, align = \"center\", baseline = \"middle\", font = \"10px sans-serif\", padding = [0,0], aPos, sText;\r\n  \r\n  canvas.text = function () {\r\n  \r\n    function txt(ctx){\r\n      ctx.fillStyle = color;\r\n      ctx.textAlign = align;\r\n      ctx.textBaseline = baseline;\r\n      \r\n      //var pt = projection(d.geometry.coordinates);\r\n      if (angle) {\r\n        canvas.save();     \r\n        canvas.translate(aPos[0], aPos[1]);\r\n        canvas.rotate(angle); \r\n        canvas.fillText(sText, 0, 0);\r\n        canvas.restore();     \r\n      } else\r\n        canvas.fillText(sText, aPos[0], aPos[1]);\r\n    }\r\n    \r\n    txt.angle = function(x) {\r\n      if (!arguments.length) return angle * 180 / Math.PI;\r\n      color = x  * Math.PI / 180;\r\n      return txt;\r\n    };  \r\n    txt.color = function(s) {\r\n      if (!arguments.length) return color;\r\n      color = s;\r\n      return txt;\r\n    };  \r\n    txt.align = function(s) {\r\n      if (!arguments.length) return align;\r\n      align = s;\r\n      return txt;\r\n    };\r\n    txt.baseline = function(s) {\r\n      if (!arguments.length) return baseline;\r\n      baseline = s;\r\n      return txt;\r\n    };\r\n    txt.padding = function(a) {\r\n      if (!arguments.length) return padding;\r\n      padding = a;\r\n      return txt;\r\n    };\r\n    txt.text = function(s) {\r\n      if (!arguments.length) return sText;\r\n      sText = s;\r\n      return txt;\r\n    };\r\n    txt.font = function(s) {\r\n      if (!arguments.length) return font;\r\n      font = s;\r\n      return txt;\r\n    };\r\n    txt.style = function(o) {\r\n      if (!arguments.length) return;\r\n      if (o.fill) color = o.fill;\r\n      if (o.font) font = o.font;\r\n      return txt;\r\n    }; \r\n    \r\n  }\r\n  \r\n    function ctxPath(d) {\r\n      var pt;\r\n      //d.map( function(axe, i) {\r\n      context.beginPath();\r\n      for (var i = 0; i < d.length; i++) {\r\n        pt = projection(d[i]);\r\n        if (i === 0)\r\n          context.moveTo(pt[0], pt[1]);\r\n        else\r\n          context.lineTo(pt[0], pt[1]);\r\n      }\r\n      context.fill();\r\n    }\r\n    \r\n  \r\n    function ctxText(d, ang) {\r\n      var pt = projection(d.geometry.coordinates);\r\n      if (ang) {\r\n        canvas.save();     \r\n        canvas.translate(pt[0], pt[1]);\r\n        canvas.rotate(Math.PI/2); \r\n        canvas.fillText(txt, 0, 0);\r\n        canvas.restore();     \r\n      } else\r\n        canvas.fillText(d.properties.txt, pt[0], pt[1]);\r\n    }\r\n    \r\n  \r\n  */\n  function $(id) {\n    return document.querySelector(parentElement + \" #\" + id);\n  }\n  function px(n) {\n    return n + \"px\";\n  }\n  function Round(x, dg) {\n    return Math.round(Math.pow(10, dg) * x) / Math.pow(10, dg);\n  }\n  function sign(x) {\n    return x ? x < 0 ? -1 : 1 : 0;\n  }\n  function pad(n) {\n    return n < 10 ? '0' + n : n;\n  }\n  function has(o, key) {\n    return o !== null && hasOwnProperty.call(o, key);\n  }\n  function when(o, key, val) {\n    return o !== null && hasOwnProperty.call(o, key) ? o[key] : val;\n  }\n  function isNumber(n) {\n    return n !== null && !isNaN(parseFloat(n)) && isFinite(n);\n  }\n  function isArray(o) {\n    return o !== null && Object.prototype.toString.call(o) === \"[object Array]\";\n  }\n  function isObject(o) {\n    var type = typeof o;\n    return type === 'function' || type === 'object' && !!o;\n  }\n  function isFunction(o) {\n    return typeof o == 'function' || false;\n  }\n  function isValidDate(d) {\n    return d && d instanceof Date && !isNaN(d);\n  }\n  function fileExists(url) {\n    var http = new XMLHttpRequest();\n    http.open('HEAD', url, false);\n    http.send();\n    return http.status != 404;\n  }\n  function findPos(o) {\n    var l = 0,\n      t = 0;\n    if (o.offsetParent) {\n      do {\n        l += o.offsetLeft;\n        t += o.offsetTop;\n      } while ((o = o.offsetParent) !== null);\n    }\n    return [l, t];\n  }\n  function hasParent(t, id) {\n    while (t.parentNode) {\n      if (t.id === id) return true;\n      t = t.parentNode;\n    }\n    return false;\n  }\n  function attach(node, event, func) {\n    if (node.addEventListener) node.addEventListener(event, func, false);else node.attachEvent(\"on\" + event, func);\n  }\n  function stopPropagation(e) {\n    if (typeof e.stopPropagation != \"undefined\") e.stopPropagation();else e.cancelBubble = true;\n  }\n  function dateDiff(dt1, dt2, type) {\n    var diff = dt2.valueOf() - dt1.valueOf(),\n      tp = type || \"d\";\n    switch (tp) {\n      case 'y':\n      case 'yr':\n        diff /= 31556926080;\n        break;\n      case 'm':\n      case 'mo':\n        diff /= 2629800000;\n        break;\n      case 'd':\n      case 'dy':\n        diff /= 86400000;\n        break;\n      case 'h':\n      case 'hr':\n        diff /= 3600000;\n        break;\n      case 'n':\n      case 'mn':\n        diff /= 60000;\n        break;\n      case 's':\n      case 'sec':\n        diff /= 1000;\n        break;\n      case 'ms':\n        break;\n    }\n    return Math.floor(diff);\n  }\n  function dateParse(s) {\n    if (!s) return;\n    var t = s.split(\".\");\n    if (t.length < 1) return;\n    t = t[0].split(\"-\");\n    t[0] = t[0].replace(/\\D/g, \"\");\n    if (!t[0]) return;\n    t[1] = t[1] ? t[1].replace(/\\D/g, \"\") : \"1\";\n    t[2] = t[2] ? t[2].replace(/\\D/g, \"\") : \"1\";\n    //Fraction -> h:m:s\n    return new Date(Date.UTC(t[0], t[1] - 1, t[2]));\n  }\n  function interpolateAngle(a1, a2, t) {\n    a1 = (a1 * deg2rad + τ) % τ;\n    a2 = (a2 * deg2rad + τ) % τ;\n    if (Math.abs(a1 - a2) > Math.PI) {\n      if (a1 > a2) a1 = a1 - τ;else if (a2 > a1) a2 = a2 - τ;\n    }\n    return d3.interpolateNumber(a1 / deg2rad, a2 / deg2rad);\n  }\n  var Trig = {\n    sinh: function (val) {\n      return (Math.pow(Math.E, val) - Math.pow(Math.E, -val)) / 2;\n    },\n    cosh: function (val) {\n      return (Math.pow(Math.E, val) + Math.pow(Math.E, -val)) / 2;\n    },\n    tanh: function (val) {\n      return 2.0 / (1.0 + Math.exp(-2.0 * val)) - 1.0;\n    },\n    asinh: function (val) {\n      return Math.log(val + Math.sqrt(val * val + 1));\n    },\n    acosh: function (val) {\n      return Math.log(val + Math.sqrt(val * val - 1));\n    },\n    normalize0: function (val) {\n      return (val + Math.PI * 3) % (Math.PI * 2) - Math.PI;\n    },\n    normalize: function (val) {\n      return (val + Math.PI * 2) % (Math.PI * 2);\n    },\n    cartesian: function (p) {\n      var ϕ = p[0],\n        θ = halfπ - p[1],\n        r = p[2];\n      return {\n        \"x\": r * Math.sin(θ) * Math.cos(ϕ),\n        \"y\": r * Math.sin(θ) * Math.sin(ϕ),\n        \"z\": r * Math.cos(θ)\n      };\n    },\n    spherical: function (p) {\n      var r = Math.sqrt(p.x * p.x + p.y * p.y + p.z * p.z),\n        θ = Math.atan(p.y / p.x),\n        ϕ = Math.acos(p.z / r);\n      return [θ / deg2rad, ϕ / deg2rad, r];\n    },\n    distance: function (p1, p2) {\n      return Math.acos(Math.sin(p1[1]) * Math.sin(p2[1]) + Math.cos(p1[1]) * Math.cos(p2[1]) * Math.cos(p1[0] - p2[0]));\n    }\n  };\n  var epsilon = 1e-6,\n    halfPi = Math.PI / 2,\n    quarterPi = Math.PI / 4,\n    tau = Math.PI * 2;\n  function cartesian(spherical) {\n    var lambda = spherical[0],\n      phi = spherical[1],\n      cosPhi = Math.cos(phi);\n    return [cosPhi * Math.cos(lambda), cosPhi * Math.sin(lambda), Math.sin(phi)];\n  }\n  function cartesianCross(a, b) {\n    return [a[1] * b[2] - a[2] * b[1], a[2] * b[0] - a[0] * b[2], a[0] * b[1] - a[1] * b[0]];\n  }\n  function cartesianNormalizeInPlace(d) {\n    var l = Math.sqrt(d[0] * d[0] + d[1] * d[1] + d[2] * d[2]);\n    d[0] /= l;\n    d[1] /= l;\n    d[2] /= l;\n  }\n  function longitude(point) {\n    if (Math.abs(point[0]) <= Math.PI) return point[0];else return sign(point[0]) * ((Math.abs(point[0]) + Math.PI) % tau - Math.PI);\n  }\n  function poligonContains(polygon, point) {\n    var lambda = longitude(point),\n      phi = point[1],\n      sinPhi = Math.sin(phi),\n      normal = [Math.sin(lambda), -Math.cos(lambda), 0],\n      angle = 0,\n      winding = 0,\n      sum = 0;\n    if (sinPhi === 1) phi = halfPi + epsilon;else if (sinPhi === -1) phi = -halfPi - epsilon;\n    for (var i = 0, n = polygon.length; i < n; ++i) {\n      if (!(m = (ring = polygon[i]).length)) continue;\n      var ring,\n        m,\n        point0 = ring[m - 1],\n        lambda0 = longitude(point0),\n        phi0 = point0[1] / 2 + quarterPi,\n        sinPhi0 = Math.sin(phi0),\n        cosPhi0 = Math.cos(phi0),\n        point1,\n        cosPhi1,\n        sinPhi1,\n        lambda1;\n      for (var j = 0; j < m; ++j, lambda0 = lambda1, sinPhi0 = sinPhi1, cosPhi0 = cosPhi1, point0 = point1) {\n        point1 = ring[j];\n        lambda1 = longitude(point1);\n        var phi1 = point1[1] / 2 + quarterPi;\n        sinPhi1 = Math.sin(phi1);\n        cosPhi1 = Math.cos(phi1);\n        var delta = lambda1 - lambda0,\n          sign = delta >= 0 ? 1 : -1,\n          absDelta = sign * delta,\n          antimeridian = absDelta > Math.PI,\n          k = sinPhi0 * sinPhi1;\n        sum += Math.atan2(k * sign * Math.sin(absDelta), cosPhi0 * cosPhi1 + k * Math.cos(absDelta));\n        angle += antimeridian ? delta + sign * tau : delta;\n        if ((antimeridian ^ lambda0) >= (lambda ^ lambda1) >= lambda) {\n          var arc = cartesianCross(cartesian(point0), cartesian(point1));\n          cartesianNormalizeInPlace(arc);\n          var intersection = cartesianCross(normal, arc);\n          cartesianNormalizeInPlace(intersection);\n          var phiArc = (antimeridian ^ delta >= 0 ? -1 : 1) * Math.asin(intersection[2]);\n          if (phi > phiArc || phi === phiArc && (arc[0] || arc[1])) {\n            winding += antimeridian ^ delta >= 0 ? 1 : -1;\n          }\n        }\n      }\n    }\n    return (angle < -epsilon || angle < epsilon && sum < -epsilon) ^ winding & 1;\n  }\n\n  //display settings form in div with id \"celestial-form\"\n  function form(cfg) {\n    var config = settings.set(cfg);\n    var prj = Celestial.projections(),\n      leo = Celestial.eulerAngles();\n    var div = d3.select(parentElement + \" ~ #celestial-form\");\n    //if div doesn't exist, create it\n    if (div.size() < 1) {\n      //var container = (config.container || \"celestial-map\");\n      div = d3.select(parentElement).select(function () {\n        return this.parentNode;\n      }).append(\"div\").attr(\"id\", \"celestial-form\");\n    }\n    var ctrl = div.append(\"div\").attr(\"class\", \"ctrl\");\n    var frm = ctrl.append(\"form\").attr(\"id\", \"params\").attr(\"name\", \"params\").attr(\"method\", \"get\").attr(\"action\", \"#\");\n\n    //Map parameters    \n    var col = frm.append(\"div\").attr(\"class\", \"col\").attr(\"id\", \"general\");\n    col.append(\"label\").attr(\"title\", \"Map width in pixel, 0 indicates full width\").attr(\"for\", \"width\").html(\"Width \");\n    col.append(\"input\").attr(\"type\", \"number\").attr(\"maxlength\", \"4\").attr(\"max\", \"20000\").attr(\"min\", \"0\").attr(\"title\", \"Map width\").attr(\"id\", \"width\").attr(\"value\", config.width).on(\"change\", resize);\n    col.append(\"span\").html(\"px\");\n    col.append(\"label\").attr(\"title\", \"Map projection, (hemi) indicates hemispherical projection\").attr(\"for\", \"projection\").html(\"Projection\");\n    var sel = col.append(\"select\").attr(\"id\", \"projection\").on(\"change\", reproject);\n    var selected = 0;\n    var list = Object.keys(prj).map(function (key, i) {\n      var n = prj[key].clip && prj[key].clip === true ? prj[key].n + \" (hemi)\" : prj[key].n;\n      if (key === config.projection) selected = i;\n      return {\n        o: key,\n        n: n\n      };\n    });\n    sel.selectAll('option').data(list).enter().append('option').attr(\"value\", function (d) {\n      return d.o;\n    }).text(function (d) {\n      return d.n;\n    });\n    sel.property(\"selectedIndex\", selected);\n    selected = 0;\n    col.append(\"label\").attr(\"title\", \"Coordinate space in which the map is displayed\").attr(\"for\", \"transform\").html(\"Coordinates\");\n    sel = col.append(\"select\").attr(\"id\", \"transform\").on(\"change\", reload);\n    list = Object.keys(leo).map(function (key, i) {\n      if (key === config.transform) selected = i;\n      return {\n        o: key,\n        n: key.replace(/^([a-z])/, function (s, m) {\n          return m.toUpperCase();\n        })\n      };\n    });\n    sel.selectAll(\"option\").data(list).enter().append('option').attr(\"value\", function (d) {\n      return d.o;\n    }).text(function (d) {\n      return d.n;\n    });\n    sel.property(\"selectedIndex\", selected);\n    col.append(\"br\");\n    col.append(\"label\").attr(\"title\", \"Center coordinates long/lat in selected coordinate space\").attr(\"for\", \"centerx\").html(\"Center\");\n    col.append(\"input\").attr(\"type\", \"number\").attr(\"id\", \"centerx\").attr(\"title\", \"Center right ascension/longitude\").attr(\"max\", \"24\").attr(\"min\", \"0\").attr(\"step\", \"0.1\").on(\"change\", turn);\n    col.append(\"span\").attr(\"id\", \"cxunit\").html(\"h\");\n    //addList(\"centerx\", \"ra\");\n\n    col.append(\"input\").attr(\"type\", \"number\").attr(\"id\", \"centery\").attr(\"title\", \"Center declination/latitude\").attr(\"max\", \"90\").attr(\"min\", \"-90\").attr(\"step\", \"0.1\").on(\"change\", turn);\n    col.append(\"span\").html(\"\\u00b0\");\n    col.append(\"label\").attr(\"title\", \"Orientation\").attr(\"for\", \"centerz\").html(\"Orientation\");\n    col.append(\"input\").attr(\"type\", \"number\").attr(\"id\", \"centerz\").attr(\"title\", \"Center orientation\").attr(\"max\", \"180\").attr(\"min\", \"-180\").attr(\"step\", \"0.1\").on(\"change\", turn);\n    col.append(\"span\").html(\"\\u00b0\");\n    col.append(\"label\").attr(\"for\", \"orientationfixed\").attr(\"class\", \"advanced\").html(\"Fixed\");\n    col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"orientationfixed\").attr(\"class\", \"advanced\").property(\"checked\", config.orientationfixed).on(\"change\", apply);\n    col.append(\"label\").attr(\"title\", \"Center and zoom in on this constellation\").attr(\"for\", \"constellation\").html(\"Show\");\n    col.append(\"select\").attr(\"id\", \"constellation\").on(\"change\", showConstellation);\n    setCenter(config.center, config.transform);\n\n    // Stars \n    col = frm.append(\"div\").attr(\"class\", \"col\").attr(\"id\", \"stars\");\n    col.append(\"label\").attr(\"class\", \"header\").attr(\"for\", \"stars-show\").html(\"Stars\");\n    col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"stars-show\").property(\"checked\", config.stars.show).on(\"change\", apply);\n    col.append(\"label\").attr(\"for\", \"stars-limit\").html(\"down to magnitude\");\n    col.append(\"input\").attr(\"type\", \"number\").attr(\"id\", \"stars-limit\").attr(\"title\", \"Star display limit (magnitude)\").attr(\"value\", config.stars.limit).attr(\"max\", \"6\").attr(\"min\", \"-1\").attr(\"step\", \"0.1\").on(\"change\", apply);\n    col.append(\"label\").attr(\"for\", \"stars-colors\").html(\"with spectral colors\");\n    col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"stars-colors\").property(\"checked\", config.stars.colors).on(\"change\", apply);\n    col.append(\"label\").attr(\"for\", \"stars-color\").html(\"or default color \");\n    col.append(\"input\").attr(\"type\", \"color\").attr(\"autocomplete\", \"off\").attr(\"id\", \"stars-style-fill\").attr(\"title\", \"Star color\").property(\"value\", config.stars.style.fill).on(\"change\", apply);\n    col.append(\"br\");\n    var names = formats.starnames[config.culture] || formats.starnames.iau;\n    for (var fld in names) {\n      if (!has(names, fld)) continue;\n      var keys = Object.keys(names[fld]);\n      if (keys.length > 1) {\n        //Select List\n        col.append(\"label\").attr(\"for\", \"stars-\" + fld).html(\"Show\");\n        selected = 0;\n        col.append(\"label\").attr(\"title\", \"Type of star name\").attr(\"id\", \"label-propername\").attr(\"for\", \"stars-\" + fld + \"Type\").html(function () {\n          return fld === \"propername\" ? \"proper names\" : \"\";\n        });\n        sel = col.append(\"select\").attr(\"id\", \"stars-\" + fld + \"Type\").attr(\"class\", function () {\n          return fld === \"propername\" ? \"advanced\" : \"\";\n        }).on(\"change\", apply);\n        list = keys.map(function (key, i) {\n          if (key === config.stars[fld + \"Type\"]) selected = i;\n          return {\n            o: key,\n            n: names[fld][key]\n          };\n        });\n        sel.selectAll(\"option\").data(list).enter().append('option').attr(\"value\", function (d) {\n          return d.o;\n        }).text(function (d) {\n          return d.n;\n        });\n        sel.property(\"selectedIndex\", selected);\n        col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"stars-\" + fld).property(\"checked\", config.stars[fld]).on(\"change\", apply);\n      } else if (keys.length === 1) {\n        //Simple field\n        col.append(\"label\").attr(\"for\", \"stars-\" + fld).html(\" \" + names[fld][keys[0]]);\n        col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"stars-\" + fld).property(\"checked\", config.stars[fld]).on(\"change\", apply);\n      }\n      col.append(\"label\").attr(\"for\", \"stars-\" + fld + \"Limit\").html(\"down to mag\");\n      col.append(\"input\").attr(\"type\", \"number\").attr(\"id\", \"stars-\" + fld + \"Limit\").attr(\"title\", \"Star name display limit (magnitude)\").attr(\"value\", config.stars[fld + \"Limit\"]).attr(\"max\", \"6\").attr(\"min\", \"-1\").attr(\"step\", \"0.1\").on(\"change\", apply);\n    }\n    col.append(\"br\");\n    col.append(\"label\").attr(\"for\", \"stars-size\").attr(\"class\", \"advanced\").html(\"Stellar disk size: base\");\n    col.append(\"input\").attr(\"type\", \"number\").attr(\"id\", \"stars-size\").attr(\"class\", \"advanced\").attr(\"title\", \"Size of the displayed star disk; base\").attr(\"value\", config.stars.size).attr(\"max\", \"100\").attr(\"min\", \"0\").attr(\"step\", \"0.1\").on(\"change\", apply);\n    col.append(\"label\").attr(\"for\", \"stars-exponent\").attr(\"class\", \"advanced\").html(\" * e ^ (exponent\");\n    col.append(\"input\").attr(\"type\", \"number\").attr(\"id\", \"stars-exponent\").attr(\"class\", \"advanced\").attr(\"title\", \"Size of the displayed star disk; exponent\").attr(\"value\", config.stars.exponent).attr(\"max\", \"3\").attr(\"min\", \"-1\").attr(\"step\", \"0.01\").on(\"change\", apply);\n    col.append(\"span\").attr(\"class\", \"advanced\").text(\" * (magnitude + 2))  [* adaptation]\");\n    enable($form(\"stars-show\"));\n\n    // DSOs \n    col = frm.append(\"div\").attr(\"class\", \"col\").attr(\"id\", \"dsos\");\n    col.append(\"label\").attr(\"class\", \"header\").attr(\"title\", \"Deep Space Objects\").attr(\"for\", \"dsos-show\").html(\"DSOs\");\n    col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"dsos-show\").property(\"checked\", config.dsos.show).on(\"change\", apply);\n    col.append(\"label\").attr(\"for\", \"dsos-limit\").html(\"down to mag\");\n    col.append(\"input\").attr(\"type\", \"number\").attr(\"id\", \"dsos-limit\").attr(\"title\", \"DSO display limit (magnitude)\").attr(\"value\", config.dsos.limit).attr(\"max\", \"6\").attr(\"min\", \"0\").attr(\"step\", \"0.1\").on(\"change\", apply);\n    col.append(\"label\").attr(\"for\", \"dsos-colors\").html(\"with symbol colors\");\n    col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"dsos-colors\").property(\"checked\", config.dsos.colors).on(\"change\", apply);\n    col.append(\"label\").attr(\"for\", \"dsos-color\").html(\"or default color \");\n    col.append(\"input\").attr(\"type\", \"color\").attr(\"autocomplete\", \"off\").attr(\"id\", \"dsos-style-fill\").attr(\"title\", \"DSO color\").property(\"value\", config.dsos.style.fill).on(\"change\", apply);\n    col.append(\"br\");\n    names = formats.dsonames[config.culture] || formats.dsonames.iau;\n    for (fld in names) {\n      if (!has(names, fld)) continue;\n      var dsoKeys = Object.keys(names[fld]);\n      col.append(\"label\").attr(\"for\", \"dsos-\" + fld).html(\"Show\");\n      selected = 0;\n      col.append(\"label\").attr(\"title\", \"Type of DSO name\").attr(\"for\", \"dsos-\" + fld + \"Type\").attr(\"class\", \"advanced\").html(\"\");\n      sel = col.append(\"select\").attr(\"id\", \"dsos-\" + fld + \"Type\").attr(\"class\", \"advanced\").on(\"change\", apply);\n      list = dsoKeys.map(function (key, i) {\n        if (key === config.stars[fld + \"Type\"]) selected = i;\n        return {\n          o: key,\n          n: names[fld][key]\n        };\n      });\n      sel.selectAll(\"option\").data(list).enter().append('option').attr(\"value\", function (d) {\n        return d.o;\n      }).text(function (d) {\n        return d.n;\n      });\n      sel.property(\"selectedIndex\", selected);\n      col.append(\"label\").attr(\"for\", \"dsos-\" + fld).html(\"names\");\n      col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"dsos-\" + fld).property(\"checked\", config.dsos[fld]).on(\"change\", apply);\n    }\n    col.append(\"label\").attr(\"for\", \"dsos-nameLimit\").html(\"down to mag\");\n    col.append(\"input\").attr(\"type\", \"number\").attr(\"id\", \"dsos-nameLimit\").attr(\"title\", \"DSO name display limit (magnitude)\").attr(\"value\", config.dsos.nameLimit).attr(\"max\", \"6\").attr(\"min\", \"0\").attr(\"step\", \"0.1\").on(\"change\", apply);\n    col.append(\"br\");\n    col.append(\"label\").attr(\"for\", \"dsos-size\").attr(\"class\", \"advanced\").html(\"DSO symbol size: (base\");\n    col.append(\"input\").attr(\"type\", \"number\").attr(\"id\", \"dsos-size\").attr(\"class\", \"advanced\").attr(\"title\", \"Size of the displayed symbol: base\").attr(\"value\", config.dsos.size).attr(\"max\", \"100\").attr(\"min\", \"0\").attr(\"step\", \"0.1\").on(\"change\", apply);\n    col.append(\"label\").attr(\"for\", \"dsos-exponent\").attr(\"class\", \"advanced\").html(\" * 2 [* adaptation] - magnitude) ^ exponent\");\n    col.append(\"input\").attr(\"type\", \"number\").attr(\"id\", \"dsos-exponent\").attr(\"class\", \"advanced\").attr(\"title\", \"Size of the displayed symbol; exponent\").attr(\"value\", config.dsos.exponent).attr(\"max\", \"3\").attr(\"min\", \"-1\").attr(\"step\", \"0.01\").on(\"change\", apply);\n    enable($form(\"dsos-show\"));\n\n    // Constellations \n    col = frm.append(\"div\").attr(\"class\", \"col\").attr(\"id\", \"constellations\");\n    col.append(\"label\").attr(\"class\", \"header\").html(\"Constellations\");\n    //col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"constellations-show\").property(\"checked\", config.constellations.show).on(\"change\", apply);\n\n    names = formats.constellations[config.culture] || formats.constellations.iau;\n    for (fld in names) {\n      if (!has(names, fld)) continue;\n      var nameKeys = Object.keys(names[fld]);\n      if (nameKeys.length > 1) {\n        //Select List\n        col.append(\"label\").attr(\"for\", \"constellations-\" + fld).html(\"Show\");\n        selected = 0;\n        col.append(\"label\").attr(\"title\", \"Language of constellation names\").attr(\"for\", \"constellations-\" + fld + \"Type\").attr(\"class\", \"advanced\").html(\"\");\n        sel = col.append(\"select\").attr(\"id\", \"constellations-\" + fld + \"Type\").attr(\"class\", \"advanced\").on(\"change\", apply);\n        list = nameKeys.map(function (key, i) {\n          if (key === config.constellations[fld + \"Type\"]) selected = i;\n          return {\n            o: key,\n            n: names[fld][key]\n          };\n        });\n        sel.selectAll(\"option\").data(list).enter().append('option').attr(\"value\", function (d) {\n          return d.o;\n        }).text(function (d) {\n          return d.n;\n        });\n        sel.property(\"selectedIndex\", selected);\n        col.append(\"label\").attr(\"for\", \"constellations-\" + fld).html(\"names\");\n        col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"constellations-\" + fld).property(\"checked\", config.constellations[fld]).on(\"change\", apply);\n      } else if (nameKeys.length === 1) {\n        //Simple field\n        col.append(\"label\").attr(\"for\", \"constellations-\" + fld).attr(\"class\", \"advanced\").html(\" \" + names[fld][nameKeys[0]]);\n        col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"constellations-\" + fld).attr(\"class\", \"advanced\").property(\"checked\", config.constellations[fld]).on(\"change\", apply);\n      }\n    }\n    col.append(\"label\").attr(\"for\", \"constellations-lines\").html(\" lines\");\n    col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"constellations-lines\").property(\"checked\", config.constellations.lines).on(\"change\", apply);\n    col.append(\"label\").attr(\"for\", \"constellations-bounds\").html(\" boundaries\");\n    col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"constellations-bounds\").property(\"checked\", config.constellations.bounds).on(\"change\", apply);\n    enable($form(\"constellations-names\"));\n\n    // graticules & planes \n    col = frm.append(\"div\").attr(\"class\", \"col\").attr(\"id\", \"lines\");\n    col.append(\"label\").attr(\"class\", \"header\").html(\"Lines\");\n    col.append(\"label\").attr(\"title\", \"Latitude/longitude grid lines\").attr(\"for\", \"lines-graticule\").html(\"Graticule\");\n    col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"lines-graticule-show\").property(\"checked\", config.lines.graticule.show).on(\"change\", apply);\n    col.append(\"label\").attr(\"for\", \"lines-equatorial\").html(\"Equator\");\n    col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"lines-equatorial-show\").property(\"checked\", config.lines.equatorial.show).on(\"change\", apply);\n    col.append(\"label\").attr(\"for\", \"lines-ecliptic\").html(\"Ecliptic\");\n    col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"lines-ecliptic-show\").property(\"checked\", config.lines.ecliptic.show).on(\"change\", apply);\n    col.append(\"label\").attr(\"for\", \"lines-galactic\").html(\"Galactic plane\");\n    col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"lines-galactic-show\").property(\"checked\", config.lines.galactic.show).on(\"change\", apply);\n    col.append(\"label\").attr(\"for\", \"lines-supergalactic\").html(\"Supergalactic plane\");\n    col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"lines-supergalactic-show\").property(\"checked\", config.lines.supergalactic.show).on(\"change\", apply);\n\n    // Other\n    col = frm.append(\"div\").attr(\"class\", \"col\").attr(\"id\", \"other\");\n    col.append(\"label\").attr(\"class\", \"header\").html(\"Other\");\n    col.append(\"label\").attr(\"for\", \"mw-show\").html(\"Milky Way\");\n    col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"mw-show\").property(\"checked\", config.mw.show).on(\"change\", apply);\n    col.append(\"label\").attr(\"for\", \"mw-style-fill\").attr(\"class\", \"advanced\").html(\" color\");\n    col.append(\"input\").attr(\"type\", \"color\").attr(\"id\", \"mw-style-fill\").attr(\"class\", \"advanced\").attr(\"title\", \"Milky Way color\").attr(\"value\", config.mw.style.fill).on(\"change\", apply);\n    col.append(\"label\").attr(\"for\", \"mw-style-opacity\").attr(\"class\", \"advanced\").html(\" opacity\");\n    col.append(\"input\").attr(\"type\", \"number\").attr(\"id\", \"mw-style-opacity\").attr(\"class\", \"advanced\").attr(\"title\", \"Transparency of each Milky Way layer\").attr(\"value\", config.mw.style.opacity).attr(\"max\", \"1\").attr(\"min\", \"0\").attr(\"step\", \"0.01\").on(\"change\", apply);\n    col.append(\"label\").attr(\"for\", \"advanced\").html(\"Advanced options\");\n    col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"advanced\").property(\"checked\", config.advanced).on(\"change\", apply);\n    col.append(\"br\");\n    col.append(\"label\").attr(\"for\", \"background-fill\").html(\"Background color\");\n    col.append(\"input\").attr(\"type\", \"color\").attr(\"id\", \"background-fill\").attr(\"title\", \"Background color\").attr(\"value\", config.background.fill).on(\"change\", apply);\n    col.append(\"label\").attr(\"for\", \"background-opacity\").attr(\"class\", \"advanced\").html(\"opacity\");\n    col.append(\"input\").attr(\"type\", \"number\").attr(\"id\", \"background-opacity\").attr(\"class\", \"advanced\").attr(\"title\", \"Background opacity\").attr(\"value\", config.background.opacity).attr(\"max\", \"1\").attr(\"min\", \"0\").attr(\"step\", \"0.01\").on(\"change\", apply);\n    col.append(\"label\").attr(\"title\", \"Star/DSO sizes are increased with higher zoom-levels\").attr(\"for\", \"adaptable\").attr(\"class\", \"advanced\").html(\"Adaptable object sizes\");\n    col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"adaptable\").attr(\"class\", \"advanced\").property(\"checked\", config.adaptable).on(\"change\", apply);\n\n    // General language setting\n    var langKeys = formats_all[config.culture];\n    selected = 0;\n    col.append(\"label\").attr(\"title\", \"General language setting\").attr(\"for\", \"lang\").html(\"Object names \");\n    sel = col.append(\"select\").attr(\"id\", \"lang\").on(\"change\", apply);\n    list = langKeys.map(function (key, i) {\n      if (key === config.lang) selected = i;\n      return {\n        o: key,\n        n: formats.constellations[config.culture].names[key]\n      };\n    });\n    list = [{\n      o: \"---\",\n      n: \"(Select language)\"\n    }].concat(list);\n    sel.selectAll(\"option\").data(list).enter().append('option').attr(\"value\", function (d) {\n      return d.o;\n    }).text(function (d) {\n      return d.n;\n    });\n    sel.property(\"selectedIndex\", selected);\n    col = frm.append(\"div\").attr(\"class\", \"col\").attr(\"id\", \"download\");\n    col.append(\"label\").attr(\"class\", \"header\").html(\"Download\");\n    col.append(\"input\").attr(\"type\", \"button\").attr(\"id\", \"download-png\").attr(\"value\", \"PNG Image\").on(\"click\", function () {\n      var a = d3.select(\"body\").append(\"a\").node(),\n        canvas = document.querySelector(parentElement + ' canvas');\n      a.download = getFilename(\".png\");\n      a.rel = \"noopener\";\n      a.href = canvas.toDataURL('image/png').replace('image/png', 'image/octet-stream');\n      a.click();\n      d3.select(a).remove();\n    });\n    col.append(\"input\").attr(\"type\", \"button\").attr(\"id\", \"download-svg\").attr(\"value\", \"SVG File\").on(\"click\", function () {\n      exportSVG(getFilename(\".svg\"));\n      return false;\n    });\n    setLimits();\n    setUnit(config.transform);\n    setVisibility(cfg);\n    showAdvanced(config.advanced);\n    function resize() {\n      var src = this,\n        w = src.value;\n      if (testNumber(src) === false) return;\n      config.width = w;\n      Celestial.resize({\n        width: w\n      });\n    }\n    function reload() {\n      var src = this,\n        trans = src.value,\n        cx = setUnit(trans, config.transform);\n      if (cx !== null) config.center[0] = cx;\n      config.transform = trans;\n      settings.set(config);\n      Celestial.reload(config);\n    }\n    function reproject() {\n      var src = this;\n      if (!src) return;\n      config.projection = src.value;\n      settings.set(config);\n      Celestial.reproject(config);\n    }\n    function turn() {\n      if (testNumber(this) === false) return;\n      if (getCenter() === false) return;\n      Celestial.rotate(config);\n    }\n    function getCenter() {\n      var cx = $form(\"centerx\"),\n        cy = $form(\"centery\"),\n        cz = $form(\"centerz\"),\n        rot = [];\n      if (!cx || !cy) return;\n      if (config.transform !== \"equatorial\") config.center[0] = parseFloat(cx.value);else {\n        var vx = parseFloat(cx.value);\n        config.center[0] = vx > 12 ? vx * 15 - 360 : vx * 15;\n      }\n      config.center[1] = parseFloat(cy.value);\n      var vz = parseFloat(cz.value);\n      config.center[2] = isNaN(vz) ? 0 : vz;\n      return cx.value !== \"\" && cy.value !== \"\";\n    }\n    function getFilename(ext) {\n      var dateFormat = d3.time.format(\"%Y%m%dT%H%M%S%Z\"),\n        filename = \"d3-celestial\",\n        dt = Celestial.date();\n      if (dt) filename += dateFormat(dt);\n      return filename + ext;\n    }\n    function showConstellation() {\n      var id = this.value;\n      if (!id) return;\n      showCon(id);\n    }\n    function showCon(id) {\n      var z,\n        anims = [],\n        config = globalConfig;\n      if (id === \"---\") {\n        Celestial.constellation = null;\n        z = Celestial.zoomBy();\n        if (z !== 1) {\n          anims.push({\n            param: \"zoom\",\n            value: 1 / z,\n            duration: 0\n          });\n        }\n        Celestial.animate(anims, false);\n        //Celestial.redraw();\n        return;\n      }\n      if (!isObject(Celestial.constellations) || !has(Celestial.constellations, id)) return;\n      var con = Celestial.constellations[id];\n      //transform according to settings\n      var center = transformDeg(con.center, euler[config.transform]);\n      config.center = center;\n      setCenter(config.center, config.transform);\n      //config.lines.graticule.lat.pos = [Round(con.center[0])];\n      //config.lines.graticule.lon.pos = [Round(con.center[1])];\n      //Celestial.apply(config);\n\n      //if zoomed, zoom out\n      z = Celestial.zoomBy();\n      if (z !== 1) anims.push({\n        param: \"zoom\",\n        value: 1 / z,\n        duration: 0\n      });\n      //rotate\n      anims.push({\n        param: \"center\",\n        value: center,\n        duration: 0\n      });\n      //and zoom in\n      var sc = 1 + 360 / con.scale; // > 10 ? 10 : con.scale;\n      anims.push({\n        param: \"zoom\",\n        value: sc,\n        duration: 0\n      });\n      Celestial.constellation = id;\n      //Object.assign(globalConfig, config);   \n      Celestial.animate(anims, false);\n    }\n    function apply() {\n      var value,\n        src = this;\n      //Get current configuration\n      Object.assign(config, settings.set());\n      switch (src.type) {\n        case \"checkbox\":\n          value = src.checked;\n          enable(src);\n          break;\n        case \"number\":\n          if (testNumber(src) === false) return;\n          value = parseFloat(src.value);\n          break;\n        case \"color\":\n          if (testColor(src) === false) return;\n          value = src.value;\n          break;\n        case \"text\":\n          if (src.id.search(/fill$/) === -1) return;\n          if (testColor(src) === false) return;\n          value = src.value;\n          break;\n        case \"select-one\":\n          value = src.value;\n          break;\n      }\n      if (value === null) return;\n      set(src.id, value);\n      if (src.id === \"dsos-style-fill\") {\n        set(\"dsos-style-stroke\", value);\n        set(\"dsos-nameStyle-fill\", value);\n      } else if (src.id === \"constellations-namesType\") {\n        listConstellations();\n      } else if (src.id === \"lang\") {\n        setLanguage(value);\n      } else if (src.id === \"advanced\") {\n        showAdvanced(value);\n      }\n      getCenter();\n      Object.assign(globalConfig, config);\n      Celestial.apply(config);\n    }\n    function set(prop, val) {\n      var a = prop.split(\"-\");\n      switch (a.length) {\n        case 1:\n          config[a[0]] = val;\n          break;\n        case 2:\n          config[a[0]][a[1]] = val;\n          break;\n        case 3:\n          config[a[0]][a[1]][a[2]] = val;\n          break;\n        default:\n          return;\n      }\n    }\n    function setLanguage(lang) {\n      Object.assign(config, globalConfig);\n      config.lang = lang;\n      var keys = [\"constellations\", \"planets\"];\n      for (var i = 0; i < keys.length; i++) {\n        if (has(formats[keys[i]][config.culture].names, lang)) config[keys[i]].namesType = lang;else if (has(formats[keys[i]][config.culture].names, \"desig\")) config[keys[i]].namesType = \"desig\";else config[keys[i]].namesType = \"name\";\n      }\n      if (has(formats.dsonames[config.culture].names, lang)) config.dsos.namesType = lang;else config.dsos.namesType = \"desig\";\n      if (has(formats.starnames[config.culture].propername, lang)) config.stars.propernameType = lang;else config.stars.propernameType = \"desig\";\n      //update cont. list\n      Object.assign(globalConfig, config);\n      update();\n      listConstellations();\n      return config;\n    }\n    function update() {\n      // Update all form fields\n      d3.selectAll(parentElement + \" ~ #celestial-form input, \" + parentElement + \" ~  #celestial-form select\").each(function (d, i) {\n        if (this === undefined) return;\n        var id = this.id;\n\n        // geopos -> lat, lon\n        if (id === \"lat\" || id === \"lon\") {\n          if (isArray(config.geopos)) this.value = id === \"lat\" ? config.geopos[0] : config.geopos[1];\n          // center -> centerx, centery     \n        } else if (id.search(/center/) !== -1) {\n          if (isArray(config.center)) {\n            switch (id) {\n              case \"centerx\":\n                this.value = config.center[0];\n                break;\n              case \"centery\":\n                this.value = config.center[1];\n                break;\n              case \"centerz\":\n                this.value = config.center[2] || 0;\n                break;\n            }\n          }\n        } else if (id === \"datetime\" || id === \"hr\" || id === \"min\" || id === \"sec\" || id === \"tz\") {\n          return; //skip, timezone?\n        } else if (this.type !== \"button\") {\n          var value = get(id);\n          switch (this.type) {\n            case \"checkbox\":\n              this.checked = value;\n              enable(id);\n              break;\n            case \"number\":\n              if (testNumber(this) === false) break;\n              this.value = parseFloat(get(id));\n              break;\n            case \"color\":\n              if (testColor(this) === false) break;\n              this.value = value;\n              break;\n            case \"text\":\n              if (id.search(/fill$/) === -1) break;\n              if (testColor(this) === false) break;\n              this.value = value;\n              break;\n            case \"select-one\":\n              this.value = value;\n              break;\n          }\n        }\n      });\n    }\n    function get(id) {\n      var a = id.split(\"-\");\n      switch (a.length) {\n        case 1:\n          return config[a[0]];\n        case 2:\n          return config[a[0]][a[1]];\n        case 3:\n          return config[a[0]][a[1]][a[2]];\n        default:\n          return;\n      }\n    }\n    Celestial.updateForm = update;\n    Celestial.showConstellation = showCon;\n    Celestial.setLanguage = function (lang) {\n      var cfg = settings.set();\n      if (formats_all[config.culture].indexOf(lang) !== -1) cfg = setLanguage(lang);\n      return cfg;\n    };\n  }\n\n  // Dependend fields relations\n  var depends = {\n    \"stars-show\": [\"stars-limit\", \"stars-colors\", \"stars-style-fill\", \"stars-designation\", \"stars-propername\", \"stars-size\", \"stars-exponent\"],\n    \"stars-designation\": [\"stars-designationType\", \"stars-designationLimit\"],\n    \"stars-propername\": [\"stars-propernameLimit\", \"stars-propernameType\"],\n    \"dsos-show\": [\"dsos-limit\", \"dsos-colors\", \"dsos-style-fill\", \"dsos-names\", \"dsos-size\", \"dsos-exponent\"],\n    \"dsos-names\": [\"dsos-namesType\", \"dsos-nameLimit\"],\n    \"mw-show\": [\"mw-style-opacity\", \"mw-style-fill\"],\n    \"constellations-names\": [\"constellations-namesType\"],\n    \"planets-show\": [\"planets-symbolType\", \"planets-names\"],\n    \"planets-names\": [\"planets-namesType\"]\n  };\n\n  // De/activate fields depending on selection of dependencies\n  function enable(source) {\n    var fld = source.id,\n      off;\n    switch (fld) {\n      case \"stars-show\":\n        off = !$form(fld).checked;\n        for (var i = 0; i < depends[fld].length; i++) {\n          fldEnable(depends[fld][i], off);\n        }\n      /* falls through */\n      case \"stars-designation\":\n        off = !$form(\"stars-designation\").checked || !$form(\"stars-show\").checked;\n        for (i = 0; i < depends[\"stars-designation\"].length; i++) {\n          fldEnable(depends[\"stars-designation\"][i], off);\n        }\n      /* falls through */\n      case \"stars-propername\":\n        off = !$form(\"stars-propername\").checked || !$form(\"stars-show\").checked;\n        for (i = 0; i < depends[\"stars-propername\"].length; i++) {\n          fldEnable(depends[\"stars-propername\"][i], off);\n        }\n        break;\n      case \"dsos-show\":\n        off = !$form(fld).checked;\n        for (i = 0; i < depends[fld].length; i++) {\n          fldEnable(depends[fld][i], off);\n        }\n      /* falls through */\n      case \"dsos-names\":\n        off = !$form(\"dsos-names\").checked || !$form(\"dsos-show\").checked;\n        for (i = 0; i < depends[\"dsos-names\"].length; i++) {\n          fldEnable(depends[\"dsos-names\"][i], off);\n        }\n        break;\n      case \"planets-show\":\n        off = !$form(fld).checked;\n        for (i = 0; i < depends[fld].length; i++) {\n          fldEnable(depends[fld][i], off);\n        }\n      /* falls through */\n      case \"planets-names\":\n        off = !$form(\"planets-names\").checked || !$form(\"planets-show\").checked;\n        for (i = 0; i < depends[\"planets-names\"].length; i++) {\n          fldEnable(depends[\"planets-names\"][i], off);\n        }\n        break;\n      case \"constellations-names\":\n      case \"mw-show\":\n        off = !$form(fld).checked;\n        for (i = 0; i < depends[fld].length; i++) {\n          fldEnable(depends[fld][i], off);\n        }\n        break;\n    }\n  }\n\n  // Enable/disable field d to status off\n  function fldEnable(d, off) {\n    var node = $form(d);\n    if (!node) return;\n    node.disabled = off;\n    node.style.color = off ? \"#999\" : \"#000\";\n    node.previousSibling.style.color = off ? \"#999\" : \"#000\";\n    //if (node.previousSibling.previousSibling && node.previousSibling.previousSibling.tagName === \"LABEL\")\n    //  node.previousSibling.previousSibling.style.color = off ? \"#999\" : \"#000\";  \n  }\n\n  // Error notification\n  function popError(nd, err) {\n    var p = findPos(nd);\n    d3.select(\"#error\").html(err).style({\n      top: px(p[1] + nd.offsetHeight + 1),\n      left: px(p[0]),\n      opacity: 1\n    });\n    nd.focus();\n  }\n\n  //Check numeric field\n  function testNumber(node) {\n    var v,\n      adj = node.id === \"hr\" || node.id === \"min\" || node.id === \"sec\" ? 1 : 0;\n    if (node.validity) {\n      v = node.validity;\n      if (v.typeMismatch || v.badInput) {\n        popError(node, node.title + \": check field value\");\n        return false;\n      }\n      if (v.rangeOverflow || v.rangeUnderflow) {\n        popError(node, node.title + \" must be between \" + (parseInt(node.min) + adj) + \" and \" + (parseInt(node.max) - adj));\n        return false;\n      }\n    } else {\n      v = node.value;\n      if (!isNumber(v)) {\n        popError(node, node.title + \": check field value\");\n        return false;\n      }\n      v = parseFloat(v);\n      if (v < node.min || v > node.max) {\n        popError(node, node.title + \" must be between \" + (node.min + adj) + \" and \" + (+node.max - adj));\n        return false;\n      }\n    }\n    d3.select(\"#error\").style({\n      top: \"-9999px\",\n      left: \"-9999px\",\n      opacity: 0\n    });\n    return true;\n  }\n\n  //Check color field\n  function testColor(node) {\n    var v;\n    if (node.validity) {\n      v = node.validity;\n      if (v.typeMismatch || v.badInput) {\n        popError(node, node.title + \": check field value\");\n        return false;\n      }\n      if (node.value.search(/^#[0-9A-F]{6}$/i) === -1) {\n        popError(node, node.title + \": not a color value\");\n        return false;\n      }\n    } else {\n      v = node.value;\n      if (v === \"\") return true;\n      if (v.search(/^#[0-9A-F]{6}$/i) === -1) {\n        popError(node, node.title + \": not a color value\");\n        return false;\n      }\n    }\n    d3.select(\"#error\").style({\n      top: \"-9999px\",\n      left: \"-9999px\",\n      opacity: 0\n    });\n    return true;\n  }\n  function setUnit(trans, old) {\n    var cx = $form(\"centerx\");\n    if (!cx) return null;\n    if (old) {\n      if (trans === \"equatorial\" && old !== \"equatorial\") {\n        cx.value = (cx.value / 15).toFixed(1);\n        if (cx.value < 0) cx.value += 24;\n      } else if (trans !== \"equatorial\" && old === \"equatorial\") {\n        cx.value = (cx.value * 15).toFixed(1);\n        if (cx.value > 180) cx.value -= 360;\n      }\n    }\n    if (trans === 'equatorial') {\n      cx.min = \"0\";\n      cx.max = \"24\";\n      $form(\"cxunit\").innerHTML = \"h\";\n    } else {\n      cx.min = \"-180\";\n      cx.max = \"180\";\n      $form(\"cxunit\").innerHTML = \"\\u00b0\";\n    }\n    return cx.value;\n  }\n  function setCenter(ctr, trans) {\n    var cx = $form(\"centerx\"),\n      cy = $form(\"centery\"),\n      cz = $form(\"centerz\");\n    if (!cx || !cy) return;\n    if (ctr === null || ctr.length < 1) ctr = [0, 0, 0];\n    if (ctr.length <= 2 || ctr[2] === undefined) ctr[2] = 0;\n    //config.center = ctr; \n    if (trans !== \"equatorial\") cx.value = ctr[0].toFixed(1);else cx.value = ctr[0] < 0 ? (ctr[0] / 15 + 24).toFixed(1) : (ctr[0] / 15).toFixed(1);\n    cy.value = ctr[1].toFixed(1);\n    cz.value = ctr[2] !== null ? ctr[2].toFixed(1) : 0;\n    settings.set({\n      center: ctr\n    });\n  }\n\n  // Set max input limits depending on data\n  function setLimits() {\n    var t,\n      rx = /\\d+(\\.\\d+)?/g,\n      s,\n      d,\n      res = {\n        s: 6,\n        d: 6\n      },\n      config = Celestial.settings();\n    d = config.dsos.data;\n\n    //test dso limit\n    t = d.match(rx);\n    if (t !== null) {\n      res.d = parseFloat(t[t.length - 1]);\n    }\n    if (res.d !== 6) {\n      $form(\"dsos-limit\").max = res.d;\n      $form(\"dsos-nameLimit\").max = res.d;\n    }\n    s = config.stars.data;\n\n    //test star limit\n    t = s.match(rx);\n    if (t !== null) {\n      res.s = parseFloat(t[t.length - 1]);\n    }\n    if (res.s != 6) {\n      $form(\"stars-limit\").max = res.s;\n      $form(\"stars-designationLimit\").max = res.s;\n      $form(\"stars-propernameLimit\").max = res.s;\n    }\n    return res;\n  }\n\n  // Options only visible in advanced mode\n  //\"stars-designationType\", \"stars-propernameType\", \"stars-size\", \"stars-exponent\", \"stars-size\", \"stars-exponent\", //\"constellations-namesType\", \"planets-namesType\", \"planets-symbolType\"\n  function showAdvanced(showit) {\n    var vis = showit ? \"inline-block\" : \"none\";\n    d3.select(parentElement + \" ~ #celestial-form\").selectAll(\".advanced\").style(\"display\", vis);\n    d3.select(parentElement + \" ~ #celestial-form\").selectAll(\"#label-propername\").style(\"display\", showit ? \"none\" : \"inline-block\");\n  }\n  function setVisibility(cfg, which) {\n    var vis, fld;\n    if (!has(cfg, \"formFields\")) return;\n    if (which && has(cfg.formFields, which)) {\n      d3.select(parentElement + \" ~ #celestial-form\").select(\"#\" + which).style({\n        \"display\": \"none\"\n      });\n      return;\n    }\n    // Special case for backward compatibility\n    if (cfg.form === false && cfg.location === true) {\n      d3.select(parentElement + \" ~ #celestial-form\").style(\"display\", \"inline-block\");\n      for (fld in cfg.formFields) {\n        if (!has(cfg.formFields, fld)) continue;\n        if (fld === \"location\") continue;\n        d3.select(parentElement + \" ~ #celestial-form\").select(\"#\" + fld).style({\n          \"display\": \"none\"\n        });\n      }\n      return;\n    }\n    // hide if not desired\n    if (cfg.form === false) d3.select(parentElement + \" ~ #celestial-form\").style(\"display\", \"none\");\n    for (fld in cfg.formFields) {\n      if (!has(cfg.formFields, fld)) continue;\n      if (fld === \"location\") continue;\n      vis = cfg.formFields[fld] === false ? \"none\" : \"block\";\n      d3.select(parentElement + \" ~ #celestial-form\").select(\"#\" + fld).style({\n        \"display\": vis\n      });\n    }\n  }\n  function listConstellations() {\n    var sel = d3.select(parentElement + \" ~ #celestial-form\").select(\"#constellation\"),\n      list = [],\n      selected = 0,\n      id,\n      name,\n      config = globalConfig;\n    Celestial.container.selectAll(\".constname\").each(function (d, i) {\n      id = d.id;\n      if (id === config.constellation) selected = i;\n      name = d.properties[config.constellations.namesType];\n      if (name !== id) name += \" (\" + id + \")\";\n      list.push({\n        o: id,\n        n: name\n      });\n    });\n    if (list.length < 1 || sel.length < 1) {\n      setTimeout(listConstellations, 1000);\n      return;\n    }\n    list = [{\n      o: \"---\",\n      n: \"(Select constellation)\"\n    }].concat(list);\n    sel.selectAll('option').remove();\n    sel.selectAll('option').data(list).enter().append('option').attr(\"value\", function (d) {\n      return d.o;\n    }).text(function (d) {\n      return d.n;\n    });\n    sel.property(\"selectedIndex\", selected);\n    //$form(\"constellation\").firstChild.disabled = true;\n\n    //Celestial.constellations = list;\n  }\n\n  function $form(id) {\n    return document.querySelector(parentElement + \" ~ #celestial-form\" + \" #\" + id);\n  }\n  var geoInfo = null;\n  function geo(cfg) {\n    var dtFormat = d3.time.format(\"%Y-%m-%d %H:%M:%S\"),\n      zenith = [0, 0],\n      geopos = [0, 0],\n      date = new Date(),\n      localZone = -date.getTimezoneOffset(),\n      timeZone = localZone,\n      config = settings.set(cfg),\n      frm = d3.select(parentElement + \" ~ #celestial-form form\").insert(\"div\", \"div#general\").attr(\"id\", \"loc\");\n    var dtpick = new datetimepicker(config, function (date, tz) {\n      $form(\"datetime\").value = dateFormat(date, tz);\n      timeZone = tz;\n      go();\n    });\n    if (has(config, \"geopos\") && config.geopos !== null && config.geopos.length === 2) geopos = config.geopos;\n    var col = frm.append(\"div\").attr(\"class\", \"col\").attr(\"id\", \"location\").style(\"display\", \"none\");\n    //Latitude & longitude fields\n    col.append(\"label\").attr(\"title\", \"Location coordinates long/lat\").attr(\"for\", \"lat\").html(\"Location\");\n    col.append(\"input\").attr(\"type\", \"number\").attr(\"id\", \"lat\").attr(\"title\", \"Latitude\").attr(\"placeholder\", \"Latitude\").attr(\"max\", \"90\").attr(\"min\", \"-90\").attr(\"step\", \"0.0001\").attr(\"value\", geopos[0]).on(\"change\", function () {\n      if (testNumber(this) === true) go();\n    });\n    col.append(\"span\").html(\"\\u00b0\");\n    col.append(\"input\").attr(\"type\", \"number\").attr(\"id\", \"lon\").attr(\"title\", \"Longitude\").attr(\"placeholder\", \"Longitude\").attr(\"max\", \"180\").attr(\"min\", \"-180\").attr(\"step\", \"0.0001\").attr(\"value\", geopos[1]).on(\"change\", function () {\n      if (testNumber(this) === true) go();\n    });\n    col.append(\"span\").html(\"\\u00b0\");\n    //Here-button if supported\n    if (\"geolocation\" in navigator) {\n      col.append(\"input\").attr(\"type\", \"button\").attr(\"value\", \"Here\").attr(\"id\", \"here\").on(\"click\", here);\n    }\n    //Datetime field with dtpicker-button\n    col.append(\"label\").attr(\"title\", \"Local date/time\").attr(\"for\", \"datetime\").html(\" Date/time\");\n    col.append(\"input\").attr(\"type\", \"button\").attr(\"id\", \"day-left\").attr(\"title\", \"One day back\").on(\"click\", function () {\n      date.setDate(date.getDate() - 1);\n      $form(\"datetime\").value = dateFormat(date, timeZone);\n      go();\n    });\n    col.append(\"input\").attr(\"type\", \"text\").attr(\"id\", \"datetime\").attr(\"title\", \"Date and time\").attr(\"value\", dateFormat(date, timeZone)).on(\"click\", showpick, true).on(\"input\", function () {\n      this.value = dateFormat(date, timeZone);\n      if (!dtpick.isVisible()) showpick();\n    });\n    col.append(\"div\").attr(\"id\", \"datepick\").on(\"click\", showpick);\n    col.append(\"input\").attr(\"type\", \"button\").attr(\"id\", \"day-right\").attr(\"title\", \"One day forward\").on(\"click\", function () {\n      date.setDate(date.getDate() + 1);\n      $form(\"datetime\").value = dateFormat(date, timeZone);\n      go();\n    });\n    //Now -button sets current time & date of device  \n    col.append(\"input\").attr(\"type\", \"button\").attr(\"value\", \"Now\").attr(\"id\", \"now\").on(\"click\", now);\n    //Horizon marker\n    col.append(\"br\");\n    col.append(\"label\").attr(\"title\", \"Show horizon marker\").attr(\"for\", \"horizon-show\").html(\" Horizon marker\");\n    col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"horizon-show\").property(\"checked\", config.horizon.show).on(\"change\", apply);\n    //Daylight\n    col.append(\"label\").attr(\"title\", \"Show daylight\").attr(\"for\", \"daylight-show\").html(\"Daylight sky\");\n    col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"daylight-show\").property(\"checked\", config.daylight.show).on(\"change\", apply);\n    col.append(\"br\");\n\n    //Show planets\n    col.append(\"label\").attr(\"title\", \"Show solar system objects\").attr(\"for\", \"planets-show\").html(\" Planets, Sun & Moon\");\n    col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"planets-show\").property(\"checked\", config.planets.show).on(\"change\", apply);\n    //Planet names\n    var names = formats.planets[config.culture] || formats.planets.iau;\n    for (var fld in names) {\n      if (!has(names, fld)) continue;\n      var keys = Object.keys(names[fld]);\n      if (keys.length > 1) {\n        //Select List\n        var txt = fld === \"symbol\" ? \"as\" : \"with\";\n        col.append(\"label\").attr(\"for\", \"planets-\" + fld + \"Type\").html(txt);\n        var selected = 0;\n        col.append(\"label\").attr(\"title\", \"Type of planet name\").attr(\"for\", \"planets-\" + fld + \"Type\").attr(\"class\", \"advanced\").html(\"\");\n        var sel = col.append(\"select\").attr(\"id\", \"planets-\" + fld + \"Type\").on(\"change\", apply);\n        var list = keys.map(function (key, i) {\n          if (key === config.planets[fld + \"Type\"]) selected = i;\n          return {\n            o: key,\n            n: names[fld][key]\n          };\n        });\n        sel.selectAll(\"option\").data(list).enter().append('option').attr(\"value\", function (d) {\n          return d.o;\n        }).text(function (d) {\n          return d.n;\n        });\n        sel.property(\"selectedIndex\", selected);\n        if (fld === \"names\") {\n          sel.attr(\"class\", \"advanced\");\n          col.append(\"label\").attr(\"for\", \"planets-\" + fld).html(\"names\");\n          col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"planets-\" + fld).property(\"checked\", config.planets[fld]).on(\"change\", apply);\n        }\n      }\n    }\n    enable($form(\"planets-show\"));\n    showAdvanced(config.advanced);\n    d3.select(document).on(\"mousedown\", function () {\n      if (!hasParent(d3.event.target, \"celestial-date\") && dtpick.isVisible()) dtpick.hide();\n    });\n    function now() {\n      date.setTime(Date.now());\n      $form(\"datetime\").value = dateFormat(date, timeZone);\n      go();\n    }\n    function here() {\n      navigator.geolocation.getCurrentPosition(function (pos) {\n        geopos = [Round(pos.coords.latitude, 4), Round(pos.coords.longitude, 4)];\n        $form(\"lat\").value = geopos[0];\n        $form(\"lon\").value = geopos[1];\n        go();\n      });\n    }\n    function showpick() {\n      dtpick.show(date, timeZone);\n    }\n    function dateFormat(dt, tz) {\n      var tzs;\n      if (!tz || tz === \"0\") tzs = \" ±0000\";else {\n        var h = Math.floor(Math.abs(tz) / 60),\n          m = Math.abs(tz) - h * 60,\n          s = tz > 0 ? \" +\" : \" −\";\n        tzs = s + pad(h) + pad(m);\n      }\n      return dtFormat(dt) + tzs;\n    }\n    function isValidLocation(loc) {\n      //[lat, lon] expected\n      if (!loc || !isArray(loc) || loc.length < 2) return false;\n      if (!isNumber(loc[0]) || loc[0] < -90 || loc[0] > 90) return false;\n      if (!isNumber(loc[1]) || loc[1] < -180 || loc[1] > 180) return false;\n      return true;\n    }\n    function isValidTimezone(tz) {\n      if (tz === undefined || tz === null) return false;\n      if (!isNumber(tz) && Math.abs(tz) > 840) return false;\n      return true;\n    }\n    function apply() {\n      Object.assign(config, settings.set());\n      config.horizon.show = !!$form(\"horizon-show\").checked;\n      config.daylight.show = !!$form(\"daylight-show\").checked;\n      config.planets.show = !!$form(\"planets-show\").checked;\n      config.planets.names = !!$form(\"planets-names\").checked;\n      config.planets.namesType = $form(\"planets-namesType\").value;\n      config.planets.symbolType = $form(\"planets-symbolType\").value;\n      enable($form(\"planets-show\"));\n      Celestial.apply(config);\n    }\n    function go() {\n      var lon = parseFloat($form(\"lon\").value),\n        lat = parseFloat($form(\"lat\").value),\n        tz;\n      //Get current configuration\n      Object.assign(config, settings.set());\n      date = dtFormat.parse($form(\"datetime\").value.slice(0, -6));\n\n      //Celestial.apply(config);\n\n      if (!isNaN(lon) && !isNaN(lat)) {\n        if (lat !== geopos[0] || lon !== geopos[1]) {\n          geopos = [lat, lon];\n          setPosition([lat, lon], true);\n          return;\n        }\n        //if (!tz) tz = date.getTimezoneOffset();\n        $form(\"datetime\").value = dateFormat(date, timeZone);\n        var dtc = new Date(date.valueOf() - (timeZone - localZone) * 60000);\n        zenith = Celestial.getPoint(horizontal.inverse(dtc, [90, 0], geopos), config.transform);\n        zenith[2] = 0;\n        if (config.follow === \"zenith\") {\n          Celestial.rotate({\n            center: zenith\n          });\n        } else {\n          Celestial.redraw();\n        }\n      }\n    }\n    function setPosition(p, settime) {\n      if (!p || !has(config, \"settimezone\") || config.settimezone === false) return;\n      var timestamp = Math.floor(date.getTime() / 1000),\n        protocol = window && window.location.protocol === \"https:\" ? \"https\" : \"http\",\n        url = protocol + \"://api.timezonedb.com/v2.1/get-time-zone?key=\" + config.timezoneid + \"&format=json&by=position\" + \"&lat=\" + p[0] + \"&lng=\" + p[1] + \"&time=\" + timestamp;\n      // oldZone = timeZone;\n\n      d3.json(url, function (error, json) {\n        if (error) return console.warn(error);\n        if (json.status === \"FAILED\") {\n          // Location at sea inferred from longitude\n          timeZone = Math.round(p[1] / 15) * 60;\n          geoInfo = {\n            gmtOffset: timeZone * 60,\n            message: \"Sea locatation inferred\",\n            timestamp: timestamp\n          };\n        } else {\n          timeZone = json.gmtOffset / 60;\n          geoInfo = json;\n        }\n        //if (settime) {\n        //date.setTime(timestamp * 1000); // - (timeZone - oldZone) * 60000);\n        //console.log(date.toUTCString());\n        //}\n        $form(\"datetime\").value = dateFormat(date, timeZone);\n        go();\n      });\n    }\n    Celestial.dateFormat = dateFormat;\n    Celestial.date = function (dt, tz) {\n      if (!dt) return date;\n      if (isValidTimezone(tz)) timeZone = tz;\n      Object.assign(config, settings.set());\n      if (dtpick.isVisible()) dtpick.hide();\n      date.setTime(dt.valueOf());\n      $form(\"datetime\").value = dateFormat(dt, timeZone);\n      go();\n    };\n    Celestial.timezone = function (tz) {\n      if (!tz) return timeZone;\n      if (isValidTimezone(tz)) timeZone = tz;\n      Object.assign(config, settings.set());\n      if (dtpick.isVisible()) dtpick.hide();\n      $form(\"datetime\").value = dateFormat(date, timeZone);\n      go();\n    };\n    Celestial.position = function () {\n      return geopos;\n    };\n    Celestial.location = function (loc, tz) {\n      if (!loc || loc.length < 2) return geopos;\n      if (isValidLocation(loc)) {\n        geopos = loc.slice();\n        $form(\"lat\").value = geopos[0];\n        $form(\"lon\").value = geopos[1];\n        if (isValidTimezone(tz)) timeZone = tz;else setPosition(geopos, true);\n      }\n    };\n    //{\"date\":dt, \"location\":loc, \"timezone\":tz}\n    Celestial.skyview = function (cfg) {\n      if (!cfg) return {\n        \"date\": date,\n        \"location\": geopos,\n        \"timezone\": timeZone\n      };\n      var valid = false;\n      if (dtpick.isVisible()) dtpick.hide();\n      if (has(cfg, \"timezone\") && isValidTimezone(cfg.timezone)) {\n        timeZone = cfg.timezone;\n        valid = true;\n      }\n      if (has(cfg, \"date\") && isValidDate(cfg.date)) {\n        date.setTime(cfg.date.valueOf());\n        $form(\"datetime\").value = dateFormat(cfg.date, timeZone);\n        valid = true;\n      }\n      if (has(cfg, \"location\") && isValidLocation(cfg.location)) {\n        geopos = cfg.location.slice();\n        $form(\"lat\").value = geopos[0];\n        $form(\"lon\").value = geopos[1];\n        if (!has(cfg, \"timezone\")) {\n          setPosition(geopos, !has(cfg, \"date\"));\n          return;\n        }\n      }\n      //Celestial.updateForm();\n      if (valid === false) return {\n        \"date\": date,\n        \"location\": geopos,\n        \"timezone\": timeZone\n      };\n      if (config.follow === \"zenith\") go();else Celestial.redraw();\n    };\n    Celestial.dtLoc = Celestial.skyview;\n    Celestial.zenith = function () {\n      return zenith;\n    };\n    Celestial.nadir = function () {\n      var b = -zenith[1],\n        l = zenith[0] + 180;\n      if (l > 180) l -= 360;\n      return [l, b - 0.001];\n    };\n    if (has(config, \"formFields\") && (config.location === true || config.formFields.location === true)) {\n      d3.select(parentElement + \" ~ #celestial-form\").select(\"#location\").style({\n        \"display\": \"inline-block\"\n      });\n    }\n    //only if appropriate\n    if (isValidLocation(geopos) && (config.location === true || config.formFields.location === true) && config.follow === \"zenith\") setTimeout(go, 1000);\n  }\n  var gmdat = {\n      \"sol\": 0.0002959122082855911025,\n      // AU^3/d^2\n      \"mer\": 164468599544771,\n      //km^3/d^2\n      \"ven\": 2425056445892137,\n      \"ter\": 2975536307796296,\n      \"lun\": 36599199229256,\n      \"mar\": 319711652803400,\n      \"cer\": 467549107200,\n      \"ves\": 129071530155,\n      \"jup\": 945905718740635000,\n      \"sat\": 283224952705891000,\n      \"ura\": 43256077238632300,\n      \"nep\": 51034401552155700,\n      \"plu\": 7327611364884,\n      \"eri\": 8271175680000\n    },\n    symbols = {\n      \"sol\": \"\\u2609\",\n      \"mer\": \"\\u263f\",\n      \"ven\": \"\\u2640\",\n      \"ter\": \"\\u2295\",\n      \"lun\": \"\\u25cf\",\n      \"mar\": \"\\u2642\",\n      \"cer\": \"\\u26b3\",\n      \"ves\": \"\\u26b6\",\n      \"jup\": \"\\u2643\",\n      \"sat\": \"\\u2644\",\n      \"ura\": \"\\u2645\",\n      \"nep\": \"\\u2646\",\n      \"plu\": \"\\u2647\",\n      \"eri\": \"\\u26aa\"\n    },\n    ε = 23.43928 * deg2rad,\n    sinε = Math.sin(ε),\n    cosε = Math.cos(ε),\n    kelements = [\"a\", \"e\", \"i\", \"w\", \"M\", \"L\", \"W\", \"N\", \"n\", \"ep\", \"ref\", \"lecl\", \"becl\", \"Tilt\"];\n  /*\r\n      ep = epoch (iso-date)\r\n      N = longitude of the ascending node (deg) Ω\r\n      i = inclination to the refrence plane, default:ecliptic (deg) \r\n      w = argument of periapsis (deg)  ω\r\n      a = semi-major axis, or mean distance from parent body (AU,km)\r\n      e = eccentricity (0=circle, 0-1=ellipse, 1=parabola, >1=hyperbola ) (-)\r\n      M = mean anomaly (0 at periapsis; increases uniformly with time) (deg)\r\n      n = mean daily motion = 360/P (deg/day)\r\n      \r\n      W = N + w  = longitude of periapsis ϖ\r\n      L = M + W  = mean longitude\r\n      q = a*(1-e) = periapsis distance\r\n      Q = a*(1+e) = apoapsis distance\r\n      P = 2π * sqrt(a^3/GM) = orbital period (years)\r\n      T = Epoch_of_M - (M(deg)/360_deg) / P  = time of periapsis\r\n      v = true anomaly (angle between position and periapsis) ν\r\n      E = eccentric anomaly\r\n      \r\n      Mandatory: a, e, i, N, w|W, M|L, dM|n\r\n      \r\n  */\n\n  var Kepler = function () {\n    var gm = gmdat.sol,\n      parentBody = \"sol\",\n      elem = {},\n      dat = {},\n      id,\n      name,\n      symbol;\n    function kepler(date) {\n      dates(date);\n      if (id === \"sol\") {\n        dat.ephemeris.x = 0;\n        dat.ephemeris.y = 0;\n        dat.ephemeris.z = 0;\n        dat.ephemeris.mag = -6;\n        return kepler;\n      }\n      coordinates();\n      return kepler;\n    }\n    var dates = function (date) {\n      var dt,\n        de = dat.ephemeris = {};\n      if (date) {\n        if (date instanceof Date) {\n          dt = new Date(date.valueOf());\n        } else {\n          dt = dateParse(date);\n        }\n      }\n      if (!dt) {\n        dt = new Date();\n      }\n      de.jd = JD(dt);\n      dt = dateParse(elem.ep);\n      if (!dt) dt = dateParse(\"2000-01-01\");\n      de.jd0 = JD(dt);\n      de.d = de.jd - de.jd0;\n      de.cy = de.d / 36525;\n    };\n    var coordinates = function () {\n      var key,\n        de = dat.ephemeris;\n      if (id === \"lun\") {\n        de = moon_elements(de);\n        if (!de) return;\n      } else {\n        for (var i = 0; i < kelements.length; i++) {\n          key = kelements[i];\n          if (!has(elem, key)) continue;\n          if (has(elem, \"d\" + key)) {\n            de[key] = elem[key] + elem[\"d\" + key] * de.cy;\n          } else if (has(elem, key)) {\n            de[key] = elem[key];\n          }\n        }\n        if (has(de, \"M\") && !has(de, \"dM\") && has(de, \"n\")) {\n          de.M += de.n * de.d;\n        }\n      }\n      derive();\n      trueAnomaly();\n      cartesian();\n    };\n    kepler.cartesian = function () {\n      return dat;\n    };\n    kepler.spherical = function () {\n      spherical();\n      return dat;\n    };\n    kepler.equatorial = function (pos) {\n      equatorial(pos);\n      return dat;\n    };\n    kepler.transpose = function () {\n      transpose(dat);\n      return dat;\n    };\n    kepler.elements = function (_) {\n      var key;\n      if (!arguments.length || arguments[0] === undefined) return kepler;\n      for (var i = 0; i < kelements.length; i++) {\n        key = kelements[i];\n        if (!has(_, key)) continue;\n        elem[key] = _[key];\n        if (key === \"a\" || key === \"e\") elem[key] *= 1.0;else if (key !== \"ref\" && key !== \"ep\") elem[key] *= deg2rad;\n        if (has(_, \"d\" + key)) {\n          key = \"d\" + key;\n          elem[key] = _[key];\n          if (key === \"da\" || key === \"de\") elem[key] *= 1.0;else elem[key] *= deg2rad;\n        }\n      }\n      return kepler;\n    };\n    kepler.params = function (_) {\n      if (!arguments.length) return kepler;\n      for (var par in _) {\n        if (!has(_, par)) continue;\n        if (_[par] === \"elements\") continue;\n        dat[par] = _[par];\n      }\n      return kepler;\n    };\n    kepler.parentBody = function (_) {\n      if (!arguments.length) return parentBody;\n      parentBody = _;\n      gm = gmdat[parentBody];\n      return kepler;\n    };\n    kepler.id = function (_) {\n      if (!arguments.length) return id;\n      id = _;\n      symbol = symbols[_];\n      return kepler;\n    };\n    kepler.Name = function (_) {\n      if (!arguments.length) return name;\n      name = _;\n      return kepler;\n    };\n    kepler.symbol = function (_) {\n      if (!arguments.length) return symbol;\n      symbol = symbols[_];\n      return kepler;\n    };\n    function near_parabolic(E, e) {\n      var anom2 = e > 1.0 ? E * E : -E * E,\n        term = e * anom2 * E / 6.0,\n        rval = (1.0 - e) * E - term,\n        n = 4;\n      while (Math.abs(term) > 1e-15) {\n        term *= anom2 / (n * (n + 1));\n        rval -= term;\n        n += 2;\n      }\n      return rval;\n    }\n    function anomaly() {\n      var de = dat.ephemeris,\n        curr,\n        err,\n        trial,\n        tmod,\n        e = de.e,\n        M = de.M,\n        thresh = 1e-8,\n        offset = 0.0,\n        delta_curr = 1.9,\n        is_negative = false,\n        n_iter = 0;\n      if (!M) return 0.0;\n      if (e < 1.0) {\n        if (M < -Math.PI || M > Math.PI) {\n          tmod = Trig.normalize0(M);\n          offset = M - tmod;\n          M = tmod;\n        }\n        if (e < 0.9) {\n          curr = Math.atan2(Math.sin(M), Math.cos(M) - e);\n          do {\n            err = (curr - e * Math.sin(curr) - M) / (1.0 - e * Math.cos(curr));\n            curr -= err;\n          } while (Math.abs(err) > thresh);\n          return curr; // + offset;\n        }\n      }\n\n      if (M < 0.0) {\n        M = -M;\n        is_negative = true;\n      }\n      curr = M;\n      thresh = thresh * Math.abs(1.0 - e);\n      /* Due to roundoff error,  there's no way we can hope to */\n      /* get below a certain minimum threshhold anyway:        */\n      if (thresh < 1e-15) {\n        thresh = 1e-15;\n      }\n      if (e > 0.8 && M < Math.PI / 3.0 || e > 1.0) {\n        /* up to 60 degrees */\n        trial = M / Math.abs(1.0 - e);\n        if (trial * trial > 6.0 * Math.abs(1.0 - e)) {\n          /* cubic term is dominant */\n          if (M < Math.PI) {\n            trial = Math.pow(6.0 * M, 1 / 3);\n          } else {\n            /* hyperbolic w/ 5th & higher-order terms predominant */\n            trial = Trig.asinh(M / e);\n          }\n        }\n        curr = trial;\n      }\n      if (e > 1.0 && M > 4.0) {\n        /* hyperbolic, large-mean-anomaly case */\n        curr = Math.log(M);\n      }\n      if (e < 1.0) {\n        while (Math.abs(delta_curr) > thresh) {\n          if (n_iter++ > 8) {\n            err = near_parabolic(curr, e) - M;\n          } else {\n            err = curr - e * Math.sin(curr) - M;\n          }\n          delta_curr = -err / (1.0 - e * Math.cos(curr));\n          curr += delta_curr;\n        }\n      } else {\n        while (Math.abs(delta_curr) > thresh) {\n          if (n_iter++ > 7) {\n            err = -near_parabolic(curr, e) - M;\n          } else {\n            err = e * Trig.sinh(curr) - curr - M;\n          }\n          delta_curr = -err / (e * Trig.cosh(curr) - 1.0);\n          curr += delta_curr;\n        }\n      }\n      return is_negative ? offset - curr : offset + curr;\n    }\n    function trueAnomaly() {\n      var x,\n        y,\n        r0,\n        g,\n        t,\n        de = dat.ephemeris;\n      if (de.e === 1.0) {\n        /* parabolic */\n        t = de.jd0 - de.T;\n        g = de.w0 * t * 0.5;\n        y = Math.pow(g + Math.sqrt(g * g + 1.0), 1 / 3);\n        de.v = 2.0 * Math.atan(y - 1.0 / y);\n      } else {\n        /* got the mean anomaly;  compute eccentric,  then true */\n        de.E = anomaly();\n        if (de.e > 1.0) {\n          /* hyperbolic case */\n          x = de.e - Trig.cosh(de.E);\n          y = Trig.sinh(de.E);\n        } else {\n          /* elliptical case */\n          x = Math.cos(de.E) - de.e;\n          y = Math.sin(de.E);\n        }\n        y *= Math.sqrt(Math.abs(1.0 - de.e * de.e));\n        de.v = Math.atan2(y, x);\n      }\n      r0 = de.q * (1.0 + de.e);\n      de.r = r0 / (1.0 + de.e * Math.cos(de.v));\n    }\n    function derive() {\n      var de = dat.ephemeris;\n      if (!de.hasOwnProperty(\"w\")) {\n        de.w = de.W - de.N;\n      }\n      if (!de.hasOwnProperty(\"M\")) {\n        de.M = de.L - de.W;\n      }\n      if (de.e < 1.0) {\n        de.M = Trig.normalize0(de.M);\n      }\n      //de.P = Math.pow(Math.abs(de.a), 1.5);\n      de.P = τ * Math.sqrt(Math.pow(de.a, 3) / gm) / 365.25;\n      de.T = de.jd0 - de.M / halfπ / de.P;\n      if (de.e !== 1.0) {\n        /* for non-parabolic orbits: */\n        de.q = de.a * (1.0 - de.e);\n        de.t0 = de.a * Math.sqrt(Math.abs(de.a) / gm);\n      } else {\n        de.w0 = 3.0 / Math.sqrt(2) / (de.q * Math.sqrt(de.q / gm));\n        de.a = 0.0;\n        de.t0 = 0.0;\n      }\n      de.am = Math.sqrt(gm * de.q * (1.0 + de.e));\n    }\n    function transpose() {\n      var de = dat.ephemeris;\n      if (!de.ref || de.ref === \"ecl\") {\n        de.tx = de.x;\n        de.ty = de.y;\n        de.tz = de.z;\n        return;\n      }\n      var a0 = de.lecl,\n        // - Math.PI/2,\n        a1 = Math.PI / 2 - de.becl,\n        angles = [0, a1, -a0];\n      transform(de, angles);\n      var tp = Trig.cartesian([de.tl, de.tb, de.r]);\n      de.tx = tp.x;\n      de.ty = tp.y;\n      de.tz = tp.z;\n    }\n    function equatorial(pos) {\n      var de = dat.ephemeris,\n        pe = pos.ephemeris;\n      ε = (23.439292 - 0.0130042 * de.cy - 1.667e-7 * de.cy * de.cy + 5.028e-7 * de.cy * de.cy * de.cy) * deg2rad;\n      sinε = Math.sin(ε);\n      cosε = Math.cos(ε);\n      var o = id === \"lun\" ? {\n        x: 0,\n        y: 0,\n        z: 0\n      } : {\n        x: pe.x,\n        y: pe.y,\n        z: pe.z\n      };\n      de.xeq = de.x - o.x;\n      de.yeq = (de.y - o.y) * cosε - (de.z - o.z) * sinε;\n      de.zeq = (de.y - o.y) * sinε + (de.z - o.z) * cosε;\n      de.ra = Trig.normalize(Math.atan2(de.yeq, de.xeq));\n      de.dec = Math.atan2(de.zeq, Math.sqrt(de.xeq * de.xeq + de.yeq * de.yeq));\n      if (id === \"lun\") de = moon_corr(de, pe);\n      de.pos = [de.ra / deg2rad, de.dec / deg2rad];\n      de.rt = Math.sqrt(de.xeq * de.xeq + de.yeq * de.yeq + de.zeq * de.zeq);\n      if (id !== \"sol\") de.mag = magnitude();\n    }\n    function magnitude() {\n      var de = dat.ephemeris,\n        rs = de.r,\n        rt = de.rt,\n        a = Math.acos((rs * rs + rt * rt - 1) / (2 * rs * rt)),\n        q = 0.666 * ((1 - a / Math.PI) * Math.cos(a) + 1 / Math.PI * Math.sin(a)),\n        m = dat.H * 1 + 5 * Math.log(rs * rt) * Math.LOG10E - 2.5 * Math.log(q) * Math.LOG10E;\n      return m;\n    }\n    function cartesian() {\n      var de = dat.ephemeris,\n        u = de.v + de.w;\n      de.x = de.r * (Math.cos(de.N) * Math.cos(u) - Math.sin(de.N) * Math.sin(u) * Math.cos(de.i));\n      de.y = de.r * (Math.sin(de.N) * Math.cos(u) + Math.cos(de.N) * Math.sin(u) * Math.cos(de.i));\n      de.z = de.r * (Math.sin(u) * Math.sin(de.i));\n      return dat;\n    }\n    function spherical() {\n      var de = dat.ephemeris,\n        lon = Math.atan2(de.y, de.x),\n        lat = Math.atan2(de.z, Math.sqrt(de.x * de.x + de.y * de.y));\n      de.l = Trig.normalize(lon);\n      de.b = lat;\n      return dat;\n    }\n    function transform(angles) {}\n    function polar2cart(pos) {\n      var rclat = Math.cos(pos.lat) * pos.r;\n      pos.x = rclat * Math.cos(pos.lon);\n      pos.y = rclat * Math.sin(pos.lon);\n      pos.z = pos.r * Math.sin(pos.lat);\n      return pos;\n    }\n    function JD(dt) {\n      var yr = dt.getUTCFullYear(),\n        mo = dt.getUTCMonth() + 1,\n        dy = dt.getUTCDate(),\n        frac = (dt.getUTCHours() - 12 + dt.getUTCMinutes() / 60.0 + dt.getUTCSeconds() / 3600.0) / 24,\n        IYMIN = -4799; /* Earliest year allowed (4800BC) */\n\n      if (yr < IYMIN) return -1;\n      var a = Math.floor((14 - mo) / 12),\n        y = yr + 4800 - a,\n        m = mo + 12 * a - 3;\n      var jdn = dy + Math.floor((153 * m + 2) / 5) + 365 * y + Math.floor(y / 4) - Math.floor(y / 100) + Math.floor(y / 400) - 32045;\n      return jdn + frac;\n    }\n    function mst(lon) {\n      var l = lon || 0; // lon=0 -> gmst\n      return (18.697374558 + 24.06570982441908 * dat.ephemeris.d) * 15 + l;\n    }\n    function observer(pos) {\n      var flat = 298.257223563,\n        // WGS84 flattening of earth\n        re = 6378.137,\n        // GRS80/WGS84 semi major axis of earth ellipsoid\n        h = pos.h || 0,\n        cart = {},\n        gmst = mst();\n      var cosl = Math.cos(pos.lat),\n        sinl = Math.sin(pos.lat),\n        fl = 1.0 - 1.0 / flat;\n      var fl2 = fl * fl;\n      var u = 1.0 / Math.sqrt(cosl * cosl + fl2 * sinl * sinl),\n        a = re * u + h,\n        b = re * fl2 * u + h,\n        r = Math.sqrt(a * a * cosl * cosl + b * b * sinl * sinl); // geocentric distance from earth center\n\n      cart.lat = Math.acos(a * cosl / r);\n      cart.lon = pos.lon;\n      cart.r = h;\n      if (pos.lat < 0.0) cart.lat *= -1;\n      polar2cart(cart);\n\n      // rotate around earth's polar axis to align coordinate system from Greenwich to vernal equinox\n      var angle = gmst * deg2rad; // sideral time gmst given in hours. Convert to radians\n\n      cart.x = cart.x * Math.cos(angle) - cart.y * Math.sin(angle);\n      cart.y = cart.x * Math.sin(angle) + cart.y * Math.cos(angle);\n      return cart;\n    }\n    function moon_elements(dat) {\n      if (typeof Moon !== \"undefined\") return Moon.elements(dat);\n    }\n    function moon_corr(dat, pos) {\n      spherical();\n      if (typeof Moon !== \"undefined\") return Moon.corr(dat, pos);\n    }\n    return kepler;\n  };\n  var Moon = {\n    elements: function (dat) {\n      var t = (dat.jd - 2451545) / 36525,\n        t2 = t * t,\n        t3 = t * t2,\n        t4 = t * t3,\n        t5 = t * t4,\n        t2e4 = t2 * 1e-4,\n        t3e6 = t3 * 1e-6,\n        t4e8 = t4 * 1e-8;\n\n      // semimajor axis\n      var sa = 3400.4 * Math.cos(deg2rad * (235.7004 + 890534.2230 * t - 32.601 * t2e4 + 3.664 * t3e6 - 1.769 * t4e8)) - 635.6 * Math.cos(deg2rad * (100.7370 + 413335.3554 * t - 122.571 * t2e4 - 10.684 * t3e6 + 5.028 * t4e8)) - 235.6 * Math.cos(deg2rad * (134.9634 + 477198.8676 * t + 89.970 * t2e4 + 14.348 * t3e6 - 6.797 * t4e8)) + 218.1 * Math.cos(deg2rad * (238.1713 + 854535.1727 * t - 31.065 * t2e4 + 3.623 * t3e6 - 1.769 * t4e8)) + 181.0 * Math.cos(deg2rad * (10.6638 + 1367733.0907 * t + 57.370 * t2e4 + 18.011 * t3e6 - 8.566 * t4e8)) - 39.9 * Math.cos(deg2rad * (103.2079 + 377336.3051 * t - 121.035 * t2e4 - 10.724 * t3e6 + 5.028 * t4e8)) - 38.4 * Math.cos(deg2rad * (233.2295 + 926533.2733 * t - 34.136 * t2e4 + 3.705 * t3e6 - 1.769 * t4e8)) + 33.8 * Math.cos(deg2rad * (336.4374 + 1303869.5784 * t - 155.171 * t2e4 - 7.020 * t3e6 + 3.259 * t4e8)) + 28.8 * Math.cos(deg2rad * (111.4008 + 1781068.4461 * t - 65.201 * t2e4 + 7.328 * t3e6 - 3.538 * t4e8)) + 12.6 * Math.cos(deg2rad * (13.1347 + 1331734.0404 * t + 58.906 * t2e4 + 17.971 * t3e6 - 8.566 * t4e8)) + 11.4 * Math.cos(deg2rad * (186.5442 + 966404.0351 * t - 68.058 * t2e4 - 0.567 * t3e6 + 0.232 * t4e8)) - 11.1 * Math.cos(deg2rad * (222.5657 - 441199.8173 * t - 91.506 * t2e4 - 14.307 * t3e6 + 6.797 * t4e8)) - 10.2 * Math.cos(deg2rad * (269.9268 + 954397.7353 * t + 179.941 * t2e4 + 28.695 * t3e6 - 13.594 * t4e8)) + 9.7 * Math.cos(deg2rad * (145.6272 + 1844931.9583 * t + 147.340 * t2e4 + 32.359 * t3e6 - 15.363 * t4e8)) + 9.6 * Math.cos(deg2rad * (240.6422 + 818536.1225 * t - 29.529 * t2e4 + 3.582 * t3e6 - 1.769 * t4e8)) + 8.0 * Math.cos(deg2rad * (297.8502 + 445267.1115 * t - 16.300 * t2e4 + 1.832 * t3e6 - 0.884 * t4e8)) - 6.2 * Math.cos(deg2rad * (132.4925 + 513197.9179 * t + 88.434 * t2e4 + 14.388 * t3e6 - 6.797 * t4e8)) + 6.0 * Math.cos(deg2rad * (173.5506 + 1335801.3346 * t - 48.901 * t2e4 + 5.496 * t3e6 - 2.653 * t4e8)) + 3.7 * Math.cos(deg2rad * (113.8717 + 1745069.3958 * t - 63.665 * t2e4 + 7.287 * t3e6 - 3.538 * t4e8)) + 3.6 * Math.cos(deg2rad * (338.9083 + 1267870.5281 * t - 153.636 * t2e4 - 7.061 * t3e6 + 3.259 * t4e8)) + 3.2 * Math.cos(deg2rad * (246.3642 + 2258267.3137 * t + 24.769 * t2e4 + 21.675 * t3e6 - 10.335 * t4e8)) - 3.0 * Math.cos(deg2rad * (8.1929 + 1403732.1410 * t + 55.834 * t2e4 + 18.052 * t3e6 - 8.566 * t4e8)) + 2.3 * Math.cos(deg2rad * (98.2661 + 449334.4057 * t - 124.107 * t2e4 - 10.643 * t3e6 + 5.028 * t4e8)) - 2.2 * Math.cos(deg2rad * (357.5291 + 35999.0503 * t - 1.536 * t2e4 + 0.041 * t3e6 + 0.000 * t4e8)) - 2.0 * Math.cos(deg2rad * (38.5872 + 858602.4669 * t - 138.871 * t2e4 - 8.852 * t3e6 + 4.144 * t4e8)) - 1.8 * Math.cos(deg2rad * (105.6788 + 341337.2548 * t - 119.499 * t2e4 - 10.765 * t3e6 + 5.028 * t4e8)) - 1.7 * Math.cos(deg2rad * (201.4740 + 826670.7108 * t - 245.142 * t2e4 - 21.367 * t3e6 + 10.057 * t4e8)) + 1.6 * Math.cos(deg2rad * (184.1196 + 401329.0556 * t + 125.428 * t2e4 + 18.579 * t3e6 - 8.798 * t4e8)) - 1.4 * Math.cos(deg2rad * (308.4192 - 489205.1674 * t + 158.029 * t2e4 + 14.915 * t3e6 - 7.029 * t4e8)) + 1.3 * Math.cos(deg2rad * (325.7736 - 63863.5122 * t - 212.541 * t2e4 - 25.031 * t3e6 + 11.826 * t4e8));\n      var sapp = -0.55 * Math.cos(deg2rad * (238.2 + 854535.2 * t)) + 0.10 * Math.cos(deg2rad * (103.2 + 377336.3 * t)) + 0.10 * Math.cos(deg2rad * (233.2 + 926533.3 * t));\n      var sma = 383397.6 + sa + sapp * t;\n\n      // orbital eccentricity\n\n      var se = 0.014217 * Math.cos(deg2rad * (100.7370 + 413335.3554 * t - 122.571 * t2e4 - 10.684 * t3e6 + 5.028 * t4e8)) + 0.008551 * Math.cos(deg2rad * (325.7736 - 63863.5122 * t - 212.541 * t2e4 - 25.031 * t3e6 + 11.826 * t4e8)) - 0.001383 * Math.cos(deg2rad * (134.9634 + 477198.8676 * t + 89.970 * t2e4 + 14.348 * t3e6 - 6.797 * t4e8)) + 0.001353 * Math.cos(deg2rad * (10.6638 + 1367733.0907 * t + 57.370 * t2e4 + 18.011 * t3e6 - 8.566 * t4e8)) - 0.001146 * Math.cos(deg2rad * (66.5106 + 349471.8432 * t - 335.112 * t2e4 - 35.715 * t3e6 + 16.854 * t4e8)) - 0.000915 * Math.cos(deg2rad * (201.4740 + 826670.7108 * t - 245.142 * t2e4 - 21.367 * t3e6 + 10.057 * t4e8)) + 0.000869 * Math.cos(deg2rad * (103.2079 + 377336.3051 * t - 121.035 * t2e4 - 10.724 * t3e6 + 5.028 * t4e8)) - 0.000628 * Math.cos(deg2rad * (235.7004 + 890534.2230 * t - 32.601 * t2e4 + 3.664 * t3e6 - 1.769 * t4e8)) - 0.000393 * Math.cos(deg2rad * (291.5472 - 127727.0245 * t - 425.082 * t2e4 - 50.062 * t3e6 + 23.651 * t4e8)) + 0.000284 * Math.cos(deg2rad * (328.2445 - 99862.5625 * t - 211.005 * t2e4 - 25.072 * t3e6 + 11.826 * t4e8)) - 0.000278 * Math.cos(deg2rad * (162.8868 - 31931.7561 * t - 106.271 * t2e4 - 12.516 * t3e6 + 5.913 * t4e8)) - 0.000240 * Math.cos(deg2rad * (269.9268 + 954397.7353 * t + 179.941 * t2e4 + 28.695 * t3e6 - 13.594 * t4e8)) + 0.000230 * Math.cos(deg2rad * (111.4008 + 1781068.4461 * t - 65.201 * t2e4 + 7.328 * t3e6 - 3.538 * t4e8)) + 0.000229 * Math.cos(deg2rad * (167.2476 + 762807.1986 * t - 457.683 * t2e4 - 46.398 * t3e6 + 21.882 * t4e8)) - 0.000202 * Math.cos(deg2rad * (83.3826 - 12006.2998 * t + 247.999 * t2e4 + 29.262 * t3e6 - 13.826 * t4e8)) + 0.000190 * Math.cos(deg2rad * (190.8102 - 541062.3799 * t - 302.511 * t2e4 - 39.379 * t3e6 + 18.623 * t4e8)) + 0.000177 * Math.cos(deg2rad * (357.5291 + 35999.0503 * t - 1.536 * t2e4 + 0.041 * t3e6 + 0.000 * t4e8)) + 0.000153 * Math.cos(deg2rad * (32.2842 + 285608.3309 * t - 547.653 * t2e4 - 60.746 * t3e6 + 28.679 * t4e8)) - 0.000137 * Math.cos(deg2rad * (44.8902 + 1431596.6029 * t + 269.911 * t2e4 + 43.043 * t3e6 - 20.392 * t4e8)) + 0.000122 * Math.cos(deg2rad * (145.6272 + 1844931.9583 * t + 147.340 * t2e4 + 32.359 * t3e6 - 15.363 * t4e8)) + 0.000116 * Math.cos(deg2rad * (302.2110 + 1240006.0662 * t - 367.713 * t2e4 - 32.051 * t3e6 + 15.085 * t4e8)) - 0.000111 * Math.cos(deg2rad * (203.9449 + 790671.6605 * t - 243.606 * t2e4 - 21.408 * t3e6 + 10.057 * t4e8)) - 0.000108 * Math.cos(deg2rad * (68.9815 + 313472.7929 * t - 333.576 * t2e4 - 35.756 * t3e6 + 16.854 * t4e8)) + 0.000096 * Math.cos(deg2rad * (336.4374 + 1303869.5784 * t - 155.171 * t2e4 - 7.020 * t3e6 + 3.259 * t4e8)) - 0.000090 * Math.cos(deg2rad * (98.2661 + 449334.4057 * t - 124.107 * t2e4 - 10.643 * t3e6 + 5.028 * t4e8)) + 0.000090 * Math.cos(deg2rad * (13.1347 + 1331734.0404 * t + 58.906 * t2e4 + 17.971 * t3e6 - 8.566 * t4e8)) + 0.000056 * Math.cos(deg2rad * (55.8468 - 1018261.2475 * t - 392.482 * t2e4 - 53.726 * t3e6 + 25.420 * t4e8)) - 0.000056 * Math.cos(deg2rad * (238.1713 + 854535.1727 * t - 31.065 * t2e4 + 3.623 * t3e6 - 1.769 * t4e8)) + 0.000052 * Math.cos(deg2rad * (308.4192 - 489205.1674 * t + 158.029 * t2e4 + 14.915 * t3e6 - 7.029 * t4e8)) - 0.000050 * Math.cos(deg2rad * (133.0212 + 698943.6863 * t - 670.224 * t2e4 - 71.429 * t3e6 + 33.708 * t4e8)) - 0.000049 * Math.cos(deg2rad * (267.9846 + 1176142.5540 * t - 580.254 * t2e4 - 57.082 * t3e6 + 26.911 * t4e8)) - 0.000049 * Math.cos(deg2rad * (184.1196 + 401329.0556 * t + 125.428 * t2e4 + 18.579 * t3e6 - 8.798 * t4e8)) - 0.000045 * Math.cos(deg2rad * (49.1562 - 75869.8120 * t + 35.458 * t2e4 + 4.231 * t3e6 - 2.001 * t4e8)) + 0.000044 * Math.cos(deg2rad * (257.3208 - 191590.5367 * t - 637.623 * t2e4 - 75.093 * t3e6 + 35.477 * t4e8)) + 0.000042 * Math.cos(deg2rad * (105.6788 + 341337.2548 * t - 119.499 * t2e4 - 10.765 * t3e6 + 5.028 * t4e8)) + 0.000042 * Math.cos(deg2rad * (160.4159 + 4067.2942 * t - 107.806 * t2e4 - 12.475 * t3e6 + 5.913 * t4e8)) + 0.000040 * Math.cos(deg2rad * (246.3642 + 2258267.3137 * t + 24.769 * t2e4 + 21.675 * t3e6 - 10.335 * t4e8)) - 0.000040 * Math.cos(deg2rad * (156.5838 - 604925.8921 * t - 515.053 * t2e4 - 64.410 * t3e6 + 30.448 * t4e8)) + 0.000036 * Math.cos(deg2rad * (169.7185 + 726808.1483 * t - 456.147 * t2e4 - 46.439 * t3e6 + 21.882 * t4e8)) + 0.000029 * Math.cos(deg2rad * (113.8717 + 1745069.3958 * t - 63.665 * t2e4 + 7.287 * t3e6 - 3.538 * t4e8)) - 0.000029 * Math.cos(deg2rad * (297.8502 + 445267.1115 * t - 16.300 * t2e4 + 1.832 * t3e6 - 0.884 * t4e8)) - 0.000028 * Math.cos(deg2rad * (294.0181 - 163726.0747 * t - 423.546 * t2e4 - 50.103 * t3e6 + 23.651 * t4e8)) + 0.000027 * Math.cos(deg2rad * (263.6238 + 381403.5993 * t - 228.841 * t2e4 - 23.199 * t3e6 + 10.941 * t4e8)) - 0.000026 * Math.cos(deg2rad * (358.0578 + 221744.8187 * t - 760.194 * t2e4 - 85.777 * t3e6 + 40.505 * t4e8)) - 0.000026 * Math.cos(deg2rad * (8.1929 + 1403732.1410 * t + 55.834 * t2e4 + 18.052 * t3e6 - 8.566 * t4e8));\n      var sedp = -0.0022 * Math.cos(deg2rad * (103.2 + 377336.3 * t));\n      var ecc = 0.055544 + se + 1e-3 * t * sedp;\n\n      // sine of half the inclination\n\n      var sg = 0.0011776 * Math.cos(deg2rad * (49.1562 - 75869.8120 * t + 35.458 * t2e4 + 4.231 * t3e6 - 2.001 * t4e8)) - 0.0000971 * Math.cos(deg2rad * (235.7004 + 890534.2230 * t - 32.601 * t2e4 + 3.664 * t3e6 - 1.769 * t4e8)) + 0.0000908 * Math.cos(deg2rad * (186.5442 + 966404.0351 * t - 68.058 * t2e4 - 0.567 * t3e6 + 0.232 * t4e8)) + 0.0000623 * Math.cos(deg2rad * (83.3826 - 12006.2998 * t + 247.999 * t2e4 + 29.262 * t3e6 - 13.826 * t4e8)) + 0.0000483 * Math.cos(deg2rad * (51.6271 - 111868.8623 * t + 36.994 * t2e4 + 4.190 * t3e6 - 2.001 * t4e8)) + 0.0000348 * Math.cos(deg2rad * (100.7370 + 413335.3554 * t - 122.571 * t2e4 - 10.684 * t3e6 + 5.028 * t4e8)) - 0.0000316 * Math.cos(deg2rad * (308.4192 - 489205.1674 * t + 158.029 * t2e4 + 14.915 * t3e6 - 7.029 * t4e8)) - 0.0000253 * Math.cos(deg2rad * (46.6853 - 39870.7617 * t + 33.922 * t2e4 + 4.272 * t3e6 - 2.001 * t4e8)) - 0.0000141 * Math.cos(deg2rad * (274.1928 - 553068.6797 * t - 54.513 * t2e4 - 10.116 * t3e6 + 4.797 * t4e8)) + 0.0000127 * Math.cos(deg2rad * (325.7736 - 63863.5122 * t - 212.541 * t2e4 - 25.031 * t3e6 + 11.826 * t4e8)) + 0.0000117 * Math.cos(deg2rad * (184.1196 + 401329.0556 * t + 125.428 * t2e4 + 18.579 * t3e6 - 8.798 * t4e8)) - 0.0000078 * Math.cos(deg2rad * (98.3124 - 151739.6240 * t + 70.916 * t2e4 + 8.462 * t3e6 - 4.001 * t4e8)) - 0.0000063 * Math.cos(deg2rad * (238.1713 + 854535.1727 * t - 31.065 * t2e4 + 3.623 * t3e6 - 1.769 * t4e8)) + 0.0000063 * Math.cos(deg2rad * (134.9634 + 477198.8676 * t + 89.970 * t2e4 + 14.348 * t3e6 - 6.797 * t4e8)) + 0.0000036 * Math.cos(deg2rad * (321.5076 + 1443602.9027 * t + 21.912 * t2e4 + 13.780 * t3e6 - 6.566 * t4e8)) - 0.0000035 * Math.cos(deg2rad * (10.6638 + 1367733.0907 * t + 57.370 * t2e4 + 18.011 * t3e6 - 8.566 * t4e8)) + 0.0000024 * Math.cos(deg2rad * (149.8932 + 337465.5434 * t - 87.113 * t2e4 - 6.453 * t3e6 + 3.028 * t4e8)) + 0.0000024 * Math.cos(deg2rad * (170.9849 - 930404.9848 * t + 66.523 * t2e4 + 0.608 * t3e6 - 0.232 * t4e8));\n      var sgp = -0.0203 * Math.cos(deg2rad * (125.0 - 1934.1 * t)) + 0.0034 * Math.cos(deg2rad * (220.2 - 1935.5 * t));\n      var gamma = 0.0449858 + sg + 1e-3 * sgp;\n\n      // longitude of perigee\n\n      var sp = -15.448 * Math.sin(deg2rad * (100.7370 + 413335.3554 * t - 122.571 * t2e4 - 10.684 * t3e6 + 5.028 * t4e8)) - 9.642 * Math.sin(deg2rad * (325.7736 - 63863.5122 * t - 212.541 * t2e4 - 25.031 * t3e6 + 11.826 * t4e8)) - 2.721 * Math.sin(deg2rad * (134.9634 + 477198.8676 * t + 89.970 * t2e4 + 14.348 * t3e6 - 6.797 * t4e8)) + 2.607 * Math.sin(deg2rad * (66.5106 + 349471.8432 * t - 335.112 * t2e4 - 35.715 * t3e6 + 16.854 * t4e8)) + 2.085 * Math.sin(deg2rad * (201.4740 + 826670.7108 * t - 245.142 * t2e4 - 21.367 * t3e6 + 10.057 * t4e8)) + 1.477 * Math.sin(deg2rad * (10.6638 + 1367733.0907 * t + 57.370 * t2e4 + 18.011 * t3e6 - 8.566 * t4e8)) + 0.968 * Math.sin(deg2rad * (291.5472 - 127727.0245 * t - 425.082 * t2e4 - 50.062 * t3e6 + 23.651 * t4e8)) - 0.949 * Math.sin(deg2rad * (103.2079 + 377336.3051 * t - 121.035 * t2e4 - 10.724 * t3e6 + 5.028 * t4e8)) - 0.703 * Math.sin(deg2rad * (167.2476 + 762807.1986 * t - 457.683 * t2e4 - 46.398 * t3e6 + 21.882 * t4e8)) - 0.660 * Math.sin(deg2rad * (235.7004 + 890534.2230 * t - 32.601 * t2e4 + 3.664 * t3e6 - 1.769 * t4e8)) - 0.577 * Math.sin(deg2rad * (190.8102 - 541062.3799 * t - 302.511 * t2e4 - 39.379 * t3e6 + 18.623 * t4e8)) - 0.524 * Math.sin(deg2rad * (269.9268 + 954397.7353 * t + 179.941 * t2e4 + 28.695 * t3e6 - 13.594 * t4e8)) - 0.482 * Math.sin(deg2rad * (32.2842 + 285608.3309 * t - 547.653 * t2e4 - 60.746 * t3e6 + 28.679 * t4e8)) + 0.452 * Math.sin(deg2rad * (357.5291 + 35999.0503 * t - 1.536 * t2e4 + 0.041 * t3e6 + 0.000 * t4e8)) - 0.381 * Math.sin(deg2rad * (302.2110 + 1240006.0662 * t - 367.713 * t2e4 - 32.051 * t3e6 + 15.085 * t4e8)) - 0.342 * Math.sin(deg2rad * (328.2445 - 99862.5625 * t - 211.005 * t2e4 - 25.072 * t3e6 + 11.826 * t4e8)) - 0.312 * Math.sin(deg2rad * (44.8902 + 1431596.6029 * t + 269.911 * t2e4 + 43.043 * t3e6 - 20.392 * t4e8)) + 0.282 * Math.sin(deg2rad * (162.8868 - 31931.7561 * t - 106.271 * t2e4 - 12.516 * t3e6 + 5.913 * t4e8)) + 0.255 * Math.sin(deg2rad * (203.9449 + 790671.6605 * t - 243.606 * t2e4 - 21.408 * t3e6 + 10.057 * t4e8)) + 0.252 * Math.sin(deg2rad * (68.9815 + 313472.7929 * t - 333.576 * t2e4 - 35.756 * t3e6 + 16.854 * t4e8)) - 0.211 * Math.sin(deg2rad * (83.3826 - 12006.2998 * t + 247.999 * t2e4 + 29.262 * t3e6 - 13.826 * t4e8)) + 0.193 * Math.sin(deg2rad * (267.9846 + 1176142.5540 * t - 580.254 * t2e4 - 57.082 * t3e6 + 26.911 * t4e8)) + 0.191 * Math.sin(deg2rad * (133.0212 + 698943.6863 * t - 670.224 * t2e4 - 71.429 * t3e6 + 33.708 * t4e8)) - 0.184 * Math.sin(deg2rad * (55.8468 - 1018261.2475 * t - 392.482 * t2e4 - 53.726 * t3e6 + 25.420 * t4e8)) + 0.182 * Math.sin(deg2rad * (145.6272 + 1844931.9583 * t + 147.340 * t2e4 + 32.359 * t3e6 - 15.363 * t4e8)) - 0.158 * Math.sin(deg2rad * (257.3208 - 191590.5367 * t - 637.623 * t2e4 - 75.093 * t3e6 + 35.477 * t4e8)) + 0.148 * Math.sin(deg2rad * (156.5838 - 604925.8921 * t - 515.053 * t2e4 - 64.410 * t3e6 + 30.448 * t4e8)) - 0.111 * Math.sin(deg2rad * (169.7185 + 726808.1483 * t - 456.147 * t2e4 - 46.439 * t3e6 + 21.882 * t4e8)) + 0.101 * Math.sin(deg2rad * (13.1347 + 1331734.0404 * t + 58.906 * t2e4 + 17.971 * t3e6 - 8.566 * t4e8)) + 0.100 * Math.sin(deg2rad * (358.0578 + 221744.8187 * t - 760.194 * t2e4 - 85.777 * t3e6 + 40.505 * t4e8)) + 0.087 * Math.sin(deg2rad * (98.2661 + 449334.4057 * t - 124.107 * t2e4 - 10.643 * t3e6 + 5.028 * t4e8)) + 0.080 * Math.sin(deg2rad * (42.9480 + 1653341.4216 * t - 490.283 * t2e4 - 42.734 * t3e6 + 20.113 * t4e8)) + 0.080 * Math.sin(deg2rad * (222.5657 - 441199.8173 * t - 91.506 * t2e4 - 14.307 * t3e6 + 6.797 * t4e8)) + 0.077 * Math.sin(deg2rad * (294.0181 - 163726.0747 * t - 423.546 * t2e4 - 50.103 * t3e6 + 23.651 * t4e8)) - 0.073 * Math.sin(deg2rad * (280.8834 - 1495460.1151 * t - 482.452 * t2e4 - 68.074 * t3e6 + 32.217 * t4e8)) - 0.071 * Math.sin(deg2rad * (304.6819 + 1204007.0159 * t - 366.177 * t2e4 - 32.092 * t3e6 + 15.085 * t4e8)) - 0.069 * Math.sin(deg2rad * (233.7582 + 1112279.0417 * t - 792.795 * t2e4 - 82.113 * t3e6 + 38.736 * t4e8)) - 0.067 * Math.sin(deg2rad * (34.7551 + 249609.2807 * t - 546.117 * t2e4 - 60.787 * t3e6 + 28.679 * t4e8)) - 0.067 * Math.sin(deg2rad * (263.6238 + 381403.5993 * t - 228.841 * t2e4 - 23.199 * t3e6 + 10.941 * t4e8)) + 0.055 * Math.sin(deg2rad * (21.6203 - 1082124.7597 * t - 605.023 * t2e4 - 78.757 * t3e6 + 37.246 * t4e8)) + 0.055 * Math.sin(deg2rad * (308.4192 - 489205.1674 * t + 158.029 * t2e4 + 14.915 * t3e6 - 7.029 * t4e8)) - 0.054 * Math.sin(deg2rad * (8.7216 + 1589477.9094 * t - 702.824 * t2e4 - 67.766 * t3e6 + 31.939 * t4e8)) - 0.052 * Math.sin(deg2rad * (179.8536 + 1908795.4705 * t + 359.881 * t2e4 + 57.390 * t3e6 - 27.189 * t4e8)) - 0.050 * Math.sin(deg2rad * (98.7948 + 635080.1741 * t - 882.765 * t2e4 - 96.461 * t3e6 + 45.533 * t4e8)) - 0.049 * Math.sin(deg2rad * (128.6604 - 95795.2683 * t - 318.812 * t2e4 - 37.547 * t3e6 + 17.738 * t4e8)) - 0.047 * Math.sin(deg2rad * (17.3544 + 425341.6552 * t - 370.570 * t2e4 - 39.946 * t3e6 + 18.854 * t4e8)) - 0.044 * Math.sin(deg2rad * (160.4159 + 4067.2942 * t - 107.806 * t2e4 - 12.475 * t3e6 + 5.913 * t4e8)) - 0.043 * Math.sin(deg2rad * (238.1713 + 854535.1727 * t - 31.065 * t2e4 + 3.623 * t3e6 - 1.769 * t4e8)) + 0.042 * Math.sin(deg2rad * (270.4555 + 1140143.5037 * t - 578.718 * t2e4 - 57.123 * t3e6 + 26.911 * t4e8)) - 0.042 * Math.sin(deg2rad * (132.4925 + 513197.9179 * t + 88.434 * t2e4 + 14.388 * t3e6 - 6.797 * t4e8)) - 0.041 * Math.sin(deg2rad * (122.3573 - 668789.4043 * t - 727.594 * t2e4 - 89.441 * t3e6 + 42.274 * t4e8)) - 0.040 * Math.sin(deg2rad * (105.6788 + 341337.2548 * t - 119.499 * t2e4 - 10.765 * t3e6 + 5.028 * t4e8)) + 0.038 * Math.sin(deg2rad * (135.4921 + 662944.6361 * t - 668.688 * t2e4 - 71.470 * t3e6 + 33.708 * t4e8)) - 0.037 * Math.sin(deg2rad * (242.3910 - 51857.2124 * t - 460.540 * t2e4 - 54.293 * t3e6 + 25.652 * t4e8)) + 0.036 * Math.sin(deg2rad * (336.4374 + 1303869.5784 * t - 155.171 * t2e4 - 7.020 * t3e6 + 3.259 * t4e8)) + 0.035 * Math.sin(deg2rad * (223.0943 - 255454.0489 * t - 850.164 * t2e4 - 100.124 * t3e6 + 47.302 * t4e8)) - 0.034 * Math.sin(deg2rad * (193.2811 - 577061.4302 * t - 300.976 * t2e4 - 39.419 * t3e6 + 18.623 * t4e8)) + 0.031 * Math.sin(deg2rad * (87.6023 - 918398.6850 * t - 181.476 * t2e4 - 28.654 * t3e6 + 13.594 * t4e8));\n      var spp = 2.4 * Math.sin(deg2rad * (103.2 + 377336.3 * t));\n      var lp = 83.353 + 4069.0137 * t - 103.238 * t2e4 - 12.492 * t3e6 + 5.263 * t4e8 + sp + 1e-3 * t * spp;\n\n      // longitude of the ascending node\n\n      var sr = -1.4979 * Math.sin(deg2rad * (49.1562 - 75869.8120 * t + 35.458 * t2e4 + 4.231 * t3e6 - 2.001 * t4e8)) - 0.1500 * Math.sin(deg2rad * (357.5291 + 35999.0503 * t - 1.536 * t2e4 + 0.041 * t3e6 + 0.000 * t4e8)) - 0.1226 * Math.sin(deg2rad * (235.7004 + 890534.2230 * t - 32.601 * t2e4 + 3.664 * t3e6 - 1.769 * t4e8)) + 0.1176 * Math.sin(deg2rad * (186.5442 + 966404.0351 * t - 68.058 * t2e4 - 0.567 * t3e6 + 0.232 * t4e8)) - 0.0801 * Math.sin(deg2rad * (83.3826 - 12006.2998 * t + 247.999 * t2e4 + 29.262 * t3e6 - 13.826 * t4e8)) - 0.0616 * Math.sin(deg2rad * (51.6271 - 111868.8623 * t + 36.994 * t2e4 + 4.190 * t3e6 - 2.001 * t4e8)) + 0.0490 * Math.sin(deg2rad * (100.7370 + 413335.3554 * t - 122.571 * t2e4 - 10.684 * t3e6 + 5.028 * t4e8)) + 0.0409 * Math.sin(deg2rad * (308.4192 - 489205.1674 * t + 158.029 * t2e4 + 14.915 * t3e6 - 7.029 * t4e8)) + 0.0327 * Math.sin(deg2rad * (134.9634 + 477198.8676 * t + 89.970 * t2e4 + 14.348 * t3e6 - 6.797 * t4e8)) + 0.0324 * Math.sin(deg2rad * (46.6853 - 39870.7617 * t + 33.922 * t2e4 + 4.272 * t3e6 - 2.001 * t4e8)) + 0.0196 * Math.sin(deg2rad * (98.3124 - 151739.6240 * t + 70.916 * t2e4 + 8.462 * t3e6 - 4.001 * t4e8)) + 0.0180 * Math.sin(deg2rad * (274.1928 - 553068.6797 * t - 54.513 * t2e4 - 10.116 * t3e6 + 4.797 * t4e8)) + 0.0150 * Math.sin(deg2rad * (325.7736 - 63863.5122 * t - 212.541 * t2e4 - 25.031 * t3e6 + 11.826 * t4e8)) - 0.0150 * Math.sin(deg2rad * (184.1196 + 401329.0556 * t + 125.428 * t2e4 + 18.579 * t3e6 - 8.798 * t4e8)) - 0.0078 * Math.sin(deg2rad * (238.1713 + 854535.1727 * t - 31.065 * t2e4 + 3.623 * t3e6 - 1.769 * t4e8)) - 0.0045 * Math.sin(deg2rad * (10.6638 + 1367733.0907 * t + 57.370 * t2e4 + 18.011 * t3e6 - 8.566 * t4e8)) + 0.0044 * Math.sin(deg2rad * (321.5076 + 1443602.9027 * t + 21.912 * t2e4 + 13.780 * t3e6 - 6.566 * t4e8)) - 0.0042 * Math.sin(deg2rad * (162.8868 - 31931.7561 * t - 106.271 * t2e4 - 12.516 * t3e6 + 5.913 * t4e8)) - 0.0031 * Math.sin(deg2rad * (170.9849 - 930404.9848 * t + 66.523 * t2e4 + 0.608 * t3e6 - 0.232 * t4e8)) + 0.0031 * Math.sin(deg2rad * (103.2079 + 377336.3051 * t - 121.035 * t2e4 - 10.724 * t3e6 + 5.028 * t4e8)) + 0.0029 * Math.sin(deg2rad * (222.6120 - 1042273.8471 * t + 103.516 * t2e4 + 4.798 * t3e6 - 2.232 * t4e8)) + 0.0028 * Math.sin(deg2rad * (184.0733 + 1002403.0853 * t - 69.594 * t2e4 - 0.526 * t3e6 + 0.232 * t4e8));\n      var srp = 25.9 * Math.sin(deg2rad * (125.0 - 1934.1 * t)) - 4.3 * Math.sin(deg2rad * (220.2 - 1935.5 * t));\n      var srpp = 0.38 * Math.sin(deg2rad * (357.5 + 35999.1 * t));\n      var raan = 125.0446 - 1934.13618 * t + 20.762 * t2e4 + 2.139 * t3e6 - 1.650 * t4e8 + sr + 1e-3 * (srp + srpp * t);\n\n      // mean longitude\n\n      var sl = -0.92581 * Math.sin(deg2rad * (235.7004 + 890534.2230 * t - 32.601 * t2e4 + 3.664 * t3e6 - 1.769 * t4e8)) + 0.33262 * Math.sin(deg2rad * (100.7370 + 413335.3554 * t - 122.571 * t2e4 - 10.684 * t3e6 + 5.028 * t4e8)) - 0.18402 * Math.sin(deg2rad * (357.5291 + 35999.0503 * t - 1.536 * t2e4 + 0.041 * t3e6 + 0.000 * t4e8)) + 0.11007 * Math.sin(deg2rad * (134.9634 + 477198.8676 * t + 89.970 * t2e4 + 14.348 * t3e6 - 6.797 * t4e8)) - 0.06055 * Math.sin(deg2rad * (238.1713 + 854535.1727 * t - 31.065 * t2e4 + 3.623 * t3e6 - 1.769 * t4e8)) + 0.04741 * Math.sin(deg2rad * (325.7736 - 63863.5122 * t - 212.541 * t2e4 - 25.031 * t3e6 + 11.826 * t4e8)) - 0.03086 * Math.sin(deg2rad * (10.6638 + 1367733.0907 * t + 57.370 * t2e4 + 18.011 * t3e6 - 8.566 * t4e8)) + 0.02184 * Math.sin(deg2rad * (103.2079 + 377336.3051 * t - 121.035 * t2e4 - 10.724 * t3e6 + 5.028 * t4e8)) + 0.01645 * Math.sin(deg2rad * (49.1562 - 75869.8120 * t + 35.458 * t2e4 + 4.231 * t3e6 - 2.001 * t4e8)) + 0.01022 * Math.sin(deg2rad * (233.2295 + 926533.2733 * t - 34.136 * t2e4 + 3.705 * t3e6 - 1.769 * t4e8)) - 0.00756 * Math.sin(deg2rad * (336.4374 + 1303869.5784 * t - 155.171 * t2e4 - 7.020 * t3e6 + 3.259 * t4e8)) - 0.00530 * Math.sin(deg2rad * (222.5657 - 441199.8173 * t - 91.506 * t2e4 - 14.307 * t3e6 + 6.797 * t4e8)) - 0.00496 * Math.sin(deg2rad * (162.8868 - 31931.7561 * t - 106.271 * t2e4 - 12.516 * t3e6 + 5.913 * t4e8)) - 0.00472 * Math.sin(deg2rad * (297.8502 + 445267.1115 * t - 16.300 * t2e4 + 1.832 * t3e6 - 0.884 * t4e8)) - 0.00271 * Math.sin(deg2rad * (240.6422 + 818536.1225 * t - 29.529 * t2e4 + 3.582 * t3e6 - 1.769 * t4e8)) + 0.00264 * Math.sin(deg2rad * (132.4925 + 513197.9179 * t + 88.434 * t2e4 + 14.388 * t3e6 - 6.797 * t4e8)) - 0.00254 * Math.sin(deg2rad * (186.5442 + 966404.0351 * t - 68.058 * t2e4 - 0.567 * t3e6 + 0.232 * t4e8)) + 0.00234 * Math.sin(deg2rad * (269.9268 + 954397.7353 * t + 179.941 * t2e4 + 28.695 * t3e6 - 13.594 * t4e8)) - 0.00220 * Math.sin(deg2rad * (13.1347 + 1331734.0404 * t + 58.906 * t2e4 + 17.971 * t3e6 - 8.566 * t4e8)) - 0.00202 * Math.sin(deg2rad * (355.0582 + 71998.1006 * t - 3.072 * t2e4 + 0.082 * t3e6 + 0.000 * t4e8)) + 0.00167 * Math.sin(deg2rad * (328.2445 - 99862.5625 * t - 211.005 * t2e4 - 25.072 * t3e6 + 11.826 * t4e8)) - 0.00143 * Math.sin(deg2rad * (173.5506 + 1335801.3346 * t - 48.901 * t2e4 + 5.496 * t3e6 - 2.653 * t4e8)) - 0.00121 * Math.sin(deg2rad * (98.2661 + 449334.4057 * t - 124.107 * t2e4 - 10.643 * t3e6 + 5.028 * t4e8)) - 0.00116 * Math.sin(deg2rad * (145.6272 + 1844931.9583 * t + 147.340 * t2e4 + 32.359 * t3e6 - 15.363 * t4e8)) + 0.00102 * Math.sin(deg2rad * (105.6788 + 341337.2548 * t - 119.499 * t2e4 - 10.765 * t3e6 + 5.028 * t4e8)) - 0.00090 * Math.sin(deg2rad * (184.1196 + 401329.0556 * t + 125.428 * t2e4 + 18.579 * t3e6 - 8.798 * t4e8)) - 0.00086 * Math.sin(deg2rad * (338.9083 + 1267870.5281 * t - 153.636 * t2e4 - 7.061 * t3e6 + 3.259 * t4e8)) - 0.00078 * Math.sin(deg2rad * (111.4008 + 1781068.4461 * t - 65.201 * t2e4 + 7.328 * t3e6 - 3.538 * t4e8)) + 0.00069 * Math.sin(deg2rad * (323.3027 - 27864.4619 * t - 214.077 * t2e4 - 24.990 * t3e6 + 11.826 * t4e8)) + 0.00066 * Math.sin(deg2rad * (51.6271 - 111868.8623 * t + 36.994 * t2e4 + 4.190 * t3e6 - 2.001 * t4e8)) + 0.00065 * Math.sin(deg2rad * (38.5872 + 858602.4669 * t - 138.871 * t2e4 - 8.852 * t3e6 + 4.144 * t4e8)) - 0.00060 * Math.sin(deg2rad * (83.3826 - 12006.2998 * t + 247.999 * t2e4 + 29.262 * t3e6 - 13.826 * t4e8)) + 0.00054 * Math.sin(deg2rad * (201.4740 + 826670.7108 * t - 245.142 * t2e4 - 21.367 * t3e6 + 10.057 * t4e8)) - 0.00052 * Math.sin(deg2rad * (308.4192 - 489205.1674 * t + 158.029 * t2e4 + 14.915 * t3e6 - 7.029 * t4e8)) + 0.00048 * Math.sin(deg2rad * (8.1929 + 1403732.1410 * t + 55.834 * t2e4 + 18.052 * t3e6 - 8.566 * t4e8)) - 0.00041 * Math.sin(deg2rad * (46.6853 - 39870.7617 * t + 33.922 * t2e4 + 4.272 * t3e6 - 2.001 * t4e8)) - 0.00033 * Math.sin(deg2rad * (274.1928 - 553068.6797 * t - 54.513 * t2e4 - 10.116 * t3e6 + 4.797 * t4e8)) + 0.00030 * Math.sin(deg2rad * (160.4159 + 4067.2942 * t - 107.806 * t2e4 - 12.475 * t3e6 + 5.913 * t4e8));\n      var slp = 3.96 * Math.sin(deg2rad * (119.7 + 131.8 * t)) + 1.96 * Math.sin(deg2rad * (125.0 - 1934.1 * t));\n      var slpp = 0.463 * Math.sin(deg2rad * (357.5 + 35999.1 * t)) + 0.152 * Math.sin(deg2rad * (238.2 + 854535.2 * t)) - 0.071 * Math.sin(deg2rad * (27.8 + 131.8 * t)) - 0.055 * Math.sin(deg2rad * (103.2 + 377336.3 * t)) - 0.026 * Math.sin(deg2rad * (233.2 + 926533.3 * t));\n      var slppp = 14 * Math.sin(deg2rad * (357.5 + 35999.1 * t)) + 5 * Math.sin(deg2rad * (238.2 + 854535.2 * t));\n      var lambda = 218.31665 + 481267.88134 * t - 13.268 * t2e4 + 1.856 * t3e6 - 1.534 * t4e8 + sl + 1e-3 * (slp + slpp * t + slppp * t2e4);\n      dat.a = sma;\n      dat.e = ecc;\n      dat.i = 2.0 * Math.asin(gamma);\n      dat.w = Trig.normalize(deg2rad * (lp - raan));\n      dat.N = Trig.normalize(deg2rad * raan);\n      dat.M = Trig.normalize(deg2rad * (lambda - lp));\n      return dat;\n    },\n    corr: function (dat, sol) {\n      var M = Trig.normalize(sol.M + Math.PI),\n        w = Trig.normalize(sol.w + Math.PI),\n        L = dat.M + dat.w,\n        // Argument of latitude \n        E = L + dat.N - M - w; // Mean elongation\n\n      var lon = -0.022234 * Math.sin(dat.M - 2 * E) +\n      // Evection\n      0.011494 * Math.sin(2 * E) +\n      // Variation\n      -0.003246 * Math.sin(M) +\n      // Yearly Equation\n      -0.001029 * Math.sin(2 * dat.M - 2 * E) + -9.94838e-4 * Math.sin(dat.M - 2 * E + M) + 9.25025e-4 * Math.sin(dat.M + 2 * E) + 8.02851e-4 * Math.sin(2 * E - M) + 7.15585e-4 * Math.sin(dat.M - M) + -6.10865e-4 * Math.sin(E) + -5.41052e-4 * Math.sin(dat.M + M) + -2.61799e-4 * Math.sin(2 * L - 2 * E) + 1.91986e-4 * Math.sin(dat.M - 4 * E);\n      dat.ra += lon;\n      var lat = -0.003019 * Math.sin(L - 2 * E) + -9.59931e-4 * Math.sin(dat.M - L - 2 * E) + -8.02851e-4 * Math.sin(dat.M + L - 2 * E) + 5.75958e-4 * Math.sin(L + 2 * E) + 2.96706e-4 * Math.sin(2 * dat.M + L);\n      dat.dec += lat;\n      dat.age = Trig.normalize(dat.l - sol.l + Math.PI);\n      dat.phase = 0.5 * (1 - Math.cos(dat.age));\n      return dat;\n    }\n  };\n  function exportSVG(fname) {\n    var doc = d3.select(\"body\").append(\"div\").attr(\"id\", \"d3-celestial-svg\").attr(\"style\", \"display: none\"),\n      svg = d3.select(\"#d3-celestial-svg\").append(\"svg\"),\n      //.attr(\"style\", \"display: none\"),\n      m = Celestial.metrics(),\n      cfg = settings.set(),\n      path = cfg.datapath,\n      proj = projections[cfg.projection],\n      rotation = getAngles(cfg.center),\n      center = [-rotation[0], -rotation[1]],\n      scale0 = proj.scale * m.width / 1024,\n      projection = Celestial.projection(cfg.projection).rotate(rotation).translate([m.width / 2, m.height / 2]).scale([m.scale]),\n      adapt = cfg.adaptable ? Math.sqrt(m.scale / scale0) : 1,\n      culture = cfg.culture !== \"\" && cfg.culture !== \"iau\" ? cfg.culture : \"\",\n      circle,\n      id;\n    svg.selectAll(\"*\").remove();\n    var defs = svg.append(\"defs\");\n    if (proj.clip) {\n      projection.clipAngle(90);\n    }\n    circle = d3.geo.circle().angle([179.95]).origin(center);\n    svg.attr(\"width\", m.width).attr(\"height\", m.height);\n    // .attr(\"viewBox\", \" 0 0 \" + (m.width) + \" \" + (m.height));\n\n    var groupNames = ['background', 'milkyWay', 'milkyWayBg', 'gridLines', 'constBoundaries', 'planesequatorial', 'planesecliptic', 'planesgalactic', 'planessupergalactic', 'constLines', 'mapBorder', 'stars', 'dsos', 'planets', 'gridvaluesLon', 'gridvaluesLat', 'constNames', 'starDesignations', 'starNames', 'dsoNames', 'planetNames', 'horizon', 'daylight'],\n      groups = {},\n      styles = {};\n    for (var i = 0; i < groupNames.length; i++) {\n      // inkscape:groupmode=\"layer\", inkscape:label=\"Ebene 1\" \n      groups[groupNames[i]] = svg.append('g').attr({\n        \"id\": groupNames[i],\n        \":inkscape:groupmode\": \"layer\",\n        \":inkscape:label\": groupNames[i]\n      });\n      styles[groupNames[i]] = {};\n    }\n    var graticule = d3.geo.graticule().minorStep([15, 10]);\n    var map = d3.geo.path().projection(projection);\n    var q = d3.queue(2);\n    groups.background.append(\"path\").datum(circle).attr(\"class\", \"background\").attr(\"d\", map);\n    styles.background.fill = cfg.background.fill;\n    if (cfg.lines.graticule.show) {\n      if (cfg.transform === \"equatorial\") {\n        groups.gridLines.append(\"path\").datum(graticule).attr(\"class\", \"gridLines\").attr(\"d\", map);\n        styles.gridLines = svgStyle(cfg.lines.graticule);\n      } else {\n        Celestial.graticule(groups.gridLines, map, cfg.transform);\n        styles.gridLines = svgStyle(cfg.lines.graticule);\n      }\n      if (has(cfg.lines.graticule, \"lon\") && cfg.lines.graticule.lon.pos.length > 0) {\n        var jlon = {\n          type: \"FeatureCollection\",\n          features: getGridValues(\"lon\", cfg.lines.graticule.lon.pos)\n        };\n        groups.gridvaluesLon.selectAll(\".gridvalues_lon\").data(jlon.features).enter().append(\"text\").attr(\"transform\", function (d, i) {\n          return point(d.geometry.coordinates);\n        }).text(function (d) {\n          return d.properties.value;\n        }).attr({\n          dy: \".5em\",\n          dx: \"-.75em\",\n          class: \"gridvaluesLon\"\n        });\n        styles.gridvaluesLon = svgTextStyle(cfg.lines.graticule.lon);\n      }\n      if (has(cfg.lines.graticule, \"lat\") && cfg.lines.graticule.lat.pos.length > 0) {\n        var jlat = {\n          type: \"FeatureCollection\",\n          features: getGridValues(\"lat\", cfg.lines.graticule.lat.pos)\n        };\n        groups.gridvaluesLat.selectAll(\".gridvalues_lat\").data(jlat.features).enter().append(\"text\").attr(\"transform\", function (d, i) {\n          return point(d.geometry.coordinates);\n        }).text(function (d) {\n          return d.properties.value;\n        }).attr({\n          dy: \"-.5em\",\n          dx: \"-.75em\",\n          class: \"gridvaluesLat\"\n        });\n        styles.gridvaluesLat = svgTextStyle(cfg.lines.graticule.lat);\n      }\n    }\n\n    //Celestial planes\n    for (var key in cfg.lines) {\n      if (has(cfg.lines, key) && key != \"graticule\" && cfg.lines[key].show !== false) {\n        id = \"planes\" + key;\n        groups[id].append(\"path\").datum(d3.geo.circle().angle([90]).origin(poles[key])).attr(\"class\", id).attr(\"d\", map);\n        styles[id] = svgStyle(cfg.lines[key]);\n      }\n    }\n\n    //Milky way outline\n    if (cfg.mw.show) {\n      q.defer(function (callback) {\n        d3.json(path + \"mw.json\", function (error, json) {\n          if (error) callback(error);\n          var mw = getData(json, cfg.transform);\n          var mw_back = getMwbackground(mw);\n          groups.milkyWay.selectAll(\".mway\").data(mw.features).enter().append(\"path\").attr(\"class\", \"milkyWay\").attr(\"d\", map);\n          styles.milkyWay = svgStyle(cfg.mw.style);\n          if (!has(cfg.background, \"opacity\") || cfg.background.opacity > 0.95) {\n            groups.milkyWayBg.selectAll(\".mwaybg\").data(mw_back.features).enter().append(\"path\").attr(\"class\", \"milkyWayBg\").attr(\"d\", map);\n            styles.milkyWayBg = {\n              \"fill\": cfg.background.fill,\n              \"fill-opacity\": cfg.background.opacity\n            };\n          }\n          callback(null);\n        });\n      });\n    }\n\n    //Constellation boundaries\n    if (cfg.constellations.bounds) {\n      q.defer(function (callback) {\n        d3.json(path + filename(\"constellations\", \"borders\"), function (error, json) {\n          if (error) callback(error);\n          var conb = getData(json, cfg.transform);\n          if (Celestial.constellation) {\n            var re = new RegExp(\"\\\\b\" + Celestial.constellation + \"\\\\b\");\n          }\n          groups.constBoundaries.selectAll(\".bounds\").data(conb.features).enter().append(\"path\").attr(\"class\", function (d) {\n            return Celestial.constellation && d.ids.search(re) !== -1 ? \"constBoundariesSel\" : \"constBoundaries\";\n          }).attr(\"d\", map);\n          styles.constBoundaries = svgStyle(cfg.constellations.boundStyle);\n          styles.constBoundariesSel = {\n            \"fill\": \"none\",\n            \"stroke\": cfg.constellations.boundStyle.stroke,\n            \"stroke-width\": cfg.constellations.boundStyle.width * 1.5,\n            \"stroke-opacity\": 1,\n            \"stroke-dasharray\": \"none\"\n          };\n          callback(null);\n        });\n      });\n    }\n\n    //Constellation lines\n    if (cfg.constellations.lines) {\n      q.defer(function (callback) {\n        d3.json(path + filename(\"constellations\", \"lines\"), function (error, json) {\n          if (error) callback(error);\n          var conl = getData(json, cfg.transform);\n          groups.constLines.selectAll(\".lines\").data(conl.features).enter().append(\"path\").attr(\"class\", function (d) {\n            return \"constLines\" + d.properties.rank;\n          }).attr(\"d\", map);\n          var dasharray = has(cfg.constellations.lineStyle, \"dash\") ? cfg.constellations.lineStyle.dash.join(\" \") : \"none\";\n          styles.constLines1 = {\n            \"fill\": \"none\",\n            \"stroke\": cfg.constellations.lineStyle.stroke[0],\n            \"stroke-width\": cfg.constellations.lineStyle.width[0],\n            \"stroke-opacity\": cfg.constellations.lineStyle.opacity[0],\n            \"stroke-dasharray\": dasharray\n          };\n          styles.constLines2 = {\n            \"fill\": \"none\",\n            \"stroke\": cfg.constellations.lineStyle.stroke[1],\n            \"stroke-width\": cfg.constellations.lineStyle.width[1],\n            \"stroke-opacity\": cfg.constellations.lineStyle.opacity[1],\n            \"stroke-dasharray\": dasharray\n          };\n          styles.constLines3 = {\n            \"fill\": \"none\",\n            \"stroke\": cfg.constellations.lineStyle.stroke[2],\n            \"stroke-width\": cfg.constellations.lineStyle.width[2],\n            \"stroke-opacity\": cfg.constellations.lineStyle.opacity[2],\n            \"stroke-dasharray\": dasharray\n          };\n          callback(null);\n        });\n      });\n    }\n\n    // Map border\n    q.defer(function (callback) {\n      var rot = projection.rotate();\n      projection.rotate([0, 0, 0]);\n      groups.mapBorder.append(\"path\").datum(graticule.outline).attr(\"class\", \"mapBorder\").attr(\"d\", map);\n      styles.mapBorder = {\n        \"fill\": \"none\",\n        \"stroke\": cfg.background.stroke,\n        \"stroke-width\": cfg.background.width,\n        \"stroke-opacity\": 1,\n        \"stroke-dasharray\": \"none\"\n      };\n      projection.rotate(rot);\n      callback(null);\n    });\n\n    //Constellation names or designation\n    if (cfg.constellations.names) {\n      q.defer(function (callback) {\n        d3.json(path + filename(\"constellations\"), function (error, json) {\n          if (error) callback(error);\n          var conn = getData(json, cfg.transform);\n          groups.constNames.selectAll(\".constnames\").data(conn.features.filter(function (d) {\n            return clip(d.geometry.coordinates) === 1;\n          })).enter().append(\"text\").attr(\"class\", function (d) {\n            return \"constNames\" + d.properties.rank;\n          }).attr(\"transform\", function (d, i) {\n            return point(d.geometry.coordinates);\n          }).text(function (d) {\n            return constName(d);\n          });\n          styles.constNames1 = {\n            \"fill\": cfg.constellations.nameStyle.fill[0],\n            \"fill-opacity\": cfg.constellations.nameStyle.opacity[0],\n            \"font\": cfg.constellations.nameStyle.font[0],\n            \"text-anchor\": svgAlign(cfg.constellations.nameStyle.align)\n          };\n          styles.constNames2 = {\n            \"fill\": cfg.constellations.nameStyle.fill[1],\n            \"fill-opacity\": cfg.constellations.nameStyle.opacity[1],\n            \"font\": cfg.constellations.nameStyle.font[1],\n            \"text-anchor\": svgAlign(cfg.constellations.nameStyle.align)\n          };\n          styles.constNames3 = {\n            \"fill\": cfg.constellations.nameStyle.fill[2],\n            \"fill-opacity\": cfg.constellations.nameStyle.opacity[2],\n            \"font\": cfg.constellations.nameStyle.font[2],\n            \"text-anchor\": svgAlign(cfg.constellations.nameStyle.align)\n          };\n          callback(null);\n        });\n      });\n    }\n\n    //Stars\n    if (cfg.stars.show) {\n      q.defer(function (callback) {\n        d3.json(path + cfg.stars.data, function (error, json) {\n          if (error) callback(error);\n          var cons = getData(json, cfg.transform);\n          groups.stars.selectAll(\".stars\").data(cons.features.filter(function (d) {\n            return d.properties.mag <= cfg.stars.limit;\n          })).enter().append(\"path\").attr(\"class\", function (d) {\n            return \"stars\" + starColor(d.properties.bv);\n          }).attr(\"d\", map.pointRadius(function (d) {\n            return d.properties ? starSize(d.properties.mag) : 1;\n          }));\n          styles.stars = svgStyle(cfg.stars.style);\n          var range = bvcolor.domain();\n          for (i = Round(range[1], 1); i <= Round(range[0], 1); i += 0.1) {\n            styles[\"stars\" + Math.round(i * 10).toString()] = {\n              \"fill\": bvcolor(i)\n            };\n          }\n          if (cfg.stars.designation) {\n            groups.starDesignations.selectAll(\".stardesigs\").data(cons.features.filter(function (d) {\n              return d.properties.mag <= cfg.stars.designationLimit * adapt && clip(d.geometry.coordinates) === 1;\n            })).enter().append(\"text\").attr(\"transform\", function (d) {\n              return point(d.geometry.coordinates);\n            }).text(function (d) {\n              return starDesignation(d.id);\n            }).attr({\n              dy: \".85em\",\n              dx: \".35em\",\n              class: \"starDesignations\"\n            });\n            styles.starDesignations = svgTextStyle(cfg.stars.designationStyle);\n          }\n          if (cfg.stars.propername) {\n            groups.starNames.selectAll(\".starnames\").data(cons.features.filter(function (d) {\n              return d.properties.mag <= cfg.stars.propernameLimit * adapt && clip(d.geometry.coordinates) === 1;\n            })).enter().append(\"text\").attr(\"transform\", function (d) {\n              return point(d.geometry.coordinates);\n            }).text(function (d) {\n              return starPropername(d.id);\n            }).attr({\n              dy: \"-.5em\",\n              dx: \"-.35em\",\n              class: \"starNames\"\n            });\n            styles.starNames = svgTextStyle(cfg.stars.propernameStyle);\n          }\n          callback(null);\n        });\n      });\n    }\n\n    //Deep space objects\n    if (cfg.dsos.show) {\n      q.defer(function (callback) {\n        d3.json(path + cfg.dsos.data, function (error, json) {\n          if (error) callback(error);\n          var cond = getData(json, cfg.transform);\n          groups.dsos.selectAll(\".dsos\").data(cond.features.filter(function (d) {\n            return clip(d.geometry.coordinates) === 1 && (d.properties.mag === 999 && Math.sqrt(parseInt(d.properties.dim)) > cfg.dsos.limit * adapt || d.properties.mag !== 999 && d.properties.mag <= cfg.dsos.limit);\n          })).enter().append(\"path\").attr(\"class\", function (d) {\n            return \"dsos\" + d.properties.type;\n          }).attr(\"transform\", function (d) {\n            return point(d.geometry.coordinates);\n          }).attr(\"d\", function (d) {\n            return dsoSymbol(d.properties);\n          });\n          styles.dsos = svgStyle(cfg.dsos.style);\n          for (key in cfg.dsos.symbols) {\n            if (!has(cfg.dsos.symbols, key)) continue;\n            id = \"dsos\" + key;\n            styles[id] = {\n              \"fill-opacity\": cfg.dsos.style.opacity,\n              \"stroke-opacity\": cfg.dsos.style.opacity\n            };\n            if (has(cfg.dsos.symbols[key], \"stroke\")) {\n              styles[id].fill = \"none\";\n              styles[id].stroke = cfg.dsos.colors ? cfg.dsos.symbols[key].stroke : cfg.dsos.style.stroke;\n              styles[id][\"stroke-width\"] = cfg.dsos.colors ? cfg.dsos.symbols[key].width : cfg.dsos.style.width;\n            } else {\n              styles[id].stroke = \"none\";\n              styles[id].fill = cfg.dsos.colors ? cfg.dsos.symbols[key].fill : cfg.dsos.style.fill;\n            }\n          }\n          if (cfg.dsos.names) {\n            groups.dsoNames.selectAll(\".dsonames\").data(cond.features.filter(function (d) {\n              return clip(d.geometry.coordinates) === 1 && (d.properties.mag == 999 && Math.sqrt(parseInt(d.properties.dim)) > cfg.dsos.nameLimit || d.properties.mag != 999 && d.properties.mag <= cfg.dsos.nameLimit);\n            })).enter().append(\"text\").attr(\"class\", function (d) {\n              return \"dsoNames \" + d.properties.type;\n            }).attr(\"transform\", function (d) {\n              return point(d.geometry.coordinates);\n            }).text(function (d) {\n              return dsoName(d);\n            }).attr({\n              dy: \"-.5em\",\n              dx: \".35em\"\n            });\n            styles.dsoNames = {\n              \"fill-opacity\": cfg.dsos.style.opacity,\n              \"font\": cfg.dsos.nameStyle.font,\n              \"text-anchor\": svgAlign(cfg.dsos.nameStyle.align)\n            };\n            for (key in cfg.dsos.symbols) {\n              if (!has(cfg.dsos.symbols, key)) continue;\n              styles[key] = {\n                \"fill\": cfg.dsos.colors ? cfg.dsos.symbols[key].fill : cfg.dsos.style.fill\n              };\n            }\n          }\n          callback(null);\n        });\n      });\n    }\n\n    //Planets\n    if ((cfg.location || cfg.formFields.location) && cfg.planets.show && Celestial.origin) {\n      q.defer(function (callback) {\n        var dt = Celestial.date(),\n          o = Celestial.origin(dt).spherical(),\n          jp = {\n            type: \"FeatureCollection\",\n            features: []\n          },\n          jlun = {\n            type: \"FeatureCollection\",\n            features: []\n          };\n        Celestial.container.selectAll(\".planet\").each(function (d) {\n          var id = d.id(),\n            r = 12,\n            p = d(dt).equatorial(o);\n          p.ephemeris.pos = transformDeg(p.ephemeris.pos, euler[cfg.transform]); //transform; \n          if (clip(p.ephemeris.pos) === 1) {\n            if (id === \"lun\") jlun.features.push(createEntry(p));else jp.features.push(createEntry(p));\n          }\n        });\n        if (cfg.planets.symbolType === \"disk\") {\n          groups.planets.selectAll(\".planets\").data(jp.features).enter().append(\"path\").attr(\"transform\", function (d) {\n            return point(d.geometry.coordinates);\n          }).attr(\"d\", function (d) {\n            var r = has(cfg.planets.symbols[d.id], \"size\") ? (cfg.planets.symbols[d.id].size - 1) * adapt : null;\n            return planetSymbol(d.properties, r);\n          }).attr(\"class\", function (d) {\n            return \"planets \" + d.id;\n          });\n        } else {\n          groups.planets.selectAll(\".planets\").data(jp.features).enter().append(\"text\").attr(\"transform\", function (d) {\n            return point(d.geometry.coordinates);\n          }).text(function (d) {\n            return d.properties.symbol;\n          }).attr(\"class\", function (d) {\n            return \"planets \" + d.id;\n          }).attr({\n            dy: \".35em\"\n          });\n        }\n        // Special case for Moon crescent\n        if (jlun.features.length > 0) {\n          if (cfg.planets.symbolType === \"letter\") {\n            groups.planets.selectAll(\".moon\").data(jlun.features).enter().append(\"text\").attr(\"transform\", function (d) {\n              return point(d.geometry.coordinates);\n            }).text(function (d) {\n              return d.properties.symbol;\n            }).attr(\"class\", function (d) {\n              return \"planets \" + d.id;\n            }).attr({\n              dy: \".35em\"\n            });\n          } else {\n            var rl = has(cfg.planets.symbols.lun, \"size\") ? (cfg.planets.symbols.lun.size - 1) * adapt : 11 * adapt;\n            groups.planets.selectAll(\".dmoon\").data(jlun.features).enter().append(\"path\").attr(\"class\", \"darkluna\").attr(\"transform\", function (d) {\n              return point(d.geometry.coordinates);\n            }).attr(\"d\", function (d) {\n              return d3.svg.symbol().type(\"circle\").size(rl * rl)();\n            });\n            groups.planets.selectAll(\".moon\").data(jlun.features).enter().append(\"path\").attr(\"class\", function (d) {\n              return \"planets \" + d.id;\n            }).attr(\"transform\", function (d) {\n              return point(d.geometry.coordinates);\n            }).attr(\"d\", function (d) {\n              return moonSymbol(d.properties, rl);\n            });\n          }\n        }\n        styles.planets = svgTextStyle(cfg.planets.symbolStyle);\n        styles.planets.font = planetFont(cfg.planets.symbolStyle.font);\n        styles.darkluna = {\n          \"fill\": \"#557\"\n        };\n        for (key in cfg.planets.symbols) {\n          if (!has(cfg.planets.symbols, key)) continue;\n          styles[key] = {\n            \"fill\": cfg.planets.symbols[key].fill\n          };\n        }\n\n        //Planet names\n        if (cfg.planets.names) {\n          groups.planetNames.selectAll(\".planetnames\").data(jp.features).enter().append(\"text\").attr(\"transform\", function (d) {\n            return point(d.geometry.coordinates);\n          }).text(function (d) {\n            return d.properties.name;\n          }).attr({\n            dy: \".85em\",\n            dx: \"-.35em\"\n          }).attr(\"class\", function (d) {\n            return \"planetNames \" + d.id;\n          });\n          if (jlun.features.length > 0) {\n            groups.planetNames.selectAll(\".moonname\").data(jlun.features).enter().append(\"text\").attr(\"transform\", function (d) {\n              return point(d.geometry.coordinates);\n            }).text(function (d) {\n              return d.properties.name;\n            }).attr({\n              dy: \".85em\",\n              dx: \"-.35em\"\n            }).attr(\"class\", function (d) {\n              return \"planetNames \" + d.id;\n            });\n          }\n        }\n        styles.planetNames = svgTextStyle(cfg.planets.nameStyle);\n        callback(null);\n      });\n    }\n    if ((cfg.location || cfg.formFields.location) && cfg.daylight.show && proj.clip) {\n      q.defer(function (callback) {\n        var sol = getPlanet(\"sol\");\n        if (sol) {\n          var up = Celestial.zenith(),\n            solpos = sol.ephemeris.pos,\n            dist = d3.geo.distance(up, solpos),\n            pt = projection(solpos),\n            daylight = d3.geo.circle().angle([179.95]).origin(solpos);\n          groups.daylight.append(\"path\").datum(daylight).attr(\"class\", \"daylight\").attr(\"d\", map);\n          styles.daylight = svgSkyStyle(dist, pt);\n          if (clip(solpos) === 1 && dist < halfπ) {\n            groups.daylight.append(\"circle\").attr(\"cx\", pt[0]).attr(\"cy\", pt[1]).attr(\"r\", 5).style(\"fill\", \"#fff\");\n          }\n        }\n        callback(null);\n      });\n    }\n    if ((cfg.location || cfg.formFields.location) && cfg.horizon.show && !proj.clip) {\n      q.defer(function (callback) {\n        var horizon = d3.geo.circle().angle([90]).origin(Celestial.nadir());\n        groups.horizon.append(\"path\").datum(horizon).attr(\"class\", \"horizon\").attr(\"d\", map);\n        styles.horizon = svgStyle(cfg.horizon);\n        callback(null);\n      });\n    }\n    if (Celestial.data.length > 0) {\n      Celestial.data.forEach(function (d) {\n        if (has(d, \"save\")) {\n          q.defer(function (callback) {\n            d.save();\n            callback(null);\n          });\n        }\n      });\n    }\n\n    // Helper functions\n\n    function clip(coords) {\n      return proj.clip && d3.geo.distance(center, coords) > halfπ ? 0 : 1;\n    }\n    function point(coords) {\n      return \"translate(\" + projection(coords) + \")\";\n    }\n    function filename(what, sub, ext) {\n      var cult = has(formats[what], culture) ? \".\" + culture : \"\";\n      ext = ext ? \".\" + ext : \".json\";\n      sub = sub ? \".\" + sub : \"\";\n      return what + sub + cult + ext;\n    }\n    function svgStyle(s) {\n      var res = {};\n      res.fill = s.fill || \"none\";\n      res[\"fill-opacity\"] = s.opacity !== null ? s.opacity : 1;\n      res.stroke = s.stroke || \"none\";\n      res[\"stroke-width\"] = s.width !== null ? s.width : 0;\n      res[\"stroke-opacity\"] = s.opacity !== null ? s.opacity : 1;\n      if (has(s, \"dash\")) res[\"stroke-dasharray\"] = s.dash.join(\" \");else res[\"stroke-dasharray\"] = \"none\";\n      res.font = s.font || null;\n      return res;\n    }\n    function svgTextStyle(s) {\n      var res = {};\n      res.stroke = \"none\";\n      res.fill = s.fill || \"none\";\n      res[\"fill-opacity\"] = s.opacity !== null ? s.opacity : 1;\n      //res.textBaseline = s.baseline || \"bottom\";\n      res[\"text-anchor\"] = svgAlign(s.align);\n      res.font = s.font || null;\n      return res;\n    }\n    function svgStyleA(rank, s) {\n      var res = {};\n      rank = rank || 1;\n      res.fill = isArray(s.fill) ? s.fill[rank - 1] : null;\n      res[\"fill-opacity\"] = isArray(s.opacity) ? s.opacity[rank - 1] : 1;\n      res.stroke = isArray(s.stroke) ? s.stroke[rank - 1] : null;\n      res[\"stroke-width\"] = isArray(s.width) ? s.width[rank - 1] : null;\n      res[\"stroke-opacity\"] = isArray(s.opacity) ? s.opacity[rank - 1] : 1;\n      res[\"text-anchor\"] = svgAlign(s.align);\n      res.font = isArray(s.font) ? s.font[rank - 1] : null;\n      //res.textBaseline = s.baseline || \"bottom\";\n      return res;\n    }\n    function svgSkyStyle(dist, pt) {\n      var factor,\n        color1,\n        color2,\n        color3,\n        upper = 1.36,\n        lower = 1.885;\n      if (dist > lower) return {\n        fill: \"transparent\"\n      };\n      if (dist <= upper) {\n        color1 = \"#daf1fa\";\n        color2 = \"#93d7f0\";\n        color3 = \"#57c0e8\";\n        factor = -(upper - dist) / 10;\n      } else {\n        factor = (dist - upper) / (lower - upper);\n        color1 = d3.interpolateLab(\"#daf1fa\", \"#e8c866\")(factor);\n        color2 = d3.interpolateLab(\"#93c7d0\", \"#ff854a\")(factor);\n        color3 = d3.interpolateLab(\"#57b0c8\", \"#6caae2\")(factor);\n      }\n      var gradient = groups.daylight.append(\"radialGradient\").attr(\"cx\", pt[0]).attr(\"cy\", pt[1]).attr(\"fr\", \"0\").attr(\"r\", \"300\").attr(\"id\", \"skygradient\").attr(\"gradientUnits\", \"userSpaceOnUse\");\n      gradient.append(\"stop\").attr(\"offset\", \"0\").attr(\"stop-color\", color1);\n      gradient.append(\"stop\").attr(\"offset\", 0.2 + 0.4 * factor).attr(\"stop-color\", color2);\n      gradient.append(\"stop\").attr(\"offset\", \"1\").attr(\"stop-color\", color3);\n      return {\n        \"fill\": \"url(#skygradient)\",\n        \"fill-opacity\": skyTransparency(factor, 1.4)\n      };\n    }\n    function skyTransparency(t, a) {\n      return 0.9 * (1 - (Math.pow(Math.E, t * a) - 1) / (Math.pow(Math.E, a) - 1));\n    }\n    function svgAlign(s) {\n      if (!s) return \"start\";\n      if (s === \"center\") return \"middle\";\n      if (s === \"right\") return \"end\";\n      return \"start\";\n    }\n    function dsoSymbol(p) {\n      var size = dsoSize(p.mag, p.dim) || 9,\n        type = dsoShape(p.type);\n      if (d3.svg.symbolTypes.indexOf(type) !== -1) {\n        return d3.svg.symbol().type(type).size(size)();\n      } else {\n        return d3.svg.customSymbol().type(type).size(size)();\n      }\n    }\n    function dsoShape(type) {\n      if (!type || !has(cfg.dsos.symbols, type)) return \"circle\";else return cfg.dsos.symbols[type].shape;\n    }\n    function dsoSize(mag, dim) {\n      if (!mag || mag === 999) return Math.pow(parseInt(dim) * cfg.dsos.size * adapt / 7, 0.5);\n      return Math.pow(2 * cfg.dsos.size * adapt - mag, cfg.dsos.exponent);\n    }\n    function dsoName(d) {\n      //return p[cfg.dsos.namesType]; \n      var lang = cfg.dsos.namesType,\n        id = d.id;\n      if (lang === \"desig\" || !has(dsonames, id)) return d.properties.desig;\n      return has(dsonames[id], lang) ? dsonames[id][lang] : d.properties.desig;\n    }\n    function dsoColor(p) {\n      if (cfg.dsos.colors === true) return svgStyle(cfg.dsos.symbols[p.type]);\n      return svgStyle(cfg.dsos.style);\n    }\n    function starDesignation(id) {\n      if (!has(starnames, id)) return \"\";\n      return starnames[id][cfg.stars.designationType];\n    }\n    function starPropername(id) {\n      var lang = cfg.stars.propernameType;\n      if (!has(starnames, id)) return \"\";\n      return has(starnames[id], lang) ? starnames[id][lang] : starnames[id].name;\n    }\n    function starSize(mag) {\n      if (mag === null) return 0.1;\n      var d = cfg.stars.size * adapt * Math.exp(cfg.stars.exponent * (mag + 2));\n      return Math.max(d, 0.1);\n    }\n    function starColor(bv) {\n      if (!cfg.stars.colors || isNaN(bv)) return \"\";\n      return Math.round(bv * 10).toString();\n    }\n    function constName(d) {\n      return d.properties[cfg.constellations.namesType];\n    }\n    function moonSymbol(p, r) {\n      var size = r ? r * r : 121;\n      return d3.svg.customSymbol().type(\"crescent\").size(size).ratio(p.age)();\n    }\n    function planetSymbol(p, r) {\n      var size = r ? r * r : planetSize(p.mag);\n      return d3.svg.symbol().type(\"circle\").size(size)();\n    }\n    function planetFont(s) {\n      var size = s.replace(/(^\\D*)(\\d+)(\\D.+$)/i, '$2');\n      size = Math.round(adapt * size);\n      return s.replace(/(^\\D*)(\\d+)(\\D.+$)/i, '$1' + size + '$3');\n    }\n    function planetSize(m) {\n      var mag = m || 2;\n      var r = 4 * adapt * Math.exp(-0.05 * (mag + 2));\n      return Math.max(r, 2);\n    }\n    function createEntry(o) {\n      var res = {\n        type: \"Feature\",\n        \"id\": o.id,\n        properties: {},\n        geometry: {}\n      };\n      res.properties.name = o[cfg.planets.namesType];\n      if (cfg.planets.symbolType === \"symbol\" || cfg.planets.symbolType === \"letter\") res.properties.symbol = cfg.planets.symbols[res.id][cfg.planets.symbolType];\n      res.properties.mag = o.ephemeris.mag || 10;\n      if (res.id === \"lun\") {\n        res.properties.age = o.ephemeris.age;\n        res.properties.phase = o.ephemeris.phase;\n      }\n      res.geometry.type = \"Point\";\n      res.geometry.coordinates = o.ephemeris.pos;\n      return res;\n    }\n    function createStyles() {\n      var res = \"\";\n      for (var key in styles) {\n        if (!has(styles, key)) continue;\n        res += \" .\" + key + stringifyStyle(styles[key]);\n      }\n      return \"/*\\u003c![CDATA[*/\\n\" + res + \"\\n/*]]\\u003e*/\";\n    }\n    function stringifyStyle(s) {\n      var res = \" {\";\n      for (var key in s) {\n        if (!has(s, key)) continue;\n        res += key + \":\" + s[key] + \"; \";\n      }\n      return res + \"} \";\n    }\n    q.await(function (error) {\n      if (error) throw error;\n      var svg = d3.select(\"#d3-celestial-svg svg\").attr(\"title\", \"D3-Celestial\").attr(\"version\", 1.1).attr(\"encoding\", \"UTF-8\").attr(\"xmlns\", \"http://www.w3.org/2000/svg\").attr(\"xmlns:xlink\", \"http://www.w3.org/1999/xlink\").attr(\"xmlns:sodipodi\", \"http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd\").attr(\"xmlns:inkscape\", \"http://www.inkscape.org/namespaces/inkscape\").attr(\"viewBox\", \" 0 0 \" + m.width + \" \" + m.height);\n      defs.append(\"style\").attr(\"type\", \"text\\/css\").text(createStyles());\n      /*defs.append(\":sodipodi:namedview\")\r\n       .attr(\":inkscape:window-width\", m.width+200)\r\n       .attr(\":inkscape:window-height\", m.height)\r\n       .attr(\":inkscape:window-maximized\", \"1\");*/\n      if (fname) {\n        var blob = new Blob([svg.node().outerHTML], {\n          type: \"image/svg+xml;charset=utf-8\"\n        });\n        var a = d3.select(\"body\").append(\"a\").node();\n        a.download = fname || \"d3-celestial.svg\";\n        a.rel = \"noopener\";\n        a.href = URL.createObjectURL(blob);\n        a.click();\n        d3.select(a).remove();\n      } else if (exportCallback !== null) {\n        exportCallback(svg.node().outerHTML);\n      }\n      d3.select(\"#d3-celestial-svg\").remove();\n    });\n  }\n  var customSvgSymbols = d3.map({\n    'ellipse': function (size, ratio) {\n      var s = Math.sqrt(size),\n        rx = s * 0.666,\n        ry = s / 3;\n      return 'M' + -rx + ',' + -ry + ' m' + -rx + ',0' + ' a' + rx + ',' + ry + ' 0 1,0' + rx * 2 + ',0' + ' a' + rx + ',' + ry + ' 0 1,0' + -(rx * 2) + ',0';\n    },\n    'marker': function (size, ratio) {\n      var s = size > 48 ? size / 4 : 12,\n        r = s / 2,\n        l = r - 3;\n      return 'M ' + -r + ' 0 h ' + l + ' M 0 ' + -r + ' v ' + l + ' M ' + r + ' 0 h ' + -l + ' M 0 ' + r + ' v ' + -l;\n    },\n    'cross-circle': function (size, ratio) {\n      var s = Math.sqrt(size),\n        r = s / 2;\n      return 'M' + -r + ',' + -r + ' m' + -r + ',0' + ' a' + r + ',' + r + ' 0 1,0' + r * 2 + ',0' + ' a' + r + ',' + r + ' 0 1,0' + -(r * 2) + ',0' + ' M' + -r + ' 0 h ' + s + ' M 0 ' + -r + ' v ' + s;\n    },\n    'stroke-circle': function (size, ratio) {\n      var s = Math.sqrt(size),\n        r = s / 2;\n      return 'M' + -r + ',' + -r + ' m' + -r + ',0' + ' a' + r + ',' + r + ' 0 1,0' + r * 2 + ',0' + ' a' + r + ',' + r + ' 0 1,0' + -(r * 2) + ',0' + ' M' + (-s - 2) + ',' + (-s - 2) + ' l' + (s + 4) + ',' + (s + 4);\n    },\n    \"crescent\": function (size, ratio) {\n      var s = Math.sqrt(size),\n        r = s / 2,\n        ph = 0.5 * (1 - Math.cos(ratio)),\n        e = 1.6 * Math.abs(ph - 0.5) + 0.01,\n        dir = ratio > Math.PI ? 0 : 1,\n        termdir = Math.abs(ph) > 0.5 ? dir : Math.abs(dir - 1);\n      return 'M ' + -1 + ',' + -1 + ' m 1,' + (-r + 1) + ' a' + r + ',' + r + ' 0 1 ' + dir + ' 0,' + r * 2 + ' a' + r * e + ',' + r + ' 0 1 ' + termdir + ' 0,' + -(r * 2) + 'z';\n    }\n  });\n  d3.svg.customSymbol = function () {\n    var type,\n      size = 64,\n      ratio = d3.functor(1);\n    function symbol(d, i) {\n      return customSvgSymbols.get(type.call(this, d, i))(size.call(this, d, i), ratio.call(this, d, i));\n    }\n    symbol.type = function (_) {\n      if (!arguments.length) return type;\n      type = d3.functor(_);\n      return symbol;\n    };\n    symbol.size = function (_) {\n      if (!arguments.length) return size;\n      size = d3.functor(_);\n      return symbol;\n    };\n    symbol.ratio = function (_) {\n      if (!arguments.length) return ratio;\n      ratio = d3.functor(_);\n      return symbol;\n    };\n    return symbol;\n  };\n  var exportCallback = null;\n  Celestial.exportSVG = function (callback) {\n    if (!callback) return;\n    exportCallback = callback;\n    exportSVG();\n  };\n  var datetimepicker = function (cfg, callback) {\n    var date = new Date(),\n      tzFormat = d3.time.format(\"%Z\"),\n      tz = [{\n        \"−12:00\": -720\n      }, {\n        \"−11:00\": -660\n      }, {\n        \"−10:00\": -600\n      }, {\n        \"−09:30\": -570\n      }, {\n        \"−09:00\": -540\n      }, {\n        \"−08:00\": -480\n      }, {\n        \"−07:00\": -420\n      }, {\n        \"−06:00\": -360\n      }, {\n        \"−05:00\": -300\n      }, {\n        \"−04:30\": -270\n      }, {\n        \"−04:00\": -240\n      }, {\n        \"−03:30\": -210\n      }, {\n        \"−03:00\": -180\n      }, {\n        \"−02:30\": -150\n      }, {\n        \"−02:00\": -120\n      }, {\n        \"−01:00\": -60\n      }, {\n        \"±00:00\": 0\n      }, {\n        \"+01:00\": 60\n      }, {\n        \"+02:00\": 120\n      }, {\n        \"+03:00\": 180\n      }, {\n        \"+03:30\": 210\n      }, {\n        \"+04:00\": 240\n      }, {\n        \"+04:30\": 270\n      }, {\n        \"+05:00\": 300\n      }, {\n        \"+05:30\": 330\n      }, {\n        \"+05:45\": 345\n      }, {\n        \"+06:00\": 360\n      }, {\n        \"+06:30\": 390\n      }, {\n        \"+07:00\": 420\n      }, {\n        \"+08:00\": 480\n      }, {\n        \"+08:30\": 510\n      }, {\n        \"+08:45\": 525\n      }, {\n        \"+09:00\": 540\n      }, {\n        \"+09:30\": 570\n      }, {\n        \"+10:00\": 600\n      }, {\n        \"+10:30\": 630\n      }, {\n        \"+11:00\": 660\n      }, {\n        \"+12:00\": 720\n      }, {\n        \"+12:45\": 765\n      }, {\n        \"+13:00\": 780\n      }, {\n        \"+14:00\": 840\n      }],\n      months = [\"January\", \"February\", \"March\", \"April\", \"May\", \"June\", \"July\", \"August\", \"September\", \"October\", \"November\", \"December\"],\n      days = [\"Su\", \"M\", \"Tu\", \"W\", \"Th\", \"F\", \"Sa\"],\n      years = getYears(date),\n      dateFormat = d3.time.format(\"%Y-%m-%d\"),\n      dtrange = cfg.daterange || [];\n    var picker = d3.select(parentElement + \" ~ #celestial-form\").append(\"div\").attr(\"id\", \"celestial-date\");\n    nav(\"left\");\n    monSel();\n    yrSel();\n    nav(\"right\");\n    var cal = picker.append(\"div\").attr(\"id\", \"cal\");\n    daySel();\n    timeSel();\n    tzSel();\n    function daySel() {\n      var mo = $form(\"mon\").value,\n        yr = $form(\"yr\").value,\n        curdt = new Date(yr, mo, 1),\n        cal = d3.select(parentElement + \" ~ #celestial-form\").select(\"#cal\"),\n        today = new Date();\n      yr = parseInt(yr);\n      mo = parseInt(mo);\n      curdt.setDate(curdt.getDate() - curdt.getDay());\n      var nd = cal.node();\n      while (nd.firstChild) nd.removeChild(nd.firstChild);\n      for (var i = 0; i < 7; i++) {\n        cal.append(\"div\").classed({\n          \"date\": true,\n          \"weekday\": true\n        }).html(days[i]);\n      }\n      for (i = 0; i < 42; i++) {\n        var curmon = curdt.getMonth(),\n          curday = curdt.getDay(),\n          curid = dateFormat(curdt);\n        cal.append(\"div\").classed({\n          \"date\": true,\n          \"grey\": curmon !== mo,\n          \"weekend\": curmon === mo && (curday === 0 || curday === 6),\n          \"today\": dateDiff(curdt, today) === 0,\n          \"selected\": dateDiff(curdt, date) === 0\n        }).attr(\"id\", curid).on(\"click\", pick).html(curdt.getDate().toString());\n        curdt.setDate(curdt.getDate() + 1);\n      }\n    }\n    function yrSel() {\n      picker.append(\"select\").attr(\"title\", \"Year\").attr(\"id\", \"yr\").on(\"change\", daySel);\n      fillYrSel();\n    }\n    function fillYrSel() {\n      var sel = d3.select(parentElement + \" ~ #celestial-form\").select(\"select#yr\"),\n        year = date.getFullYear(),\n        selected = 0,\n        years = getYears(date);\n      sel.selectAll(\"*\").remove();\n      sel.selectAll('option').data(years).enter().append('option').text(function (d, i) {\n        if (d === year) selected = i;\n        return d.toString();\n      });\n      sel.property(\"selectedIndex\", selected);\n    }\n    function monSel() {\n      var sel = picker.append(\"select\").attr(\"title\", \"Month\").attr(\"id\", \"mon\").on(\"change\", daySel),\n        selected = 0,\n        month = date.getMonth();\n      sel.selectAll('option').data(months).enter().append('option').attr(\"value\", function (d, i) {\n        if (i === month) selected = i;\n        return i;\n      }).text(function (d) {\n        return d;\n      });\n      sel.property(\"selectedIndex\", selected);\n    }\n    function nav(dir) {\n      var lnk = picker.append(\"div\").attr(\"id\", dir).on(\"click\", function () {\n        var mon = $form(\"mon\"),\n          yr = $form(\"yr\");\n        if (dir === \"left\") {\n          if (mon.selectedIndex === 0) {\n            mon.selectedIndex = 11;\n            yr.selectedIndex--;\n          } else mon.selectedIndex--;\n        } else {\n          if (mon.selectedIndex === 11) {\n            mon.selectedIndex = 0;\n            yr.selectedIndex++;\n          } else mon.selectedIndex++;\n        }\n        daySel();\n      });\n    }\n    function timeSel() {\n      picker.append(\"input\").attr(\"type\", \"number\").attr(\"id\", \"hr\").attr(\"title\", \"Hours\").attr(\"max\", \"24\").attr(\"min\", \"-1\").attr(\"step\", \"1\").attr(\"value\", date.getHours()).on(\"change\", function () {\n        if (testNumber(this) === true) pick();\n      });\n      picker.append(\"input\").attr(\"type\", \"number\").attr(\"id\", \"min\").attr(\"title\", \"Minutes\").attr(\"max\", \"60\").attr(\"min\", \"-1\").attr(\"step\", \"1\").attr(\"value\", date.getMinutes()).on(\"change\", function () {\n        if (testNumber(this) === true) pick();\n      });\n      picker.append(\"input\").attr(\"type\", \"number\").attr(\"id\", \"sec\").attr(\"title\", \"Seconds\").attr(\"max\", \"60\").attr(\"min\", \"-1\").attr(\"step\", \"1\").attr(\"value\", date.getSeconds()).on(\"change\", function () {\n        if (testNumber(this) === true) pick();\n      });\n    }\n    function tzSel() {\n      var sel = picker.append(\"select\").attr(\"title\", \"Time zone offset from UTC\").attr(\"id\", \"tz\").on(\"change\", pick),\n        selected = 15,\n        tzOffset = -date.getTimezoneOffset();\n      sel.selectAll('option').data(tz).enter().append('option').attr(\"value\", function (d, i) {\n        var k = Object.keys(d)[0];\n        if (d[k] === tzOffset) selected = i;\n        return d[k];\n      }).text(function (d) {\n        return Object.keys(d)[0];\n      });\n      sel.property(\"selectedIndex\", selected);\n    }\n    function getYears(dt) {\n      var r = getDateRange(dt.getFullYear()),\n        res = [];\n      for (var i = r[0]; i <= r[1]; i++) res.push(i);\n      return res;\n    }\n    function getDateRange(yr) {\n      if (!dtrange || dtrange.length < 1) return [yr - 10, yr + 10];\n      if (dtrange.length === 1 && isNumber(dtrange[0])) {\n        if (dtrange[0] >= 100) return [dtrange[0] - 10, dtrange[0] + 10];else return [yr - dtrange[0], yr + dtrange[0]];\n      }\n      if (dtrange.length === 2 && isNumber(dtrange[0]) && isNumber(dtrange[1])) {\n        if (dtrange[1] >= 100) return [dtrange[0], dtrange[1]];else return [dtrange[0] - dtrange[1], dtrange[0] + dtrange[1]];\n      }\n      return [yr - 10, yr + 10];\n    }\n    function select(id, val) {\n      var sel = $form(id);\n      for (var i = 0; i < sel.childNodes.length; i++) {\n        if (sel.childNodes[i].value == val) {\n          sel.selectedIndex = i;\n          break;\n        }\n      }\n    }\n    function set(dt) {\n      if (dt) date.setTime(dt.valueOf());\n      select(\"yr\", date.getFullYear());\n      select(\"mon\", date.getMonth());\n      daySel();\n      $form(\"hr\").value = date.getHours();\n      $form(\"min\").value = date.getMinutes();\n      $form(\"sec\").value = date.getSeconds();\n    }\n    this.show = function (dt, tz) {\n      var nd = $form(\"celestial-date\"),\n        src = $form(\"datepick\"),\n        left = src.offsetLeft + src.offsetWidth - nd.offsetWidth,\n        top = src.offsetTop - nd.offsetHeight - 1;\n      if (nd.offsetTop === -9999) {\n        date.setTime(dt.valueOf());\n        select(\"tz\", tz);\n        set();\n        d3.select(parentElement + \" ~ #celestial-form\").select(\"#celestial-date\").style({\n          \"top\": px(top),\n          \"left\": px(left),\n          \"opacity\": 1\n        });\n        d3.select(parentElement + \" ~ #celestial-form\").select(\"#datepick\").classed(\"active\", true);\n      } else {\n        vanish();\n      }\n    };\n    this.isVisible = function () {\n      if (!document.getElementById(\"datepick\")) return false;\n      return d3.select(parentElement + \" ~ #celestial-form\").select(\"#datepick\").classed(\"active\") === true;\n    };\n    this.hide = function () {\n      vanish();\n    };\n    function vanish() {\n      d3.select(parentElement + \" ~ #celestial-form\").select(\"#celestial-date\").style(\"opacity\", 0);\n      d3.select(\"#error\").style({\n        top: \"-9999px\",\n        left: \"-9999px\",\n        opacity: 0\n      });\n      d3.select(parentElement + \" ~ #celestial-form\").select(\"#datepick\").classed(\"active\", false);\n      setTimeout(function () {\n        $form(\"celestial-date\").style.top = px(-9999);\n      }, 600);\n    }\n    function pick() {\n      var h = $form(\"hr\").value,\n        m = $form(\"min\").value,\n        s = $form(\"sec\").value,\n        tz = $form(\"tz\").value;\n      if (this.id && this.id.search(/^\\d/) !== -1) {\n        date = dateFormat.parse(this.id);\n      }\n      fillYrSel();\n      date.setHours(h, m, s);\n      set();\n      callback(date, tz);\n    }\n  }; // Copyright 2014, Jason Davies, http://www.jasondavies.com\n  // See LICENSE.txt for details.\n  (function () {\n    var radians = Math.PI / 180,\n      degrees = 180 / Math.PI;\n\n    // TODO make incremental rotate optional\n\n    d3.geo.zoom = function () {\n      var projection, duration;\n      var zoomPoint,\n        zooming = 0,\n        event = d3_eventDispatch(zoom, \"zoomstart\", \"zoom\", \"zoomend\"),\n        zoom = d3.behavior.zoom().on(\"zoomstart\", function () {\n          var mouse0 = d3.mouse(this),\n            rotate = quaternionFromEuler(projection.rotate()),\n            point = position(projection, mouse0);\n          if (point) zoomPoint = point;\n          zoomOn.call(zoom, \"zoom\", function () {\n            projection.scale(view.k = d3.event.scale);\n            var mouse1 = d3.mouse(this),\n              between = rotateBetween(zoomPoint, position(projection, mouse1));\n            projection.rotate(view.r = eulerFromQuaternion(rotate = between ? multiply(rotate, between) : multiply(bank(projection, mouse0, mouse1), rotate)));\n            mouse0 = mouse1;\n            zoomed(event.of(this, arguments));\n          });\n          zoomstarted(event.of(this, arguments));\n        }).on(\"zoomend\", function () {\n          zoomOn.call(zoom, \"zoom\", null);\n          zoomended(event.of(this, arguments));\n        }),\n        zoomOn = zoom.on,\n        view = {\n          r: [0, 0, 0],\n          k: 1\n        };\n      zoom.rotateTo = function (location) {\n        var between = rotateBetween(cartesian(location), cartesian([-view.r[0], -view.r[1]]));\n        return eulerFromQuaternion(multiply(quaternionFromEuler(view.r), between));\n      };\n      zoom.projection = function (_) {\n        if (!arguments.length) return projection;\n        projection = _;\n        view = {\n          r: projection.rotate(),\n          k: projection.scale()\n        };\n        return zoom.scale(view.k);\n      };\n      zoom.duration = function (_) {\n        return arguments.length ? (duration = _, zoom) : duration;\n      };\n      zoom.event = function (g) {\n        g.each(function () {\n          var g = d3.select(this),\n            dispatch = event.of(this, arguments),\n            view1 = view,\n            transition = d3.transition(g);\n          if (transition !== g) {\n            transition.each(\"start.zoom\", function () {\n              if (this.__chart__) {\n                // pre-transition state\n                view = this.__chart__;\n                if (!view.hasOwnProperty(\"r\")) view.r = projection.rotate();\n              }\n              projection.rotate(view.r).scale(view.k);\n              zoomstarted(dispatch);\n            }).tween(\"zoom:zoom\", function () {\n              var width = zoom.size()[0],\n                i = interpolateBetween(quaternionFromEuler(view.r), quaternionFromEuler(view1.r)),\n                d = d3.geo.distance(view.r, view1.r),\n                smooth = d3.interpolateZoom([0, 0, width / view.k], [d, 0, width / view1.k]);\n              if (duration) transition.duration(duration(smooth.duration * .001)); // see https://github.com/mbostock/d3/pull/2045\n              return function (t) {\n                var uw = smooth(t);\n                this.__chart__ = view = {\n                  r: eulerFromQuaternion(i(uw[0] / d)),\n                  k: width / uw[2]\n                };\n                projection.rotate(view.r).scale(view.k);\n                zoom.scale(view.k);\n                zoomed(dispatch);\n              };\n            }).each(\"end.zoom\", function () {\n              zoomended(dispatch);\n            });\n            try {\n              // see https://github.com/mbostock/d3/pull/1983\n              transition.each(\"interrupt.zoom\", function () {\n                zoomended(dispatch);\n              });\n            } catch (e) {\n              console.log(e);\n            }\n          } else {\n            this.__chart__ = view;\n            zoomstarted(dispatch);\n            zoomed(dispatch);\n            zoomended(dispatch);\n          }\n        });\n      };\n      function zoomstarted(dispatch) {\n        if (!zooming++) dispatch({\n          type: \"zoomstart\"\n        });\n      }\n      function zoomed(dispatch) {\n        dispatch({\n          type: \"zoom\"\n        });\n      }\n      function zoomended(dispatch) {\n        if (! --zooming) dispatch({\n          type: \"zoomend\"\n        });\n      }\n      return d3.rebind(zoom, event, \"on\");\n    };\n    function bank(projection, p0, p1) {\n      var t = projection.translate(),\n        angle = Math.atan2(p0[1] - t[1], p0[0] - t[0]) - Math.atan2(p1[1] - t[1], p1[0] - t[0]);\n      return [Math.cos(angle / 2), 0, 0, Math.sin(angle / 2)];\n    }\n    function position(projection, point) {\n      var spherical = projection.invert(point);\n      return spherical && isFinite(spherical[0]) && isFinite(spherical[1]) && cartesian(spherical);\n    }\n    function quaternionFromEuler(euler) {\n      var λ = .5 * euler[0] * radians,\n        φ = .5 * euler[1] * radians,\n        γ = .5 * euler[2] * radians,\n        sinλ = Math.sin(λ),\n        cosλ = Math.cos(λ),\n        sinφ = Math.sin(φ),\n        cosφ = Math.cos(φ),\n        sinγ = Math.sin(γ),\n        cosγ = Math.cos(γ);\n      return [cosλ * cosφ * cosγ + sinλ * sinφ * sinγ, sinλ * cosφ * cosγ - cosλ * sinφ * sinγ, cosλ * sinφ * cosγ + sinλ * cosφ * sinγ, cosλ * cosφ * sinγ - sinλ * sinφ * cosγ];\n    }\n    function multiply(a, b) {\n      var a0 = a[0],\n        a1 = a[1],\n        a2 = a[2],\n        a3 = a[3],\n        b0 = b[0],\n        b1 = b[1],\n        b2 = b[2],\n        b3 = b[3];\n      return [a0 * b0 - a1 * b1 - a2 * b2 - a3 * b3, a0 * b1 + a1 * b0 + a2 * b3 - a3 * b2, a0 * b2 - a1 * b3 + a2 * b0 + a3 * b1, a0 * b3 + a1 * b2 - a2 * b1 + a3 * b0];\n    }\n    function rotateBetween(a, b) {\n      if (!a || !b) return;\n      var axis = cross(a, b),\n        norm = Math.sqrt(dot(axis, axis)),\n        halfγ = .5 * Math.acos(Math.max(-1, Math.min(1, dot(a, b)))),\n        k = Math.sin(halfγ) / norm;\n      return norm && [Math.cos(halfγ), axis[2] * k, -axis[1] * k, axis[0] * k];\n    }\n\n    // Interpolate between two quaternions (slerp).\n    function interpolateBetween(a, b) {\n      var d = Math.max(-1, Math.min(1, dot(a, b))),\n        s = d < 0 ? -1 : 1,\n        θ = Math.acos(s * d),\n        sinθ = Math.sin(θ);\n      return sinθ ? function (t) {\n        var A = s * Math.sin((1 - t) * θ) / sinθ,\n          B = Math.sin(t * θ) / sinθ;\n        return [a[0] * A + b[0] * B, a[1] * A + b[1] * B, a[2] * A + b[2] * B, a[3] * A + b[3] * B];\n      } : function () {\n        return a;\n      };\n    }\n    function eulerFromQuaternion(q) {\n      return [Math.atan2(2 * (q[0] * q[1] + q[2] * q[3]), 1 - 2 * (q[1] * q[1] + q[2] * q[2])) * degrees, Math.asin(Math.max(-1, Math.min(1, 2 * (q[0] * q[2] - q[3] * q[1])))) * degrees, Math.atan2(2 * (q[0] * q[3] + q[1] * q[2]), 1 - 2 * (q[2] * q[2] + q[3] * q[3])) * degrees];\n    }\n    function cartesian(spherical) {\n      var λ = spherical[0] * radians,\n        φ = spherical[1] * radians,\n        cosφ = Math.cos(φ);\n      return [cosφ * Math.cos(λ), cosφ * Math.sin(λ), Math.sin(φ)];\n    }\n    function dot(a, b) {\n      for (var i = 0, n = a.length, s = 0; i < n; ++i) s += a[i] * b[i];\n      return s;\n    }\n    function cross(a, b) {\n      return [a[1] * b[2] - a[2] * b[1], a[2] * b[0] - a[0] * b[2], a[0] * b[1] - a[1] * b[0]];\n    }\n\n    // Like d3.dispatch, but for custom events abstracting native UI events. These\n    // events have a target component (such as a brush), a target element (such as\n    // the svg:g element containing the brush) and the standard arguments `d` (the\n    // target element's data) and `i` (the selection index of the target element).\n    function d3_eventDispatch(target) {\n      var i = 0,\n        n = arguments.length,\n        argumentz = [];\n      while (++i < n) argumentz.push(arguments[i]);\n      var dispatch = d3.dispatch.apply(null, argumentz);\n\n      // Creates a dispatch context for the specified `thiz` (typically, the target\n      // DOM element that received the source event) and `argumentz` (typically, the\n      // data `d` and index `i` of the target element). The returned function can be\n      // used to dispatch an event to any registered listeners; the function takes a\n      // single argument as input, being the event to dispatch. The event must have\n      // a \"type\" attribute which corresponds to a type registered in the\n      // constructor. This context will automatically populate the \"sourceEvent\" and\n      // \"target\" attributes of the event, as well as setting the `d3.event` global\n      // for the duration of the notification.\n      dispatch.of = function (thiz, argumentz) {\n        return function (e1) {\n          try {\n            var e0 = e1.sourceEvent = d3.event;\n            e1.target = target;\n            d3.event = e1;\n            dispatch[e1.type].apply(thiz, argumentz);\n          } finally {\n            d3.event = e0;\n          }\n        };\n      };\n      return dispatch;\n    }\n  })();\n  // https://d3js.org/d3-queue/ Version 3.0.7. Copyright 2017 Mike Bostock.\n  (function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) : typeof define === 'function' && define.amd ? define(['exports'], factory) : factory(global.d3 = global.d3 || {});\n  })(this, function (exports) {\n    'use strict';\n\n    var slice = [].slice;\n    var noabort = {};\n    function Queue(size) {\n      this._size = size;\n      this._call = this._error = null;\n      this._tasks = [];\n      this._data = [];\n      this._waiting = this._active = this._ended = this._start = 0; // inside a synchronous task callback?\n    }\n\n    Queue.prototype = queue.prototype = {\n      constructor: Queue,\n      defer: function (callback) {\n        if (typeof callback !== \"function\") throw new Error(\"invalid callback\");\n        if (this._call) throw new Error(\"defer after await\");\n        if (this._error != null) return this;\n        var t = slice.call(arguments, 1);\n        t.push(callback);\n        ++this._waiting, this._tasks.push(t);\n        poke(this);\n        return this;\n      },\n      abort: function () {\n        if (this._error == null) abort(this, new Error(\"abort\"));\n        return this;\n      },\n      await: function (callback) {\n        if (typeof callback !== \"function\") throw new Error(\"invalid callback\");\n        if (this._call) throw new Error(\"multiple await\");\n        this._call = function (error, results) {\n          callback.apply(null, [error].concat(results));\n        };\n        maybeNotify(this);\n        return this;\n      },\n      awaitAll: function (callback) {\n        if (typeof callback !== \"function\") throw new Error(\"invalid callback\");\n        if (this._call) throw new Error(\"multiple await\");\n        this._call = callback;\n        maybeNotify(this);\n        return this;\n      }\n    };\n    function poke(q) {\n      if (!q._start) {\n        try {\n          start(q);\n        } // let the current task complete\n        catch (e) {\n          if (q._tasks[q._ended + q._active - 1]) abort(q, e); // task errored synchronously\n          else if (!q._data) throw e; // await callback errored synchronously\n        }\n      }\n    }\n\n    function start(q) {\n      while (q._start = q._waiting && q._active < q._size) {\n        var i = q._ended + q._active,\n          t = q._tasks[i],\n          j = t.length - 1,\n          c = t[j];\n        t[j] = end(q, i);\n        --q._waiting, ++q._active;\n        t = c.apply(null, t);\n        if (!q._tasks[i]) continue; // task finished synchronously\n        q._tasks[i] = t || noabort;\n      }\n    }\n    function end(q, i) {\n      return function (e, r) {\n        if (!q._tasks[i]) return; // ignore multiple callbacks\n        --q._active, ++q._ended;\n        q._tasks[i] = null;\n        if (q._error != null) return; // ignore secondary errors\n        if (e != null) {\n          abort(q, e);\n        } else {\n          q._data[i] = r;\n          if (q._waiting) poke(q);else maybeNotify(q);\n        }\n      };\n    }\n    function abort(q, e) {\n      var i = q._tasks.length,\n        t;\n      q._error = e; // ignore active callbacks\n      q._data = undefined; // allow gc\n      q._waiting = NaN; // prevent starting\n\n      while (--i >= 0) {\n        if (t = q._tasks[i]) {\n          q._tasks[i] = null;\n          if (t.abort) {\n            try {\n              t.abort();\n            } catch (e) {/* ignore */}\n          }\n        }\n      }\n      q._active = NaN; // allow notification\n      maybeNotify(q);\n    }\n    function maybeNotify(q) {\n      if (!q._active && q._call) {\n        var d = q._data;\n        q._data = undefined; // allow gc\n        q._call(q._error, d);\n      }\n    }\n    function queue(concurrency) {\n      if (concurrency == null) concurrency = Infinity;else if (!((concurrency = +concurrency) >= 1)) throw new Error(\"invalid concurrency\");\n      return new Queue(concurrency);\n    }\n    exports.queue = queue;\n    d3.queue = queue;\n    Object.defineProperty(exports, '__esModule', {\n      value: true\n    });\n  });\n  this.Celestial = Celestial;\n}();","map":{"version":3,"names":["Celestial","version","container","data","ANIMDISTANCE","ANIMSCALE","ANIMINTERVAL_R","ANIMINTERVAL_P","ANIMINTERVAL_Z","zoomextent","zoomlevel","cfg","mapProjection","parentElement","zoom","map","circle","daylight","starnames","dsonames","display","config","animationID","animations","current","repeat","settings","set","applyDefaults","isNumber","zoomextend","parent","document","getElementById","st","window","getComputedStyle","parseInt","width","style","px","parentNode","clientWidth","margin","getWidth","canvaswidth","background","pixelRatio","devicePixelRatio","projectionSetting","getProjection","projection","projectionRatio","lines","graticule","lat","pos","scale","ratio","height","Math","round","canvasheight","starbase","stars","size","dsobase","dsos","starexp","exponent","dsoexp","adapt","rotation","getAngles","center","path","datapath","rotate","translate","d3","geo","scaleExtent","on","redraw","canvas","select","selectAll","culture","length","append","attr","context","node","getContext","setTransform","minorStep","remove","interactive","call","zoomBy","setClip","clip","resize","controls","$","angle","form","location","follow","zenith","formFields","fldEnable","load","datum","outline","transform","key","has","lon","getGridValues","enter","origin","transformDeg","poles","euler","json","error","alert","console","warn","mw","getData","mw_back","getMwbackground","features","filename","con","constellations","getConstellationList","cb","conl","listConstellations","Object","assign","ds","pl","getPlanets","forEach","d","file","callback","setTimeout","lang","apply","setLanguage","factor","sc0","sc1","ext","interval","sqrt","abs","disableAnimations","zTween","interpolateNumber","transition","duration","tween","t","z","cFrom","rot","sc","keep","cTween","oTween","oof","orientationfixed","Round","distance","o","interpolateAngle","interpolate","c","reproject","prj","ctr","prjFrom","delay","clipTween","rTween","prjTo","bAdapt","adaptable","projectionTween","_","alpha","setCenter","clear","drawOutline","show","each","setStyle","fill","opacity","stroke","setTextStyle","i","geometry","coordinates","pt","gridOrientation","properties","orientation","fillText","value","bounds","boundStyle","constellation","re","RegExp","ids","search","lineWidth","globalAlpha","setLineDash","setStyleA","rank","lineStyle","names","nameStyle","constName","mag","limit","r","starSize","fillStyle","starColor","beginPath","arc","PI","closePath","designation","designationLimit","designationStyle","starDesignation","id","propername","propernameLimit","propernameStyle","starPropername","dsoDisplay","type","colors","symbols","dsoSymbol","nameLimit","dsoName","planets","dt","date","spherical","p","equatorial","ephemeris","sym","symbolType","symbolStyle","letter","Canvas","symbol","age","position","planetSize","font","planetSymbol","name","namesType","sol","getPlanet","up","solpos","dist","setSkyStyle","horizon","nadir","zoomState","hasCallback","runCallback","coords","halfπ","s","strokeStyle","dash","textAlign","align","textBaseline","baseline","isArray","color1","color2","color3","upper","lower","interpolateLab","grad","createRadialGradient","addColorStop","skyTransparency","a","pow","E","czi","czo","defscale","disabled","setit","clipAngle","what","sub","cult","formats","prop","dim","dsoSize","dsoShape","shape","desig","designationType","propernameType","exp","max","bv","isNaN","bvcolor","replace","orient","split","h","v","clearRect","w","getBoundingClientRect","ratioOverride","projections","res","animate","param","stop","clearTimeout","metrics","setConstStyle","f","arrayfy","undefined","reload","color","anims","dorepeat","wipe","go","index","module","exports","d3js","require","d3_geo_projection","d3.geo.projection","raw","forward","Error","arg","λ","φ","invert","x","y","e","log","b","α","pa","pb","arguments","ca","ta","tb","eulerAngles","τ","deg2rad","β","γ","dψ","ψ","θ","ε","sin","cos","atan2","acos","asin","init","constructor","Array","val","add","ang","hasOwnProperty","horizontal","loc","ha","getMST","dec","alt","az","inverse","hor","toFixed","ra","lng","yr","getUTCFullYear","mo","getUTCMonth","dy","getUTCDate","getUTCHours","m","getUTCMinutes","getUTCSeconds","floor","jd","jt","mst","dat","save","push","splice","addCallback","getPoint","trans","leo","which","indexOf","Kepler","parentBody","elements","params","slice","l1","reverse","getTimezones","transLine","transMultiLine","concat","getLine","jsonGridValues","min","step","coord","tp","lr","toString","line","globalConfig","geopos","download","advanced","daterange","settimezone","timezoneid","gg","g","s0","sd","oc","gc","en","bn","sfr","rn","pn","snr","dn","ecliptic","galactic","supergalactic","entries","namelimit","namestyle","proper","propernamelimit","propernamestyle","linestyle","boundstyle","quantize","domain","range","n","formats_all","keys","iau","filter","self","cn","functor","text","padding","canvas_symbol","draw_symbol","ctx","square","moveTo","lineTo","diamond","triangle","ellipse","restore","marker","cross-circle","stroke-circle","crescent","ag","ph","dir","termdir","moonFill","darkFill","querySelector","dg","sign","pad","when","parseFloat","isFinite","prototype","isObject","isFunction","isValidDate","Date","fileExists","url","http","XMLHttpRequest","open","send","status","findPos","l","offsetParent","offsetLeft","offsetTop","hasParent","attach","event","func","addEventListener","attachEvent","stopPropagation","cancelBubble","dateDiff","dt1","dt2","diff","valueOf","dateParse","UTC","a1","a2","Trig","sinh","cosh","tanh","asinh","acosh","normalize0","normalize","cartesian","ϕ","atan","p1","p2","epsilon","halfPi","quarterPi","tau","lambda","phi","cosPhi","cartesianCross","cartesianNormalizeInPlace","longitude","point","poligonContains","polygon","sinPhi","normal","winding","sum","ring","point0","lambda0","phi0","sinPhi0","cosPhi0","point1","cosPhi1","sinPhi1","lambda1","j","phi1","delta","absDelta","antimeridian","k","intersection","phiArc","div","ctrl","frm","col","html","sel","selected","list","property","toUpperCase","turn","showConstellation","fld","enable","$form","dsoKeys","nameKeys","langKeys","getFilename","rel","href","toDataURL","click","exportSVG","setLimits","setUnit","setVisibility","showAdvanced","src","testNumber","cx","getCenter","cy","cz","vx","vz","dateFormat","time","format","showCon","checked","testColor","update","get","updateForm","depends","source","off","previousSibling","popError","nd","err","top","offsetHeight","left","focus","adj","validity","typeMismatch","badInput","title","rangeOverflow","rangeUnderflow","old","innerHTML","rx","match","showit","vis","geoInfo","dtFormat","localZone","getTimezoneOffset","timeZone","insert","dtpick","datetimepicker","tz","navigator","here","setDate","getDate","showpick","isVisible","now","txt","target","hide","setTime","geolocation","getCurrentPosition","latitude","tzs","isValidLocation","isValidTimezone","parse","setPosition","dtc","settime","timestamp","getTime","protocol","gmtOffset","message","timezone","skyview","valid","dtLoc","gmdat","sinε","cosε","kelements","gm","elem","kepler","dates","de","JD","ep","jd0","moon_elements","M","derive","trueAnomaly","transpose","par","Name","near_parabolic","anom2","term","rval","anomaly","curr","trial","tmod","thresh","offset","delta_curr","is_negative","n_iter","r0","T","w0","q","W","N","L","P","t0","am","ref","tx","ty","a0","lecl","becl","angles","tl","pe","xeq","yeq","zeq","moon_corr","rt","magnitude","rs","H","LOG10E","u","polar2cart","rclat","frac","IYMIN","jdn","observer","flat","cart","gmst","cosl","sinl","fl","fl2","Moon","corr","t2","t3","t4","t5","t2e4","t3e6","t4e8","sa","sapp","sma","se","sedp","ecc","sg","sgp","gamma","sp","spp","lp","sr","srp","srpp","raan","sl","slp","slpp","slppp","phase","fname","doc","svg","proj","scale0","defs","groupNames","groups","styles","queue","gridLines","svgStyle","jlon","gridvaluesLon","dx","class","svgTextStyle","jlat","gridvaluesLat","defer","milkyWay","milkyWayBg","conb","constBoundaries","constBoundariesSel","constLines","dasharray","join","constLines1","constLines2","constLines3","mapBorder","conn","constNames","constNames1","svgAlign","constNames2","constNames3","cons","pointRadius","starDesignations","starNames","cond","dsoNames","jp","jlun","createEntry","rl","lun","moonSymbol","planetFont","darkluna","planetNames","svgSkyStyle","svgStyleA","gradient","symbolTypes","customSymbol","dsoColor","createStyles","stringifyStyle","await","blob","Blob","outerHTML","URL","createObjectURL","exportCallback","customSvgSymbols","ry","tzFormat","months","days","years","getYears","dtrange","picker","nav","monSel","yrSel","cal","daySel","timeSel","tzSel","curdt","today","getDay","firstChild","removeChild","classed","curmon","getMonth","curday","curid","pick","fillYrSel","year","getFullYear","month","lnk","mon","selectedIndex","getHours","getMinutes","getSeconds","tzOffset","getDateRange","childNodes","offsetWidth","vanish","setHours","radians","degrees","zoomPoint","zooming","d3_eventDispatch","behavior","mouse0","mouse","quaternionFromEuler","zoomOn","view","mouse1","between","rotateBetween","eulerFromQuaternion","multiply","bank","zoomed","of","zoomstarted","zoomended","rotateTo","dispatch","view1","__chart__","interpolateBetween","smooth","interpolateZoom","uw","rebind","p0","sinλ","cosλ","sinφ","cosφ","sinγ","cosγ","a3","b0","b1","b2","b3","axis","cross","norm","dot","halfγ","sinθ","A","B","argumentz","thiz","e1","e0","sourceEvent","global","factory","define","amd","noabort","Queue","_size","_call","_error","_tasks","_data","_waiting","_active","_ended","_start","poke","abort","results","maybeNotify","awaitAll","start","end","NaN","concurrency","Infinity","defineProperty"],"sources":["/Users/sergo/Work/lm-astronomy/src/front/node_modules/d3-celestial/celestial.js"],"sourcesContent":["// Copyright 2015-2020 Olaf Frohn https://github.com/ofrohn, see LICENSE\n!(function() {\r\nvar Celestial = {\r\n  version: '0.7.35',\r\n  container: null,\r\n  data: []\r\n};\r\n\r\nvar ANIMDISTANCE = 0.035,  // Rotation animation threshold, ~2deg in radians\r\n    ANIMSCALE = 1.4,       // Zoom animation threshold, scale factor\r\n    ANIMINTERVAL_R = 2000, // Rotation duration scale in ms\r\n    ANIMINTERVAL_P = 2500, // Projection duration in ms\r\n    ANIMINTERVAL_Z = 1500, // Zoom duration scale in ms\r\n    zoomextent = 10,       // Default maximum extent of zoom (max/min)\r\n    zoomlevel = 1;         // Default zoom level, 1 = 100%\r\n\r\nvar cfg, mapProjection, parentElement, zoom, map, circle, daylight, starnames = {}, dsonames = {};\r\n\r\n// Show it all, with the given config, otherwise with default settings\r\nCelestial.display = function(config) {\r\n  var animationID,\r\n      container = Celestial.container,\r\n      animations = [], \r\n      current = 0, \r\n      repeat = false;\r\n  \r\n  //Mash config with default settings, todo: if globalConfig exists, make another one\r\n  cfg = settings.set(config).applyDefaults(config);\r\n  if (isNumber(cfg.zoomextend)) zoomextent = cfg.zoomextend;\r\n  if (isNumber(cfg.zoomlevel)) zoomlevel = cfg.zoomlevel;\r\n  //if (cfg.disableAnimations) ANIMDISTANCE = Infinity;\r\n\r\n  var parent = document.getElementById(cfg.container);\r\n  if (parent) { \r\n    parentElement = \"#\" + cfg.container;\r\n    var st = window.getComputedStyle(parent, null);\r\n    if (!parseInt(st.width) && !cfg.width) parent.style.width = px(parent.parentNode.clientWidth); \r\n  } else { \r\n    parentElement = \"body\"; \r\n    parent = null; \r\n  }\r\n   \r\n  var margin = [16, 16],\r\n      width = getWidth(),\r\n      canvaswidth = isNumber(cfg.background.width) ? width + cfg.background.width : width,\r\n      pixelRatio = window.devicePixelRatio || 1,\r\n      projectionSetting = getProjection(cfg.projection, cfg.projectionRatio);\r\n\r\n  if (!projectionSetting) return;\r\n\r\n  if (cfg.lines.graticule.lat && cfg.lines.graticule.lat.pos[0] === \"outline\") projectionSetting.scale -= 2;\r\n        \r\n  var ratio = projectionSetting.ratio,\r\n      height = Math.round(width / ratio),\r\n      canvasheight = Math.round(canvaswidth / ratio),\r\n      scale = projectionSetting.scale * width/1024,\r\n      starbase = cfg.stars.size, \r\n      dsobase = cfg.dsos.size || starbase,\r\n      starexp = cfg.stars.exponent,\r\n      dsoexp = cfg.dsos.exponent || starexp, //Object size base & exponent\r\n      adapt = 1,\r\n      rotation = getAngles(cfg.center),\r\n      path = cfg.datapath;\r\n     \r\n  if (parentElement !== \"body\") parent.style.height = px(canvasheight);\r\n  \r\n  mapProjection = Celestial.projection(cfg.projection).rotate(rotation).translate([canvaswidth/2, canvasheight/2]).scale(scale * zoomlevel);\r\n    \r\n  zoom = d3.geo.zoom().projection(mapProjection).center([canvaswidth/2, canvasheight/2]).scaleExtent([scale, scale * zoomextent]).on(\"zoom.redraw\", redraw);\r\n  // Set initial zoom level\r\n  scale *= zoomlevel;\r\n\r\n  var canvas = d3.select(parentElement).selectAll(\"canvas\"),\r\n      culture = (cfg.culture !== \"\" && cfg.culture !== \"iau\") ? cfg.culture : \"\";\r\n  \r\n  if (canvas[0].length === 0) canvas = d3.select(parentElement).append(\"canvas\");\r\n  //canvas.attr(\"width\", width).attr(\"height\", height);\r\n  canvas.style(\"width\", px(canvaswidth)).style(\"height\", px(canvasheight)).attr(\"width\", canvaswidth * pixelRatio).attr(\"height\", canvasheight * pixelRatio);\r\n  var context = canvas.node().getContext(\"2d\");  \r\n  context.setTransform(pixelRatio,0,0,pixelRatio,0,0);\r\n\r\n  var graticule = d3.geo.graticule().minorStep([15,10]);\r\n  \r\n  map = d3.geo.path().projection(mapProjection).context(context);\r\n   \r\n  //parent div with id #celestial-map or body\r\n  if (container) container.selectAll(parentElement + \" *\").remove();\r\n  else container = d3.select(parentElement).append(\"container\");\r\n\r\n  if (cfg.interactive) {\r\n    canvas.call(zoom);\r\n    d3.select(parentElement).on('dblclick', function () { zoomBy(1.5625); return false; });\r\n  } else {\r\n    canvas.attr(\"style\", \"cursor: default!important\");\r\n  }\r\n\r\n  setClip(projectionSetting.clip);\r\n\r\n  d3.select(window).on('resize', resize);\r\n\r\n  if (cfg.interactive === true && cfg.controls === true && $(\"celestial-zoomin\") === null) {\r\n    d3.select(parentElement).append(\"input\").attr(\"type\", \"button\").attr(\"id\", \"celestial-zoomin\").attr(\"value\", \"\\u002b\").on(\"click\", function () { zoomBy(1.25); return false; });\r\n    d3.select(parentElement).append(\"input\").attr(\"type\", \"button\").attr(\"id\", \"celestial-zoomout\").attr(\"value\", \"\\u2212\").on(\"click\", function () { zoomBy(0.8); return false; });\r\n  }\r\n  \r\n  circle = d3.geo.circle().angle([90]);  \r\n  daylight = d3.geo.circle().angle([179.9]);\r\n\r\n  form(cfg);\r\n  \r\n  if ($(\"error\") === null) d3.select(\"body\").append(\"div\").attr(\"id\", \"error\");\r\n\r\n  if ($(\"loc\") === null) geo(cfg);\r\n  else if (cfg.location === true && cfg.follow === \"zenith\") rotate({center: Celestial.zenith()});\r\n\r\n  if (cfg.location === true || cfg.formFields.location === true) {\r\n    d3.select(parentElement + \" #location\").style(\"display\", \"inline-block\");\r\n    fldEnable(\"horizon-show\", projectionSetting.clip);\r\n    fldEnable(\"daylight-show\", !projectionSetting.clip);\r\n  }\r\n\r\n  function load() {\r\n    //Background\r\n    setClip(projectionSetting.clip);\r\n    container.append(\"path\").datum(graticule.outline).attr(\"class\", \"outline\"); \r\n    container.append(\"path\").datum(circle).attr(\"class\", \"horizon\");\r\n    container.append(\"path\").datum(daylight).attr(\"class\", \"daylight\");\r\n    //Celestial planes\r\n    if (cfg.transform === \"equatorial\") graticule.minorStep([15,10]);\r\n    else  graticule.minorStep([10,10]);\r\n    for (var key in cfg.lines) {\r\n      if (!has(cfg.lines, key)) continue;\r\n      if (key === \"graticule\") {\r\n        container.append(\"path\").datum(graticule).attr(\"class\", \"graticule\"); \r\n        if (has(cfg.lines.graticule, \"lon\") && cfg.lines.graticule.lon.pos.length > 0) \r\n          container.selectAll(parentElement + \" .gridvalues_lon\")\r\n            .data(getGridValues(\"lon\", cfg.lines.graticule.lon.pos))\r\n            .enter().append(\"path\")\r\n            .attr(\"class\", \"graticule_lon\"); \r\n        if (has(cfg.lines.graticule, \"lat\") && cfg.lines.graticule.lat.pos.length > 0) \r\n          container.selectAll(parentElement + \" .gridvalues_lat\")\r\n            .data(getGridValues(\"lat\", cfg.lines.graticule.lat.pos))\r\n            .enter().append(\"path\")\r\n            .attr(\"class\", \"graticule_lat\"); \r\n      } else {\r\n        container.append(\"path\")\r\n          .datum(d3.geo.circle().angle([90]).origin(transformDeg(poles[key], euler[cfg.transform])) )\r\n          .attr(\"class\", key);\r\n      }\r\n    }\r\n\r\n    //Milky way outline\r\n    d3.json(path + \"mw.json\", function(error, json) {\r\n      if (error) { \r\n        window.alert(\"Data file could not be loaded or doesn't exist. See readme.md\");\r\n        return console.warn(error);  \r\n      }\r\n\r\n      var mw = getData(json, cfg.transform);\r\n      var mw_back = getMwbackground(mw);\r\n\r\n      container.selectAll(parentElement + \" .mway\")\r\n         .data(mw.features)\r\n         .enter().append(\"path\")\r\n         .attr(\"class\", \"mw\");\r\n      container.selectAll(parentElement + \" .mwaybg\")\r\n         .data(mw_back.features)\r\n         .enter().append(\"path\")\r\n         .attr(\"class\", \"mwbg\");\r\n      redraw();\r\n    }); \r\n\r\n    //Constellation names or designation\r\n    d3.json(path + filename(\"constellations\"), function(error, json) {\r\n      if (error) return console.warn(error);\r\n      \r\n      var con = getData(json, cfg.transform);\r\n      container.selectAll(parentElement + \" .constnames\")\r\n         .data(con.features)\r\n         .enter().append(\"text\")\r\n         .attr(\"class\", \"constname\");\r\n         \r\n      Celestial.constellations = getConstellationList(con);\r\n      redraw();\r\n    });\r\n\r\n    //Constellation boundaries\r\n    d3.json(path + filename(\"constellations\", \"borders\"), function(error, json) {\r\n      if (error) return console.warn(error);\r\n      \r\n      //var cb = getData(topojson.feature(json, json.objects.constellations_bounds), cfg.transform);\r\n      var cb = getData(json, cfg.transform);\r\n      \r\n      container.selectAll(parentElement + \" .bounds\")\r\n         .data(cb.features)\r\n         .enter().append(\"path\")\r\n         .attr(\"class\", \"boundaryline\");\r\n      redraw();\r\n    });\r\n\r\n    //Constellation lines\r\n    d3.json(path + filename(\"constellations\", \"lines\"), function(error, json) {\r\n      if (error) return console.warn(error);\r\n\r\n      var conl = getData(json, cfg.transform);\r\n\r\n      container.selectAll(parentElement + \" .lines\")\r\n         .data(conl.features)\r\n         .enter().append(\"path\")\r\n         .attr(\"class\", \"constline\");\r\n\r\n      listConstellations();\r\n      redraw();\r\n    });\r\n    \r\n    //Stars\r\n    d3.json(path + cfg.stars.data, function(error, json) {\r\n      if (error) return console.warn(error);\r\n\r\n      var st = getData(json, cfg.transform);\r\n\r\n      container.selectAll(parentElement + \" .stars\")\r\n         .data(st.features)\r\n         .enter().append(\"path\")\r\n         .attr(\"class\", \"star\");\r\n      redraw();\r\n\r\n    });\r\n\r\n    //Star names\r\n    d3.json(path + filename(\"starnames\"), function(error, json) {\r\n      if (error) return console.warn(error);\r\n      Object.assign(starnames, json);\r\n      redraw();\r\n    });\r\n\r\n    //Deep space objects\r\n    d3.json(path + cfg.dsos.data, function(error, json) {\r\n      if (error) return console.warn(error);\r\n      \r\n      var ds = getData(json, cfg.transform);\r\n\r\n      container.selectAll(parentElement + \" .dsos\")\r\n         .data(ds.features)\r\n         .enter().append(\"path\")\r\n         .attr(\"class\", \"dso\" );\r\n      redraw();\r\n    });\r\n\r\n    //DSO names\r\n    d3.json(path + filename(\"dsonames\"), function(error, json) {\r\n      if (error) return console.warn(error);\r\n      Object.assign(dsonames, json);\r\n      redraw();\r\n    });\r\n\r\n    //Planets, Sun & Moon\r\n    d3.json(path + filename(\"planets\"), function(error, json) {\r\n      if (error) return console.warn(error);\r\n      \r\n      var pl = getPlanets(json, cfg.transform);\r\n\r\n      container.selectAll(parentElement + \" .planets\")\r\n         .data(pl)\r\n         .enter().append(\"path\")\r\n         .attr(\"class\", \"planet\");\r\n      redraw();\r\n    });\r\n\r\n    if (Celestial.data.length > 0) { \r\n      Celestial.data.forEach( function(d) {\r\n        if (has(d, \"file\")) d3.json(d.file, d.callback);\r\n        else setTimeout(d.callback, 0);\r\n      }, this);\r\n    }\r\n  \r\n    if (cfg.lang && cfg.lang != \"\") apply(Celestial.setLanguage(cfg.lang));\r\n    //redraw();\r\n  }\r\n  \r\n  // Zoom by factor; >1 larger <1 smaller \r\n  function zoomBy(factor) {\r\n    if (!factor || factor === 1) return;\r\n    var sc0 = mapProjection.scale(),\r\n        sc1 = sc0 * factor,\r\n        ext = zoom.scaleExtent(),\r\n        interval = ANIMINTERVAL_Z * Math.sqrt(Math.abs(1-factor));\r\n        \r\n    if (sc1 < ext[0]) sc1 = ext[0];\r\n    if (sc1 > ext[1]) sc1 = ext[1];\r\n    if (cfg.disableAnimations === true) { \r\n      mapProjection.scale(sc1); \r\n      zoom.scale(sc1); \r\n      redraw(); \r\n      return 0; \r\n    }\r\n    var zTween = d3.interpolateNumber(sc0, sc1);\r\n    d3.select({}).transition().duration(interval).tween(\"scale\", function () {\r\n        return function(t) {\r\n          var z = zTween(t);\r\n          mapProjection.scale(z); \r\n          redraw(); \r\n        };\r\n    }).transition().duration(0).tween(\"scale\", function () {\r\n      zoom.scale(sc1); \r\n      redraw(); \r\n    });\r\n    return interval;\r\n  }  \r\n  \r\n  function apply(config) {\r\n    cfg = settings.set(config); \r\n    redraw();\r\n  }\r\n\r\n\r\n  function rotate(config) {\r\n    var cFrom = cfg.center, \r\n        rot = mapProjection.rotate(),\r\n        sc = mapProjection.scale(),\r\n        interval = ANIMINTERVAL_R,\r\n        keep = false, \r\n        cTween, zTween, oTween,\r\n        oof = cfg.orientationfixed;\r\n    \r\n    if (Round(rot[1], 1) === -Round(config.center[1], 1)) keep = true; //keep lat fixed if equal\r\n    cfg = cfg.set(config);\r\n    var d = Round(d3.geo.distance(cFrom, cfg.center), 2);\r\n    var o = d3.geo.distance([cFrom[2],0], [cfg.center[2],0]);\r\n    if ((d < ANIMDISTANCE && o < ANIMDISTANCE) || cfg.disableAnimations === true) { \r\n      rotation = getAngles(cfg.center);\r\n      mapProjection.rotate(rotation);\r\n      redraw();\r\n      return 0; \r\n    } \r\n    // Zoom interpolator\r\n    if (sc > scale * ANIMSCALE) zTween = d3.interpolateNumber(sc, scale);\r\n    else zTween = function () { return sc; };\r\n    // Orientation interpolator\r\n    if (o === 0) oTween = function () { return rot[2]; };\r\n    else oTween = interpolateAngle(cFrom[2], cfg.center[2]);\r\n    if (d > 3.14) cfg.center[0] -= 0.01; //180deg turn doesn't work well\r\n    cfg.orientationfixed = false;  \r\n    // Rotation interpolator\r\n    if (d === 0) cTween = function () { return cfg.center; };\r\n    else cTween = d3.geo.interpolate(cFrom, cfg.center);\r\n    interval = (d !== 0) ? interval * d : interval * o; // duration scaled by ang. distance\r\n    d3.select({}).transition().duration(interval).tween(\"center\", function () {\r\n      return function(t) {\r\n        var c = getAngles(cTween(t));\r\n        c[2] = oTween(t);\r\n        var z = t < 0.5 ? zTween(t) : zTween(1-t);\r\n        if (keep) c[1] = rot[1]; \r\n        mapProjection.scale(z);\r\n        mapProjection.rotate(c);\r\n        redraw();\r\n      };\r\n    }).transition().duration(0).tween(\"center\", function () {\r\n      cfg.orientationfixed = oof;\r\n      rotation = getAngles(cfg.center);\r\n      mapProjection.rotate(rotation);\r\n      redraw();\r\n    });\r\n    return interval;\r\n  }\r\n  \r\n  function resize(set) {\r\n    width = getWidth();\r\n    if (cfg.width === width && !set) return;\r\n    height = width/ratio;\r\n    canvaswidth = isNumber(cfg.background.width) ? width + cfg.background.width : width;\r\n    canvasheight = Math.round(canvaswidth / ratio);\r\n\r\n    scale = projectionSetting.scale * width/1024;\r\n    //canvas.attr(\"width\", width).attr(\"height\", height);\r\n    canvas.style(\"width\", px(canvaswidth)).style(\"height\", px(canvasheight)).attr(\"width\", canvaswidth * pixelRatio).attr(\"height\", canvasheight * pixelRatio);\r\n    zoom.scaleExtent([scale, scale * zoomextent]).scale(scale * zoomlevel);\r\n    mapProjection.translate([canvaswidth/2, canvasheight/2]).scale(scale * zoomlevel);\r\n    if (parent) parent.style.height = px(height);\r\n    scale *= zoomlevel;\r\n    redraw();\r\n  }\r\n\r\n  function reproject(config) {\r\n    var prj = getProjection(config.projection, config.projectionRatio);\r\n    if (!prj) return;\r\n    \r\n    var rot = mapProjection.rotate(), ctr = mapProjection.center(), sc = mapProjection.scale(), ext = zoom.scaleExtent(), clip = [],\r\n        prjFrom = Celestial.projection(cfg.projection).center(ctr).translate([canvaswidth/2, canvasheight/2]).scale([ext[0]]),\r\n        interval = ANIMINTERVAL_P, \r\n        delay = 0, clipTween = null,\r\n        rTween = d3.interpolateNumber(ratio, prj.ratio);\r\n\r\n    if (projectionSetting.clip != prj.clip || cfg.disableAnimations === true) {\r\n      interval = 0; // Different clip = no transition\r\n    }\r\n    /*if (projectionSetting.clip !== prj.clip) {\r\n      clipTween = d3.interpolateNumber(projectionSetting.clip ? 90 : 180, prj.clip ? 90 : 180); // Clipangle from - to\r\n    } else*/ setClip(prj.clip);\r\n    \r\n    var prjTo = Celestial.projection(config.projection).center(ctr).translate([canvaswidth/2, canvaswidth/prj.ratio/2]).scale([prj.scale * width/1024]);\r\n    var bAdapt = cfg.adaptable;\r\n\r\n    if (sc > ext[0]) {\r\n      delay = zoomBy(0.1);\r\n      setTimeout(reproject, delay, config);\r\n      return delay + interval;\r\n    }\r\n    \r\n    if (cfg.location || cfg.formFields.location) { \r\n      fldEnable(\"horizon-show\", prj.clip);\r\n      fldEnable(\"daylight-show\", !prj.clip);\r\n    }\r\n    \r\n    mapProjection = projectionTween(prjFrom, prjTo);\r\n    cfg.adaptable = false;\r\n\r\n    d3.select({}).transition().duration(interval).tween(\"projection\", function () {\r\n      return function(_) {\r\n        mapProjection.alpha(_).rotate(rot);\r\n        map.projection(mapProjection);\r\n        /*if (clipTween) mapProjection.clipAngle(clipTween(_));\r\n        else*/setClip(prj.clip);\r\n        ratio = rTween(_);\r\n        height = width/ratio;\r\n        //canvas.attr(\"width\", width).attr(\"height\", height);\r\n        canvas.style(\"width\", px(canvaswidth)).style(\"height\", px(canvasheight)).attr(\"width\", canvaswidth * pixelRatio).attr(\"height\",  canvasheight * pixelRatio);\r\n        if (parent) parent.style.height = px(canvasheight);\r\n        redraw();\r\n      };\r\n    }).transition().duration(0).tween(\"projection\", function () {\r\n      projectionSetting = prj;\r\n      ratio = projectionSetting.ratio;\r\n      height = width / projectionSetting.ratio;\r\n      canvasheight = isNumber(cfg.background.width) ? height + cfg.background.width : height;\r\n      scale = projectionSetting.scale * width/1024;\r\n      //canvas.attr(\"width\", width).attr(\"height\", height);\r\n      canvas.style(\"width\", px(canvaswidth)).style(\"height\", px(canvasheight)).attr(\"width\", canvaswidth * pixelRatio).attr(\"height\", canvasheight * pixelRatio);\r\n      if (parent) parent.style.height = px(canvasheight);\r\n      cfg.projection = config.projection;\r\n      mapProjection = Celestial.projection(config.projection).rotate(rot).translate([canvaswidth/2, canvasheight/2]).scale(scale * zoomlevel);\r\n      map.projection(mapProjection);\r\n      setClip(projectionSetting.clip); \r\n      zoom.projection(mapProjection).scaleExtent([scale, scale * zoomextent]).scale(scale * zoomlevel);\r\n      cfg.adaptable = bAdapt;\r\n      scale *= zoomlevel;\r\n      redraw();\r\n    });\r\n    return interval;\r\n  }\r\n\r\n  \r\n  function redraw() {  \r\n    var rot = mapProjection.rotate();\r\n    \r\n    context.setTransform(pixelRatio,0,0,pixelRatio,0,0);\r\n    if (cfg.adaptable) adapt = Math.sqrt(mapProjection.scale()/scale);\r\n    if (!adapt) adapt = 1;\r\n    starbase = cfg.stars.size;\r\n    starexp = cfg.stars.exponent;\r\n    dsobase = cfg.dsos.size || starbase;\r\n    dsoexp = cfg.dsos.exponent;\r\n    \r\n    if (cfg.orientationfixed && cfg.center.length > 2) {\r\n      rot[2] = cfg.center[2]; \r\n      mapProjection.rotate(rot);\r\n    }\r\n    cfg.center = [-rot[0], -rot[1], rot[2]];\r\n    \r\n    setCenter(cfg.center, cfg.transform);\r\n    clear();\r\n    \r\n    drawOutline();\r\n    \r\n    //Draw all types of objects on the canvas\r\n    if (cfg.mw.show) { \r\n      container.selectAll(parentElement + \" .mw\").each(function(d) { setStyle(cfg.mw.style); map(d); context.fill(); });\r\n      // paint mw-outside in background color\r\n      if (cfg.transform !== \"supergalactic\" && cfg.background.opacity > 0.95)\r\n        container.selectAll(parentElement + \" .mwbg\").each(function(d) { setStyle(cfg.background); map(d); context.fill(); });\r\n    }\r\n    \r\n    for (var key in cfg.lines) {\r\n      if (!has(cfg.lines, key)) continue;\r\n      if (cfg.lines[key].show !== true) continue;\r\n      setStyle(cfg.lines[key]);\r\n      container.selectAll(parentElement + \" .\" + key).attr(\"d\", map);  \r\n      context.stroke(); \r\n    }\r\n\r\n    if (has(cfg.lines.graticule, \"lon\")) {\r\n      setTextStyle(cfg.lines.graticule.lon);\r\n      container.selectAll(parentElement + \" .graticule_lon\").each(function(d, i) { \r\n        if (clip(d.geometry.coordinates)) {\r\n          var pt = mapProjection(d.geometry.coordinates);\r\n          gridOrientation(pt, d.properties.orientation);\r\n          context.fillText(d.properties.value, pt[0], pt[1]); \r\n        }\r\n      });\r\n    }\r\n    \r\n    if (has(cfg.lines.graticule, \"lat\")) {\r\n      setTextStyle(cfg.lines.graticule.lat);\r\n      container.selectAll(parentElement + \" .graticule_lat\").each(function(d, i) { \r\n        if (clip(d.geometry.coordinates)) {\r\n          var pt = mapProjection(d.geometry.coordinates);\r\n          gridOrientation(pt, d.properties.orientation);\r\n          context.fillText(d.properties.value, pt[0], pt[1]); \r\n        }\r\n      });\r\n    }\r\n    \r\n    if (cfg.constellations.bounds) { \r\n      container.selectAll(parentElement + \" .boundaryline\").each(function(d) { \r\n        setStyle(cfg.constellations.boundStyle); \r\n        if (Celestial.constellation) {\r\n          var re = new RegExp(\"\\\\b\" + Celestial.constellation + \"\\\\b\");\r\n          if (d.ids.search(re) !== -1) {\r\n            context.lineWidth *= 1.5;\r\n            context.globalAlpha = 1;\r\n            context.setLineDash([]);\r\n          }\r\n        }\r\n        map(d); \r\n        context.stroke(); \r\n      });\r\n      context.setLineDash([]);\r\n    }\r\n\r\n    if (cfg.constellations.lines) { \r\n      container.selectAll(parentElement + \" .constline\").each(function(d) { \r\n        setStyleA(d.properties.rank, cfg.constellations.lineStyle); \r\n        map(d); \r\n        context.stroke(); \r\n      });\r\n    }\r\n    \r\n    drawOutline(true);    \r\n\r\n    if (cfg.constellations.names) { \r\n      //setTextStyle(cfg.constellations.nameStyle);\r\n      container.selectAll(parentElement + \" .constname\").each( function(d) { \r\n        if (clip(d.geometry.coordinates)) {\r\n          setStyleA(d.properties.rank, cfg.constellations.nameStyle);\r\n          var pt = mapProjection(d.geometry.coordinates);\r\n          context.fillText(constName(d), pt[0], pt[1]); \r\n        }\r\n      });\r\n    }\r\n      \r\n\r\n    if (cfg.stars.show) { \r\n      setStyle(cfg.stars.style);\r\n      container.selectAll(parentElement + \" .star\").each(function(d) {\r\n        if (clip(d.geometry.coordinates) && d.properties.mag <= cfg.stars.limit) {\r\n          var pt = mapProjection(d.geometry.coordinates),\r\n              r = starSize(d);\r\n          context.fillStyle = starColor(d); \r\n          context.beginPath();\r\n          context.arc(pt[0], pt[1], r, 0, 2 * Math.PI);\r\n          context.closePath();\r\n          context.fill();\r\n          if (cfg.stars.designation && d.properties.mag <= cfg.stars.designationLimit*adapt) {\r\n            setTextStyle(cfg.stars.designationStyle);\r\n            context.fillText(starDesignation(d.id), pt[0]+r, pt[1]);\r\n          }\r\n          if (cfg.stars.propername && d.properties.mag <= cfg.stars.propernameLimit*adapt) {\r\n            setTextStyle(cfg.stars.propernameStyle);\r\n            context.fillText(starPropername(d.id), pt[0]-r, pt[1]);\r\n          }\r\n        }\r\n      });\r\n    }\r\n    \r\n    if (cfg.dsos.show) { \r\n      container.selectAll(parentElement + \" .dso\").each(function(d) {\r\n        if (clip(d.geometry.coordinates) && dsoDisplay(d.properties, cfg.dsos.limit)) {\r\n          var pt = mapProjection(d.geometry.coordinates),\r\n              type = d.properties.type;\r\n          if (cfg.dsos.colors === true) setStyle(cfg.dsos.symbols[type]);\r\n          else setStyle(cfg.dsos.style);\r\n          var r = dsoSymbol(d, pt);\r\n          if (has(cfg.dsos.symbols[type], \"stroke\")) context.stroke();\r\n          else context.fill();\r\n          \r\n          if (cfg.dsos.names && dsoDisplay(d.properties, cfg.dsos.nameLimit*adapt)) {\r\n            setTextStyle(cfg.dsos.nameStyle);\r\n            if (cfg.dsos.colors === true) context.fillStyle = cfg.dsos.symbols[type].fill;\r\n            context.fillText(dsoName(d), pt[0]+r, pt[1]-r);      \r\n          }\r\n        }\r\n      });\r\n    }\r\n\r\n    if ((cfg.location || cfg.formFields.location) && cfg.planets.show && Celestial.origin) { \r\n      var dt = Celestial.date(),\r\n          o = Celestial.origin(dt).spherical();\r\n      container.selectAll(parentElement + \" .planet\").each(function(d) {\r\n        var id = d.id(), r = 12 * adapt,\r\n            p = d(dt).equatorial(o),\r\n            pos = transformDeg(p.ephemeris.pos, euler[cfg.transform]);  //transform; \r\n        if (clip(pos)) {\r\n          var pt = mapProjection(pos),\r\n              sym = cfg.planets.symbols[id];\r\n          if (cfg.planets.symbolType === \"letter\") {\r\n            setTextStyle(cfg.planets.symbolStyle);\r\n            context.fillStyle = sym.fill;\r\n            context.fillText(sym.letter, pt[0], pt[1]);\r\n          } else if (id === \"lun\") {\r\n            if (has(sym, \"size\") && isNumber(sym.size)) r = sym.size * adapt;\r\n            context.fillStyle = sym.fill;\r\n            Canvas.symbol().type(\"crescent\").size(r*r).age(p.ephemeris.age).position(pt)(context);\r\n          } else if (cfg.planets.symbolType === \"disk\") {\r\n            r = has(sym, \"size\") && isNumber(sym.size) ? sym.size * adapt : planetSize(p.ephemeris);\r\n            context.fillStyle = sym.fill;\r\n            Canvas.symbol().type(\"circle\").size(r*r).position(pt)(context);\r\n            context.fill();\r\n          } else if (cfg.planets.symbolType === \"symbol\") {\r\n            setTextStyle(cfg.planets.symbolStyle);\r\n            context.font = planetSymbol(cfg.planets.symbolStyle.font);\r\n            context.fillStyle = sym.fill;\r\n            context.fillText(sym[cfg.planets.symbolType], pt[0], pt[1]);            \r\n          }\r\n          //name\r\n          if (cfg.planets.names) {\r\n            var name = p[cfg.planets.namesType];\r\n            setTextStyle(cfg.planets.nameStyle);\r\n            //context.direction = \"ltr\" || \"rtl\" ar il ir\r\n            context.fillStyle = sym.fill;\r\n            context.fillText(name, pt[0] - r/2, pt[1] + r/2);                        \r\n          }\r\n        }\r\n      });\r\n    }\r\n    \r\n    if (Celestial.data.length > 0) { \r\n      Celestial.data.forEach( function(d) {\r\n        d.redraw();\r\n      });\r\n    }\r\n    \r\n    if ((cfg.location || cfg.formFields.location) && cfg.daylight.show && projectionSetting.clip) {\r\n      var sol = getPlanet(\"sol\");\r\n      if (sol) {\r\n        var up = Celestial.zenith(),\r\n            solpos = sol.ephemeris.pos,\r\n            dist = d3.geo.distance(up, solpos),\r\n            pt = mapProjection(solpos);\r\n\r\n        daylight.origin(solpos);\r\n        setSkyStyle(dist, pt);\r\n        container.selectAll(parentElement + \" .daylight\").datum(daylight).attr(\"d\", map);\r\n        context.fill();    \r\n        context.fillStyle = \"#fff\"; \r\n        if (clip(solpos)) {\r\n          context.beginPath();\r\n          context.arc(pt[0], pt[1], 6, 0, 2 * Math.PI);\r\n          context.closePath();\r\n          context.fill();\r\n        }\r\n      }\r\n    }\r\n\r\n    if ((cfg.location || cfg.formFields.location) && cfg.horizon.show && !projectionSetting.clip) {\r\n      circle.origin(Celestial.nadir());\r\n      setStyle(cfg.horizon);\r\n      container.selectAll(parentElement + \" .horizon\").datum(circle).attr(\"d\", map);  \r\n      context.fill(); \r\n      if (cfg.horizon.stroke) context.stroke(); \r\n    }\r\n\r\n    if (cfg.controls) { \r\n      zoomState(mapProjection.scale());\r\n    }\r\n    \r\n    if (hasCallback) { \r\n      Celestial.runCallback();\r\n    }\r\n    \r\n    //Celestial.updateForm();\r\n\r\n  }\r\n    \r\n\r\n  function drawOutline(stroke) {\r\n    var rot = mapProjection.rotate(),\r\n        prj = getProjection(cfg.projection, config.projectionRatio);\r\n    \r\n    mapProjection.rotate([0,0]);\r\n    setStyle(cfg.background);\r\n    container.selectAll(parentElement + \" .outline\").attr(\"d\", map);\r\n    if (stroke === true) {\r\n      context.globalAlpha = 1;      \r\n      context.stroke(); \r\n    } else {\r\n      context.fill();\r\n    }\r\n    mapProjection.rotate(rot);\r\n  }\r\n\r\n  // Helper functions -------------------------------------------------\r\n  \r\n  function clip(coords) {\r\n    return projectionSetting.clip && d3.geo.distance(cfg.center, coords) > halfπ ? 0 : 1;\r\n  }\r\n\r\n  function setStyle(s) {\r\n    context.fillStyle = s.fill || null;\r\n    context.strokeStyle = s.stroke || null;\r\n    context.lineWidth = s.width || null;\r\n    context.globalAlpha = s.opacity !== null ? s.opacity : 1;  \r\n    context.font = s.font || null;\r\n    if (has(s, \"dash\")) context.setLineDash(s.dash); else context.setLineDash([]);\r\n    context.beginPath();\r\n  }\r\n\r\n  function setTextStyle(s) {\r\n    context.fillStyle = s.fill;\r\n    context.textAlign = s.align || \"left\";\r\n    context.textBaseline = s.baseline || \"bottom\";\r\n    context.globalAlpha = s.opacity !== null ? s.opacity : 1;  \r\n    context.font = s.font;\r\n  }\r\n\r\n  function setStyleA(rank, s) {\r\n    rank = rank || 1;\r\n    context.fillStyle = isArray(s.fill) ? s.fill[rank-1] : null;\r\n    context.strokeStyle = isArray(s.stroke) ? s.stroke[rank-1] : null;\r\n    context.lineWidth = isArray(s.width) ? s.width[rank-1] : null;\r\n    context.globalAlpha = isArray(s.opacity) ? s.opacity[rank-1] : 1;  \r\n    context.font = isArray(s.font) ? s.font[rank-1] : null;\r\n    if (has(s, \"dash\")) context.setLineDash(s.dash); else context.setLineDash([]);\r\n    context.textAlign = s.align || \"left\";\r\n    context.textBaseline = s.baseline || \"bottom\";\r\n    context.beginPath();\r\n  }\r\n\r\n  function setSkyStyle(dist, pt) {\r\n    var factor, color1, color2, color3,\r\n        upper = 1.36, \r\n        lower = 1.885;\r\n    \r\n    if (dist > lower) {\r\n      context.fillStyle = \"transparent\"; \r\n      context.globalAlpha = 0;\r\n      return;\r\n    }\r\n    \r\n    if (dist <= upper) { \r\n      color1 = \"#daf1fa\";\r\n      color2 = \"#93d7f0\"; \r\n      color3 = \"#57c0e8\"; \r\n      factor = -(upper-dist) / 10; \r\n    } else {\r\n      factor = (dist - upper) / (lower - upper);\r\n      color1 = d3.interpolateLab(\"#daf1fa\", \"#e8c866\")(factor);\r\n      color2 = d3.interpolateLab(\"#93c7d0\", \"#ff854a\")(factor);\r\n      color3 = d3.interpolateLab(\"#57b0c8\", \"#6caae2\")(factor);\r\n    }\r\n    var grad = context.createRadialGradient(pt[0],pt[1],0, pt[0],pt[1],300);\r\n    grad.addColorStop(0, color1);\r\n    grad.addColorStop(0.2+0.4*factor, color2);\r\n    grad.addColorStop(1, color3);\r\n    context.fillStyle = grad;\r\n    context.globalAlpha = 0.9 * (1 - skyTransparency(factor, 1.4));\r\n  }\r\n  \r\n  function skyTransparency(t, a) {\r\n    return (Math.pow(Math.E, t*a) - 1) / (Math.pow(Math.E, a) - 1);\r\n  }\r\n  \r\n  function zoomState(sc) {\r\n    var czi = $(\"celestial-zoomin\"),\r\n        czo = $(\"celestial-zoomout\"),\r\n        defscale = projectionSetting.scale * width/1024;\r\n    if (!czi || !czo) return;\r\n    czi.disabled = sc >= defscale * zoomextent * 0.99;\r\n    czo.disabled = sc <= defscale; \r\n  }\r\n  \r\n  function setClip(setit) {\r\n    if (setit) { mapProjection.clipAngle(90); } \r\n    else { mapProjection.clipAngle(null); }        \r\n  }\r\n  \r\n  function filename(what, sub, ext) {\r\n    var cult = (has(formats[what], culture)) ? \".\" + culture : \"\";\r\n    ext = ext ? \".\" + ext : \".json\";\r\n    sub = sub ? \".\" + sub : \"\";\r\n    return what + sub + cult + ext;\r\n  }\r\n  \r\n  function dsoDisplay(prop, limit) {\r\n    return prop.mag === 999 && Math.sqrt(parseInt(prop.dim)) > limit ||\r\n           prop.mag !== 999 && prop.mag <= limit;\r\n  }\r\n  \r\n  function dsoSymbol(d, pt) {\r\n    var prop = d.properties;\r\n    var size = dsoSize(prop) || 9,\r\n        type = dsoShape(prop.type);\r\n    Canvas.symbol().type(type).size(size).position(pt)(context);\r\n    return Math.sqrt(size)/2;\r\n  }\r\n\r\n  function dsoShape(type) {\r\n    if (!type || !has(cfg.dsos.symbols, type)) return \"circle\"; \r\n    else return cfg.dsos.symbols[type].shape; \r\n  }\r\n\r\n  function dsoSize(prop) {\r\n    if (!prop.mag || prop.mag === 999) return Math.pow(parseInt(prop.dim) * dsobase * adapt / 7, 0.5); \r\n    return Math.pow(2 * dsobase * adapt - prop.mag, dsoexp);\r\n  }\r\n \r\n\r\n  function dsoName(d) {\r\n    //return d.properties[cfg.dsos.namesType]; \r\n    var lang = cfg.dsos.namesType, id = d.id;\r\n    if (lang === \"desig\" || !has(dsonames, id)) return d.properties.desig;\r\n    return has(dsonames[id], lang) ? dsonames[id][lang] : d.properties.desig; \r\n  }\r\n  \r\n  /* Star designation  */\r\n  function starDesignation(id) {\r\n    if (!has(starnames, id)) return \"\";\r\n    return starnames[id][cfg.stars.designationType]; \r\n  }\r\n\r\n  function starPropername(id) {\r\n    var lang = cfg.stars.propernameType;\r\n    if (!has(starnames, id)) return \"\";\r\n    return has(starnames[id], lang) ? starnames[id][lang] : starnames[id].name; \r\n  }\r\n  \r\n  function starSize(d) {\r\n    var mag = d.properties.mag;\r\n    if (mag === null) return 0.1; \r\n    var r = starbase * adapt * Math.exp(starexp * (mag+2));\r\n    return Math.max(r, 0.1);\r\n  }\r\n\r\n  \r\n  function starColor(d) {\r\n    var bv = d.properties.bv;\r\n    if (!cfg.stars.colors || isNaN(bv)) {return cfg.stars.style.fill; }\r\n    return bvcolor(bv);\r\n  }\r\n  \r\n  function constName(d) { \r\n    return d.properties[cfg.constellations.namesType]; \r\n  }\r\n\r\n  function planetSize(d) {\r\n    var mag = d.mag;\r\n    if (mag === null) return 2; \r\n    var r = 4 * adapt * Math.exp(-0.05 * (mag+2));\r\n    return Math.max(r, 2);\r\n  }\r\n \r\n  function planetSymbol(s) {\r\n    var size = s.replace(/(^\\D*)(\\d+)(\\D.+$)/i,'$2');\r\n    size = Math.round(adapt * size);\r\n    return s.replace(/(^\\D*)(\\d+)(\\D.+$)/i,'$1' + size + '$3');\r\n  }\r\n \r\n  function gridOrientation(pos, orient) {\r\n    var o = orient.split(\"\"), h = \"center\", v = \"middle\"; \r\n    for (var i = o.length-1; i >= 0; i--) {\r\n      switch(o[i]) {\r\n        case \"N\": v = \"bottom\"; break;\r\n        case \"S\": v = \"top\"; break;\r\n        case \"E\": h = \"left\"; pos[0] += 2; break;\r\n        case \"W\": h = \"right\";  pos[0] -= 2; break;\r\n      }\r\n    }\r\n    context.textAlign = h;\r\n    context.textBaseline = v;\r\n    return pos;\r\n  }\r\n  \r\n  function clear() {\r\n    context.clearRect(0, 0, canvaswidth + margin[0], canvasheight + margin[1]);\r\n  }\r\n  \r\n  function getWidth() {\r\n    var w = 0;\r\n    if (isNumber(cfg.width) && cfg.width > 0) w = cfg.width;\r\n    else if (parent) w = parent.getBoundingClientRect().width - margin[0] *2;\r\n    else w = window.getBoundingClientRect().width - margin[0]*2;\r\n    //if (isNumber(cfg.background.width)) w -= cfg.background.width;\r\n    return w;\r\n  }\r\n  \r\n  function getProjection(p, ratioOverride) {\r\n    if (!has(projections, p)) return;\r\n    var res = projections[p];\r\n    if (!has(res, \"ratio\")) res.ratio = 2;  // Default w/h ratio 2:1    \r\n    res.ratio = ratioOverride ? ratioOverride : res.ratio;\r\n    return res;\r\n  }\r\n \r\n  \r\n  function animate() {\r\n    if (!animations || animations.length < 1) return;\r\n\r\n    var d, a = animations[current];\r\n    \r\n    switch (a.param) {\r\n      case \"projection\": d = reproject({projection:a.value}); break;\r\n      case \"center\": d = rotate({center:a.value}); break;\r\n      case \"zoom\": d = zoomBy(a.value);\r\n    }\r\n    if (a.callback) setTimeout(a.callback, d);\r\n    current++;\r\n    if (repeat === true && current === animations.length) current = 0;\r\n    d = a.duration === 0 || a.duration < d ? d : a.duration;\r\n    if (current < animations.length) animationID = setTimeout(animate, d);\r\n  }\r\n  \r\n  function stop() {\r\n    clearTimeout(animationID);\r\n    //current = 0;\r\n    //repeat = false;\r\n  }\r\n\r\n  \r\n  // Exported objects and functions for adding data\r\n  this.container = container;\r\n  this.clip = clip;\r\n  this.map = map;\r\n  this.mapProjection = mapProjection;\r\n  this.context = context;\r\n  this.metrics = function() {\r\n    return {\"width\": width, \"height\": height, \"margin\": margin, \"scale\": mapProjection.scale()};\r\n  };\r\n  this.setStyle = setStyle;\r\n  this.setTextStyle = setTextStyle;\r\n  this.setStyleA = setStyleA;\r\n  this.setConstStyle = function(rank, font) { \r\n    var f = arrayfy(font);\r\n    context.font = f[rank];    \r\n  };\r\n  this.symbol = Canvas.symbol;\r\n  this.dsoSymbol = dsoSymbol;\r\n  this.redraw = redraw; \r\n  this.resize = function(config) { \r\n    if (config !== undefined) {  \r\n      if (has(config, \"width\")) cfg.width = config.width; \r\n      else if (isNumber(config)) cfg.width = config;\r\n    }\r\n    resize(true); \r\n    return cfg.width;\r\n  }; \r\n  this.reload = function(config) { \r\n    var ctr;\r\n    //if (!config || !has(config, \"transform\")) return;\r\n    //cfg.transform = config.transform; \r\n    if (config) Object.assign(cfg, settings.set(config));\r\n    if (cfg.follow === \"center\" && has(cfg, \"center\")) {\r\n      ctr = getAngles(cfg.center);\r\n    } else if (cfg.follow === \"zenith\") {\r\n      ctr = getAngles(Celestial.zenith());\r\n    } \r\n    if (ctr) mapProjection.rotate(ctr);\r\n    container.selectAll(parentElement + \" *\").remove(); \r\n    load(); \r\n  }; \r\n  this.apply = function(config) { apply(config); }; \r\n  this.reproject = function(config) { return reproject(config); }; \r\n  this.rotate = function(config) { if (!config) return cfg.center; return rotate(config); }; \r\n  this.zoomBy = function(factor) { if (!factor) return mapProjection.scale()/scale; return zoomBy(factor); };\r\n  this.color = function(type) {\r\n    if (!type) return \"#000\";\r\n    if (has(cfg.dsos.symbols, type)) return cfg.dsos.symbols[type].fill;\r\n    return \"#000\";\r\n  };\r\n  this.starColor = starColor;\r\n  this.animate = function(anims, dorepeat) { \r\n    if (!anims) return; \r\n    animations = anims; \r\n    current = 0; \r\n    repeat = dorepeat ? true : false; \r\n    animate(); \r\n  };\r\n  this.stop  = function(wipe) {\r\n    stop();\r\n    if (wipe === true) animations = [];\r\n  };\r\n  this.go = function(index) {\r\n    if (animations.length < 1) return;\r\n    if (index && index < animations.length) current = index;\r\n    animate(); \r\n  };\r\n\r\n  /* obsolete\r\n  if (!has(this, \"date\"))\r\n    this.date = function() { console.log(\"Celestial.date() needs config.location = true to work.\" ); };\r\n  */\r\n  load();\r\n};\r\n \r\n//Export entire object if invoked by require\r\nif (typeof module === \"object\" && module.exports) {\r\n  var d3js = require('./lib/d3.js'),\r\n      d3_geo_projection = require('./lib/d3.geo.projection.js');\r\n  module.exports = {\r\n    Celestial: function() { return Celestial; },\r\n    d3: function() { return d3js; },\r\n    \"d3.geo.projection\": function() { return d3_geo_projection; }\r\n  };\r\n}\r\n\r\n//Flipped projection generated on the fly\r\nCelestial.projection = function(projection) {\r\n  var p, raw, forward;\r\n  \r\n  if (!has(projections, projection)) { throw new Error(\"Projection not supported: \" + projection); }\r\n  p = projections[projection];    \r\n\r\n  if (p.arg !== null) {\r\n    raw = d3.geo[projection].raw(p.arg);\r\n  } else {\r\n    raw = d3.geo[projection].raw;  \r\n  }\r\n  \r\n  forward = function(λ, φ) {\r\n    var coords = raw(-λ, φ);\r\n    return coords;\r\n  };\r\n\r\n  forward.invert = function(x, y) {\r\n    try {\r\n      var coords = raw.invert(x, y);\r\n      coords[0] = coords && -coords[0];\r\n      return coords;\r\n    } catch(e) { console.log(e); }\r\n  };\r\n\r\n  return d3.geo.projection(forward);\r\n};\r\n\r\n\r\nfunction projectionTween(a, b) {\r\n  var prj = d3.geo.projection(raw).scale(1),\r\n      center = prj.center,\r\n      translate = prj.translate,\r\n      α;\r\n\r\n  function raw(λ, φ) {\r\n    var pa = a([λ *= 180 / Math.PI, φ *= 180 / Math.PI]), pb = b([λ, φ]);\r\n    return [(1 - α) * pa[0] + α * pb[0], (α - 1) * pa[1] - α * pb[1]];\r\n  }\r\n\r\n  prj.alpha = function(_) {\r\n    if (!arguments.length) return α;\r\n    α = +_;\r\n    var ca = a.center(), cb = b.center(),\r\n        ta = a.translate(), tb = b.translate();\r\n    \r\n    center([(1 - α) * ca[0] + α * cb[0], (1 - α) * ca[1] + α * cb[1]]);\r\n    translate([(1 - α) * ta[0] + α * tb[0], (1 - α) * ta[1] + α * tb[1]]);\r\n    return prj;\r\n  };\r\n\r\n  delete prj.translate;\r\n  delete prj.center;\r\n  return prj.alpha(0);\r\n}\r\n\r\nvar eulerAngles = {\r\n  \"equatorial\": [0.0, 0.0, 0.0],\r\n  \"ecliptic\": [0.0, 0.0, 23.4393],\r\n  \"galactic\": [93.5949, 28.9362, -58.5988],\r\n  \"supergalactic\": [137.3100, 59.5283, 57.7303]\r\n//  \"mars\": [97.5,23.5,29]\r\n};\r\n\r\nvar poles = {\r\n  \"equatorial\": [0.0, 90.0],\r\n  \"ecliptic\": [-90.0, 66.5607],\r\n  \"galactic\": [-167.1405, 27.1283],\r\n  \"supergalactic\": [-76.2458, 15.7089]\r\n//  \"mars\": [-42.3186, 52.8865]\r\n};\r\n\r\nCelestial.eulerAngles = function () { return eulerAngles; };\r\nCelestial.poles = function () { return poles; };\r\n\r\nvar τ = Math.PI*2,\r\n    halfπ = Math.PI/2,\r\n    deg2rad = Math.PI/180;\r\n\r\n\r\n//Transform equatorial into any coordinates, degrees\r\nfunction transformDeg(c, euler) {\r\n  var res = transform( c.map( function(d) { return d * deg2rad; } ), euler);\r\n  return res.map( function(d) { return d / deg2rad; } );\r\n}\r\n\r\n//Transform equatorial into any coordinates, radians\r\nfunction transform(c, euler) {\r\n  var x, y, z, β, γ, λ, φ, dψ, ψ, θ,\r\n      ε = 1.0e-5;\r\n\r\n  if (!euler) return c; \r\n\r\n  λ = c[0];  // celestial longitude 0..2pi\r\n  if (λ < 0) λ += τ; \r\n  φ = c[1];  // celestial latitude  -pi/2..pi/2\r\n  \r\n  λ -= euler[0];  // celestial longitude - celestial coordinates of the native pole\r\n  β = euler[1];  // inclination between the poles (colatitude)\r\n  γ = euler[2];  // native coordinates of the celestial pole\r\n  \r\n  x = Math.sin(φ) * Math.sin(β) - Math.cos(φ) * Math.cos(β) * Math.cos(λ);\r\n  if (Math.abs(x) < ε) {\r\n    x = -Math.cos(φ + β) + Math.cos(φ) * Math.cos(β) * (1 - Math.cos(λ));\r\n  }\r\n  y = -Math.cos(φ) * Math.sin(λ);\r\n  \r\n  if (x !== 0 || y !== 0) {\r\n    dψ = Math.atan2(y, x);\r\n  } else {\r\n    dψ = λ - Math.PI;\r\n  }\r\n  ψ = (γ + dψ); \r\n  if (ψ > Math.PI) ψ -= τ; \r\n  \r\n  if (λ % Math.PI === 0) {\r\n    θ = φ + Math.cos(λ) * β;\r\n    if (θ > halfπ) θ = Math.PI - θ; \r\n    if (θ < -halfπ) θ = -Math.PI - θ; \r\n  } else {\r\n    z = Math.sin(φ) * Math.cos(β) + Math.cos(φ) * Math.sin(β) * Math.cos(λ);\r\n    if (Math.abs(z) > 0.99) {\r\n      θ = Math.abs(Math.acos(Math.sqrt(x*x+y*y)));\r\n      if (z < 0) θ *= -1; \r\n    } else {\r\n      θ = Math.asin(z);\r\n    }\r\n  }\r\n  \r\n  return [ψ, θ];\r\n}\r\n\r\n  \r\nfunction getAngles(coords) {\r\n  if (coords === null || coords.length <= 0) return [0,0,0];\r\n  var rot = eulerAngles.equatorial; \r\n  if (!coords[2]) coords[2] = 0;\r\n  return [rot[0] - coords[0], rot[1] - coords[1], rot[2] + coords[2]];\r\n}\r\n\r\n\r\nvar euler = {\r\n  \"ecliptic\": [-90.0, 23.4393, 90.0],\r\n  \"inverse ecliptic\": [90.0, 23.4393, -90.0],\r\n  \"galactic\": [-167.1405, 62.8717, 122.9319], \r\n  \"inverse galactic\": [122.9319, 62.8717, -167.1405],\r\n  \"supergalactic\": [283.7542, 74.2911, 26.4504],\r\n  \"inverse supergalactic\": [26.4504, 74.2911, 283.7542],\r\n  \"init\": function () {\r\n    for (var key in this) {\r\n      if (this[key].constructor == Array) { \r\n        this[key] = this[key].map( function(val) { return val * deg2rad; } );\r\n      }\r\n    }\r\n  },\r\n  \"add\": function(name, ang) {\r\n    if (!ang || !name || ang.length !== 3 || this.hasOwnProperty(name)) return; \r\n    this[name] = ang.map( function(val) { return val * deg2rad; } );\r\n    return this[name];\r\n  }\r\n};\r\n\r\neuler.init();\r\nCelestial.euler = function () { return euler; };\r\n\r\nvar horizontal = function(dt, pos, loc) {\r\n  //dt: datetime, pos: celestial coordinates [lat,lng], loc: location [lat,lng]  \r\n  var ha = getMST(dt, loc[1]) - pos[0];\r\n  if (ha < 0) ha = ha + 360;\r\n  \r\n  ha  = ha * deg2rad;\r\n  var dec = pos[1] * deg2rad;\r\n  var lat = loc[0] * deg2rad;\r\n\r\n  var alt = Math.asin(Math.sin(dec) * Math.sin(lat) + Math.cos(dec) * Math.cos(lat) * Math.cos(ha));\r\n  var az = Math.acos((Math.sin(dec) - Math.sin(alt) * Math.sin(lat)) / (Math.cos(alt) * Math.cos(lat)));\r\n\r\n  if (Math.sin(ha) > 0) az = Math.PI * 2 - az;\r\n  \r\n  return [alt / deg2rad, az / deg2rad, 0];\r\n};\r\n\r\nhorizontal.inverse = function(dt, hor, loc) {\r\n  \r\n  var alt = hor[0] * deg2rad;\r\n  var az = hor[1] * deg2rad;\r\n  var lat = loc[0] * deg2rad;\r\n   \r\n  var dec = Math.asin((Math.sin(alt) * Math.sin(lat)) + (Math.cos(alt) * Math.cos(lat) * Math.cos(az)));\r\n  var ha = ((Math.sin(alt) - (Math.sin(dec) * Math.sin(lat))) / (Math.cos(dec) * Math.cos(lat))).toFixed(6);\r\n  \r\n  ha = Math.acos(ha);\r\n  ha  = ha / deg2rad;\r\n  \r\n  var ra = getMST(dt, loc[1]) - ha;\r\n  //if (ra < 0) ra = ra + 360;\r\n    \r\n  return [ra, dec / deg2rad, 0];\r\n};\r\n\r\nfunction getMST(dt, lng)\r\n{\r\n    var yr = dt.getUTCFullYear();\r\n    var mo = dt.getUTCMonth() + 1;\r\n    var dy = dt.getUTCDate();\r\n    var h = dt.getUTCHours();\r\n    var m = dt.getUTCMinutes();\r\n    var s = dt.getUTCSeconds();\r\n\r\n    if ((mo == 1)||(mo == 2)) {\r\n        yr  = yr - 1;\r\n        mo = mo + 12;\r\n    }\r\n\r\n    var a = Math.floor(yr / 100);\r\n    var b = 2 - a + Math.floor(a / 4);\r\n    var c = Math.floor(365.25 * yr);\r\n    var d = Math.floor(30.6001 * (mo + 1));\r\n\r\n    // days since J2000.0\r\n    var jd = b + c + d - 730550.5 + dy + (h + m/60.0 + s/3600.0)/24.0;\r\n    \r\n    // julian centuries since J2000.0\r\n    var jt = jd/36525.0;\r\n\r\n    // the mean sidereal time in degrees\r\n    var mst = 280.46061837 + 360.98564736629*jd + 0.000387933*jt*jt - jt*jt*jt/38710000 + lng;\r\n\r\n    // in degrees modulo 360.0\r\n    if (mst > 0.0) \r\n        while (mst > 360.0) mst = mst - 360.0;\r\n    else\r\n        while (mst < 0.0)   mst = mst + 360.0;\r\n        \r\n    return mst;\r\n}\r\n\r\nCelestial.horizontal = horizontal;\r\nCelestial.ha = function(dt, lng, ra) {\r\n  var ha = getMST(dt, lng) - ra;\r\n  if (ha < 180) ha = ha + 360;\r\n  return ha;\r\n};\r\n//Add more JSON data to the map\r\nvar hasCallback = false;\r\n\r\nCelestial.add = function(dat) {\r\n  var res = {};\r\n  //dat: {file: path, type:'json|raw', callback: func(), redraw: func()} \r\n  //or {file:file, size:null, shape:null, color:null}  TBI\r\n  //  with size,shape,color: \"prop=val:result;..\" || function(prop) { .. return res; } \r\n  if (!has(dat, \"type\")) return console.log(\"Missing type\");\r\n  \r\n  if ((dat.type === \"dso\" || dat.type === \"json\") && (!has(dat, \"file\") || !has(dat, \"callback\"))) return console.log(\"Can't add data file\");\r\n  if ((dat.type === \"line\" || dat.type === \"raw\") && !has(dat, \"callback\")) return console.log(\"Can't add data\");\r\n  \r\n  if (has(dat, \"file\")) res.file = dat.file;\r\n  res.type = dat.type;\r\n  if (has(dat, \"callback\")) res.callback = dat.callback;\r\n  if (has(dat, \"redraw\")) res.redraw = dat.redraw;\r\n  if (has(dat, \"save\")) res.save = dat.save;\r\n  Celestial.data.push(res);\r\n};\r\n\r\nCelestial.remove = function(i) {\r\n  if (i !== null && i < Celestial.data.length) {\r\n    return Celestial.data.splice(i,1);\r\n  }\r\n};\r\n\r\nCelestial.clear = function() {\r\n  Celestial.data = [];\r\n};\r\n\r\nCelestial.addCallback = function(dat) {\r\n  Celestial.callback = dat;\r\n  hasCallback = (dat !== null);\r\n};\r\n\r\nCelestial.runCallback = function(dat) {\r\n  hasCallback = false; // avoid recursion\r\n  Celestial.callback();\r\n  hasCallback = true;\r\n};\r\n//load data and transform coordinates\r\n\r\n\r\nfunction getPoint(coords, trans) {\r\n  return transformDeg(coords, euler[trans]);\r\n}\r\n \r\nfunction getData(d, trans) {\r\n  if (trans === \"equatorial\") return d;\r\n\r\n  var leo = euler[trans],\r\n      f = d.features;\r\n\r\n  for (var i=0; i<f.length; i++)\r\n    f[i].geometry.coordinates = translate(f[i], leo);\r\n  \r\n  return d;\r\n}\r\n\r\nfunction getPlanets(d) {\r\n  var res = [];\r\n  \r\n  for (var key in d) {\r\n    if (!has(d, key)) continue;\r\n    if (cfg.planets.which.indexOf(key) === -1) continue;\r\n    var dat = Kepler().id(key);\r\n    if (has(d[key], \"parent\")) dat.parentBody(d[key].parent);\r\n    dat.elements(d[key].elements[0]).params(d[key]);\r\n    if (key === \"ter\") \r\n      Celestial.origin = dat;\r\n    else res.push(dat);\r\n  }\r\n  //res.push(Kepler().id(\"sol\"));\r\n  //res.push(Kepler().id(\"lun\"));\r\n  return res;\r\n}\r\n\r\n\r\nfunction getPlanet(id, dt) {\r\n  dt = dt || Celestial.date();\r\n  if (!Celestial.origin) return;\r\n\r\n  var o = Celestial.origin(dt).spherical(), res;\r\n     \r\n  Celestial.container.selectAll(\".planet\").each(function(d) {\r\n    if (id === d.id()) {\r\n      res = d(dt).equatorial(o);\r\n    }\r\n  });\r\n  return res;\r\n}\r\n\r\nfunction getConstellationList(d) {\r\n  var res = {},\r\n      f = d.features;\r\n      \r\n  for (var i=0; i<f.length; i++) {\r\n    res[f[i].id] = {\r\n      center: f[i].properties.display.slice(0,2),\r\n      scale: f[i].properties.display[2]\r\n    };\r\n  }\r\n  return res;\r\n}\r\n\r\nfunction getMwbackground(d) {\r\n  // geoJson object to darken the mw-outside, prevent greying of whole map in some orientations \r\n  var res = {'type': 'FeatureCollection', 'features': [ {'type': 'Feature', \r\n              'geometry': { 'type': 'MultiPolygon', 'coordinates' : [] }\r\n            }]};\r\n\r\n  // reverse the polygons, inside -> outside\r\n  var l1 = d.features[0].geometry.coordinates[0];\r\n  res.features[0].geometry.coordinates[0] = [];\r\n  for (var i=0; i<l1.length; i++) {\r\n    res.features[0].geometry.coordinates[0][i] = l1[i].slice().reverse();\r\n  }\r\n\r\n  return res;\r\n}\r\n\r\nfunction getTimezones() {\r\n  \r\n}\r\n\r\nfunction translate(d, leo) {\r\n  var res = [];\r\n  switch (d.geometry.type) {\r\n    case \"Point\": res = transformDeg(d.geometry.coordinates, leo); break;\r\n    case \"LineString\": res.push(transLine(d.geometry.coordinates, leo)); break;\r\n    case \"MultiLineString\": res = transMultiLine(d.geometry.coordinates, leo); break;\r\n    case \"Polygon\": res.push(transLine(d.geometry.coordinates[0], leo)); break;\r\n    case \"MultiPolygon\": res.push(transMultiLine(d.geometry.coordinates[0], leo)); break;\r\n  }\r\n  \r\n  return res;\r\n}\r\n\r\nfunction getGridValues(type, loc) {\r\n  var lines = [];\r\n  if (!loc) return [];\r\n  if (!isArray(loc)) loc = [loc];\r\n  //center, outline, values\r\n  for (var i=0; i < loc.length; i++) {\r\n    switch (loc[i]) {\r\n      case \"center\": \r\n        if (type === \"lat\")\r\n          lines = lines.concat(getLine(type, cfg.center[0], \"N\"));\r\n        else\r\n          lines = lines.concat(getLine(type, cfg.center[1], \"S\")); \r\n        break;\r\n      case \"outline\": \r\n        if (type === \"lon\") { \r\n          lines = lines.concat(getLine(type, cfg.center[1]-89.99, \"S\"));\r\n          lines = lines.concat(getLine(type, cfg.center[1]+89.99, \"N\"));\r\n        } else {\r\n\t\t\t\t\t// TODO: hemi\r\n          lines = lines.concat(getLine(type, cfg.center[0]-179.99, \"E\"));\r\n          lines = lines.concat(getLine(type, cfg.center[0]+179.99, \"W\"));\r\n        }\r\n        break;\r\n      default: if (isNumber(loc[i])) {\r\n        if (type === \"lat\")\r\n          lines = lines.concat(getLine(type, loc[i], \"N\"));\r\n        else\r\n          lines = lines.concat(getLine(type, loc[i], \"S\")); \r\n        break;        \r\n      }\r\n    }\r\n  }\r\n  //return [{coordinates, value, orientation}, ...]\r\n  return jsonGridValues(lines);\r\n}\r\n\r\nfunction jsonGridValues(lines) {\r\n  var res = [];\r\n  for (var i=0; i < lines.length; i++) {\r\n    var f = {type: \"Feature\", \"id\":i, properties: {}, geometry:{type:\"Point\"}};\r\n    f.properties.value = lines[i].value;\r\n    f.properties.orientation = lines[i].orientation;\r\n    f.geometry.coordinates = lines[i].coordinates;\r\n    res.push(f);\r\n  }\r\n  return res;\r\n}\r\n\r\nfunction getLine(type, loc, orient) {\r\n  var min, max, step, val, coord,\r\n      tp = type,\r\n      res = [],\r\n      lr = loc;\r\n  if (cfg.transform === \"equatorial\" && tp === \"lon\") tp = \"ra\";\r\n  \r\n  if (tp === \"ra\") {\r\n    min = 0; max = 23; step = 1;\r\n  } else if (tp === \"lon\") {\r\n    min = 0; max = 350; step = 10;    \r\n  } else {\r\n    min = -80; max = 80; step = 10;    \r\n  }\r\n  for (var i=min; i<=max; i+=step) {\r\n    var o = orient;\r\n    if (tp === \"lat\") {\r\n      coord = [lr, i];\r\n      val = i.toString() + \"\\u00b0\";\r\n      if (i < 0) o += \"S\"; else o += \"N\";\r\n    } else if (tp === \"ra\") {\r\n      coord = [i * 15, lr];\r\n      val = i.toString() + \"\\u02b0\";\r\n    } else {\r\n      coord = [i, lr];\r\n      val = i.toString() + \"\\u00b0\";\r\n    }\r\n  \r\n    res.push({coordinates: coord, value: val, orientation: o});\r\n  }\r\n  return res;\r\n}\r\n\r\nfunction transLine(c, leo) {\r\n  var line = [];\r\n  \r\n  for (var i=0; i<c.length; i++)\r\n    line.push(transformDeg(c[i], leo));\r\n  \r\n  return line;\r\n}\r\n\r\nfunction transMultiLine(c, leo) {\r\n  var lines = [];\r\n  \r\n  for (var i=0; i<c.length; i++)\r\n    lines.push(transLine(c[i], leo));\r\n  \r\n  return lines;\r\n}\r\n\r\nCelestial.getData = getData;\r\nCelestial.getPoint = getPoint;\r\nCelestial.getPlanet = getPlanet;\r\n\r\n// Central configuration object\r\nvar globalConfig = {};\r\n\r\n//Defaults\r\nvar settings = { \r\n  width: 0,     // Default width; height is determined by projection\r\n  projection: \"aitoff\",  // Map projection used: airy, aitoff, armadillo, august, azimuthalEqualArea, azimuthalEquidistant, baker, berghaus, boggs, bonne, bromley, collignon, craig, craster, cylindricalEqualArea, cylindricalStereographic, eckert1, eckert2, eckert3, eckert4, eckert5, eckert6, eisenlohr, equirectangular, fahey, foucaut, ginzburg4, ginzburg5, ginzburg6, ginzburg8, ginzburg9, gringorten, hammer, hatano, healpix, hill, homolosine, kavrayskiy7, lagrange, larrivee, laskowski, loximuthal, mercator, miller, mollweide, mtFlatPolarParabolic, mtFlatPolarQuartic, mtFlatPolarSinusoidal, naturalEarth, nellHammer, orthographic, patterson, polyconic, rectangularPolyconic, robinson, sinusoidal, stereographic, times, twoPointEquidistant, vanDerGrinten, vanDerGrinten2, vanDerGrinten3, vanDerGrinten4, wagner4, wagner6, wagner7, wiechel, winkel3\r\n  projectionRatio: null, // Optional override for default projection ratio\r\n  transform: \"equatorial\", // Coordinate transformation: equatorial (default), ecliptic, galactic, supergalactic\r\n  center: null,       // Initial center coordinates in equatorial transformation [hours, degrees, degrees], \r\n                      // otherwise [degrees, degrees, degrees], 3rd parameter is orientation, null = default center\r\n  geopos: null,       // optional initial geographic position [lat,lon] in degrees, overrides center\r\n  follow: \"zenith\",   // on which coordinates to center the map, default: zenith, if location enabled, otherwise center\r\n  orientationfixed: true,  // Keep orientation angle the same as center[2]\r\n  zoomlevel: null,    // initial zoom level 0...zoomextend; 0|null = default, 1 = 100%, 0 < x <= zoomextend\r\n  zoomextend: 10,     // maximum zoom level\r\n  adaptable: true,    // Sizes are increased with higher zoom-levels\r\n  interactive: true,  // Enable zooming and rotation with mousewheel and dragging\r\n  disableAnimations: false, // Disable all animations\r\n  form: false,        // Display settings form\r\n  location: false,    // Display location settings, deprecated, use formFields\r\n  // Set visiblity for each group of fields of the form\r\n  formFields: {\"location\": true, \"general\": true, \"stars\": true, \"dsos\": true, \"constellations\": true, \"lines\": true, \"other\": true, download: false},\r\n  advanced: true,     // Display fewer form fields if false\r\n  daterange: [],      // Calender date range; null: displaydate-+10; [n<100]: displaydate-+n; [yr]: yr-+10; \r\n                      // [yr, n<100]: [yr-n, yr+n]; [yr0, yr1]\r\n  settimezone: true,  // Automatcally set time zone when geolocation changes\r\n  timezoneid: \"AEFXZPQ3FDPF\", // Account ID for TimeZoneDB service, please get your own\r\n  controls: true,     // Display zoom controls\r\n  lang: \"\",           // Global language override for names, any name setting that has the chosen language available\r\n                      // Default: desig or empty string for designations, other languages as used anywhere else\r\n  culture: \"\",        // Constellation lines, default \"iau\"\r\n  container: \"celestial-map\",   // ID of parent element, e.g. div\r\n  datapath: \"data/\",  // Path/URL to data files, empty = subfolder 'data'\r\n  stars: {\r\n    show: true,    // Show stars\r\n    limit: 6,      // Show only stars brighter than limit magnitude\r\n    colors: true,  // Show stars in spectral colors, if not use fill-style\r\n    style: { fill: \"#ffffff\", opacity: 1 }, // Default style for stars\r\n    designation: true, // Show star names (Bayer, Flamsteed, Variable star, Gliese or designation, \r\n                       // i.e. whichever of the previous applies first); may vary with culture setting\r\n    designationType: \"desig\",  // Which kind of name is displayed as designation (fieldname in starnames.json)\r\n    designationStyle: { fill: \"#ddddbb\", font: \"11px 'Palatino Linotype', Georgia, Times, 'Times Roman', serif\", align: \"left\", baseline: \"top\" },\r\n    designationLimit: 2.5,  // Show only names for stars brighter than nameLimit\r\n    propername: false,   // Show proper name (if present)\r\n    propernameType: \"name\", // Field in starnames.json that contains proper name; may vary with culture setting\r\n    propernameStyle: { fill: \"#ddddbb\", font: \"13px 'Palatino Linotype', Georgia, Times, 'Times Roman', serif\", align: \"right\", baseline: \"bottom\" },\r\n    propernameLimit: 1.5,  // Show proper names for stars brighter than propernameLimit\r\n    size: 7,       // Scale size (radius) of star circle in pixels\r\n    exponent: -0.28, // Scale exponent for star size, larger = more linear\r\n    data: \"stars.6.json\" // Data source for stellar data\r\n  },\r\n  dsos: {\r\n    show: true,    // Show Deep Space Objects \r\n    limit: 6,      // Show only DSOs brighter than limit magnitude\r\n    colors: true,  // Show DSOs in symbol colors if true, use style setting below if false\r\n    style: { fill: \"#cccccc\", stroke: \"#cccccc\", width: 2, opacity: 1 }, // Default style for dsos\r\n    names: true,   // Show DSO names\r\n    namesType: \"desig\",  // Type of displayed name: desig, name, or 15 different language codes from dsonames.json\r\n    nameStyle: { fill: \"#cccccc\", font: \"11px 'Lucida Sans Unicode', 'DejaVu Sans', Helvetica, Arial, serif\", align: \"left\", baseline: \"bottom\" },\r\n    nameLimit: 4,  // Show only names for DSOs brighter than nameLimit\r\n    size: null,    // Optional seperate scale size for DSOs, null = stars.size\r\n    exponent: 1.4, // Scale exponent for DSO size, larger = more non-linear\r\n    data: \"dsos.bright.json\",  // Data source for DSOs\r\n    symbols: {  // DSO symbol styles\r\n      gg: {shape: \"circle\", fill: \"#ff0000\"},                                 // Galaxy cluster\r\n      g:  {shape: \"ellipse\", fill: \"#ff0000\"},                                // Generic galaxy\r\n      s:  {shape: \"ellipse\", fill: \"#ff0000\"},                                // Spiral galaxy\r\n      s0: {shape: \"ellipse\", fill: \"#ff0000\"},                                // Lenticular galaxy\r\n      sd: {shape: \"ellipse\", fill: \"#ff0000\"},                                // Dwarf galaxy\r\n      e:  {shape: \"ellipse\", fill: \"#ff0000\"},                                // Elliptical galaxy\r\n      i:  {shape: \"ellipse\", fill: \"#ff0000\"},                                // Irregular galaxy\r\n      oc: {shape: \"circle\", fill: \"#ff9900\", stroke: \"#ff9900\", width: 2},    // Open cluster\r\n      gc: {shape: \"circle\", fill: \"#ff9900\"},                                 // Globular cluster\r\n      en: {shape: \"square\", fill: \"#ff00cc\"},                                 // Emission nebula\r\n      bn: {shape: \"square\", fill: \"#ff00cc\"},                                 // Generic bright nebula\r\n      sfr:{shape: \"square\", fill: \"#cc00ff\"},                                 // Star forming region\r\n      rn: {shape: \"square\", fill: \"#0000ff\"},                                 // Reflection nebula\r\n      pn: {shape: \"diamond\", fill: \"#00cccc\"},                                // Planetary nebula \r\n      snr:{shape: \"diamond\", fill: \"#ff00cc\"},                                // Supernova remnant\r\n      dn: {shape: \"square\", fill: \"#999999\", stroke: \"#999999\", width: 2},    // Dark nebula \r\n      pos:{shape: \"marker\", fill: \"#cccccc\", stroke: \"#cccccc\", width: 1.5}   // Generic marker\r\n    }\r\n  },\r\n  constellations: {\r\n    show: true,    // Show constellations \r\n    names: true,   // Show constellation names \r\n    namesType: \"desig\",   // What kind of name to show (default 3 letter designations) all options: name, desig, \r\n                         // lat, en, ar, cn, cz, ee, fi, fr, de, gr, il, it, jp, kr, in, ir, ru, es, tr \r\n    nameStyle: { fill:\"#cccc99\", align: \"center\", baseline: \"middle\", opacity:0.8, \r\n                 font: [\"14px 'Lucida Sans Unicode', 'DejaVu Sans', Helvetica, Arial, sans-serif\",  // Different fonts for brighter &\r\n                        \"12px 'Lucida Sans Unicode', 'DejaVu Sans', Helvetica, Arial, sans-serif\",  // darker constellations\r\n                        \"11px 'Lucida Sans Unicode', 'DejaVu Sans', Helvetica, Arial, sans-serif\"]},\r\n    lines: true,   // Show constellation lines \r\n    lineStyle: { stroke: \"#cccccc\", width: 1.5, opacity: 0.6 },\r\n    bounds: false,  // Show constellation boundaries \r\n    boundStyle: { stroke: \"#ccff00\", width: 1.0, opacity: 0.8, dash: [4,4] }\r\n  },\r\n  mw: {\r\n    show: true,    // Show Milky Way as filled polygons \r\n    style: { fill: \"#ffffff\", opacity: \"0.15\" } // style for each MW-layer (5 on top of each other)\r\n  },\r\n  lines: {\r\n    graticule: { show: true, stroke: \"#cccccc\", width: 0.6, opacity: 0.8,      // Show graticule lines \r\n\t\t\t// grid values: \"outline\", \"center\", or [lat,...] specific position\r\n      lon: {pos: [], fill: \"#eee\", font: \"10px 'Lucida Sans Unicode', Helvetica, Arial, sans-serif\"}, \r\n\t\t\t// grid values: \"outline\", \"center\", or [lon,...] specific position\r\n\t\t  lat: {pos: [], fill: \"#eee\", font: \"10px 'Lucida Sans Unicode', Helvetica, Arial, sans-serif\"}},\r\n    equatorial: { show: true, stroke: \"#aaaaaa\", width: 1.3, opacity: 0.7 },    // Show equatorial plane \r\n    ecliptic: { show: true, stroke: \"#66cc66\", width: 1.3, opacity: 0.7 },      // Show ecliptic plane \r\n    galactic: { show: false, stroke: \"#cc6666\", width: 1.3, opacity: 0.7 },     // Show galactic plane \r\n    supergalactic: { show: false, stroke: \"#cc66cc\", width: 1.3, opacity: 0.7 } // Show supergalactic plane \r\n   //mars: { show: false, stroke:\"#cc0000\", width:1.3, opacity:.7 }\r\n  }, // Background style\r\n  background: { \r\n    fill: \"#000000\", \r\n    opacity: 1, \r\n    stroke: \"#000000\", // Outline\r\n    width: 1.5 \r\n  }, \r\n  horizon: {  //Show horizon marker, if geo-position and date-time is set\r\n    show: false, \r\n    stroke: \"#cccccc\", // Line\r\n    width: 1.0, \r\n    fill: \"#000000\", // Area below horizon\r\n    opacity: 0.4\r\n  },  \r\n  daylight: {  //Show approximate state of sky at selected time\r\n    show: false\r\n  },\r\n  planets: {  //Show planet locations, if date-time is set\r\n    show: false, \r\n    // 3-letter designations of all solar system objects that should be displayed\r\n    which: [\"sol\", \"mer\", \"ven\", \"ter\", \"lun\", \"mar\", \"jup\", \"sat\", \"ura\", \"nep\", \"cer\", \"plu\"],\r\n    // Symbols as unicode codepoints, letter abbreviations and colors to be displayed\r\n    symbols: {\r\n      \"sol\": {symbol: \"\\u2609\", letter:\"Su\", fill: \"#ffff00\", size: 12},\r\n      \"mer\": {symbol: \"\\u263f\", letter:\"Me\", fill: \"#cccccc\"},\r\n      \"ven\": {symbol: \"\\u2640\", letter:\"V\", fill: \"#eeeecc\"},\r\n      \"ter\": {symbol: \"\\u2295\", letter:\"T\", fill: \"#00ccff\"},\r\n      \"lun\": {symbol: \"\\u25cf\", letter:\"L\", fill: \"#ffffff\", size: 12},\r\n      \"mar\": {symbol: \"\\u2642\", letter:\"Ma\", fill: \"#ff6600\"},\r\n      \"cer\": {symbol: \"\\u26b3\", letter:\"C\", fill: \"#cccccc\"},\r\n      \"ves\": {symbol: \"\\u26b6\", letter:\"Ma\", fill: \"#cccccc\"},\r\n      \"jup\": {symbol: \"\\u2643\", letter:\"J\", fill: \"#ffaa33\"},\r\n      \"sat\": {symbol: \"\\u2644\", letter:\"Sa\", fill: \"#ffdd66\"},\r\n      \"ura\": {symbol: \"\\u2645\", letter:\"U\", fill: \"#66ccff\"},\r\n      \"nep\": {symbol: \"\\u2646\", letter:\"N\", fill: \"#6666ff\"},\r\n      \"plu\": {symbol: \"\\u2647\", letter:\"P\", fill: \"#aaaaaa\"},\r\n      \"eri\": {symbol: \"\\u26aa\", letter:\"E\", fill: \"#eeeeee\"}\r\n    },\r\n    // Style options for planetary symbols\r\n    symbolStyle: { fill: \"#cccccc\", opacity:1, font: \"bold 20px 'DejaVu Sans Mono', 'Arial Unicode MS', sans-serif\", align: \"center\", baseline: \"middle\" },\r\n    symbolType: \"symbol\",  // Type of planetary symbol to be displayed: 'symbol', 'letter' or 'disk'\r\n    names: false,  // Show name next to symbol\r\n    // Style options for planetary names\r\n    nameStyle: { fill: \"#cccccc\", font: \"14px 'Lucida Sans Unicode', 'DejaVu Sans', sans-serif\", align: \"right\", baseline: \"top\" },\r\n    namesType: \"en\"  // Language in which the name is displayed, options desig, ar, cn, en, fr, de, gr, il, in, it, jp, lat, ru, es\r\n  },\r\n  set: function(cfg) {  // Override defaults with values of cfg\r\n    var prop, key, config = {}, res = {};\r\n    if (Object.entries(globalConfig).length === 0) Object.assign(config, this);\r\n    else Object.assign(config, globalConfig);\r\n    if (!cfg) return config; \r\n    for (prop in config) {\r\n      if (!has(config, prop)) continue; \r\n      //if (typeof(config[prop]) === 'function'); \r\n      if (!has(cfg, prop) || cfg[prop] === null) { \r\n        res[prop] = config[prop]; \r\n      } else if (config[prop] === null || config[prop].constructor != Object ) {\r\n        res[prop] = cfg[prop];\r\n      } else {\r\n        res[prop] = {};\r\n        for (key in config[prop]) {\r\n          if (has(cfg[prop], key)) {\r\n            res[prop][key] = cfg[prop][key];\r\n          } else {\r\n            res[prop][key] = config[prop][key];\r\n          }            \r\n        }\r\n      }\r\n    }\r\n    res.constellations.nameStyle.font = arrayfy(res.constellations.nameStyle.font);\r\n    res.constellations.nameStyle.opacity = arrayfy(res.constellations.nameStyle.opacity);\r\n    res.constellations.nameStyle.fill = arrayfy(res.constellations.nameStyle.fill);\r\n    res.constellations.lineStyle.width = arrayfy(res.constellations.lineStyle.width);\r\n    res.constellations.lineStyle.opacity = arrayfy(res.constellations.lineStyle.opacity);\r\n    res.constellations.lineStyle.stroke = arrayfy(res.constellations.lineStyle.stroke);\r\n    \r\n    Object.assign(globalConfig, res);\r\n    return res;\r\n  },\r\n  applyDefaults: function(cfg) {\r\n    var res = {};\r\n    Object.assign(res, globalConfig);\r\n    // Nothing works without these\r\n    res.stars.size = res.stars.size || 7;  \r\n    res.stars.exponent = res.stars.exponent || -0.28;\r\n    if (!res.center || res.center.length <= 0) res.center = [0,0,0];\r\n    res.datapath = res.datapath || \"\";\r\n    res.datapath = res.datapath.replace(/([^\\/]$)/, \"$1\\/\");\r\n    if (!res.transform || res.transform === \"\") res.transform = \"equatorial\";\r\n    // If no recognized language/culture settings, assume defaults\r\n    //if (!res.lang || res.lang.search(/^de|es$/) === -1) res.lang = \"name\";\r\n    //Set all poss. names to cfg.lang if not english\r\n    if (!res.culture || res.culture.search(/^cn$/) === -1) res.culture = \"iau\";\r\n\r\n    if (cfg) {\r\n      // Adapt legacy name parameters\r\n      if (has(cfg, \"stars\")) {\r\n        // names -> designation\r\n        if (has(cfg.stars, \"names\")) res.stars.designation = cfg.stars.names;\r\n        if (has(cfg.stars, \"namelimit\")) res.stars.designationLimit = cfg.stars.namelimit;\r\n        if (has(cfg.stars, \"namestyle\")) Object.assign(res.stars.designationStyle, cfg.stars.namestyle);    \r\n        // proper -> propername\r\n        if (has(cfg.stars, \"proper\")) res.stars.propername = cfg.stars.proper;\r\n        if (has(cfg.stars, \"propernamelimit\")) res.stars.propernameLimit = cfg.stars.propernamelimit;\r\n        if (has(cfg.stars, \"propernamestyle\")) Object.assign(res.stars.propernameStyle, cfg.stars.propernamestyle);\r\n      }\r\n\r\n      if (has(cfg, \"dsos\")) {\r\n        // names, desig -> namesType\r\n        //if (has(cfg.dsos, \"names\") && cfg.dsos.names === true) res.dsos.namesType = \"name\";\r\n        if (has(cfg.dsos, \"desig\") && cfg.dsos.desig === true) res.dsos.namesType = \"desig\";\r\n        if (has(cfg.dsos, \"namelimit\")) res.dsos.nameLimit = cfg.dsos.namelimit;\r\n        if (has(cfg.dsos, \"namestyle\")) Object.assign(res.dsos.nameStyle, cfg.dsos.namestyle);    \r\n      }\r\n      \r\n      if (has(cfg, \"constellations\")) {\r\n        // names, desig -> namesType\r\n        if (has(cfg.constellations, \"show\") && cfg.constellations.show === true) res.constellations.names = true;\r\n        //if (has(cfg.constellations, \"names\") && cfg.constellations.names === true) res.constellations.namesType = \"name\";\r\n        if (has(cfg.constellations, \"desig\") && cfg.constellations.desig === true) res.constellations.namesType = \"desig\";\r\n        if (res.constellations.namesType === \"latin\") res.constellations.namesType = \"la\";\r\n        if (res.constellations.namesType === \"iau\") res.constellations.namesType = \"name\";\r\n        if (has(cfg.constellations, \"namestyle\")) Object.assign(res.constellations.nameStyle, cfg.constellations.namestyle);\r\n        if (has(cfg.constellations, \"linestyle\")) Object.assign(res.constellations.lineStyle, cfg.constellations.linestyle);\r\n        if (has(cfg.constellations, \"boundstyle\")) Object.assign(res.constellations.boundStyle, cfg.constellations.boundstyle);\r\n      }\r\n\r\n      if (has(cfg, \"planets\")) {\r\n        if (has(cfg.planets, \"style\")) Object.assign(res.planets.style, cfg.planets.symbolStyle);      \r\n      }\r\n    }\r\n    //Assign default name types if none given\r\n    if (!res.stars.designationType || res.stars.designationType === \"\") res.stars.designationType = \"desig\";\r\n    if (!has(formats.starnames[res.culture].designation, res.stars.designationType)) res.designationType = \"desig\";\r\n    if (!res.stars.propernameType || res.stars.propernameType === \"\") res.stars.propernameType = \"name\";\r\n    if (!has(formats.starnames[res.culture].propername, res.stars.propernameType)) res.propernameType = \"name\";\r\n    if (!res.dsos.namesType || res.dsos.namesType === \"\") res.dsos.namesType = \"desig\";\r\n    if (!res.constellations.namesType || res.constellations.namesType === \"\") res.constellations.namesType = \"desig\";\r\n    if (!has(formats.constellations[res.culture].names, res.constellations.namesType)) res.constellations.namesType = \"name\";\r\n    if (!res.planets.symbolType || res.planets.symbolType === \"\") res.planets.symbolType = \"symbol\";\r\n    if (!res.planets.namesType || res.planets.namesType === \"\") res.planets.namesType = \"desig\";\r\n    if (!has(formats.planets[res.culture].names, res.planets.namesType)) res.planets.namesType = \"desig\";\r\n    //Expand all parameters that can be arrays into arrays, no need to test it later\r\n    res.constellations.nameStyle.font = arrayfy(res.constellations.nameStyle.font);\r\n    res.constellations.nameStyle.opacity = arrayfy(res.constellations.nameStyle.opacity);\r\n    res.constellations.nameStyle.fill = arrayfy(res.constellations.nameStyle.fill);\r\n    res.constellations.lineStyle.width = arrayfy(res.constellations.lineStyle.width);\r\n    res.constellations.lineStyle.opacity = arrayfy(res.constellations.lineStyle.opacity);\r\n    res.constellations.lineStyle.stroke = arrayfy(res.constellations.lineStyle.stroke);\r\n\r\n    Object.assign(globalConfig, res);\r\n    return res; \r\n  }\r\n};\r\n\r\nfunction arrayfy(o) {\r\n  var res;\r\n  if (!isArray(o)) return [o, o, o];  //It saves some work later, OK?\r\n  if (o.length >= 3) return o;\r\n  if (o.length === 1) return [o[0], o[0], o[0]];\r\n  if (o.length === 2) return [o[0], o[1], o[1]];\r\n}\r\n\r\nCelestial.settings = function () { return settings; };\r\n\r\n//b-v color index to rgb color value scale\r\nvar bvcolor = \r\n  d3.scale.quantize().domain([3.347, -0.335]) //main sequence <= 1.7\r\n    .range([ '#ff4700', '#ff4b00', '#ff4f00', '#ff5300', '#ff5600', '#ff5900', '#ff5b00', '#ff5d00', '#ff6000', '#ff6300', '#ff6500', '#ff6700', '#ff6900', '#ff6b00', '#ff6d00', '#ff7000', '#ff7300', '#ff7500', '#ff7800', '#ff7a00', '#ff7c00', '#ff7e00', '#ff8100', '#ff8300', '#ff8506', '#ff870a', '#ff8912', '#ff8b1a', '#ff8e21', '#ff9127', '#ff932c', '#ff9631', '#ff9836', '#ff9a3c', '#ff9d3f', '#ffa148', '#ffa34b', '#ffa54f', '#ffa753', '#ffa957', '#ffab5a', '#ffad5e', '#ffb165', '#ffb269', '#ffb46b', '#ffb872', '#ffb975', '#ffbb78', '#ffbe7e', '#ffc184', '#ffc489', '#ffc78f', '#ffc892', '#ffc994', '#ffcc99', '#ffce9f', '#ffd1a3', '#ffd3a8', '#ffd5ad', '#ffd7b1', '#ffd9b6', '#ffdbba', '#ffddbe', '#ffdfc2', '#ffe1c6', '#ffe3ca', '#ffe4ce', '#ffe8d5', '#ffe9d9', '#ffebdc', '#ffece0', '#ffefe6', '#fff0e9', '#fff2ec', '#fff4f2', '#fff5f5', '#fff6f8', '#fff9fd', '#fef9ff', '#f9f6ff', '#f6f4ff', '#f3f2ff', '#eff0ff', '#ebeeff', '#e9edff', '#e6ebff', '#e3e9ff', '#e0e7ff', '#dee6ff', '#dce5ff', '#d9e3ff', '#d7e2ff', '#d3e0ff', '#c9d9ff', '#bfd3ff', '#b7ceff', '#afc9ff', '#a9c5ff', '#a4c2ff', '#9fbfff', '#9bbcff']);\r\n \r\n/* Default parameters for each supported projection\r\n     arg: constructor argument, if any \r\n     scale: scale parameter so that they all have ~equal width, normalized to 1024 pixels\r\n     ratio: width/height ratio, 2.0 if none\r\n     clip: projection clipped to 90 degrees from center, otherwise to antimeridian\r\n*/\r\nvar projections = {\r\n  \"airy\": {n:\"Airy’s Minimum Error\", arg:Math.PI/2, scale:360, ratio:1.0, clip:true},\r\n  \"aitoff\": {n:\"Aitoff\", arg:null, scale:162},\r\n  \"armadillo\": {n:\"Armadillo\", arg:0, scale:250}, \r\n  \"august\": {n:\"August\", arg:null, scale:94, ratio:1.4},\r\n  \"azimuthalEqualArea\": {n:\"Azimuthal Equal Area\", arg:null, scale:340, ratio:1.0, clip:true},\r\n  \"azimuthalEquidistant\": {n:\"Azimuthal Equidistant\", arg:null, scale:320, ratio:1.0, clip:true},\r\n  \"baker\": {n:\"Baker Dinomic\", arg:null, scale:160, ratio:1.4},\r\n  \"berghaus\": {n:\"Berghaus Star\", arg:0, scale:320, ratio:1.0, clip:true},\r\n  \"boggs\": {n:\"Boggs Eumorphic\", arg:null, scale:170},\r\n  \"bonne\": {n:\"Bonne\", arg:Math.PI/2.5, scale:225, ratio:0.88},\r\n  \"bromley\": {n:\"Bromley\", arg:null, scale:162},\r\n//  \"butterfly\": {n:\"Butterfly\", arg:null, scale:31, ratio:1.1, clip:true},\r\n  \"cassini\": {n:\"Cassini\", arg:null, scale:325, ratio:1.0, clip:true},\r\n  \"collignon\": {n:\"Collignon\", arg:null, scale:100, ratio:2.6},\r\n  \"craig\": {n:\"Craig Retroazimuthal\", arg:0, scale:310, ratio:1.5, clip:true},\r\n  \"craster\": {n:\"Craster Parabolic\", arg:null, scale:160},\r\n  \"cylindricalEqualArea\": {n:\"Cylindrical Equal Area\", arg:Math.PI/6, scale:190, ratio:2.3},\r\n  \"cylindricalStereographic\": {n:\"Cylindrical Stereographic\", arg:Math.PI/4, scale:230, ratio:1.3},\r\n  \"eckert1\": {n:\"Eckert I\", arg:null, scale:175},\r\n  \"eckert2\": {n:\"Eckert II\", arg:null, scale:175},\r\n  \"eckert3\": {n:\"Eckert III\", arg:null, scale:190},\r\n  \"eckert4\": {n:\"Eckert IV\", arg:null, scale:190},\r\n  \"eckert5\": {n:\"Eckert V\", arg:null, scale:182},\r\n  \"eckert6\": {n:\"Eckert VI\", arg:null, scale:182},\r\n  \"eisenlohr\": {n:\"Eisenlohr\", arg:null, scale:102},\r\n  \"equirectangular\": {n:\"Equirectangular\", arg:null, scale:165},\r\n  \"fahey\": {n:\"Fahey\", arg:null, scale:196, ratio:1.4},\r\n  \"mtFlatPolarParabolic\": {n:\"Flat Polar Parabolic\", arg:null, scale:175},\r\n  \"mtFlatPolarQuartic\": {n:\"Flat Polar Quartic\", arg:null, scale:230, ratio:1.65},\r\n  \"mtFlatPolarSinusoidal\": {n:\"Flat Polar Sinusoidal\", arg:null, scale:175, ratio:1.9},\r\n  \"foucaut\": {n:\"Foucaut\", arg:null, scale:142},\r\n  \"ginzburg4\": {n:\"Ginzburg IV\", arg:null, scale:180, ratio:1.7},\r\n  \"ginzburg5\": {n:\"Ginzburg V\", arg:null, scale:196, ratio:1.55},\r\n  \"ginzburg6\": {n:\"Ginzburg VI\", arg:null, scale:190, ratio:1.4},\r\n  \"ginzburg8\": {n:\"Ginzburg VIII\", arg:null, scale:205, ratio:1.3},\r\n  \"ginzburg9\": {n:\"Ginzburg IX\", arg:null, scale:190, ratio:1.4},\r\n  //\"guyou\": {n:\"Guyou\", arg:null, scale:160, ratio:2, clip:true},\r\n  //\"bonne\": {n:\"Heart\", arg:Math.PI/2.5, scale:225, ratio:0.88},\r\n  \"homolosine\": {n:\"Goode Homolosine\", arg:null, scale:160, ratio:2.2},\r\n  \"hammer\": {n:\"Hammer\", arg:2, scale:180},\r\n  \"hatano\": {n:\"Hatano\", arg:null, scale:186},\r\n  \"healpix\": {n:\"HEALPix\", arg:1, scale:320, ratio:1.2},\r\n  \"hill\": {n:\"Hill Eucyclic\", arg:2, scale:190, ratio:1.1},\r\n  \"kavrayskiy7\": {n:\"Kavrayskiy VII\", arg:null, scale:185, ratio:1.75},\r\n  \"lagrange\": {n:\"Lagrange\", arg:Math.PI/4, scale:88, ratio:1.6, clip:false},\r\n  \"larrivee\": {n:\"l'Arrivée\", arg:null, scale:160, ratio:1.25},\r\n  \"laskowski\": {n:\"Laskowski Tri-Optimal\", arg:null, scale:165, ratio:1.7},\r\n  \"loximuthal\": {n:\"Loximuthal\", arg:Math.PI/4, scale:175, ratio:1.8},\r\n  \"mercator\": {n:\"Mercator\", arg:null, scale:160, ratio:1.3},\r\n  \"miller\": {n:\"Miller\", arg:null, scale:160, ratio:1.5},\r\n  \"mollweide\": {n:\"Mollweide\", arg:null, scale:180},\r\n  \"naturalEarth\": {n:\"Natural Earth\", arg:null, scale:185, ratio:1.85},\r\n  \"nellHammer\": {n:\"Nell Hammer\", arg:null, scale:160, ratio:2.6},\r\n  \"orthographic\": {n:\"Orthographic\", arg:null, scale:480, ratio:1.0, clip:true},\r\n  \"patterson\": {n:\"Patterson Cylindrical\", arg:null, scale:160, ratio:1.75},\r\n  \"polyconic\": {n:\"Polyconic\", arg:null, scale:160, ratio:1.3},\r\n  \"quincuncial\": {n:\"Quincuncial\", arg:null, scale:160, ratio:1.3},\r\n  \"rectangularPolyconic\": {n:\"Rectangular Polyconic\", arg:0, scale:160, ratio:1.65},\r\n  \"robinson\": {n:\"Robinson\", arg:null, scale:160},\r\n  \"sinusoidal\": {n:\"Sinusoidal\", arg:null, scale:160, ratio:2},\r\n  \"stereographic\": {n:\"Stereographic\", arg:null, scale:500, ratio:1.0, clip:true},\r\n  \"times\": {n:\"Times\", arg:null, scale:210, ratio:1.4}, \r\n  \"twoPointEquidistant\": {n:\"Two-Point Equidistant\", arg:Math.PI/2, scale:320, ratio:1.15, clip:true},\r\n  \"vanDerGrinten\": {n:\"van Der Grinten\", arg:null, scale:160, ratio:1.0}, \r\n  \"vanDerGrinten2\": {n:\"van Der Grinten II\", arg:null, scale:160, ratio:1.0},\r\n  \"vanDerGrinten3\": {n:\"van Der Grinten III\", arg:null, scale:160, ratio:1.0},\r\n  \"vanDerGrinten4\": {n:\"van Der Grinten IV\", arg:null, scale:160, ratio:1.6},\r\n  \"wagner4\": {n:\"Wagner IV\", arg:null, scale:185},\r\n  \"wagner6\": {n:\"Wagner VI\", arg:null, scale:160},\r\n  \"wagner7\": {n:\"Wagner VII\", arg:null, scale:190, ratio:1.8},\r\n  \"wiechel\": {n:\"Wiechel\", arg:null, scale:360, ratio:1.0, clip:true},\r\n  \"winkel3\": {n:\"Winkel Tripel\", arg:null, scale:196, ratio:1.7}\r\n};\r\n\r\nCelestial.projections = function () { return projections; };\r\n\r\nvar formats = {\r\n  \"starnames\": {\r\n    // \"name\":\"\",\"bayer\":\"\",\"flam\":\"\",\"var\":\"\",\"gl\":\"\",\"hd\":\"\",\"c\":\"\",\"desig\":\"\"\r\n    \"iau\": {\r\n      \"designation\": {\r\n        \"desig\": \"Designation\",     \r\n        \"bayer\": \"Bayer\",\r\n        \"flam\": \"Flamsteed\",\r\n        \"var\": \"Variable\",\r\n        \"gl\": \"Gliese\",\r\n        \"hd\": \"Draper\",\r\n        \"hip\": \"Hipparcos\"},\r\n      \"propername\": {\r\n        \"name\": \"IAU Name\",\r\n        \"ar\": \"Arabic\", \r\n        \"zh\": \"Chinese\",\r\n        \"en\": \"English\",\r\n        \"fi\": \"Finnish\", \r\n        \"fr\": \"French\", \r\n        \"de\": \"German\",\r\n        \"el\": \"Greek\", \r\n        \"he\": \"Hebrew\", \r\n        \"hi\": \"Hindi\", \r\n        \"it\": \"Italian\", \r\n        \"ja\": \"Japanese\", \r\n        \"ko\": \"Korean\", \r\n        \"la\": \"Latin\",\r\n        \"fa\": \"Persian\", \r\n        \"ru\": \"Russian\", \r\n        \"es\": \"Spanish\",\r\n        \"tr\": \"Turkish\"}\r\n    },\r\n    \"cn\": {\r\n      \"propername\": {\r\n        \"name\": \"Proper name\",\r\n        \"en\": \"English\",\r\n        \"pinyin\": \"Pinyin\"},\r\n      \"designation\": { \r\n        \"desig\": \"IAU Designation\"}\r\n    }\r\n  },\r\n  \"constellations\": {\r\n    \"iau\": {\r\n      \"names\": {\r\n        \"desig\": \"Designation\",\r\n        \"name\": \"IAU Name\",\r\n        \"ar\": \"Arabic\", \r\n        \"zh\": \"Chinese\",\r\n        \"cz\": \"Czech\", \r\n        \"en\": \"English\",\r\n        \"ee\": \"Estonian\", \r\n        \"fi\": \"Finnish\", \r\n        \"fr\": \"French\", \r\n        \"de\": \"German\",\r\n        \"el\": \"Greek\", \r\n        \"he\": \"Hebrew\",\r\n        \"hi\": \"Hindi\", \r\n        \"it\": \"Italian\", \r\n        \"ja\": \"Japanese\", \r\n        \"sw\": \"Kiswahili\",\r\n        \"ko\": \"Korean\", \r\n        \"la\": \"Latin\",\r\n        \"fa\": \"Persian\", \r\n        \"ru\": \"Russian\", \r\n        \"es\": \"Spanish\",\r\n        \"tr\": \"Turkish\"}\r\n    },\r\n    \"cn\": {\r\n      \"names\": {\r\n        \"name\": \"Proper name\",\r\n        \"en\": \"English\",\r\n        \"pinyin\": \"Pinyin\"}\r\n    }             \r\n  },\r\n  \"planets\": {\r\n    \"iau\": {\r\n      \"symbol\": {\r\n        \"symbol\": \"\\u263e Symbol\",\r\n        \"letter\": \"\\u216c Letter\",\r\n        \"disk\": \"\\u25cf Disk\"},\r\n      \"names\": {\r\n        \"desig\": \"Designation\",\r\n        \"ar\": \"Arabic\",\r\n        \"zh\": \"Chinese\",\r\n        \"en\": \"English\",\r\n        \"fr\": \"French\",\r\n        \"de\": \"German\",\r\n        \"el\": \"Greek\",\r\n        \"he\": \"Hebrew\",\r\n        \"hi\": \"Hindi\",\r\n        \"it\": \"Italian\",\r\n        \"ja\": \"Japanese\",\r\n        \"ko\": \"Korean\", \r\n        \"la\": \"Latin\",\r\n        \"fa\": \"Persian\", \r\n        \"ru\": \"Russian\",\r\n        \"es\": \"Spanish\"}\r\n    },\r\n    \"cn\": {\r\n      \"symbol\": {\r\n        \"symbol\": \"\\u263e Symbol\",\r\n        \"letter\": \"\\u216c Letter\",\r\n        \"disk\": \"\\u25cf Disk\"},\r\n      \"names\": {\r\n        \"desig\": \"Designation\",\r\n        \"name\": \"Chinese\",\r\n        \"pinyin\": \"Pinyin\",\r\n        \"en\": \"English\"}\r\n    }\r\n  },\r\n  \"dsonames\": {\r\n    \"iau\": {\r\n      \"names\": {\r\n        \"desig\": \"Designation\",\r\n        \"name\": \"English\",\r\n        \"ar\": \"Arabic\", \r\n        \"zh\": \"Chinese\",\r\n        \"fi\": \"Finnish\", \r\n        \"fr\": \"French\", \r\n        \"de\": \"German\",\r\n        \"el\": \"Greek\", \r\n        //\"he\": \"Hebrew\",\r\n        \"hi\": \"Hindi\", \r\n        \"it\": \"Italian\", \r\n        \"ja\": \"Japanese\", \r\n        \"ko\": \"Korean\", \r\n        \"la\": \"Latin\",\r\n        \"fa\": \"Persian\", \r\n        \"ru\": \"Russian\", \r\n        \"es\": \"Spanish\",\r\n        \"tr\": \"Turkish\"}\r\n    },\r\n    \"cn\": {\r\n      \"names\": {\r\n        \"desig\": \"Designation\",\r\n        \"name\": \"Chinese\",\r\n        \"pinyin\": \"Pinyin\",\r\n        \"en\": \"English\"}\r\n    }\r\n  }\r\n};\r\n\r\nvar formats_all = {\r\n  \"iau\": Object.keys(formats.constellations.iau.names).concat(Object.keys(formats.planets.iau.names)).filter( function(value, index, self) { return self.indexOf(value) === index; } ),\r\n  \"cn\":  Object.keys(formats.constellations.cn.names).concat(Object.keys(formats.starnames.cn.propername)).filter( function(value, index, self) { return self.indexOf(value) === index; } )\r\n};\r\n\r\nvar Canvas = {}; \r\n\r\nCanvas.symbol = function () {\r\n  // parameters and default values\r\n  var type = d3.functor(\"circle\"), \r\n      size = d3.functor(64), \r\n      age = d3.functor(Math.PI), //crescent shape 0..2Pi\r\n      color = d3.functor(\"#fff\"),  \r\n      text = d3.functor(\"\"),  \r\n      padding = d3.functor([2,2]),  \r\n      pos;\r\n  \r\n  function canvas_symbol(context) {\r\n    draw_symbol[type()](context);\r\n  }\r\n  \r\n  var draw_symbol = {\r\n    \"circle\": function(ctx) {\r\n      var s = Math.sqrt(size()), \r\n          r = s/2;\r\n      ctx.arc(pos[0], pos[1], r, 0, 2 * Math.PI);\r\n      ctx.closePath();\r\n      return r;\r\n    },\r\n    \"square\": function(ctx) {\r\n      var s = Math.sqrt(size()), \r\n          r = s/1.7;\r\n      ctx.moveTo(pos[0]-r, pos[1]-r);\r\n      ctx.lineTo(pos[0]+r, pos[1]-r);\r\n      ctx.lineTo(pos[0]+r, pos[1]+r);\r\n      ctx.lineTo(pos[0]-r, pos[1]+r);\r\n      ctx.closePath();\r\n      return r;\r\n    },\r\n    \"diamond\": function(ctx) {\r\n      var s = Math.sqrt(size()), \r\n          r = s/1.5;\r\n      ctx.moveTo(pos[0], pos[1]-r);\r\n      ctx.lineTo(pos[0]+r, pos[1]);\r\n      ctx.lineTo(pos[0], pos[1]+r);\r\n      ctx.lineTo(pos[0]-r, pos[1]);\r\n      ctx.closePath();\r\n      return r;\r\n    },\r\n    \"triangle\": function(ctx) {\r\n      var s = Math.sqrt(size()), \r\n          r = s/Math.sqrt(3);\r\n      ctx.moveTo(pos[0], pos[1]-r);\r\n      ctx.lineTo(pos[0]+r, pos[1]+r);\r\n      ctx.lineTo(pos[0]-r, pos[1]+r);\r\n      ctx.closePath();\r\n      return r;\r\n    },\r\n    \"ellipse\": function(ctx) {\r\n      var s = Math.sqrt(size()), \r\n          r = s/2;\r\n      ctx.save();\r\n      ctx.translate(pos[0], pos[1]);\r\n      ctx.scale(1.6, 0.8); \r\n      ctx.beginPath();\r\n      ctx.arc(0, 0, r, 0, 2 * Math.PI); \r\n      ctx.closePath();\r\n      ctx.restore();      \r\n      return r;\r\n    },\r\n    \"marker\": function(ctx) {\r\n      var s = Math.sqrt(size()), \r\n          r = s/2;\r\n      ctx.moveTo(pos[0], pos[1]-r);\r\n      ctx.lineTo(pos[0], pos[1]+r);\r\n      ctx.moveTo(pos[0]-r, pos[1]);\r\n      ctx.lineTo(pos[0]+r, pos[1]);\r\n      ctx.closePath();\r\n      return r;\r\n    },\r\n    \"cross-circle\": function(ctx) {\r\n      var s = Math.sqrt(size()), \r\n          r = s/2;\r\n      ctx.moveTo(pos[0], pos[1]-s);\r\n      ctx.lineTo(pos[0], pos[1]+s);\r\n      ctx.moveTo(pos[0]-s, pos[1]);\r\n      ctx.lineTo(pos[0]+s, pos[1]);\r\n      ctx.stroke();\r\n      ctx.beginPath();\r\n      ctx.moveTo(pos[0], pos[1]);\r\n      ctx.arc(pos[0], pos[1], r, 0, 2 * Math.PI);    \r\n      ctx.closePath();\r\n      return r;\r\n    },\r\n    \"stroke-circle\": function(ctx) {\r\n      var s = Math.sqrt(size()), \r\n          r = s/2;\r\n      ctx.moveTo(pos[0], pos[1]-s);\r\n      ctx.lineTo(pos[0], pos[1]+s);\r\n      ctx.stroke();\r\n      ctx.beginPath();\r\n      ctx.moveTo(pos[0], pos[1]);\r\n      ctx.arc(pos[0], pos[1], r, 0, 2 * Math.PI);    \r\n      ctx.closePath();\r\n      return r;\r\n    }, \r\n    \"crescent\": function(ctx) {\r\n      var s = Math.sqrt(size()), \r\n          r = s/2,\r\n          ag = age(),\r\n          ph = 0.5 * (1 - Math.cos(ag)),\r\n          e = 1.6 * Math.abs(ph - 0.5) + 0.01,\r\n          dir = ag > Math.PI,\r\n          termdir = Math.abs(ph) > 0.5 ? dir : !dir,\r\n          moonFill = ctx.fillStyle,\r\n          darkFill = ph < 0.157 ? \"#669\" : \"#557\";\r\n      ctx.save();\r\n      ctx.fillStyle = darkFill;\r\n      ctx.beginPath();\r\n      ctx.moveTo(pos[0], pos[1]);\r\n      ctx.arc(pos[0], pos[1], r, 0, 2 * Math.PI);    \r\n      ctx.closePath();\r\n      ctx.fill();\r\n      ctx.fillStyle = moonFill;\r\n      ctx.beginPath();\r\n      ctx.moveTo(pos[0], pos[1]);\r\n      ctx.arc(pos[0], pos[1], r, -Math.PI/2, Math.PI/2, dir); \r\n      ctx.scale(e, 1);\r\n      ctx.arc(pos[0]/e, pos[1], r, Math.PI/2, -Math.PI/2, termdir); \r\n      ctx.closePath();\r\n      ctx.fill();\r\n      ctx.restore();\r\n      \r\n      return r;\r\n    } \r\n  };\r\n\r\n  \r\n  canvas_symbol.type = function(_) {\r\n    if (!arguments.length) return type; \r\n    type = d3.functor(_);\r\n    return canvas_symbol;\r\n  };\r\n  canvas_symbol.size = function(_) {\r\n    if (!arguments.length) return size; \r\n    size = d3.functor(_);\r\n    return canvas_symbol;\r\n  };\r\n  canvas_symbol.age = function(_) {\r\n    if (!arguments.length) return age; \r\n    age = d3.functor(_);\r\n    return canvas_symbol;\r\n  };\r\n  canvas_symbol.text = function(_) {\r\n    if (!arguments.length) return text; \r\n    text = d3.functor(_);\r\n    return canvas_symbol;\r\n  };\r\n  canvas_symbol.position = function(_) {\r\n    if (!arguments.length) return; \r\n    pos = _;\r\n    return canvas_symbol;\r\n  };\r\n\r\n  return canvas_symbol;\r\n};\r\n\r\nCelestial.Canvas = Canvas;\r\n\r\n\r\n/*var color = \"#fff\", angle = 0, align = \"center\", baseline = \"middle\", font = \"10px sans-serif\", padding = [0,0], aPos, sText;\r\n\r\ncanvas.text = function () {\r\n\r\n  function txt(ctx){\r\n    ctx.fillStyle = color;\r\n    ctx.textAlign = align;\r\n    ctx.textBaseline = baseline;\r\n    \r\n    //var pt = projection(d.geometry.coordinates);\r\n    if (angle) {\r\n      canvas.save();     \r\n      canvas.translate(aPos[0], aPos[1]);\r\n      canvas.rotate(angle); \r\n      canvas.fillText(sText, 0, 0);\r\n      canvas.restore();     \r\n    } else\r\n      canvas.fillText(sText, aPos[0], aPos[1]);\r\n  }\r\n  \r\n  txt.angle = function(x) {\r\n    if (!arguments.length) return angle * 180 / Math.PI;\r\n    color = x  * Math.PI / 180;\r\n    return txt;\r\n  };  \r\n  txt.color = function(s) {\r\n    if (!arguments.length) return color;\r\n    color = s;\r\n    return txt;\r\n  };  \r\n  txt.align = function(s) {\r\n    if (!arguments.length) return align;\r\n    align = s;\r\n    return txt;\r\n  };\r\n  txt.baseline = function(s) {\r\n    if (!arguments.length) return baseline;\r\n    baseline = s;\r\n    return txt;\r\n  };\r\n  txt.padding = function(a) {\r\n    if (!arguments.length) return padding;\r\n    padding = a;\r\n    return txt;\r\n  };\r\n  txt.text = function(s) {\r\n    if (!arguments.length) return sText;\r\n    sText = s;\r\n    return txt;\r\n  };\r\n  txt.font = function(s) {\r\n    if (!arguments.length) return font;\r\n    font = s;\r\n    return txt;\r\n  };\r\n  txt.style = function(o) {\r\n    if (!arguments.length) return;\r\n    if (o.fill) color = o.fill;\r\n    if (o.font) font = o.font;\r\n    return txt;\r\n  }; \r\n  \r\n}\r\n\r\n  function ctxPath(d) {\r\n    var pt;\r\n    //d.map( function(axe, i) {\r\n    context.beginPath();\r\n    for (var i = 0; i < d.length; i++) {\r\n      pt = projection(d[i]);\r\n      if (i === 0)\r\n        context.moveTo(pt[0], pt[1]);\r\n      else\r\n        context.lineTo(pt[0], pt[1]);\r\n    }\r\n    context.fill();\r\n  }\r\n  \r\n\r\n  function ctxText(d, ang) {\r\n    var pt = projection(d.geometry.coordinates);\r\n    if (ang) {\r\n      canvas.save();     \r\n      canvas.translate(pt[0], pt[1]);\r\n      canvas.rotate(Math.PI/2); \r\n      canvas.fillText(txt, 0, 0);\r\n      canvas.restore();     \r\n    } else\r\n      canvas.fillText(d.properties.txt, pt[0], pt[1]);\r\n  }\r\n  \r\n\r\n*/\r\nfunction $(id) { return document.querySelector(parentElement + \" #\" + id); }\r\nfunction px(n) { return n + \"px\"; } \r\nfunction Round(x, dg) { return(Math.round(Math.pow(10,dg)*x)/Math.pow(10,dg)); }\r\nfunction sign(x) { return x ? x < 0 ? -1 : 1 : 0; }\r\nfunction pad(n) { return n < 10 ? '0' + n : n; }\r\n\r\n\r\nfunction has(o, key) { return o !== null && hasOwnProperty.call(o, key); }\r\nfunction when(o, key, val) { return o !== null && hasOwnProperty.call(o, key) ? o[key] : val; }\r\nfunction isNumber(n) { return n !== null && !isNaN(parseFloat(n)) && isFinite(n); }\r\nfunction isArray(o) { return o !== null && Object.prototype.toString.call(o) === \"[object Array]\"; }\r\nfunction isObject(o) { var type = typeof o;  return type === 'function' || type === 'object' && !!o; }\r\nfunction isFunction(o) { return typeof o == 'function' || false; }\r\nfunction isValidDate(d) { return d && d instanceof Date && !isNaN(d); }\r\nfunction fileExists(url) {\r\n  var http = new XMLHttpRequest();\r\n  http.open('HEAD', url, false);\r\n  http.send();\r\n  return http.status != 404;\r\n}\r\n\r\nfunction findPos(o) {\r\n  var l = 0, t = 0;\r\n  if (o.offsetParent) {\r\n    do {\r\n      l += o.offsetLeft;\r\n      t += o.offsetTop;\r\n    } while ((o = o.offsetParent) !== null);\r\n  }\r\n  return [l, t];\r\n}\r\n\r\nfunction hasParent(t, id){\r\n  while(t.parentNode){\r\n    if(t.id === id) return true;\r\n    t = t.parentNode;\r\n  }\r\n  return false;\r\n}\r\n\r\nfunction attach(node, event, func) {\r\n  if (node.addEventListener) node.addEventListener(event, func, false);\r\n  else node.attachEvent(\"on\" + event, func); \r\n}\r\n\r\nfunction stopPropagation(e) {\r\n  if (typeof e.stopPropagation != \"undefined\") e.stopPropagation();\r\n  else e.cancelBubble = true;\r\n}\r\n\r\nfunction dateDiff(dt1, dt2, type) {\r\n  var diff = dt2.valueOf() - dt1.valueOf(),\r\n      tp = type || \"d\";\r\n  switch (tp) {\r\n    case 'y': case 'yr': diff /= 31556926080; break;\r\n    case 'm': case 'mo': diff /= 2629800000; break;\r\n    case 'd': case 'dy': diff /= 86400000; break;\r\n    case 'h': case 'hr': diff /= 3600000; break;\r\n    case 'n': case 'mn': diff /= 60000; break;\r\n    case 's': case 'sec': diff /= 1000; break;\r\n    case 'ms': break;    \r\n  }\r\n  return Math.floor(diff);\r\n}\r\n\r\nfunction dateParse(s) {\r\n  if (!s) return; \r\n  var t = s.split(\".\");\r\n  if (t.length < 1) return; \r\n  t = t[0].split(\"-\");\r\n  t[0] = t[0].replace(/\\D/g, \"\");\r\n  if (!t[0]) return; \r\n  t[1] = t[1] ? t[1].replace(/\\D/g, \"\") : \"1\";\r\n  t[2] = t[2] ? t[2].replace(/\\D/g, \"\") : \"1\";\r\n  //Fraction -> h:m:s\r\n  return new Date(Date.UTC(t[0], t[1]-1, t[2]));\r\n}\r\n\r\n\r\nfunction interpolateAngle(a1, a2, t) {\r\n  a1 = (a1*deg2rad +τ) % τ;\r\n  a2 = (a2*deg2rad + τ) % τ;\r\n  if (Math.abs(a1 - a2) > Math.PI) {\r\n    if (a1 > a2) a1 = a1 - τ;\r\n    else if (a2 > a1) a2 = a2 - τ;\r\n  }\r\n  return d3.interpolateNumber(a1/deg2rad, a2/deg2rad);\r\n}\r\n\r\nvar Trig = {\r\n  sinh: function (val) { return (Math.pow(Math.E, val)-Math.pow(Math.E, -val))/2; },\r\n  cosh: function (val) { return (Math.pow(Math.E, val)+Math.pow(Math.E, -val))/2; },\r\n  tanh: function (val) { return 2.0 / (1.0 + Math.exp(-2.0 * val)) - 1.0; },\r\n  asinh: function (val) { return Math.log(val + Math.sqrt(val * val + 1)); },\r\n  acosh: function (val) { return Math.log(val + Math.sqrt(val * val - 1)); },\r\n  normalize0: function(val) {  return ((val + Math.PI*3) % (Math.PI*2)) - Math.PI; },\r\n  normalize: function(val) {  return ((val + Math.PI*2) % (Math.PI*2)); },  \r\n  cartesian: function(p) {\r\n    var ϕ = p[0], θ = halfπ - p[1], r = p[2];\r\n    return {\"x\": r * Math.sin(θ) * Math.cos(ϕ), \"y\": r * Math.sin(θ) * Math.sin(ϕ), \"z\": r * Math.cos(θ)};\r\n  },\r\n  spherical: function(p) {\r\n    var r = Math.sqrt(p.x * p.x + p.y * p.y + p.z * p.z),\r\n        θ = Math.atan(p.y / p.x),\r\n        ϕ = Math.acos(p.z / r);\r\n    return  [θ / deg2rad, ϕ / deg2rad, r];\r\n  },\r\n  distance: function(p1, p2) {\r\n    return Math.acos(Math.sin(p1[1])*Math.sin(p2[1]) + Math.cos(p1[1])*Math.cos(p2[1])*Math.cos(p1[0]-p2[0]));\r\n  }\r\n};\r\n\r\nvar epsilon = 1e-6, \r\n    halfPi =  Math.PI / 2, \r\n    quarterPi =  Math.PI / 4, \r\n    tau =  Math.PI * 2;\r\n    \r\nfunction cartesian(spherical) {\r\n  var lambda = spherical[0], phi = spherical[1], cosPhi = Math.cos(phi);\r\n  return [cosPhi * Math.cos(lambda), cosPhi * Math.sin(lambda), Math.sin(phi)];\r\n}\r\n\r\nfunction cartesianCross(a, b) {\r\n  return [a[1] * b[2] - a[2] * b[1], a[2] * b[0] - a[0] * b[2], a[0] * b[1] - a[1] * b[0]];\r\n}\r\n\r\nfunction cartesianNormalizeInPlace(d) {\r\n  var l = Math.sqrt(d[0] * d[0] + d[1] * d[1] + d[2] * d[2]);\r\n  d[0] /= l; d[1] /= l; d[2] /= l;\r\n}\r\n\r\nfunction longitude(point) {\r\n  if (Math.abs(point[0]) <= Math.PI)\r\n    return point[0];\r\n  else\r\n    return sign(point[0]) * ((Math.abs(point[0]) +  Math.PI) % tau -  Math.PI);\r\n}\r\n\r\nfunction poligonContains(polygon, point) {\r\n  var lambda = longitude(point),\r\n      phi = point[1],\r\n      sinPhi = Math.sin(phi),\r\n      normal = [Math.sin(lambda), -Math.cos(lambda), 0],\r\n      angle = 0,\r\n      winding = 0,\r\n      sum = 0;\r\n\r\n  if (sinPhi === 1) phi = halfPi + epsilon;\r\n  else if (sinPhi === -1) phi = -halfPi - epsilon;\r\n\r\n  for (var i = 0, n = polygon.length; i < n; ++i) {\r\n    if (!(m = (ring = polygon[i]).length)) continue;\r\n    var ring,\r\n        m,\r\n        point0 = ring[m - 1],\r\n        lambda0 = longitude(point0),\r\n        phi0 = point0[1] / 2 + quarterPi,\r\n        sinPhi0 = Math.sin(phi0),\r\n        cosPhi0 = Math.cos(phi0),\r\n        point1, cosPhi1, sinPhi1, lambda1;\r\n\r\n    for (var j = 0; j < m; ++j, lambda0 = lambda1, sinPhi0 = sinPhi1, cosPhi0 = cosPhi1, point0 = point1) {\r\n      point1 = ring[j];\r\n      lambda1 = longitude(point1);\r\n      var phi1 = point1[1] / 2 + quarterPi;\r\n      sinPhi1 = Math.sin(phi1);\r\n      cosPhi1 = Math.cos(phi1);\r\n      var delta = lambda1 - lambda0,\r\n          sign = delta >= 0 ? 1 : -1,\r\n          absDelta = sign * delta,\r\n          antimeridian = absDelta > Math.PI,\r\n          k = sinPhi0 * sinPhi1;\r\n\r\n      sum += Math.atan2(k * sign * Math.sin(absDelta), cosPhi0 * cosPhi1 + k * Math.cos(absDelta));\r\n      angle += antimeridian ? delta + sign * tau : delta;\r\n\r\n      if ((antimeridian ^ lambda0) >= (lambda ^ lambda1) >= lambda) {\r\n        var arc = cartesianCross(cartesian(point0), cartesian(point1));\r\n        cartesianNormalizeInPlace(arc);\r\n        var intersection = cartesianCross(normal, arc);\r\n        cartesianNormalizeInPlace(intersection);\r\n        var phiArc = (antimeridian ^ delta >= 0 ? -1 : 1) * Math.asin(intersection[2]);\r\n        if (phi > phiArc || phi === phiArc && (arc[0] || arc[1])) {\r\n          winding += antimeridian ^ delta >= 0 ? 1 : -1;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  return (angle < -epsilon || angle < epsilon && sum < -epsilon) ^ (winding & 1);\r\n}\r\n\r\n//display settings form in div with id \"celestial-form\"\r\nfunction form(cfg) {\r\n  var config = settings.set(cfg); \r\n\r\n  var prj = Celestial.projections(), leo = Celestial.eulerAngles();\r\n  var div = d3.select(parentElement + \" ~ #celestial-form\");\r\n  //if div doesn't exist, create it\r\n  if (div.size() < 1) {\r\n    //var container = (config.container || \"celestial-map\");\r\n    div = d3.select(parentElement).select(function() { return this.parentNode; }).append(\"div\").attr(\"id\", \"celestial-form\");\r\n  }\r\n  var ctrl = div.append(\"div\").attr(\"class\", \"ctrl\");\r\n  var frm = ctrl.append(\"form\").attr(\"id\", \"params\").attr(\"name\", \"params\").attr(\"method\", \"get\").attr(\"action\" ,\"#\");\r\n  \r\n  //Map parameters    \r\n  var col = frm.append(\"div\").attr(\"class\", \"col\").attr(\"id\", \"general\");\r\n  \r\n  col.append(\"label\").attr(\"title\", \"Map width in pixel, 0 indicates full width\").attr(\"for\", \"width\").html(\"Width \");\r\n  col.append(\"input\").attr(\"type\", \"number\").attr(\"maxlength\", \"4\").attr(\"max\", \"20000\").attr(\"min\", \"0\").attr(\"title\", \"Map width\").attr(\"id\", \"width\").attr(\"value\", config.width).on(\"change\", resize);\r\n  col.append(\"span\").html(\"px\");\r\n\r\n  col.append(\"label\").attr(\"title\", \"Map projection, (hemi) indicates hemispherical projection\").attr(\"for\", \"projection\").html(\"Projection\");\r\n  var sel = col.append(\"select\").attr(\"id\", \"projection\").on(\"change\", reproject);\r\n  var selected = 0;\r\n  var list = Object.keys(prj).map( function (key, i) { \r\n    var n = prj[key].clip && prj[key].clip === true ? prj[key].n + \" (hemi)\" : prj[key].n; \r\n    if (key === config.projection) selected = i;\r\n    return {o:key, n:n};\r\n  });\r\n  sel.selectAll('option').data(list).enter().append('option')\r\n     .attr(\"value\", function (d) { return d.o; })\r\n     .text(function (d) { return d.n; });\r\n  sel.property(\"selectedIndex\", selected);\r\n  \r\n  selected = 0;\r\n  col.append(\"label\").attr(\"title\", \"Coordinate space in which the map is displayed\").attr(\"for\", \"transform\").html(\"Coordinates\");\r\n  sel = col.append(\"select\").attr(\"id\", \"transform\").on(\"change\", reload);\r\n  list = Object.keys(leo).map(function (key, i) {\r\n    if (key === config.transform) selected = i;    \r\n    return {o:key, n:key.replace(/^([a-z])/, function(s, m) { return m.toUpperCase(); } )}; \r\n  });\r\n  sel.selectAll(\"option\").data(list).enter().append('option')\r\n     .attr(\"value\", function (d) { return d.o; })\r\n     .text(function (d) { return d.n; });\r\n  sel.property(\"selectedIndex\", selected);\r\n\r\n  col.append(\"br\");\r\n  col.append(\"label\").attr(\"title\", \"Center coordinates long/lat in selected coordinate space\").attr(\"for\", \"centerx\").html(\"Center\");\r\n  col.append(\"input\").attr(\"type\", \"number\").attr(\"id\", \"centerx\").attr(\"title\", \"Center right ascension/longitude\").attr(\"max\", \"24\").attr(\"min\", \"0\").attr(\"step\", \"0.1\").on(\"change\", turn);\r\n  col.append(\"span\").attr(\"id\", \"cxunit\").html(\"h\");\r\n  //addList(\"centerx\", \"ra\");\r\n  \r\n  col.append(\"input\").attr(\"type\", \"number\").attr(\"id\", \"centery\").attr(\"title\", \"Center declination/latitude\").attr(\"max\", \"90\").attr(\"min\", \"-90\").attr(\"step\", \"0.1\").on(\"change\", turn);\r\n  col.append(\"span\").html(\"\\u00b0\");\r\n\r\n  col.append(\"label\").attr(\"title\", \"Orientation\").attr(\"for\", \"centerz\").html(\"Orientation\");\r\n  col.append(\"input\").attr(\"type\", \"number\").attr(\"id\", \"centerz\").attr(\"title\", \"Center orientation\").attr(\"max\", \"180\").attr(\"min\", \"-180\").attr(\"step\", \"0.1\").on(\"change\", turn);\r\n  col.append(\"span\").html(\"\\u00b0\");\r\n\r\n  col.append(\"label\").attr(\"for\", \"orientationfixed\").attr(\"class\", \"advanced\").html(\"Fixed\");\r\n  col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"orientationfixed\").attr(\"class\", \"advanced\").property(\"checked\", config.orientationfixed).on(\"change\", apply);    \r\n\r\n  col.append(\"label\").attr(\"title\", \"Center and zoom in on this constellation\").attr(\"for\", \"constellation\").html(\"Show\");\r\n  col.append(\"select\").attr(\"id\", \"constellation\").on(\"change\", showConstellation);\r\n  \r\n  setCenter(config.center, config.transform);\r\n\r\n  // Stars \r\n  col = frm.append(\"div\").attr(\"class\", \"col\").attr(\"id\", \"stars\");\r\n  \r\n  col.append(\"label\").attr(\"class\", \"header\").attr(\"for\", \"stars-show\").html(\"Stars\");\r\n  col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"stars-show\").property(\"checked\", config.stars.show).on(\"change\", apply);\r\n  \r\n  col.append(\"label\").attr(\"for\", \"stars-limit\").html(\"down to magnitude\");\r\n  col.append(\"input\").attr(\"type\", \"number\").attr(\"id\", \"stars-limit\").attr(\"title\", \"Star display limit (magnitude)\").attr(\"value\", config.stars.limit).attr(\"max\", \"6\").attr(\"min\", \"-1\").attr(\"step\", \"0.1\").on(\"change\", apply);\r\n  \r\n  col.append(\"label\").attr(\"for\", \"stars-colors\").html(\"with spectral colors\");\r\n  col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"stars-colors\").property(\"checked\", config.stars.colors).on(\"change\", apply);\r\n  \r\n  col.append(\"label\").attr(\"for\", \"stars-color\").html(\"or default color \");\r\n  col.append(\"input\").attr(\"type\", \"color\").attr(\"autocomplete\", \"off\").attr(\"id\", \"stars-style-fill\").attr(\"title\", \"Star color\").property(\"value\", config.stars.style.fill).on(\"change\", apply);\r\n\r\n  col.append(\"br\");\r\n  \r\n  var names = formats.starnames[config.culture] || formats.starnames.iau;\r\n  \r\n  for (var fld in names) {\r\n    if (!has(names, fld)) continue;\r\n    var keys = Object.keys(names[fld]);\r\n    if (keys.length > 1) {\r\n      //Select List\r\n      col.append(\"label\").attr(\"for\", \"stars-\" + fld).html(\"Show\");\r\n      \r\n      selected = 0;\r\n      col.append(\"label\").attr(\"title\", \"Type of star name\").attr(\"id\", \"label-propername\").attr(\"for\", \"stars-\" + fld + \"Type\").html(function () { return fld === \"propername\" ? \"proper names\" : \"\"; });\r\n      sel = col.append(\"select\").attr(\"id\", \"stars-\" + fld + \"Type\").attr(\"class\", function () { return fld === \"propername\" ? \"advanced\" : \"\"; }).on(\"change\", apply);\r\n      list = keys.map(function (key, i) {\r\n        if (key === config.stars[fld + \"Type\"]) selected = i;\r\n        return {o:key, n:names[fld][key]}; \r\n      });\r\n      sel.selectAll(\"option\").data(list).enter().append('option')\r\n         .attr(\"value\", function (d) { return d.o; })\r\n         .text(function (d) { return d.n; });\r\n      sel.property(\"selectedIndex\", selected);\r\n\r\n      col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"stars-\" + fld).property(\"checked\", config.stars[fld]).on(\"change\", apply);\r\n    } else if (keys.length === 1) {\r\n      //Simple field\r\n    col.append(\"label\").attr(\"for\", \"stars-\" + fld).html(\" \" + names[fld][keys[0]]);\r\n      col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"stars-\" + fld).property(\"checked\", config.stars[fld]).on(\"change\", apply);\r\n    }    \r\n    col.append(\"label\").attr(\"for\", \"stars-\" + fld + \"Limit\").html(\"down to mag\");\r\n    col.append(\"input\").attr(\"type\", \"number\").attr(\"id\", \"stars-\" + fld + \"Limit\").attr(\"title\", \"Star name display limit (magnitude)\").attr(\"value\", config.stars[fld + \"Limit\"]).attr(\"max\", \"6\").attr(\"min\", \"-1\").attr(\"step\", \"0.1\").on(\"change\", apply);\r\n  \r\n  }\r\n\r\n  col.append(\"br\");\r\n\r\n  col.append(\"label\").attr(\"for\", \"stars-size\").attr(\"class\", \"advanced\").html(\"Stellar disk size: base\");\r\n  col.append(\"input\").attr(\"type\", \"number\").attr(\"id\", \"stars-size\").attr(\"class\", \"advanced\").attr(\"title\", \"Size of the displayed star disk; base\").attr(\"value\", config.stars.size).attr(\"max\", \"100\").attr(\"min\", \"0\").attr(\"step\", \"0.1\").on(\"change\", apply);\r\n\r\n  col.append(\"label\").attr(\"for\", \"stars-exponent\").attr(\"class\", \"advanced\").html(\" * e ^ (exponent\");\r\n  col.append(\"input\").attr(\"type\", \"number\").attr(\"id\", \"stars-exponent\").attr(\"class\", \"advanced\").attr(\"title\", \"Size of the displayed star disk; exponent\").attr(\"value\", config.stars.exponent).attr(\"max\", \"3\").attr(\"min\", \"-1\").attr(\"step\", \"0.01\").on(\"change\", apply);\r\n  col.append(\"span\").attr(\"class\", \"advanced\").text(\" * (magnitude + 2))  [* adaptation]\");\r\n  \r\n  enable($form(\"stars-show\"));\r\n  \r\n  // DSOs \r\n  col = frm.append(\"div\").attr(\"class\", \"col\").attr(\"id\", \"dsos\");\r\n  \r\n  col.append(\"label\").attr(\"class\", \"header\").attr(\"title\", \"Deep Space Objects\").attr(\"for\", \"dsos-show\").html(\"DSOs\");\r\n  col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"dsos-show\").property(\"checked\", config.dsos.show).on(\"change\", apply);\r\n  \r\n  col.append(\"label\").attr(\"for\", \"dsos-limit\").html(\"down to mag\");\r\n  col.append(\"input\").attr(\"type\", \"number\").attr(\"id\", \"dsos-limit\").attr(\"title\", \"DSO display limit (magnitude)\").attr(\"value\", config.dsos.limit).attr(\"max\", \"6\").attr(\"min\", \"0\").attr(\"step\", \"0.1\").on(\"change\", apply);\r\n\r\n\r\n  col.append(\"label\").attr(\"for\", \"dsos-colors\").html(\"with symbol colors\");\r\n  col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"dsos-colors\").property(\"checked\", config.dsos.colors).on(\"change\", apply);\r\n  \r\n  col.append(\"label\").attr(\"for\", \"dsos-color\").html(\"or default color \");\r\n  col.append(\"input\").attr(\"type\", \"color\").attr(\"autocomplete\", \"off\").attr(\"id\", \"dsos-style-fill\").attr(\"title\", \"DSO color\").property(\"value\", config.dsos.style.fill).on(\"change\", apply);\r\n\r\n  col.append(\"br\");\r\n  \r\n  names = formats.dsonames[config.culture] || formats.dsonames.iau;\r\n  \r\n  for (fld in names) {\r\n    if (!has(names, fld)) continue;\r\n    var dsoKeys = Object.keys(names[fld]);\r\n    col.append(\"label\").attr(\"for\", \"dsos-\" + fld).html(\"Show\");\r\n      \r\n    selected = 0;\r\n    col.append(\"label\").attr(\"title\", \"Type of DSO name\").attr(\"for\", \"dsos-\" + fld + \"Type\").attr(\"class\", \"advanced\").html(\"\");\r\n    sel = col.append(\"select\").attr(\"id\", \"dsos-\" + fld + \"Type\").attr(\"class\", \"advanced\").on(\"change\", apply);\r\n    list = dsoKeys.map(function (key, i) {\r\n      if (key === config.stars[fld + \"Type\"]) selected = i;    \r\n      return {o:key, n:names[fld][key]}; \r\n    });\r\n    sel.selectAll(\"option\").data(list).enter().append('option')\r\n       .attr(\"value\", function (d) { return d.o; })\r\n       .text(function (d) { return d.n; });\r\n    sel.property(\"selectedIndex\", selected);\r\n\r\n    col.append(\"label\").attr(\"for\", \"dsos-\" + fld).html(\"names\");\r\n    col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"dsos-\" + fld).property(\"checked\", config.dsos[fld]).on(\"change\", apply);\r\n  }    \r\n    \r\n  col.append(\"label\").attr(\"for\", \"dsos-nameLimit\").html(\"down to mag\");\r\n  col.append(\"input\").attr(\"type\", \"number\").attr(\"id\", \"dsos-nameLimit\").attr(\"title\", \"DSO name display limit (magnitude)\").attr(\"value\", config.dsos.nameLimit).attr(\"max\", \"6\").attr(\"min\", \"0\").attr(\"step\", \"0.1\").on(\"change\", apply);\r\n  col.append(\"br\");\r\n\r\n  col.append(\"label\").attr(\"for\", \"dsos-size\").attr(\"class\", \"advanced\").html(\"DSO symbol size: (base\");\r\n  col.append(\"input\").attr(\"type\", \"number\").attr(\"id\", \"dsos-size\").attr(\"class\", \"advanced\").attr(\"title\", \"Size of the displayed symbol: base\").attr(\"value\", config.dsos.size).attr(\"max\", \"100\").attr(\"min\", \"0\").attr(\"step\", \"0.1\").on(\"change\", apply);\r\n\r\n  col.append(\"label\").attr(\"for\", \"dsos-exponent\").attr(\"class\", \"advanced\").html(\" * 2 [* adaptation] - magnitude) ^ exponent\");\r\n  col.append(\"input\").attr(\"type\", \"number\").attr(\"id\", \"dsos-exponent\").attr(\"class\", \"advanced\").attr(\"title\", \"Size of the displayed symbol; exponent\").attr(\"value\", config.dsos.exponent).attr(\"max\", \"3\").attr(\"min\", \"-1\").attr(\"step\", \"0.01\").on(\"change\", apply);\r\n\r\n  enable($form(\"dsos-show\"));\r\n\r\n  // Constellations \r\n  col = frm.append(\"div\").attr(\"class\", \"col\").attr(\"id\", \"constellations\");\r\n  col.append(\"label\").attr(\"class\", \"header\").html(\"Constellations\");\r\n  //col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"constellations-show\").property(\"checked\", config.constellations.show).on(\"change\", apply);\r\n  \r\n  \r\n  names = formats.constellations[config.culture] || formats.constellations.iau;\r\n  \r\n  for (fld in names) {\r\n    if (!has(names, fld)) continue;\r\n    var nameKeys = Object.keys(names[fld]);\r\n    if (nameKeys.length > 1) {\r\n      //Select List\r\n      col.append(\"label\").attr(\"for\", \"constellations-\" + fld).html(\"Show\");\r\n      \r\n      selected = 0;\r\n      col.append(\"label\").attr(\"title\", \"Language of constellation names\").attr(\"for\", \"constellations-\" + fld + \"Type\").attr(\"class\", \"advanced\").html(\"\");\r\n      sel = col.append(\"select\").attr(\"id\", \"constellations-\" + fld + \"Type\").attr(\"class\", \"advanced\").on(\"change\", apply);\r\n      list = nameKeys.map(function (key, i) {\r\n        if (key === config.constellations[fld + \"Type\"]) selected = i;    \r\n        return {o:key, n:names[fld][key]}; \r\n      });\r\n      sel.selectAll(\"option\").data(list).enter().append('option')\r\n         .attr(\"value\", function (d) { return d.o; })\r\n         .text(function (d) { return d.n; });\r\n      sel.property(\"selectedIndex\", selected);\r\n\r\n      col.append(\"label\").attr(\"for\", \"constellations-\" + fld).html(\"names\");\r\n      col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"constellations-\" + fld).property(\"checked\", config.constellations[fld]).on(\"change\", apply);\r\n    } else if (nameKeys.length === 1) {\r\n      //Simple field\r\n      col.append(\"label\").attr(\"for\", \"constellations-\" + fld).attr(\"class\", \"advanced\").html(\" \" + names[fld][nameKeys[0]]);\r\n      col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"constellations-\" + fld).attr(\"class\", \"advanced\").property(\"checked\", config.constellations[fld]).on(\"change\", apply);      \r\n    }      \r\n  }\r\n  col.append(\"label\").attr(\"for\", \"constellations-lines\").html(\" lines\");\r\n  col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"constellations-lines\").property(\"checked\", config.constellations.lines).on(\"change\", apply);\r\n  \r\n  col.append(\"label\").attr(\"for\", \"constellations-bounds\").html(\" boundaries\");\r\n  col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"constellations-bounds\").property(\"checked\", config.constellations.bounds).on(\"change\", apply);\r\n\r\n  enable($form(\"constellations-names\"));\r\n\r\n  // graticules & planes \r\n  col = frm.append(\"div\").attr(\"class\", \"col\").attr(\"id\", \"lines\");\r\n  col.append(\"label\").attr(\"class\", \"header\").html(\"Lines\");\r\n  \r\n  col.append(\"label\").attr(\"title\", \"Latitude/longitude grid lines\").attr(\"for\", \"lines-graticule\").html(\"Graticule\");\r\n  col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"lines-graticule-show\").property(\"checked\", config.lines.graticule.show).on(\"change\", apply);\r\n  \r\n  col.append(\"label\").attr(\"for\", \"lines-equatorial\").html(\"Equator\");\r\n  col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"lines-equatorial-show\").property(\"checked\", config.lines.equatorial.show).on(\"change\", apply);\r\n  \r\n  col.append(\"label\").attr(\"for\", \"lines-ecliptic\").html(\"Ecliptic\");\r\n  col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"lines-ecliptic-show\").property(\"checked\", config.lines.ecliptic.show).on(\"change\", apply);\r\n  \r\n  col.append(\"label\").attr(\"for\", \"lines-galactic\").html(\"Galactic plane\");\r\n  col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"lines-galactic-show\").property(\"checked\", config.lines.galactic.show).on(\"change\", apply);\r\n  \r\n  col.append(\"label\").attr(\"for\", \"lines-supergalactic\").html(\"Supergalactic plane\");\r\n  col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"lines-supergalactic-show\").property(\"checked\", config.lines.supergalactic.show).on(\"change\", apply);\r\n\r\n  // Other\r\n  col = frm.append(\"div\").attr(\"class\", \"col\").attr(\"id\", \"other\");\r\n  col.append(\"label\").attr(\"class\", \"header\").html(\"Other\");\r\n  \r\n  col.append(\"label\").attr(\"for\", \"mw-show\").html(\"Milky Way\");\r\n  col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"mw-show\").property(\"checked\", config.mw.show).on(\"change\", apply);\r\n  \r\n  col.append(\"label\").attr(\"for\", \"mw-style-fill\").attr(\"class\", \"advanced\").html(\" color\");\r\n  col.append(\"input\").attr(\"type\", \"color\").attr(\"id\", \"mw-style-fill\").attr(\"class\", \"advanced\").attr(\"title\", \"Milky Way color\").attr(\"value\", config.mw.style.fill).on(\"change\", apply);\r\n\r\n  col.append(\"label\").attr(\"for\", \"mw-style-opacity\").attr(\"class\", \"advanced\").html(\" opacity\");\r\n  col.append(\"input\").attr(\"type\", \"number\").attr(\"id\", \"mw-style-opacity\").attr(\"class\", \"advanced\").attr(\"title\", \"Transparency of each Milky Way layer\").attr(\"value\", config.mw.style.opacity).attr(\"max\", \"1\").attr(\"min\", \"0\").attr(\"step\", \"0.01\").on(\"change\", apply);\r\n  \r\n  col.append(\"label\").attr(\"for\", \"advanced\").html(\"Advanced options\");\r\n  col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"advanced\").property(\"checked\", config.advanced).on(\"change\", apply);\r\n  \r\n  col.append(\"br\");\r\n  \r\n  col.append(\"label\").attr(\"for\", \"background-fill\").html(\"Background color\");\r\n  col.append(\"input\").attr(\"type\", \"color\").attr(\"id\", \"background-fill\").attr(\"title\", \"Background color\").attr(\"value\", config.background.fill).on(\"change\", apply);\r\n\r\n  col.append(\"label\").attr(\"for\", \"background-opacity\").attr(\"class\", \"advanced\").html(\"opacity\");\r\n  col.append(\"input\").attr(\"type\", \"number\").attr(\"id\", \"background-opacity\").attr(\"class\", \"advanced\").attr(\"title\", \"Background opacity\").attr(\"value\", config.background.opacity).attr(\"max\", \"1\").attr(\"min\", \"0\").attr(\"step\", \"0.01\").on(\"change\", apply);\r\n  \r\n  col.append(\"label\").attr(\"title\", \"Star/DSO sizes are increased with higher zoom-levels\").attr(\"for\", \"adaptable\").attr(\"class\", \"advanced\").html(\"Adaptable object sizes\");\r\n  col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"adaptable\").attr(\"class\", \"advanced\").property(\"checked\", config.adaptable).on(\"change\", apply);\r\n  \r\n  // General language setting\r\n  var langKeys = formats_all[config.culture];\r\n\r\n  selected = 0;\r\n  col.append(\"label\").attr(\"title\", \"General language setting\").attr(\"for\", \"lang\").html(\"Object names \");\r\n  sel = col.append(\"select\").attr(\"id\", \"lang\").on(\"change\", apply);\r\n  list = langKeys.map(function (key, i) {\r\n    if (key === config.lang) selected = i;    \r\n    return {o:key, n:formats.constellations[config.culture].names[key]}; \r\n  });\r\n  list = [{o:\"---\", n:\"(Select language)\"}].concat(list);\r\n  sel.selectAll(\"option\").data(list).enter().append('option')\r\n     .attr(\"value\", function (d) { return d.o; })\r\n     .text(function (d) { return d.n; });\r\n  sel.property(\"selectedIndex\", selected);\r\n   \r\n  col = frm.append(\"div\").attr(\"class\", \"col\").attr(\"id\", \"download\");\r\n  col.append(\"label\").attr(\"class\", \"header\").html(\"Download\");\r\n\r\n  col.append(\"input\").attr(\"type\", \"button\").attr(\"id\", \"download-png\").attr(\"value\", \"PNG Image\").on(\"click\", function() {\r\n    var a = d3.select(\"body\").append(\"a\").node(), \r\n        canvas = document.querySelector(parentElement + ' canvas');\r\n    a.download = getFilename(\".png\");\r\n    a.rel = \"noopener\";\r\n    a.href = canvas.toDataURL('image/png').replace('image/png', 'image/octet-stream');\r\n    a.click();\r\n    d3.select(a).remove();\r\n  });\r\n\r\n  col.append(\"input\").attr(\"type\", \"button\").attr(\"id\", \"download-svg\").attr(\"value\", \"SVG File\").on(\"click\", function() {\r\n    exportSVG(getFilename(\".svg\")); \r\n    return false;\r\n  });\r\n\r\n  setLimits();\r\n  setUnit(config.transform);\r\n  setVisibility(cfg);\r\n  showAdvanced(config.advanced);\r\n  \r\n  function resize() {\r\n    var src = this,\r\n        w = src.value;\r\n    if (testNumber(src) === false) return; \r\n    config.width = w;\r\n    Celestial.resize({width:w});\r\n  }\r\n  \r\n  function reload() {\r\n    var src = this,\r\n        trans = src.value,\r\n        cx = setUnit(trans, config.transform); \r\n    if (cx !== null) config.center[0] = cx; \r\n    config.transform = trans;\r\n    settings.set(config);\r\n    Celestial.reload(config);\r\n  }  \r\n  \r\n  function reproject() {\r\n    var src = this;\r\n    if (!src) return;\r\n    config.projection = src.value; \r\n    settings.set(config);\r\n    Celestial.reproject(config);\r\n  }\r\n  \r\n  function turn() {\r\n    if (testNumber(this) === false) return;   \r\n    if (getCenter() === false) return;\r\n    Celestial.rotate(config);\r\n  }\r\n\r\n  function getCenter() {\r\n    var cx = $form(\"centerx\"), cy = $form(\"centery\"), cz = $form(\"centerz\"),\r\n        rot = [];\r\n\r\n    if (!cx || !cy) return;\r\n\r\n    if (config.transform !== \"equatorial\") config.center[0] = parseFloat(cx.value); \r\n    else { \r\n      var vx = parseFloat(cx.value);\r\n      config.center[0] = vx > 12 ? vx * 15 - 360 : vx * 15;\r\n    }\r\n    config.center[1] = parseFloat(cy.value); \r\n    \r\n    var vz = parseFloat(cz.value); \r\n    config.center[2] = isNaN(vz) ? 0 : vz;\r\n    \r\n    return cx.value !== \"\" && cy.value !== \"\";\r\n  }\r\n    \r\n  function getFilename(ext) {\r\n    var dateFormat = d3.time.format(\"%Y%m%dT%H%M%S%Z\"),\r\n        filename = \"d3-celestial\",\r\n        dt = Celestial.date();\r\n    if (dt) filename += dateFormat(dt);\r\n    return filename + ext;\r\n  }\r\n    \r\n  function showConstellation() {\r\n    var id = this.value;\r\n    if (!id) return;\r\n    showCon(id);\r\n  }\r\n\r\n  function showCon(id) {\r\n    var z, anims = [],\r\n        config = globalConfig;\r\n    if (id === \"---\") { \r\n      Celestial.constellation = null;\r\n      z = Celestial.zoomBy();\r\n      if (z !== 1) {\r\n        anims.push({param:\"zoom\", value:1/z, duration:0});\r\n      }\r\n      Celestial.animate(anims, false);    \r\n      //Celestial.redraw();\r\n      return;\r\n    }\r\n    if (!isObject(Celestial.constellations) || !has(Celestial.constellations, id)) return;\r\n    \r\n    var con = Celestial.constellations[id];\r\n    //transform according to settings\r\n    var center = transformDeg(con.center, euler[config.transform]);\r\n    config.center = center;\r\n    setCenter(config.center, config.transform);\r\n    //config.lines.graticule.lat.pos = [Round(con.center[0])];\r\n    //config.lines.graticule.lon.pos = [Round(con.center[1])];\r\n    //Celestial.apply(config);\r\n\r\n    //if zoomed, zoom out\r\n    z = Celestial.zoomBy();\r\n    if (z !== 1) anims.push({param:\"zoom\", value:1/z, duration:0});\r\n    //rotate\r\n    anims.push({param:\"center\", value:center, duration:0});\r\n    //and zoom in\r\n    var sc = 1 + (360/con.scale); // > 10 ? 10 : con.scale;\r\n    anims.push({param:\"zoom\", value:sc, duration:0});\r\n    Celestial.constellation = id;\r\n    //Object.assign(globalConfig, config);   \r\n    Celestial.animate(anims, false);    \r\n  }\r\n  \r\n  function apply() {\r\n    var value, src = this;\r\n    //Get current configuration\r\n    Object.assign(config, settings.set());\r\n\r\n    switch (src.type) {\r\n      case \"checkbox\": value = src.checked; enable(src); break;\r\n      case \"number\": if (testNumber(src) === false) return; \r\n                     value = parseFloat(src.value); break;\r\n      case \"color\": if (testColor(src) === false) return; \r\n                    value = src.value; break;\r\n      case \"text\": if (src.id.search(/fill$/) === -1) return;\r\n                   if (testColor(src) === false) return; \r\n                   value = src.value; break;\r\n      case \"select-one\": value = src.value; break;\r\n    }\r\n    if (value === null) return;\r\n    set(src.id, value);\r\n    if (src.id === \"dsos-style-fill\") {\r\n      set(\"dsos-style-stroke\", value);\r\n      set(\"dsos-nameStyle-fill\", value);\r\n    } else if (src.id === \"constellations-namesType\") {\r\n      listConstellations();\r\n    } else if (src.id === \"lang\") {\r\n      setLanguage(value);\r\n    } else if (src.id === \"advanced\") {\r\n      showAdvanced(value);\r\n    }\r\n\r\n    getCenter();\r\n    Object.assign(globalConfig, config);\r\n    Celestial.apply(config);\r\n  }\r\n\r\n  function set(prop, val) {\r\n    var a = prop.split(\"-\");\r\n    switch (a.length) {\r\n      case 1: config[a[0]] = val; break;\r\n      case 2: config[a[0]][a[1]] = val; break;\r\n      case 3: config[a[0]][a[1]][a[2]] = val; break;\r\n      default: return;\r\n    }   \r\n  }\r\n  \r\n  \r\n  function setLanguage(lang) {\r\n    Object.assign(config, globalConfig);\r\n    config.lang = lang;\r\n    var keys = [\"constellations\", \"planets\"]; \r\n    for (var i=0; i < keys.length; i++) {\r\n      if (has(formats[keys[i]][config.culture].names, lang)) config[keys[i]].namesType = lang;\r\n      else if (has(formats[keys[i]][config.culture].names, \"desig\")) config[keys[i]].namesType = \"desig\";\r\n      else config[keys[i]].namesType = \"name\";\r\n    }\r\n    if (has(formats.dsonames[config.culture].names, lang)) config.dsos.namesType = lang;\r\n    else config.dsos.namesType = \"desig\";\r\n    if (has(formats.starnames[config.culture].propername, lang)) config.stars.propernameType = lang;\r\n    else config.stars.propernameType = \"desig\";\r\n    //update cont. list\r\n    Object.assign(globalConfig, config);\r\n    update();\r\n    listConstellations();\r\n    return config;\r\n  }\r\n  \r\n    \r\n  function update() {\r\n    // Update all form fields\r\n    d3.selectAll(parentElement + \" ~ #celestial-form input, \" + parentElement + \" ~  #celestial-form select\").each( function(d, i) {\r\n      if (this === undefined) return;\r\n      var id = this.id;\r\n\r\n      // geopos -> lat, lon\r\n      if (id === \"lat\" || id === \"lon\") {\r\n        if (isArray(config.geopos)) this.value = id === \"lat\" ? config.geopos[0] : config.geopos[1];\r\n      // center -> centerx, centery     \r\n      } else if (id.search(/center/) !== -1) {\r\n        if (isArray(config.center)) {\r\n          switch (id) { \r\n            case \"centerx\": this.value = config.center[0]; break;\r\n            case \"centery\": this.value = config.center[1]; break;\r\n            case \"centerz\": this.value = config.center[2] || 0; break;\r\n          }\r\n        }\r\n      } else if (id === \"datetime\" || id === \"hr\" || id === \"min\" || id === \"sec\" || id === \"tz\") {\r\n        return;//skip, timezone?\r\n      } else if (this.type !== \"button\") {\r\n        var value = get(id);      \r\n        switch (this.type) {\r\n          case \"checkbox\": this.checked = value; enable(id); break;\r\n          case \"number\": if (testNumber(this) === false) break;\r\n                         this.value = parseFloat(get(id)); break;\r\n          case \"color\": if (testColor(this) === false) break; \r\n                        this.value = value; break;\r\n          case \"text\": if (id.search(/fill$/) === -1) break;\r\n                       if (testColor(this) === false) break; \r\n                       this.value = value; break;\r\n          case \"select-one\": this.value = value; break;\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  function get(id) {\r\n    var a = id.split(\"-\");\r\n    switch (a.length) {\r\n      case 1: return config[a[0]]; \r\n      case 2: return config[a[0]][a[1]];\r\n      case 3: return config[a[0]][a[1]][a[2]];\r\n      default: return;\r\n    }   \r\n  }\r\n    \r\n  Celestial.updateForm  = update;\r\n  Celestial.showConstellation = showCon;\r\n  Celestial.setLanguage = function(lang) {\r\n    var cfg = settings.set();\r\n    if (formats_all[config.culture].indexOf(lang) !== -1) cfg = setLanguage(lang);\r\n    return cfg;    \r\n  };\r\n}\r\n\r\n\r\n// Dependend fields relations\r\nvar depends = {\r\n  \"stars-show\": [\"stars-limit\", \"stars-colors\", \"stars-style-fill\", \"stars-designation\", \"stars-propername\", \"stars-size\", \"stars-exponent\"],\r\n  \"stars-designation\": [\"stars-designationType\", \"stars-designationLimit\"],\r\n  \"stars-propername\": [\"stars-propernameLimit\", \"stars-propernameType\"],\r\n  \"dsos-show\": [\"dsos-limit\", \"dsos-colors\", \"dsos-style-fill\", \"dsos-names\", \"dsos-size\", \"dsos-exponent\"],\r\n  \"dsos-names\": [\"dsos-namesType\", \"dsos-nameLimit\"],\r\n  \"mw-show\": [\"mw-style-opacity\", \"mw-style-fill\"],\r\n  \"constellations-names\": [\"constellations-namesType\"],\r\n  \"planets-show\": [\"planets-symbolType\", \"planets-names\"],\r\n  \"planets-names\": [\"planets-namesType\"]\r\n};\r\n\r\n// De/activate fields depending on selection of dependencies\r\nfunction enable(source) {\r\n  var fld = source.id, off;\r\n  \r\n  switch (fld) {\r\n    case \"stars-show\": \r\n      off = !$form(fld).checked;\r\n      for (var i=0; i< depends[fld].length; i++) { fldEnable(depends[fld][i], off); }\r\n      /* falls through */\r\n    case \"stars-designation\": \r\n      off = !$form(\"stars-designation\").checked || !$form(\"stars-show\").checked;\r\n      for (i=0; i< depends[\"stars-designation\"].length; i++) { fldEnable(depends[\"stars-designation\"][i], off); }\r\n      /* falls through */\r\n    case \"stars-propername\": \r\n      off = !$form(\"stars-propername\").checked || !$form(\"stars-show\").checked;\r\n      for (i=0; i< depends[\"stars-propername\"].length; i++) { fldEnable(depends[\"stars-propername\"][i], off); }\r\n      break;\r\n    case \"dsos-show\": \r\n      off = !$form(fld).checked;\r\n      for (i=0; i< depends[fld].length; i++) { fldEnable(depends[fld][i], off); }\r\n      /* falls through */\r\n    case \"dsos-names\": \r\n      off = !$form(\"dsos-names\").checked || !$form(\"dsos-show\").checked;      \r\n      for (i=0; i< depends[\"dsos-names\"].length; i++) { fldEnable(depends[\"dsos-names\"][i], off); }\r\n      break;\r\n    case \"planets-show\": \r\n      off = !$form(fld).checked;\r\n      for (i=0; i< depends[fld].length; i++) { fldEnable(depends[fld][i], off); }\r\n      /* falls through */\r\n    case \"planets-names\": \r\n      off = !$form(\"planets-names\").checked || !$form(\"planets-show\").checked;      \r\n      for (i=0; i< depends[\"planets-names\"].length; i++) { fldEnable(depends[\"planets-names\"][i], off); }\r\n      break;\r\n    case \"constellations-names\": \r\n    case \"mw-show\": \r\n      off = !$form(fld).checked;\r\n      for (i=0; i< depends[fld].length; i++) { fldEnable(depends[fld][i], off); }\r\n      break;\r\n  }  \r\n}\r\n\r\n// Enable/disable field d to status off\r\nfunction fldEnable(d, off) {\r\n  var node = $form(d);\r\n  if (!node) return;\r\n  node.disabled = off;\r\n  node.style.color = off ? \"#999\" : \"#000\";  \r\n  node.previousSibling.style.color = off ? \"#999\" : \"#000\";  \r\n  //if (node.previousSibling.previousSibling && node.previousSibling.previousSibling.tagName === \"LABEL\")\r\n  //  node.previousSibling.previousSibling.style.color = off ? \"#999\" : \"#000\";  \r\n}\r\n\r\n// Error notification\r\nfunction popError(nd, err) {\r\n  var p = findPos(nd);\r\n  d3.select(\"#error\").html(err).style( {top:px(p[1] + nd.offsetHeight + 1), left:px(p[0]), opacity:1} );\r\n  nd.focus();\r\n}\r\n\r\n//Check numeric field\r\nfunction testNumber(node) {\r\n  var v, adj = node.id === \"hr\" || node.id === \"min\" || node.id === \"sec\" ? 1 : 0;\r\n  if (node.validity) {\r\n    v = node.validity;\r\n    if (v.typeMismatch || v.badInput) { popError(node, node.title + \": check field value\"); return false; }\r\n    if (v.rangeOverflow || v.rangeUnderflow) { popError(node, node.title + \" must be between \" + (parseInt(node.min) + adj) + \" and \" + (parseInt(node.max) - adj)); return false; }\r\n  } else {\r\n    v = node.value;\r\n    if (!isNumber(v)) { popError(node, node.title + \": check field value\"); return false; }\r\n    v = parseFloat(v);\r\n    if (v < node.min || v > node.max ) { popError(node, node.title + \" must be between \" + (node.min + adj) + \" and \" + (+node.max - adj)); return false; }\r\n  }\r\n  d3.select(\"#error\").style( {top:\"-9999px\", left:\"-9999px\", opacity:0} ); \r\n  return true; \r\n}\r\n\r\n//Check color field\r\nfunction testColor(node) {\r\n  var v;\r\n  if (node.validity) {\r\n    v = node.validity;\r\n    if (v.typeMismatch || v.badInput) { popError(node, node.title + \": check field value\"); return false; }\r\n    if (node.value.search(/^#[0-9A-F]{6}$/i) === -1) { popError(node, node.title + \": not a color value\"); return false; }\r\n  } else {\r\n    v = node.value;\r\n    if (v === \"\") return true;\r\n    if (v.search(/^#[0-9A-F]{6}$/i) === -1) { popError(node, node.title + \": not a color value\"); return false; }\r\n  }\r\n  d3.select(\"#error\").style( {top:\"-9999px\", left:\"-9999px\", opacity:0} );\r\n  return true;\r\n}\r\n\r\nfunction setUnit(trans, old) {\r\n  var cx = $form(\"centerx\");\r\n  if (!cx) return null;\r\n  \r\n  if (old) {\r\n    if (trans === \"equatorial\" && old !== \"equatorial\") {\r\n      cx.value = (cx.value/15).toFixed(1);\r\n      if (cx.value < 0) cx.value += 24;\r\n    } else if (trans !== \"equatorial\" && old === \"equatorial\") {\r\n      cx.value = (cx.value * 15).toFixed(1);\r\n      if (cx.value > 180) cx.value -= 360;\r\n    }\r\n  }\r\n  if (trans === 'equatorial') {\r\n    cx.min = \"0\";\r\n    cx.max = \"24\";\r\n    $form(\"cxunit\").innerHTML = \"h\";\r\n  } else {\r\n    cx.min = \"-180\";\r\n    cx.max = \"180\";\r\n    $form(\"cxunit\").innerHTML = \"\\u00b0\";\r\n  }\r\n  return cx.value;\r\n}\r\n\r\nfunction setCenter(ctr, trans) {\r\n  var cx = $form(\"centerx\"), cy = $form(\"centery\"), cz = $form(\"centerz\");\r\n  if (!cx || !cy) return;\r\n  \r\n  if (ctr === null || ctr.length < 1) ctr = [0,0,0]; \r\n  if (ctr.length <= 2 || ctr[2] === undefined) ctr[2] = 0;\r\n  //config.center = ctr; \r\n  if (trans !== \"equatorial\") cx.value = ctr[0].toFixed(1); \r\n  else cx.value = ctr[0] < 0 ? (ctr[0] / 15 + 24).toFixed(1) : (ctr[0] / 15).toFixed(1); \r\n  \r\n  cy.value = ctr[1].toFixed(1);\r\n  cz.value = ctr[2] !== null ? ctr[2].toFixed(1) : 0;\r\n  settings.set({center: ctr});\r\n}\r\n\r\n// Set max input limits depending on data\r\nfunction setLimits() {\r\n  var t, rx = /\\d+(\\.\\d+)?/g,\r\n      s, d, res = {s:6, d:6},\r\n      config =  Celestial.settings();\r\n\r\n  d = config.dsos.data;\r\n  \r\n  //test dso limit\r\n  t = d.match(rx);\r\n  if (t !== null) {\r\n    res.d = parseFloat(t[t.length-1]);\r\n  }\r\n\r\n  if (res.d !== 6) {\r\n    $form(\"dsos-limit\").max = res.d;\r\n    $form(\"dsos-nameLimit\").max = res.d;\r\n  }\r\n   \r\n   s = config.stars.data;\r\n  \r\n  //test star limit\r\n  t = s.match(rx);\r\n  if (t !== null) {\r\n    res.s = parseFloat(t[t.length-1]);\r\n  }\r\n\r\n  if (res.s != 6) {\r\n    $form(\"stars-limit\").max = res.s;\r\n    $form(\"stars-designationLimit\").max = res.s;\r\n    $form(\"stars-propernameLimit\").max = res.s;\r\n  }\r\n\r\n  return res;\r\n}\r\n\r\n// Options only visible in advanced mode\r\n//\"stars-designationType\", \"stars-propernameType\", \"stars-size\", \"stars-exponent\", \"stars-size\", \"stars-exponent\", //\"constellations-namesType\", \"planets-namesType\", \"planets-symbolType\"\r\nfunction showAdvanced(showit) {\r\n  var vis = showit ? \"inline-block\" : \"none\";\r\n  d3.select(parentElement + \" ~ #celestial-form\").selectAll(\".advanced\").style(\"display\", vis);\r\n  d3.select(parentElement + \" ~ #celestial-form\").selectAll(\"#label-propername\").style(\"display\", showit ? \"none\" : \"inline-block\");\r\n}\r\n\r\n\r\nfunction setVisibility(cfg, which) {\r\n   var vis, fld;\r\n   if (!has(cfg, \"formFields\")) return;\r\n   if (which && has(cfg.formFields, which)) {\r\n     d3.select(parentElement + \" ~ #celestial-form\").select(\"#\" + which).style( {\"display\": \"none\"} );\r\n     return;\r\n   }\r\n   // Special case for backward compatibility\r\n   if (cfg.form === false && cfg.location === true) {\r\n     d3.select(parentElement + \" ~ #celestial-form\").style(\"display\", \"inline-block\");\r\n     for (fld in cfg.formFields) {\r\n      if (!has(cfg.formFields, fld)) continue;\r\n       if (fld === \"location\") continue;\r\n       d3.select(parentElement + \" ~ #celestial-form\").select(\"#\" + fld).style( {\"display\": \"none\"} );     \r\n     }\r\n     return;\r\n   }\r\n   // hide if not desired\r\n   if (cfg.form === false) d3.select(parentElement + \" ~ #celestial-form\").style(\"display\", \"none\"); \r\n\r\n   for (fld in cfg.formFields) {\r\n     if (!has(cfg.formFields, fld)) continue;\r\n     if (fld === \"location\") continue;\r\n     vis = cfg.formFields[fld] === false ? \"none\" : \"block\";\r\n     d3.select(parentElement + \" ~ #celestial-form\").select(\"#\" + fld).style( {\"display\": vis} );     \r\n   }\r\n   \r\n}\r\n\r\nfunction listConstellations() {\r\n  var sel = d3.select(parentElement + \" ~ #celestial-form\").select(\"#constellation\"),\r\n      list = [], selected = 0, id, name, config = globalConfig;\r\n    \r\n  Celestial.container.selectAll(\".constname\").each( function(d, i) {\r\n    id = d.id;\r\n    if (id === config.constellation) selected = i;\r\n    name = d.properties[config.constellations.namesType];\r\n    if (name !== id) name += \" (\" + id + \")\";\r\n    list.push({o:id, n:name});\r\n  });\r\n  if (list.length < 1 || sel.length < 1) {\r\n    setTimeout(listConstellations, 1000);\r\n    return;\r\n  }\r\n  list = [{o:\"---\", n:\"(Select constellation)\"}].concat(list);\r\n  \r\n  sel.selectAll('option').remove();\r\n  sel.selectAll('option').data(list).enter().append('option')\r\n     .attr(\"value\", function (d) { return d.o; })\r\n     .text(function (d) { return d.n; });\r\n  sel.property(\"selectedIndex\", selected);\r\n  //$form(\"constellation\").firstChild.disabled = true;\r\n\r\n  //Celestial.constellations = list;\r\n}\r\n\r\nfunction $form(id) { return document.querySelector(parentElement + \" ~ #celestial-form\" + \" #\" + id); }\r\n\r\n\r\n\r\n\r\n\r\n\r\nvar geoInfo = null;\r\n\r\nfunction geo(cfg) {\r\n  var dtFormat = d3.time.format(\"%Y-%m-%d %H:%M:%S\"),\r\n      zenith = [0,0],\r\n      geopos = [0,0], \r\n      date = new Date(),\r\n      localZone = -date.getTimezoneOffset(),\r\n      timeZone = localZone,\r\n      config = settings.set(cfg),\r\n      frm = d3.select(parentElement + \" ~ #celestial-form form\").insert(\"div\", \"div#general\").attr(\"id\", \"loc\");\r\n\r\n  var dtpick = new datetimepicker(config, function(date, tz) { \r\n    $form(\"datetime\").value = dateFormat(date, tz); \r\n    timeZone = tz;\r\n    go(); \r\n  });\r\n  \r\n  if (has(config, \"geopos\") && config.geopos !== null && config.geopos.length === 2) geopos = config.geopos;\r\n  var col = frm.append(\"div\").attr(\"class\", \"col\").attr(\"id\", \"location\").style(\"display\", \"none\");\r\n  //Latitude & longitude fields\r\n  col.append(\"label\").attr(\"title\", \"Location coordinates long/lat\").attr(\"for\", \"lat\").html(\"Location\");\r\n  col.append(\"input\").attr(\"type\", \"number\").attr(\"id\", \"lat\").attr(\"title\", \"Latitude\").attr(\"placeholder\", \"Latitude\").attr(\"max\", \"90\").attr(\"min\", \"-90\").attr(\"step\", \"0.0001\").attr(\"value\", geopos[0]).on(\"change\",  function () {\r\n    if (testNumber(this) === true) go(); \r\n  });\r\n  col.append(\"span\").html(\"\\u00b0\");\r\n  col.append(\"input\").attr(\"type\", \"number\").attr(\"id\", \"lon\").attr(\"title\", \"Longitude\").attr(\"placeholder\", \"Longitude\").attr(\"max\", \"180\").attr(\"min\", \"-180\").attr(\"step\", \"0.0001\").attr(\"value\", geopos[1]).on(\"change\",  function () { \r\n    if (testNumber(this) === true) go(); \r\n  });\r\n  col.append(\"span\").html(\"\\u00b0\");\r\n  //Here-button if supported\r\n  if (\"geolocation\" in navigator) {\r\n    col.append(\"input\").attr(\"type\", \"button\").attr(\"value\", \"Here\").attr(\"id\", \"here\").on(\"click\", here);\r\n  }\r\n  //Datetime field with dtpicker-button\r\n  col.append(\"label\").attr(\"title\", \"Local date/time\").attr(\"for\", \"datetime\").html(\" Date/time\");\r\n  col.append(\"input\").attr(\"type\", \"button\").attr(\"id\", \"day-left\").attr(\"title\", \"One day back\").on(\"click\", function () {\r\n    date.setDate(date.getDate() - 1); \r\n    $form(\"datetime\").value = dateFormat(date, timeZone); \r\n    go(); \r\n  });\r\n  col.append(\"input\").attr(\"type\", \"text\").attr(\"id\", \"datetime\").attr(\"title\", \"Date and time\").attr(\"value\", dateFormat(date, timeZone))\r\n  .on(\"click\", showpick, true).on(\"input\", function () { \r\n    this.value = dateFormat(date, timeZone); \r\n    if (!dtpick.isVisible()) showpick(); \r\n  });\r\n  col.append(\"div\").attr(\"id\", \"datepick\").on(\"click\", showpick);\r\n  col.append(\"input\").attr(\"type\", \"button\").attr(\"id\", \"day-right\").attr(\"title\", \"One day forward\").on(\"click\", function () { \r\n    date.setDate(date.getDate() + 1); \r\n    $form(\"datetime\").value = dateFormat(date, timeZone); \r\n    go(); \r\n  });\r\n  //Now -button sets current time & date of device  \r\n  col.append(\"input\").attr(\"type\", \"button\").attr(\"value\", \"Now\").attr(\"id\", \"now\").on(\"click\", now);\r\n  //Horizon marker\r\n  col.append(\"br\");\r\n  col.append(\"label\").attr(\"title\", \"Show horizon marker\").attr(\"for\", \"horizon-show\").html(\" Horizon marker\");\r\n  col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"horizon-show\").property(\"checked\", config.horizon.show).on(\"change\", apply);    \r\n  //Daylight\r\n  col.append(\"label\").attr(\"title\", \"Show daylight\").attr(\"for\", \"daylight-show\").html(\"Daylight sky\");\r\n  col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"daylight-show\").property(\"checked\", config.daylight.show).on(\"change\", apply);col.append(\"br\");\r\n    \r\n  //Show planets\r\n  col.append(\"label\").attr(\"title\", \"Show solar system objects\").attr(\"for\", \"planets-show\").html(\" Planets, Sun & Moon\");\r\n  col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"planets-show\").property(\"checked\", config.planets.show).on(\"change\", apply);    \r\n  //Planet names\r\n  var names = formats.planets[config.culture] || formats.planets.iau;\r\n  \r\n  for (var fld in names) {\r\n    if (!has(names, fld)) continue;\r\n    var keys = Object.keys(names[fld]);\r\n    if (keys.length > 1) {\r\n      //Select List\r\n      var txt = (fld === \"symbol\") ? \"as\" : \"with\";\r\n      col.append(\"label\").attr(\"for\", \"planets-\" + fld + \"Type\").html(txt);\r\n      \r\n      var selected = 0;\r\n      col.append(\"label\").attr(\"title\", \"Type of planet name\").attr(\"for\", \"planets-\" + fld + \"Type\").attr(\"class\", \"advanced\").html(\"\");\r\n      var sel = col.append(\"select\").attr(\"id\", \"planets-\" + fld + \"Type\").on(\"change\", apply);\r\n      var list = keys.map(function (key, i) {\r\n        if (key === config.planets[fld + \"Type\"]) selected = i;    \r\n        return {o:key, n:names[fld][key]}; \r\n      });\r\n      sel.selectAll(\"option\").data(list).enter().append('option')\r\n         .attr(\"value\", function (d) { return d.o; })\r\n         .text(function (d) { return d.n; });\r\n      sel.property(\"selectedIndex\", selected);\r\n\r\n      if (fld === \"names\") {\r\n        sel.attr(\"class\", \"advanced\");\r\n        col.append(\"label\").attr(\"for\", \"planets-\" + fld).html(\"names\");\r\n        col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"planets-\" + fld).property(\"checked\", config.planets[fld]).on(\"change\", apply);\r\n      }\r\n    } \r\n  }    \r\n \r\n  enable($form(\"planets-show\"));\r\n  showAdvanced(config.advanced);\r\n  \r\n\r\n  d3.select(document).on(\"mousedown\", function () { \r\n    if (!hasParent(d3.event.target, \"celestial-date\") && dtpick.isVisible()) dtpick.hide(); \r\n  });\r\n  \r\n  function now() {\r\n    date.setTime(Date.now());\r\n    $form(\"datetime\").value = dateFormat(date, timeZone);\r\n    go();\r\n  }\r\n\r\n  function here() {\r\n    navigator.geolocation.getCurrentPosition( function(pos) {\r\n      geopos = [Round(pos.coords.latitude, 4), Round(pos.coords.longitude, 4)];\r\n      $form(\"lat\").value = geopos[0];\r\n      $form(\"lon\").value = geopos[1];\r\n      go();\r\n    });  \r\n  }\r\n  \r\n  function showpick() {\r\n    dtpick.show(date, timeZone);\r\n  }\r\n  \r\n  function dateFormat(dt, tz) {\r\n    var tzs;\r\n    if (!tz || tz === \"0\") tzs = \" ±0000\";\r\n    else {\r\n      var h = Math.floor(Math.abs(tz) / 60),\r\n          m = Math.abs(tz) - (h * 60),\r\n          s = tz > 0 ? \" +\" : \" −\";\r\n      tzs = s + pad(h) + pad(m);\r\n    }\r\n    return dtFormat(dt) + tzs;\r\n  }  \r\n  \r\n\r\n  function isValidLocation(loc) {\r\n    //[lat, lon] expected\r\n    if (!loc || !isArray(loc) || loc.length < 2) return false;\r\n    if (!isNumber(loc[0]) || loc[0] < -90 || loc[0] > 90)  return false;\r\n    if (!isNumber(loc[1]) || loc[1] < -180 || loc[1] > 180)  return false;\r\n    return true;\r\n  }\r\n\r\n  function isValidTimezone(tz) {\r\n    if (tz === undefined || tz === null) return false;\r\n    if (!isNumber(tz) && Math.abs(tz) > 840) return false;\r\n    return true;    \r\n  }\r\n  \r\n  function apply() {\r\n    Object.assign(config, settings.set());\r\n    config.horizon.show = !!$form(\"horizon-show\").checked;\r\n    config.daylight.show = !!$form(\"daylight-show\").checked;\r\n    config.planets.show = !!$form(\"planets-show\").checked;    \r\n    config.planets.names = !!$form(\"planets-names\").checked;    \r\n    config.planets.namesType = $form(\"planets-namesType\").value;    \r\n    config.planets.symbolType = $form(\"planets-symbolType\").value;    \r\n    enable($form(\"planets-show\"));\r\n\r\n    Celestial.apply(config);\r\n  }\r\n\r\n  function go() {\r\n    var lon = parseFloat($form(\"lon\").value),\r\n        lat = parseFloat($form(\"lat\").value),\r\n        tz;\r\n    //Get current configuration\r\n    Object.assign(config, settings.set());\r\n\r\n    date = dtFormat.parse($form(\"datetime\").value.slice(0,-6));\r\n\r\n    //Celestial.apply(config);\r\n\r\n    if (!isNaN(lon) && !isNaN(lat)) {\r\n      if (lat !== geopos[0] || lon !== geopos[1]) {\r\n        geopos = [lat, lon];\r\n        setPosition([lat, lon], true);\r\n        return;\r\n      }\r\n      //if (!tz) tz = date.getTimezoneOffset();\r\n      $form(\"datetime\").value = dateFormat(date, timeZone); \r\n\r\n      var dtc = new Date(date.valueOf() - (timeZone - localZone) * 60000);\r\n\r\n      zenith = Celestial.getPoint(horizontal.inverse(dtc, [90, 0], geopos), config.transform);\r\n      zenith[2] = 0;\r\n      if (config.follow === \"zenith\") {\r\n        Celestial.rotate({center:zenith});\r\n      } else {\r\n        Celestial.redraw();\r\n      }\r\n    }\r\n  }\r\n\r\n  \r\n  function setPosition(p, settime) {\r\n    if (!p || !has(config, \"settimezone\") || config.settimezone === false) return;\r\n    var timestamp = Math.floor(date.getTime() / 1000),\r\n        protocol = window && window.location.protocol === \"https:\" ? \"https\" : \"http\",\r\n        url = protocol + \"://api.timezonedb.com/v2.1/get-time-zone?key=\" + config.timezoneid + \"&format=json&by=position\" + \r\n              \"&lat=\" + p[0] + \"&lng=\" + p[1] + \"&time=\" + timestamp;\r\n       // oldZone = timeZone;\r\n\r\n    d3.json(url, function(error, json) { \r\n      if (error) return console.warn(error);\r\n      if (json.status === \"FAILED\") {\r\n        // Location at sea inferred from longitude\r\n        timeZone = Math.round(p[1] / 15) * 60;\r\n        geoInfo = {\r\n          gmtOffset: timeZone * 60,\r\n          message: \"Sea locatation inferred\",\r\n          timestamp: timestamp\r\n        };\r\n      } else {\r\n        timeZone = json.gmtOffset / 60;\r\n        geoInfo = json;\r\n      }\r\n      //if (settime) {\r\n        //date.setTime(timestamp * 1000); // - (timeZone - oldZone) * 60000);\r\n        //console.log(date.toUTCString());\r\n      //}\r\n      $form(\"datetime\").value = dateFormat(date, timeZone);\r\n      go();\r\n    }); \r\n  }\r\n\r\n  Celestial.dateFormat = dateFormat;\r\n  \r\n  Celestial.date = function (dt, tz) { \r\n    if (!dt) return date;  \r\n    if (isValidTimezone(tz)) timeZone = tz;\r\n    Object.assign(config, settings.set());\r\n    if (dtpick.isVisible()) dtpick.hide();\r\n    date.setTime(dt.valueOf());\r\n    $form(\"datetime\").value = dateFormat(dt, timeZone); \r\n    go();\r\n  };\r\n  Celestial.timezone = function (tz) { \r\n    if (!tz) return timeZone;  \r\n    if (isValidTimezone(tz)) timeZone = tz;\r\n    Object.assign(config, settings.set());\r\n    if (dtpick.isVisible()) dtpick.hide();\r\n    $form(\"datetime\").value = dateFormat(date, timeZone); \r\n    go();\r\n  };\r\n  Celestial.position = function () { return geopos; };\r\n  Celestial.location = function (loc, tz) {\r\n    if (!loc || loc.length < 2) return geopos;\r\n    if (isValidLocation(loc)) {\r\n      geopos = loc.slice();\r\n      $form(\"lat\").value = geopos[0];\r\n      $form(\"lon\").value = geopos[1];\r\n      if (isValidTimezone(tz)) timeZone = tz;\r\n      else setPosition(geopos, true);\r\n    }\r\n  };\r\n  //{\"date\":dt, \"location\":loc, \"timezone\":tz}\r\n  Celestial.skyview = function (cfg) {\r\n    if (!cfg) return {\"date\": date, \"location\": geopos, \"timezone\": timeZone};\r\n    var valid = false;\r\n    if (dtpick.isVisible()) dtpick.hide();\r\n    if (has(cfg, \"timezone\") && isValidTimezone(cfg.timezone)) {\r\n      timeZone = cfg.timezone;\r\n      valid = true;\r\n    }\r\n    if (has(cfg, \"date\") && isValidDate(cfg.date)) {\r\n      date.setTime(cfg.date.valueOf());\r\n      $form(\"datetime\").value = dateFormat(cfg.date, timeZone); \r\n      valid = true;\r\n    }\r\n    if (has(cfg, \"location\") && isValidLocation(cfg.location)) {\r\n      geopos = cfg.location.slice();\r\n      $form(\"lat\").value = geopos[0];\r\n      $form(\"lon\").value = geopos[1];\r\n      if (!has(cfg, \"timezone\")) { \r\n        setPosition(geopos, !has(cfg, \"date\"));\r\n        return;\r\n      }\r\n    }\r\n    //Celestial.updateForm();\r\n    if (valid === false) return {\"date\": date, \"location\": geopos, \"timezone\": timeZone};\r\n    if (config.follow === \"zenith\") go();\r\n    else Celestial.redraw();\r\n  };  \r\n  Celestial.dtLoc = Celestial.skyview;\r\n  Celestial.zenith = function () { return zenith; };\r\n  Celestial.nadir = function () {\r\n    var b = -zenith[1],\r\n        l = zenith[0] + 180;\r\n    if (l > 180) l -= 360;    \r\n    return [l, b-0.001]; \r\n  };\r\n\r\n  if (has(config, \"formFields\") && (config.location === true || config.formFields.location === true)) {\r\n    d3.select(parentElement + \" ~ #celestial-form\").select(\"#location\").style( {\"display\": \"inline-block\"} );\r\n  }\r\n  //only if appropriate\r\n  if (isValidLocation(geopos) && (config.location === true || config.formFields.location === true) && config.follow === \"zenith\")\r\n    setTimeout(go, 1000); \r\n \r\n}\r\n﻿\r\nvar gmdat = {\r\n  \"sol\": 0.0002959122082855911025,  // AU^3/d^2\r\n  \"mer\": 164468599544771, //km^3/d^2\r\n  \"ven\": 2425056445892137,\r\n  \"ter\": 2975536307796296,\r\n  \"lun\": 36599199229256,\r\n  \"mar\": 319711652803400,\r\n  \"cer\": 467549107200,\r\n  \"ves\": 129071530155,\r\n  \"jup\": 945905718740635000,\r\n  \"sat\": 283224952705891000,\r\n  \"ura\": 43256077238632300,\r\n  \"nep\": 51034401552155700,\r\n  \"plu\": 7327611364884,\r\n  \"eri\": 8271175680000\r\n},\r\n\r\n\r\nsymbols = {\r\n  \"sol\":\"\\u2609\", \"mer\":\"\\u263f\", \"ven\":\"\\u2640\", \"ter\":\"\\u2295\", \"lun\":\"\\u25cf\", \"mar\":\"\\u2642\", \"cer\":\"\\u26b3\", \r\n  \"ves\":\"\\u26b6\", \"jup\":\"\\u2643\", \"sat\":\"\\u2644\", \"ura\":\"\\u2645\", \"nep\":\"\\u2646\", \"plu\":\"\\u2647\", \"eri\":\"\\u26aa\"\r\n}, \r\n\r\nε = 23.43928 * deg2rad,\r\nsinε = Math.sin(ε),\r\ncosε = Math.cos(ε),\r\nkelements = [\"a\",\"e\",\"i\",\"w\",\"M\",\"L\",\"W\",\"N\",\"n\",\"ep\",\"ref\",\"lecl\",\"becl\",\"Tilt\"];\r\n/*\r\n    ep = epoch (iso-date)\r\n    N = longitude of the ascending node (deg) Ω\r\n    i = inclination to the refrence plane, default:ecliptic (deg) \r\n    w = argument of periapsis (deg)  ω\r\n    a = semi-major axis, or mean distance from parent body (AU,km)\r\n    e = eccentricity (0=circle, 0-1=ellipse, 1=parabola, >1=hyperbola ) (-)\r\n    M = mean anomaly (0 at periapsis; increases uniformly with time) (deg)\r\n    n = mean daily motion = 360/P (deg/day)\r\n    \r\n    W = N + w  = longitude of periapsis ϖ\r\n    L = M + W  = mean longitude\r\n    q = a*(1-e) = periapsis distance\r\n    Q = a*(1+e) = apoapsis distance\r\n    P = 2π * sqrt(a^3/GM) = orbital period (years)\r\n    T = Epoch_of_M - (M(deg)/360_deg) / P  = time of periapsis\r\n    v = true anomaly (angle between position and periapsis) ν\r\n    E = eccentric anomaly\r\n    \r\n    Mandatory: a, e, i, N, w|W, M|L, dM|n\r\n    \r\n*/\r\n\r\nvar Kepler = function () {\r\n  var gm = gmdat.sol, \r\n      parentBody = \"sol\", \r\n      elem = {}, dat = {},\r\n      id, name, symbol;\r\n\r\n\r\n  function kepler(date) {\r\n    dates(date);\r\n    if (id === \"sol\") {\r\n      dat.ephemeris.x = 0;\r\n      dat.ephemeris.y = 0;\r\n      dat.ephemeris.z = 0;\r\n      dat.ephemeris.mag = -6;\r\n      return kepler;\r\n    }\r\n    coordinates();\r\n    return kepler;\r\n  }\r\n\r\n  var dates = function(date) {\r\n    var dt, de = dat.ephemeris = {};\r\n    if (date) {\r\n      if (date instanceof Date) { dt = new Date(date.valueOf()); }\r\n      else { dt = dateParse(date); }\r\n    }\r\n    if (!dt) { dt = new Date(); }\r\n    de.jd = JD(dt);\r\n      \r\n    dt = dateParse(elem.ep);\r\n    if (!dt) dt = dateParse(\"2000-01-01\");\r\n    de.jd0 = JD(dt);\r\n    de.d = de.jd - de.jd0;\r\n    de.cy = de.d / 36525;\r\n  };\r\n\r\n  var coordinates = function() {\r\n    var key, de = dat.ephemeris;\r\n    if (id === \"lun\") {\r\n      de = moon_elements(de);\r\n      if (!de) return;\r\n    } else {\r\n      for (var i=0; i<kelements.length; i++) {\r\n        key = kelements[i];\r\n        if (!has(elem, key)) continue; \r\n        if (has(elem, \"d\"+key)) {\r\n          de[key] = elem[key] + elem[\"d\"+key] * de.cy;\r\n        } else if (has(elem, key)) {\r\n          de[key] = elem[key];\r\n        }\r\n      }\r\n      if (has(de, \"M\") && !has(de, \"dM\") && has(de, \"n\")) {\r\n        de.M += (de.n * de.d);\r\n      }\r\n    }\r\n    derive();\r\n    trueAnomaly();\r\n    cartesian();    \r\n  };\r\n\r\n  kepler.cartesian = function() {\r\n    return dat;    \r\n  };\r\n\r\n  kepler.spherical = function() {\r\n    spherical();\r\n    return dat;    \r\n  };\r\n\r\n  kepler.equatorial = function(pos) {\r\n    equatorial(pos);\r\n    return dat;    \r\n  };\r\n\r\n  kepler.transpose = function() {\r\n    transpose(dat);\r\n    return dat;    \r\n  };\r\n  \r\n  kepler.elements = function(_) {\r\n    var key;\r\n    \r\n    if (!arguments.length || arguments[0] === undefined) return kepler;\r\n    \r\n    for (var i=0; i<kelements.length; i++) {\r\n      key = kelements[i];\r\n      if (!has(_, key)) continue; \r\n      elem[key] = _[key];\r\n      \r\n      if (key === \"a\" || key === \"e\") elem[key] *= 1.0; \r\n      else if (key !== \"ref\" && key !== \"ep\") elem[key] *= deg2rad;\r\n\r\n      if (has(_, \"d\" + key)) {\r\n        key = \"d\" + key;\r\n        elem[key] = _[key];\r\n        if (key === \"da\" || key === \"de\") elem[key] *= 1.0; \r\n        else elem[key] *= deg2rad;\r\n      } \r\n    }\r\n    return kepler;\r\n  };\r\n\r\n  kepler.params = function(_) {\r\n    if (!arguments.length) return kepler; \r\n    for (var par in _) {\r\n      if (!has(_, par)) continue;\r\n      if (_[par] === \"elements\") continue;\r\n      dat[par] = _[par];\r\n    }\r\n    return kepler;\r\n  };\r\n  \r\n\r\n  kepler.parentBody = function(_) {\r\n    if (!arguments.length) return parentBody; \r\n    parentBody = _;\r\n    gm = gmdat[parentBody];\r\n    return kepler;\r\n  };\r\n\r\n  kepler.id = function(_) {\r\n    if (!arguments.length) return id; \r\n    id = _;\r\n    symbol = symbols[_];\r\n    return kepler;\r\n  };\r\n\r\n  kepler.Name = function(_) {\r\n    if (!arguments.length) return name; \r\n    name = _;\r\n    return kepler;\r\n  };\r\n\r\n  kepler.symbol = function(_) {\r\n    if (!arguments.length) return symbol; \r\n    symbol = symbols[_];\r\n    return kepler;\r\n  };\r\n\r\n  \r\n  function near_parabolic(E, e) {\r\n    var anom2 = e > 1.0 ? E*E : -E*E,\r\n        term = e * anom2 * E / 6.0,\r\n        rval = (1.0 - e) * E - term,\r\n        n = 4;\r\n\r\n    while(Math.abs(term) > 1e-15) {\r\n      term *= anom2 / (n * (n + 1));\r\n      rval -= term;\r\n      n += 2;\r\n    }\r\n    return(rval);\r\n  }\r\n\r\n  function anomaly() {\r\n    var de = dat.ephemeris,\r\n        curr, err, trial, tmod,\r\n        e = de.e, M = de.M,\r\n        thresh = 1e-8,\r\n        offset = 0.0, \r\n        delta_curr = 1.9, \r\n        is_negative = false, \r\n        n_iter = 0;\r\n\r\n    if (!M) return(0.0); \r\n\r\n    if (e < 1.0) {\r\n      if (M < -Math.PI || M > Math.PI) {\r\n        tmod = Trig.normalize0(M);\r\n        offset = M - tmod;\r\n        M = tmod;\r\n      }\r\n\r\n      if (e < 0.9) {   \r\n        curr = Math.atan2(Math.sin(M), Math.cos(M) - e);\r\n        do {\r\n          err = (curr - e * Math.sin(curr) - M) / (1.0 - e * Math.cos(curr));\r\n          curr -= err;\r\n        } while (Math.abs(err) > thresh);\r\n        return curr; // + offset;\r\n      }\r\n    }\r\n\r\n    if ( M < 0.0) {\r\n      M = -M;\r\n      is_negative = true;\r\n    }\r\n\r\n    curr = M;\r\n    thresh = thresh * Math.abs(1.0 - e);\r\n               /* Due to roundoff error,  there's no way we can hope to */\r\n               /* get below a certain minimum threshhold anyway:        */\r\n    if ( thresh < 1e-15) { thresh = 1e-15; }\r\n    if ( (e > 0.8 && M < Math.PI / 3.0) || e > 1.0) {   /* up to 60 degrees */\r\n      trial = M / Math.abs( 1.0 - e);\r\n\r\n      if (trial * trial > 6.0 * Math.abs(1.0 - e)) {  /* cubic term is dominant */\r\n        if (M < Math.PI) {\r\n          trial = Math.pow(6.0 * M, 1/3);\r\n        } else {       /* hyperbolic w/ 5th & higher-order terms predominant */\r\n          trial = Trig.asinh( M / e);\r\n        }\r\n      }\r\n      curr = trial;\r\n    }\r\n    if (e > 1.0 && M > 4.0) {   /* hyperbolic, large-mean-anomaly case */\r\n      curr = Math.log(M);\r\n    }\r\n    if (e < 1.0) {\r\n      while(Math.abs(delta_curr) > thresh) {\r\n        if ( n_iter++ > 8) {\r\n          err = near_parabolic(curr, e) - M;\r\n        } else {\r\n          err = curr - e * Math.sin(curr) - M;\r\n        }\r\n        delta_curr = -err / (1.0 - e * Math.cos(curr));\r\n        curr += delta_curr;\r\n      }\r\n    } else {\r\n      while (Math.abs(delta_curr) > thresh) {\r\n        if (n_iter++ > 7) {\r\n          err = -near_parabolic(curr, e) - M;\r\n        } else {\r\n          err = e * Trig.sinh(curr) - curr - M;\r\n        }\r\n        delta_curr = -err / (e * Trig.cosh(curr) - 1.0);\r\n        curr += delta_curr;\r\n      }\r\n    }\r\n    return( is_negative ? offset - curr : offset + curr);\r\n  }\r\n\r\n  function trueAnomaly() {\r\n    var x, y, r0, g, t, de = dat.ephemeris;\r\n\r\n    if (de.e === 1.0) {   /* parabolic */\r\n      t = de.jd0 - de.T;\r\n      g = de.w0 * t * 0.5;\r\n\r\n      y = Math.pow(g + Math.sqrt(g * g + 1.0), 1/3);\r\n      de.v = 2.0 * Math.atan(y - 1.0 / y);\r\n    } else {          /* got the mean anomaly;  compute eccentric,  then true */\r\n      de.E = anomaly();\r\n      if (de.e > 1.0) {    /* hyperbolic case */\r\n        x = (de.e - Trig.cosh(de.E));\r\n        y = Trig.sinh(de.E);\r\n      } else {          /* elliptical case */\r\n        x = (Math.cos(de.E) - de.e);\r\n        y =  Math.sin(de.E);\r\n      }\r\n      y *= Math.sqrt(Math.abs(1.0 - de.e * de.e));\r\n      de.v = Math.atan2(y, x);\r\n    }\r\n\r\n    r0 = de.q * (1.0 + de.e);\r\n    de.r = r0 / (1.0 + de.e * Math.cos(de.v));\r\n  }\r\n\r\n  function derive() {\r\n    var de = dat.ephemeris;\r\n    if (!de.hasOwnProperty(\"w\")) {\r\n      de.w = de.W - de.N;\r\n    }\r\n    if (!de.hasOwnProperty(\"M\")) {\r\n      de.M = de.L - de.W;\r\n    }\r\n    if (de.e < 1.0) { de.M = Trig.normalize0(de.M); }\r\n    //de.P = Math.pow(Math.abs(de.a), 1.5);\r\n    de.P = τ * Math.sqrt(Math.pow(de.a, 3) / gm) / 365.25;\r\n    de.T = de.jd0 - (de.M / halfπ) / de.P;\r\n\r\n    if (de.e !== 1.0) {   /* for non-parabolic orbits: */\r\n     de.q = de.a * (1.0 - de.e);\r\n     de.t0 = de.a * Math.sqrt(Math.abs(de.a) / gm);\r\n    } else {\r\n     de.w0 = (3.0 / Math.sqrt(2)) / (de.q * Math.sqrt(de.q / gm));\r\n     de.a = 0.0;\r\n     de.t0 = 0.0;\r\n    }\r\n    de.am = Math.sqrt(gm * de.q * (1.0 + de.e));\r\n  }\r\n\r\n  function transpose() {\r\n    var de = dat.ephemeris;\r\n    if (!de.ref || de.ref === \"ecl\") {\r\n      de.tx = de.x;\r\n      de.ty = de.y;\r\n      de.tz = de.z;\r\n      return;\r\n    }\r\n    var a0 = de.lecl,// - Math.PI/2,\r\n        a1 = Math.PI/2 - de.becl,\r\n        angles = [0, a1, -a0];\r\n    transform(de, angles);\r\n    var tp =  Trig.cartesian([de.tl, de.tb, de.r]);\r\n    de.tx = tp.x;\r\n    de.ty = tp.y;\r\n    de.tz = tp.z;\r\n  }\r\n\r\n  function equatorial(pos) {\r\n    var de = dat.ephemeris, pe = pos.ephemeris;\r\n    ε = (23.439292 - 0.0130042 * de.cy - 1.667e-7 * de.cy * de.cy + 5.028e-7 * de.cy * de.cy * de.cy) * deg2rad;\r\n    sinε = Math.sin(ε);\r\n    cosε = Math.cos(ε);\r\n    var o = (id === \"lun\") ? {x:0, y:0, z:0} : {x:pe.x, y:pe.y, z:pe.z};\r\n    de.xeq = de.x - o.x;\r\n    de.yeq = (de.y - o.y) * cosε - (de.z - o.z) * sinε;\r\n    de.zeq = (de.y - o.y) * sinε + (de.z - o.z) * cosε;\r\n\r\n    de.ra = Trig.normalize(Math.atan2(de.yeq, de.xeq));\r\n    de.dec = Math.atan2(de.zeq, Math.sqrt(de.xeq*de.xeq + de.yeq*de.yeq));\r\n    if (id === \"lun\") de = moon_corr(de, pe);\r\n    de.pos = [de.ra / deg2rad, de.dec / deg2rad];\r\n    de.rt = Math.sqrt(de.xeq*de.xeq + de.yeq*de.yeq + de.zeq*de.zeq);\r\n    if (id !== \"sol\") de.mag = magnitude();\r\n  }\r\n\r\n  function magnitude() {\r\n    var de = dat.ephemeris,\r\n        rs = de.r, rt = de.rt,\r\n        a = Math.acos((rs*rs + rt*rt - 1) / (2 * rs * rt)),\r\n        q = 0.666 *((1-a/Math.PI) * Math.cos(a) + 1 / Math.PI * Math.sin(a)),\r\n        m = dat.H * 1 + 5 * Math.log(rs*rt) * Math.LOG10E - 2.5 * Math.log(q) * Math.LOG10E;\r\n        \r\n    return m;\r\n  }\r\n\r\n  function cartesian() {\r\n    var de = dat.ephemeris,\r\n        u = de.v + de.w;\r\n    de.x = de.r * (Math.cos(de.N) * Math.cos(u) - Math.sin(de.N) * Math.sin(u) * Math.cos(de.i));\r\n    de.y = de.r * (Math.sin(de.N) * Math.cos(u) + Math.cos(de.N) * Math.sin(u) * Math.cos(de.i));\r\n    de.z = de.r * (Math.sin(u) * Math.sin(de.i));\r\n    return dat;\r\n  }\r\n\r\n  function spherical() {\r\n    var de = dat.ephemeris,\r\n        lon = Math.atan2(de.y, de.x),\r\n        lat = Math.atan2(de.z, Math.sqrt(de.x*de.x + de.y*de.y));\r\n    de.l = Trig.normalize(lon);\r\n    de.b = lat;\r\n    return dat; \r\n  }\r\n\r\n  function transform(angles) {\r\n    \r\n  }\r\n\r\n  function polar2cart(pos) {\r\n    var rclat = Math.cos(pos.lat) * pos.r;\r\n    pos.x = rclat * Math.cos(pos.lon);\r\n    pos.y = rclat * Math.sin(pos.lon);\r\n    pos.z = pos.r * Math.sin(pos.lat);\r\n    return pos;\r\n  }\r\n\r\n  \r\n  function JD(dt) {  \r\n    var yr = dt.getUTCFullYear(),\r\n        mo = dt.getUTCMonth() + 1,\r\n        dy = dt.getUTCDate(),\r\n        frac = (dt.getUTCHours() - 12 + dt.getUTCMinutes()/60.0 + dt.getUTCSeconds()/3600.0) / 24, \r\n        IYMIN = -4799;        /* Earliest year allowed (4800BC) */\r\n\r\n    if (yr < IYMIN) return -1; \r\n    var a = Math.floor((14 - mo) / 12),\r\n        y = yr + 4800 - a,\r\n        m = mo + (12 * a) - 3;\r\n    var jdn = dy + Math.floor((153 * m + 2)/5) + (365 * y) + Math.floor(y / 4) - Math.floor(y / 100) + Math.floor(y / 400) - 32045;\r\n    return jdn + frac;   \r\n  }\r\n\r\n  function mst(lon) {\r\n    var l = lon || 0;  // lon=0 -> gmst\r\n    return (18.697374558 + 24.06570982441908 * dat.ephemeris.d) * 15 + l;\r\n  }\r\n  \r\n    \r\n  function observer(pos) {\r\n    var flat = 298.257223563,    // WGS84 flattening of earth\r\n        re = 6378.137,           // GRS80/WGS84 semi major axis of earth ellipsoid\r\n        h = pos.h || 0,\r\n        cart = {},\r\n        gmst = mst();\r\n    \r\n    var cosl = Math.cos(pos.lat),\r\n        sinl = Math.sin(pos.lat),\r\n        fl = 1.0 - 1.0 / flat;\r\n    var fl2 = fl * fl;\r\n    \r\n    var u = 1.0 / Math.sqrt (cosl * cosl + fl2 * sinl * sinl),\r\n        a = re * u + h,\r\n        b = re * fl2 * u + h,\r\n        r = Math.sqrt (a * a * cosl * cosl + b * b * sinl * sinl); // geocentric distance from earth center\r\n\r\n    cart.lat = Math.acos (a * cosl / r); \r\n    cart.lon = pos.lon; \r\n    cart.r = h;\r\n    \r\n    if (pos.lat < 0.0) cart.lat *= -1; \r\n\r\n    polar2cart(cart); \r\n\r\n    // rotate around earth's polar axis to align coordinate system from Greenwich to vernal equinox\r\n    var angle = gmst * deg2rad; // sideral time gmst given in hours. Convert to radians\r\n\r\n    cart.x = cart.x * Math.cos(angle) - cart.y * Math.sin(angle);\r\n    cart.y = cart.x * Math.sin(angle) + cart.y * Math.cos(angle);\r\n    return(cart);\r\n  }\r\n\r\n  function moon_elements(dat) {\r\n    if ((typeof Moon !== \"undefined\")) return Moon.elements(dat);\r\n  }\r\n  \r\n  function moon_corr(dat, pos) {\r\n    spherical();\r\n    if ((typeof Moon !== \"undefined\")) return Moon.corr(dat, pos);\r\n  }\r\n\r\n  return kepler;  \r\n};﻿\r\nvar Moon = {\r\n  elements: function(dat) {\r\n    var t = (dat.jd - 2451545) / 36525,\r\n        t2 = t * t,\r\n        t3 = t * t2,\r\n        t4 = t * t3,\r\n        t5 = t * t4,\r\n        t2e4 = t2 * 1e-4,\r\n        t3e6 = t3 * 1e-6,\r\n        t4e8 = t4 * 1e-8;\r\n\r\n    // semimajor axis\r\n    var sa = 3400.4 * Math.cos(deg2rad * (235.7004 + 890534.2230 * t - 32.601 * t2e4 \r\n        + 3.664 * t3e6 - 1.769 * t4e8)) \r\n        - 635.6 * Math.cos(deg2rad * (100.7370 + 413335.3554 * t - 122.571 * t2e4 \r\n        - 10.684 * t3e6 + 5.028 * t4e8)) \r\n        - 235.6 * Math.cos(deg2rad * (134.9634 + 477198.8676 * t + 89.970 * t2e4 \r\n        + 14.348 * t3e6 - 6.797 * t4e8)) \r\n        + 218.1 * Math.cos(deg2rad * (238.1713 +  854535.1727 * t - 31.065 * t2e4 \r\n        + 3.623 * t3e6  - 1.769 * t4e8)) \r\n        + 181.0 * Math.cos(deg2rad * (10.6638 + 1367733.0907 * t + 57.370 * t2e4 \r\n        + 18.011 * t3e6 - 8.566 * t4e8)) \r\n        - 39.9 * Math.cos(deg2rad * (103.2079 + 377336.3051 * t - 121.035 * t2e4 \r\n        - 10.724 * t3e6 + 5.028 * t4e8)) \r\n        - 38.4 * Math.cos(deg2rad * (233.2295 + 926533.2733 * t - 34.136 * t2e4 \r\n        + 3.705 * t3e6 - 1.769 * t4e8)) \r\n        + 33.8 * Math.cos(deg2rad * (336.4374 + 1303869.5784 * t - 155.171 * t2e4 \r\n        - 7.020 * t3e6 + 3.259 * t4e8)) \r\n        + 28.8 * Math.cos(deg2rad * (111.4008 + 1781068.4461 * t - 65.201 * t2e4 \r\n        + 7.328 * t3e6 - 3.538 * t4e8)) \r\n        + 12.6 * Math.cos(deg2rad * (13.1347 + 1331734.0404 * t + 58.906 * t2e4 \r\n        + 17.971 * t3e6 - 8.566 * t4e8)) \r\n        + 11.4 * Math.cos(deg2rad * (186.5442 + 966404.0351 * t - 68.058 * t2e4 \r\n        - 0.567 * t3e6 + 0.232 * t4e8)) \r\n        - 11.1 * Math.cos(deg2rad * (222.5657 - 441199.8173 * t - 91.506 * t2e4 \r\n        - 14.307 * t3e6 + 6.797 * t4e8)) \r\n        - 10.2 * Math.cos(deg2rad * (269.9268 + 954397.7353 * t + 179.941 * t2e4 \r\n        + 28.695 * t3e6 - 13.594 * t4e8)) \r\n        + 9.7 * Math.cos(deg2rad * (145.6272 + 1844931.9583 * t + 147.340 * t2e4 \r\n        + 32.359 * t3e6 - 15.363 * t4e8)) \r\n        + 9.6 * Math.cos(deg2rad * (240.6422 + 818536.1225 * t - 29.529 * t2e4 \r\n        + 3.582 * t3e6 - 1.769 * t4e8)) \r\n        + 8.0 * Math.cos(deg2rad * (297.8502 + 445267.1115 * t - 16.300 * t2e4 \r\n        + 1.832 * t3e6 - 0.884 * t4e8)) \r\n        - 6.2 * Math.cos(deg2rad * (132.4925 + 513197.9179 * t + 88.434 * t2e4 \r\n        + 14.388 * t3e6 - 6.797 * t4e8)) \r\n        + 6.0 * Math.cos(deg2rad * (173.5506 + 1335801.3346 * t - 48.901 * t2e4 \r\n        + 5.496 * t3e6 - 2.653 * t4e8)) \r\n        + 3.7 * Math.cos(deg2rad * (113.8717 + 1745069.3958 * t - 63.665 * t2e4 \r\n        + 7.287 * t3e6 - 3.538 * t4e8)) \r\n        + 3.6 * Math.cos(deg2rad * (338.9083 + 1267870.5281 * t - 153.636 * t2e4 \r\n        - 7.061 * t3e6 + 3.259 * t4e8)) \r\n        + 3.2 * Math.cos(deg2rad * (246.3642 + 2258267.3137 * t + 24.769 * t2e4 \r\n        + 21.675 * t3e6 - 10.335 * t4e8)) \r\n        - 3.0 * Math.cos(deg2rad * (8.1929 + 1403732.1410 * t + 55.834 * t2e4 \r\n        + 18.052 * t3e6 - 8.566 * t4e8)) \r\n        + 2.3 * Math.cos(deg2rad * (98.2661 + 449334.4057 * t - 124.107 * t2e4 \r\n        - 10.643 * t3e6 + 5.028 * t4e8)) \r\n        - 2.2 * Math.cos(deg2rad * (357.5291 + 35999.0503 * t - 1.536 * t2e4 \r\n        + 0.041 * t3e6 + 0.000 * t4e8)) \r\n        - 2.0 * Math.cos(deg2rad * (38.5872 + 858602.4669 * t - 138.871 * t2e4 \r\n        - 8.852 * t3e6 + 4.144 * t4e8)) \r\n        - 1.8 * Math.cos(deg2rad * (105.6788 + 341337.2548 * t - 119.499 * t2e4 \r\n        - 10.765 * t3e6 + 5.028 * t4e8)) \r\n        - 1.7 * Math.cos(deg2rad * (201.4740 + 826670.7108 * t - 245.142 * t2e4 \r\n        - 21.367 * t3e6 + 10.057 * t4e8)) \r\n        + 1.6 * Math.cos(deg2rad * (184.1196 + 401329.0556 * t + 125.428 * t2e4 \r\n        + 18.579 * t3e6 - 8.798 * t4e8)) \r\n        - 1.4 * Math.cos(deg2rad * (308.4192 - 489205.1674 * t + 158.029 * t2e4 \r\n        + 14.915 * t3e6 - 7.029 * t4e8)) \r\n        + 1.3 * Math.cos(deg2rad * (325.7736 - 63863.5122 * t - 212.541 * t2e4 \r\n        - 25.031 * t3e6 + 11.826 * t4e8));\r\n\r\n    var sapp = - 0.55 * Math.cos(deg2rad * (238.2 + 854535.2 * t)) \r\n        + 0.10 * Math.cos(deg2rad * (103.2 + 377336.3 * t)) \r\n        + 0.10 * Math.cos(deg2rad * (233.2 + 926533.3 * t));\r\n\r\n    var sma = 383397.6 + sa + sapp * t;\r\n\r\n    // orbital eccentricity\r\n\r\n    var se = 0.014217 * Math.cos(deg2rad * (100.7370 + 413335.3554 * t - 122.571 * t2e4 \r\n        - 10.684 * t3e6 + 5.028 * t4e8)) \r\n        + 0.008551 * Math.cos(deg2rad * (325.7736 - 63863.5122 * t - 212.541 * t2e4 \r\n        - 25.031 * t3e6 + 11.826 * t4e8)) \r\n        - 0.001383 * Math.cos(deg2rad * (134.9634 + 477198.8676 * t + 89.970 * t2e4 \r\n        + 14.348 * t3e6 - 6.797 * t4e8)) \r\n        + 0.001353 * Math.cos(deg2rad * (10.6638 + 1367733.0907 * t + 57.370 * t2e4 \r\n        + 18.011 * t3e6 - 8.566 * t4e8)) \r\n        - 0.001146 * Math.cos(deg2rad * (66.5106 + 349471.8432 * t - 335.112 * t2e4 \r\n        - 35.715 * t3e6 + 16.854 * t4e8)) \r\n        - 0.000915 * Math.cos(deg2rad * (201.4740 + 826670.7108 * t - 245.142 * t2e4 \r\n        - 21.367 * t3e6 + 10.057 * t4e8)) \r\n        + 0.000869 * Math.cos(deg2rad * (103.2079 + 377336.3051 * t - 121.035 * t2e4 \r\n        - 10.724 * t3e6 + 5.028 * t4e8)) \r\n        - 0.000628 * Math.cos(deg2rad * (235.7004 + 890534.2230 * t - 32.601 * t2e4 \r\n        + 3.664 * t3e6  - 1.769 * t4e8)) \r\n        - 0.000393 * Math.cos(deg2rad * (291.5472 - 127727.0245 * t - 425.082 * t2e4 \r\n        - 50.062 * t3e6 + 23.651 * t4e8)) \r\n        + 0.000284 * Math.cos(deg2rad * (328.2445 - 99862.5625 * t - 211.005 * t2e4 \r\n        - 25.072 * t3e6 + 11.826 * t4e8)) \r\n        - 0.000278 * Math.cos(deg2rad * (162.8868 - 31931.7561 * t - 106.271 * t2e4 \r\n        - 12.516 * t3e6 + 5.913 * t4e8)) \r\n        - 0.000240 * Math.cos(deg2rad * (269.9268 + 954397.7353 * t + 179.941 * t2e4 \r\n        + 28.695 * t3e6 - 13.594 * t4e8)) \r\n        + 0.000230 * Math.cos(deg2rad * (111.4008 + 1781068.4461 * t - 65.201 * t2e4 \r\n        + 7.328 * t3e6  - 3.538 * t4e8)) \r\n        + 0.000229 * Math.cos(deg2rad * (167.2476 + 762807.1986 * t - 457.683 * t2e4 \r\n        - 46.398 * t3e6 + 21.882 * t4e8)) \r\n        - 0.000202 * Math.cos(deg2rad * ( 83.3826 - 12006.2998 * t + 247.999 * t2e4 \r\n        + 29.262 * t3e6 - 13.826 * t4e8)) \r\n        + 0.000190 * Math.cos(deg2rad * (190.8102 - 541062.3799 * t - 302.511 * t2e4 \r\n        - 39.379 * t3e6 + 18.623 * t4e8)) \r\n        + 0.000177 * Math.cos(deg2rad * (357.5291 + 35999.0503 * t - 1.536 * t2e4 \r\n        + 0.041 * t3e6 + 0.000 * t4e8)) \r\n        + 0.000153 * Math.cos(deg2rad * (32.2842 + 285608.3309 * t - 547.653 * t2e4 \r\n        - 60.746 * t3e6 + 28.679 * t4e8)) \r\n        - 0.000137 * Math.cos(deg2rad * (44.8902 + 1431596.6029 * t + 269.911 * t2e4 \r\n        + 43.043 * t3e6 - 20.392 * t4e8)) \r\n        + 0.000122 * Math.cos(deg2rad * (145.6272 + 1844931.9583 * t + 147.340 * t2e4 \r\n        + 32.359 * t3e6 - 15.363 * t4e8)) \r\n        + 0.000116 * Math.cos(deg2rad * (302.2110 + 1240006.0662 * t - 367.713 * t2e4 \r\n        - 32.051 * t3e6 + 15.085 * t4e8)) \r\n        - 0.000111 * Math.cos(deg2rad * (203.9449 + 790671.6605 * t - 243.606 * t2e4 \r\n        - 21.408 * t3e6 + 10.057 * t4e8)) \r\n        - 0.000108 * Math.cos(deg2rad * (68.9815 + 313472.7929 * t - 333.576 * t2e4 \r\n        - 35.756 * t3e6 + 16.854 * t4e8)) \r\n        + 0.000096 * Math.cos(deg2rad * (336.4374 + 1303869.5784 * t - 155.171 * t2e4 \r\n        - 7.020 * t3e6 + 3.259 * t4e8)) \r\n        - 0.000090 * Math.cos(deg2rad * (98.2661 + 449334.4057 * t - 124.107 * t2e4 \r\n        - 10.643 * t3e6 + 5.028 * t4e8)) \r\n        + 0.000090 * Math.cos(deg2rad * (13.1347 + 1331734.0404 * t + 58.906 * t2e4 \r\n        + 17.971 * t3e6 - 8.566 * t4e8)) \r\n        + 0.000056 * Math.cos(deg2rad * (55.8468 - 1018261.2475 * t - 392.482 * t2e4 \r\n        - 53.726 * t3e6 + 25.420 * t4e8)) \r\n        - 0.000056 * Math.cos(deg2rad * (238.1713 + 854535.1727 * t - 31.065 * t2e4 \r\n        + 3.623 * t3e6 - 1.769 * t4e8)) \r\n        + 0.000052 * Math.cos(deg2rad * (308.4192 - 489205.1674 * t + 158.029 * t2e4 \r\n        + 14.915 * t3e6 - 7.029 * t4e8)) \r\n        - 0.000050 * Math.cos(deg2rad * (133.0212 + 698943.6863 * t - 670.224 * t2e4 \r\n        - 71.429 * t3e6 + 33.708 * t4e8)) \r\n        - 0.000049 * Math.cos(deg2rad * (267.9846 + 1176142.5540 * t - 580.254 * t2e4 \r\n        - 57.082 * t3e6 + 26.911 * t4e8)) \r\n        - 0.000049 * Math.cos(deg2rad * (184.1196 + 401329.0556 * t + 125.428 * t2e4 \r\n        + 18.579 * t3e6 - 8.798 * t4e8)) \r\n        - 0.000045 * Math.cos(deg2rad * (49.1562 - 75869.8120 * t + 35.458 * t2e4 \r\n        + 4.231 * t3e6 - 2.001 * t4e8)) \r\n        + 0.000044 * Math.cos(deg2rad * (257.3208 - 191590.5367 * t - 637.623 * t2e4 \r\n        - 75.093 * t3e6 + 35.477 * t4e8)) \r\n        + 0.000042 * Math.cos(deg2rad * (105.6788 + 341337.2548 * t - 119.499 * t2e4 \r\n        - 10.765 * t3e6 + 5.028 * t4e8)) \r\n        + 0.000042 * Math.cos(deg2rad * (160.4159 + 4067.2942 * t - 107.806 * t2e4 \r\n        - 12.475 * t3e6 + 5.913 * t4e8)) \r\n        + 0.000040 * Math.cos(deg2rad * (246.3642 + 2258267.3137 * t + 24.769 * t2e4 \r\n        + 21.675 * t3e6 - 10.335 * t4e8)) \r\n        - 0.000040 * Math.cos(deg2rad * (156.5838 - 604925.8921 * t - 515.053 * t2e4 \r\n        - 64.410 * t3e6 + 30.448 * t4e8)) \r\n        + 0.000036 * Math.cos(deg2rad * (169.7185 + 726808.1483 * t - 456.147 * t2e4 \r\n        - 46.439 * t3e6 + 21.882 * t4e8)) \r\n        + 0.000029 * Math.cos(deg2rad * (113.8717 + 1745069.3958 * t - 63.665 * t2e4 \r\n        + 7.287 * t3e6 - 3.538 * t4e8)) \r\n        - 0.000029 * Math.cos(deg2rad * (297.8502 + 445267.1115 * t - 16.300 * t2e4 \r\n        + 1.832 * t3e6 - 0.884 * t4e8)) \r\n        - 0.000028 * Math.cos(deg2rad * (294.0181 - 163726.0747 * t - 423.546 * t2e4 \r\n        - 50.103 * t3e6 + 23.651 * t4e8)) \r\n        + 0.000027 * Math.cos(deg2rad * (263.6238 + 381403.5993 * t - 228.841 * t2e4 \r\n        - 23.199 * t3e6 + 10.941 * t4e8)) \r\n        - 0.000026 * Math.cos(deg2rad * (358.0578 + 221744.8187 * t - 760.194 * t2e4 \r\n        - 85.777 * t3e6 + 40.505 * t4e8)) \r\n        - 0.000026 * Math.cos(deg2rad * (8.1929 + 1403732.1410 * t + 55.834 * t2e4 \r\n        + 18.052 * t3e6 - 8.566 * t4e8));\r\n\r\n    var sedp = -0.0022 * Math.cos(deg2rad * (103.2 + 377336.3 * t));\r\n\r\n    var ecc = 0.055544 + se + 1e-3 * t * sedp;\r\n\r\n    // sine of half the inclination\r\n\r\n    var sg = 0.0011776 * Math.cos(deg2rad * (49.1562 - 75869.8120 * t + 35.458 * t2e4 \r\n        + 4.231 * t3e6 - 2.001 * t4e8)) \r\n        - 0.0000971 * Math.cos(deg2rad * (235.7004 + 890534.2230 * t - 32.601 * t2e4 \r\n        + 3.664 * t3e6 - 1.769 * t4e8)) \r\n        + 0.0000908 * Math.cos(deg2rad * (186.5442 + 966404.0351 * t - 68.058 * t2e4 \r\n        - 0.567 * t3e6 + 0.232 * t4e8)) \r\n        + 0.0000623 * Math.cos(deg2rad * (83.3826 - 12006.2998 * t + 247.999 * t2e4 \r\n        + 29.262 * t3e6 - 13.826 * t4e8)) \r\n        + 0.0000483 * Math.cos(deg2rad * (51.6271 - 111868.8623 * t + 36.994 * t2e4 \r\n        + 4.190 * t3e6 - 2.001 * t4e8)) \r\n        + 0.0000348 * Math.cos(deg2rad * (100.7370 + 413335.3554 * t - 122.571 * t2e4 \r\n        - 10.684 * t3e6 + 5.028 * t4e8)) \r\n        - 0.0000316 * Math.cos(deg2rad * (308.4192 - 489205.1674 * t + 158.029 * t2e4 \r\n        + 14.915 * t3e6 - 7.029 * t4e8)) \r\n        - 0.0000253 * Math.cos(deg2rad * (46.6853 - 39870.7617 * t + 33.922 * t2e4 \r\n        + 4.272 * t3e6 - 2.001 * t4e8)) \r\n        - 0.0000141 * Math.cos(deg2rad * (274.1928 - 553068.6797 * t - 54.513 * t2e4 \r\n        - 10.116 * t3e6 + 4.797 * t4e8)) \r\n        + 0.0000127 * Math.cos(deg2rad * (325.7736 - 63863.5122 * t - 212.541 * t2e4 \r\n        - 25.031 * t3e6 + 11.826 * t4e8)) \r\n        + 0.0000117 * Math.cos(deg2rad * (184.1196 + 401329.0556 * t + 125.428 * t2e4 \r\n        + 18.579 * t3e6 - 8.798 * t4e8)) \r\n        - 0.0000078 * Math.cos(deg2rad * (98.3124 - 151739.6240 * t + 70.916 * t2e4 \r\n        + 8.462 * t3e6 - 4.001 * t4e8)) \r\n        - 0.0000063 * Math.cos(deg2rad * (238.1713 + 854535.1727 * t - 31.065 * t2e4 \r\n        + 3.623 * t3e6 - 1.769 * t4e8)) \r\n        + 0.0000063 * Math.cos(deg2rad * (134.9634 + 477198.8676 * t + 89.970 * t2e4 \r\n        + 14.348 * t3e6 - 6.797 * t4e8)) \r\n        + 0.0000036 * Math.cos(deg2rad * (321.5076 + 1443602.9027 * t + 21.912 * t2e4 \r\n        + 13.780 * t3e6 - 6.566 * t4e8)) \r\n        - 0.0000035 * Math.cos(deg2rad * (10.6638 + 1367733.0907 * t + 57.370 * t2e4 \r\n        + 18.011 * t3e6 - 8.566 * t4e8)) \r\n        + 0.0000024 * Math.cos(deg2rad * (149.8932 + 337465.5434 * t - 87.113 * t2e4 \r\n        - 6.453 * t3e6 + 3.028 * t4e8)) \r\n        + 0.0000024 * Math.cos(deg2rad * (170.9849 - 930404.9848 * t + 66.523 * t2e4 \r\n        + 0.608 * t3e6 - 0.232 * t4e8));\r\n\r\n    var sgp = - 0.0203 * Math.cos(deg2rad * (125.0 - 1934.1 * t)) \r\n        + 0.0034 * Math.cos(deg2rad * (220.2 - 1935.5 * t));\r\n\r\n    var gamma = 0.0449858 + sg + 1e-3 * sgp;\r\n\r\n    // longitude of perigee\r\n\r\n    var sp = - 15.448 * Math.sin(deg2rad * (100.7370 + 413335.3554 * t - 122.571 * t2e4 \r\n        - 10.684 * t3e6 + 5.028 * t4e8))\r\n        - 9.642 * Math.sin(deg2rad * (325.7736 - 63863.5122 * t - 212.541 * t2e4 \r\n        - 25.031 * t3e6 + 11.826 * t4e8)) \r\n        - 2.721 * Math.sin(deg2rad * (134.9634 + 477198.8676 * t + 89.970 * t2e4 \r\n        + 14.348 * t3e6 - 6.797 * t4e8)) \r\n        + 2.607 * Math.sin(deg2rad * (66.5106 + 349471.8432 * t - 335.112 * t2e4 \r\n        - 35.715 * t3e6 + 16.854 * t4e8)) \r\n        + 2.085 * Math.sin(deg2rad * (201.4740 + 826670.7108 * t - 245.142 * t2e4 \r\n        - 21.367 * t3e6 + 10.057 * t4e8)) \r\n        + 1.477 * Math.sin(deg2rad * (10.6638 + 1367733.0907 * t + 57.370 * t2e4 \r\n        + 18.011 * t3e6 - 8.566 * t4e8)) \r\n        + 0.968 * Math.sin(deg2rad * (291.5472 - 127727.0245 * t - 425.082 * t2e4 \r\n        - 50.062 * t3e6 + 23.651 * t4e8)) \r\n        - 0.949 * Math.sin(deg2rad * (103.2079 + 377336.3051 * t - 121.035 * t2e4 \r\n        - 10.724 * t3e6 + 5.028 * t4e8)) \r\n        - 0.703 * Math.sin(deg2rad * (167.2476 + 762807.1986 * t - 457.683 * t2e4 \r\n        - 46.398 * t3e6 + 21.882 * t4e8)) \r\n        - 0.660 * Math.sin(deg2rad * (235.7004 + 890534.2230 * t - 32.601 * t2e4 \r\n        + 3.664 * t3e6 - 1.769 * t4e8)) \r\n        - 0.577 * Math.sin(deg2rad * (190.8102 - 541062.3799 * t - 302.511 * t2e4 \r\n        - 39.379 * t3e6 + 18.623 * t4e8)) \r\n        - 0.524 * Math.sin(deg2rad * (269.9268 + 954397.7353 * t + 179.941 * t2e4 \r\n        + 28.695 * t3e6 - 13.594 * t4e8)) \r\n        - 0.482 * Math.sin(deg2rad * (32.2842 + 285608.3309 * t - 547.653 * t2e4 \r\n        - 60.746 * t3e6 + 28.679 * t4e8)) \r\n        + 0.452 * Math.sin(deg2rad * (357.5291 + 35999.0503 * t - 1.536 * t2e4 \r\n        + 0.041 * t3e6 + 0.000 * t4e8)) \r\n        - 0.381 * Math.sin(deg2rad * (302.2110 + 1240006.0662 * t - 367.713 * t2e4 \r\n        - 32.051 * t3e6 + 15.085 * t4e8)) \r\n        - 0.342 * Math.sin(deg2rad * (328.2445 - 99862.5625 * t - 211.005 * t2e4 \r\n        - 25.072 * t3e6 + 11.826 * t4e8)) \r\n        - 0.312 * Math.sin(deg2rad * (44.8902 + 1431596.6029 * t + 269.911 * t2e4 \r\n        + 43.043 * t3e6 - 20.392 * t4e8)) \r\n        + 0.282 * Math.sin(deg2rad * (162.8868 - 31931.7561 * t - 106.271 * t2e4 \r\n        - 12.516 * t3e6 + 5.913 * t4e8)) \r\n        + 0.255 * Math.sin(deg2rad * (203.9449 + 790671.6605 * t - 243.606 * t2e4 \r\n        - 21.408 * t3e6 + 10.057 * t4e8)) \r\n        + 0.252 * Math.sin(deg2rad * (68.9815 + 313472.7929 * t - 333.576 * t2e4 \r\n        - 35.756 * t3e6 + 16.854 * t4e8)) \r\n        - 0.211 * Math.sin(deg2rad * (83.3826 - 12006.2998 * t + 247.999 * t2e4 \r\n        + 29.262 * t3e6 - 13.826 * t4e8)) \r\n        + 0.193 * Math.sin(deg2rad * (267.9846 + 1176142.5540 * t - 580.254 * t2e4 \r\n        - 57.082 * t3e6 + 26.911 * t4e8)) \r\n        + 0.191 * Math.sin(deg2rad * (133.0212 + 698943.6863 * t - 670.224 * t2e4 \r\n        - 71.429 * t3e6 + 33.708 * t4e8)) \r\n        - 0.184 * Math.sin(deg2rad * (55.8468 - 1018261.2475 * t - 392.482 * t2e4 \r\n        - 53.726 * t3e6 + 25.420 * t4e8)) \r\n        + 0.182 * Math.sin(deg2rad * (145.6272 + 1844931.9583 * t + 147.340 * t2e4 \r\n        + 32.359 * t3e6 - 15.363 * t4e8)) \r\n        - 0.158 * Math.sin(deg2rad * (257.3208 - 191590.5367 * t - 637.623 * t2e4 \r\n        - 75.093 * t3e6 + 35.477 * t4e8)) \r\n        + 0.148 * Math.sin(deg2rad * (156.5838 - 604925.8921 * t - 515.053 * t2e4 \r\n        - 64.410 * t3e6 + 30.448 * t4e8)) \r\n        - 0.111 * Math.sin(deg2rad * (169.7185 + 726808.1483 * t - 456.147 * t2e4 \r\n        - 46.439 * t3e6 + 21.882 * t4e8)) \r\n        + 0.101 * Math.sin(deg2rad * (13.1347 + 1331734.0404 * t + 58.906 * t2e4 \r\n        + 17.971 * t3e6 - 8.566 * t4e8)) \r\n        + 0.100 * Math.sin(deg2rad * (358.0578 + 221744.8187 * t - 760.194 * t2e4 \r\n        - 85.777 * t3e6 + 40.505 * t4e8)) \r\n        + 0.087 * Math.sin(deg2rad * (98.2661 + 449334.4057 * t - 124.107 * t2e4 \r\n        - 10.643 * t3e6 + 5.028 * t4e8)) \r\n        + 0.080 * Math.sin(deg2rad * (42.9480 + 1653341.4216 * t - 490.283 * t2e4 \r\n        - 42.734 * t3e6 + 20.113 * t4e8)) \r\n        + 0.080 * Math.sin(deg2rad * (222.5657 - 441199.8173 * t - 91.506 * t2e4 \r\n        - 14.307 * t3e6 + 6.797 * t4e8)) \r\n        + 0.077 * Math.sin(deg2rad * (294.0181 - 163726.0747 * t - 423.546 * t2e4 \r\n        - 50.103 * t3e6 + 23.651 * t4e8)) \r\n        - 0.073 * Math.sin(deg2rad * (280.8834 - 1495460.1151 * t - 482.452 * t2e4 \r\n        - 68.074 * t3e6 + 32.217 * t4e8)) \r\n        - 0.071 * Math.sin(deg2rad * (304.6819 + 1204007.0159 * t - 366.177 * t2e4 \r\n        - 32.092 * t3e6 + 15.085 * t4e8)) \r\n        - 0.069 * Math.sin(deg2rad * (233.7582 + 1112279.0417 * t - 792.795 * t2e4 \r\n        - 82.113 * t3e6 + 38.736 * t4e8)) \r\n        - 0.067 * Math.sin(deg2rad * (34.7551 + 249609.2807 * t - 546.117 * t2e4 \r\n        - 60.787 * t3e6 + 28.679 * t4e8)) \r\n        - 0.067 * Math.sin(deg2rad * (263.6238 + 381403.5993 * t - 228.841 * t2e4 \r\n        - 23.199 * t3e6 + 10.941 * t4e8)) \r\n        + 0.055 * Math.sin(deg2rad * (21.6203 - 1082124.7597 * t - 605.023 * t2e4 \r\n        - 78.757 * t3e6 + 37.246 * t4e8)) \r\n        + 0.055 * Math.sin(deg2rad * (308.4192 - 489205.1674 * t + 158.029 * t2e4 \r\n        + 14.915 * t3e6 -7.029 * t4e8)) \r\n        - 0.054 * Math.sin(deg2rad * (8.7216 + 1589477.9094 * t - 702.824 * t2e4 \r\n        - 67.766 * t3e6 + 31.939 * t4e8)) \r\n        - 0.052 * Math.sin(deg2rad * (179.8536 + 1908795.4705 * t + 359.881 * t2e4 \r\n        + 57.390 * t3e6 - 27.189 * t4e8)) \r\n        - 0.050 * Math.sin(deg2rad * (98.7948 + 635080.1741 * t - 882.765 * t2e4 \r\n        - 96.461 * t3e6 + 45.533 * t4e8)) \r\n        - 0.049 * Math.sin(deg2rad * (128.6604 - 95795.2683 * t - 318.812 * t2e4 \r\n        - 37.547 * t3e6 + 17.738 * t4e8)) \r\n        - 0.047 * Math.sin(deg2rad * (17.3544 + 425341.6552 * t - 370.570 * t2e4 \r\n        - 39.946 * t3e6 + 18.854 * t4e8)) \r\n        - 0.044 * Math.sin(deg2rad * (160.4159 + 4067.2942 * t - 107.806 * t2e4 \r\n        - 12.475 * t3e6 + 5.913 * t4e8)) \r\n        - 0.043 * Math.sin(deg2rad * (238.1713 + 854535.1727 * t - 31.065 * t2e4 \r\n        + 3.623 * t3e6 - 1.769 * t4e8)) \r\n        + 0.042 * Math.sin(deg2rad * (270.4555 + 1140143.5037 * t - 578.718 * t2e4 \r\n        - 57.123 * t3e6 + 26.911 * t4e8)) \r\n        - 0.042 * Math.sin(deg2rad * (132.4925 + 513197.9179 * t + 88.434 * t2e4 \r\n        + 14.388 * t3e6 - 6.797 * t4e8)) \r\n        - 0.041 * Math.sin(deg2rad * (122.3573 - 668789.4043 * t - 727.594 * t2e4 \r\n        - 89.441 * t3e6 + 42.274 * t4e8)) \r\n        - 0.040 * Math.sin(deg2rad * (105.6788 + 341337.2548 * t - 119.499 * t2e4 \r\n        - 10.765 * t3e6 + 5.028 * t4e8)) \r\n        + 0.038 * Math.sin(deg2rad * (135.4921 + 662944.6361 * t - 668.688 * t2e4 \r\n        - 71.470 * t3e6 + 33.708 * t4e8)) \r\n        - 0.037 * Math.sin(deg2rad * (242.3910 - 51857.2124 * t - 460.540 * t2e4 \r\n        - 54.293 * t3e6 + 25.652 * t4e8)) \r\n        + 0.036 * Math.sin(deg2rad * (336.4374 +  1303869.5784 * t - 155.171 * t2e4 \r\n        - 7.020 * t3e6 + 3.259 * t4e8)) \r\n        + 0.035 * Math.sin(deg2rad * (223.0943 - 255454.0489 * t - 850.164 * t2e4 \r\n        - 100.124 * t3e6 + 47.302 * t4e8)) \r\n        - 0.034 * Math.sin(deg2rad * (193.2811 - 577061.4302 * t - 300.976 * t2e4 \r\n        - 39.419 * t3e6 + 18.623 * t4e8)) \r\n        + 0.031 * Math.sin(deg2rad * (87.6023 - 918398.6850 * t - 181.476 * t2e4 \r\n        - 28.654 * t3e6 + 13.594 * t4e8));\r\n\r\n    var spp = 2.4 * Math.sin(deg2rad * (103.2 + 377336.3 * t));\r\n\r\n    var lp = 83.353 + 4069.0137 * t - 103.238 * t2e4 \r\n        - 12.492 * t3e6 + 5.263 * t4e8 + sp + 1e-3 * t * spp;\r\n\r\n    // longitude of the ascending node\r\n\r\n    var sr = - 1.4979 * Math.sin(deg2rad * (49.1562 - 75869.8120 * t + 35.458 * t2e4 \r\n        + 4.231 * t3e6 - 2.001 * t4e8)) \r\n        - 0.1500 * Math.sin(deg2rad * (357.5291 + 35999.0503 * t - 1.536 * t2e4 \r\n        + 0.041 * t3e6 + 0.000 * t4e8)) \r\n        - 0.1226 * Math.sin(deg2rad * (235.7004 + 890534.2230 * t - 32.601 * t2e4 \r\n        + 3.664 * t3e6 - 1.769 * t4e8)) \r\n        + 0.1176 * Math.sin(deg2rad * (186.5442 + 966404.0351 * t - 68.058 * t2e4 \r\n        - 0.567 * t3e6 + 0.232 * t4e8)) \r\n        - 0.0801 * Math.sin(deg2rad * (83.3826 - 12006.2998 * t + 247.999 * t2e4 \r\n        + 29.262 * t3e6 - 13.826 * t4e8)) \r\n        - 0.0616 * Math.sin(deg2rad * (51.6271 - 111868.8623 * t + 36.994 * t2e4 \r\n        + 4.190 * t3e6 - 2.001 * t4e8)) \r\n        + 0.0490 * Math.sin(deg2rad * (100.7370 + 413335.3554 * t - 122.571 * t2e4 \r\n        - 10.684 * t3e6 + 5.028 * t4e8)) \r\n        + 0.0409 * Math.sin(deg2rad * (308.4192 - 489205.1674 * t + 158.029 * t2e4 \r\n        + 14.915 * t3e6 - 7.029 * t4e8)) \r\n        + 0.0327 * Math.sin(deg2rad * (134.9634 + 477198.8676 * t + 89.970 * t2e4 \r\n        + 14.348 * t3e6 - 6.797 * t4e8)) \r\n        + 0.0324 * Math.sin(deg2rad * (46.6853 - 39870.7617 * t + 33.922 * t2e4 \r\n        + 4.272 * t3e6 - 2.001 * t4e8)) \r\n        + 0.0196 * Math.sin(deg2rad * (98.3124 - 151739.6240 * t + 70.916 * t2e4 \r\n        + 8.462 * t3e6 - 4.001 * t4e8)) \r\n        + 0.0180 * Math.sin(deg2rad * (274.1928 - 553068.6797 * t - 54.513 * t2e4 \r\n        - 10.116 * t3e6 + 4.797 * t4e8)) \r\n        + 0.0150 * Math.sin(deg2rad * (325.7736 - 63863.5122 * t - 212.541 * t2e4 \r\n        - 25.031 * t3e6 + 11.826 * t4e8)) \r\n        - 0.0150 * Math.sin(deg2rad * (184.1196 + 401329.0556 * t + 125.428 * t2e4 \r\n        + 18.579 * t3e6 - 8.798 * t4e8)) \r\n        - 0.0078 * Math.sin(deg2rad * (238.1713 + 854535.1727 * t - 31.065 * t2e4 \r\n        + 3.623 * t3e6 - 1.769 * t4e8)) \r\n        - 0.0045 * Math.sin(deg2rad * (10.6638 + 1367733.0907 * t + 57.370 * t2e4 \r\n        + 18.011 * t3e6 - 8.566 * t4e8)) \r\n        + 0.0044 * Math.sin(deg2rad * (321.5076 + 1443602.9027 * t + 21.912 * t2e4 \r\n        + 13.780 * t3e6 - 6.566 * t4e8)) \r\n        - 0.0042 * Math.sin(deg2rad * (162.8868 - 31931.7561 * t - 106.271 * t2e4 \r\n        - 12.516 * t3e6 + 5.913 * t4e8)) \r\n        - 0.0031 * Math.sin(deg2rad * (170.9849 - 930404.9848 * t + 66.523 * t2e4 \r\n        + 0.608 * t3e6 - 0.232 * t4e8)) \r\n        + 0.0031 * Math.sin(deg2rad * (103.2079 + 377336.3051 * t - 121.035 * t2e4 \r\n        - 10.724 * t3e6 + 5.028 * t4e8)) \r\n        + 0.0029 * Math.sin(deg2rad * (222.6120 - 1042273.8471 * t + 103.516 * t2e4 \r\n        + 4.798 * t3e6 - 2.232 * t4e8)) \r\n        + 0.0028 * Math.sin(deg2rad * (184.0733 + 1002403.0853 * t - 69.594 * t2e4 \r\n        - 0.526 * t3e6 + 0.232 * t4e8));\r\n\r\n    var srp = 25.9 * Math.sin(deg2rad * (125.0 - 1934.1 * t)) \r\n        - 4.3 * Math.sin(deg2rad * (220.2 - 1935.5 * t));\r\n\r\n    var srpp = 0.38 * Math.sin(deg2rad * (357.5 + 35999.1 * t));\r\n\r\n    var raan = 125.0446 - 1934.13618 * t + 20.762 * t2e4 \r\n        + 2.139 * t3e6 - 1.650 * t4e8 + sr \r\n        + 1e-3 * (srp + srpp * t);\r\n\r\n    // mean longitude\r\n\r\n    var sl = - 0.92581 * Math.sin(deg2rad * (235.7004 + 890534.2230 * t - 32.601 * t2e4 \r\n        + 3.664 * t3e6 - 1.769 * t4e8)) \r\n        + 0.33262 * Math.sin(deg2rad * (100.7370 + 413335.3554 * t - 122.571 * t2e4 \r\n        - 10.684 * t3e6 + 5.028 * t4e8)) \r\n        - 0.18402 * Math.sin(deg2rad * (357.5291 + 35999.0503 * t - 1.536 * t2e4 \r\n        + 0.041 * t3e6 + 0.000 * t4e8)) \r\n        + 0.11007 * Math.sin(deg2rad * (134.9634 + 477198.8676 * t + 89.970 * t2e4 \r\n        + 14.348 * t3e6 - 6.797 * t4e8)) \r\n        - 0.06055 * Math.sin(deg2rad * (238.1713 + 854535.1727 * t - 31.065 * t2e4 \r\n        + 3.623 * t3e6 - 1.769 * t4e8)) \r\n        + 0.04741 * Math.sin(deg2rad * (325.7736 - 63863.5122 * t - 212.541 * t2e4 \r\n        - 25.031 * t3e6 + 11.826 * t4e8)) \r\n        - 0.03086 * Math.sin(deg2rad * (10.6638 + 1367733.0907 * t + 57.370 * t2e4 \r\n        + 18.011 * t3e6 - 8.566 * t4e8)) \r\n        + 0.02184 * Math.sin(deg2rad * (103.2079 + 377336.3051 * t - 121.035 * t2e4 \r\n        - 10.724 * t3e6 + 5.028 * t4e8)) \r\n        + 0.01645 * Math.sin(deg2rad * (49.1562 - 75869.8120 * t + 35.458 * t2e4 \r\n        + 4.231 * t3e6 - 2.001 * t4e8)) \r\n        + 0.01022 * Math.sin(deg2rad * (233.2295 + 926533.2733 * t - 34.136 * t2e4 \r\n        + 3.705 * t3e6 - 1.769 * t4e8)) \r\n        - 0.00756 * Math.sin(deg2rad * (336.4374 + 1303869.5784 * t - 155.171 * t2e4 \r\n        - 7.020 * t3e6 + 3.259 * t4e8)) \r\n        - 0.00530 * Math.sin(deg2rad * (222.5657 - 441199.8173 * t - 91.506 * t2e4 \r\n        - 14.307 * t3e6 + 6.797 * t4e8)) \r\n        - 0.00496 * Math.sin(deg2rad * (162.8868 - 31931.7561 * t - 106.271 * t2e4 \r\n        - 12.516 * t3e6 + 5.913 * t4e8)) \r\n        - 0.00472 * Math.sin(deg2rad * (297.8502 + 445267.1115 * t - 16.300 * t2e4 \r\n        + 1.832 * t3e6 - 0.884 * t4e8)) \r\n        - 0.00271 * Math.sin(deg2rad * (240.6422 + 818536.1225 * t - 29.529 * t2e4 \r\n        + 3.582 * t3e6 - 1.769 * t4e8)) \r\n        + 0.00264 * Math.sin(deg2rad * (132.4925 + 513197.9179 * t + 88.434 * t2e4 \r\n        + 14.388 * t3e6 - 6.797 * t4e8)) \r\n        - 0.00254 * Math.sin(deg2rad * (186.5442 + 966404.0351 * t - 68.058 * t2e4 \r\n        - 0.567 * t3e6 + 0.232 * t4e8)) \r\n        + 0.00234 * Math.sin(deg2rad * (269.9268 + 954397.7353 * t + 179.941 * t2e4 \r\n        + 28.695 * t3e6 - 13.594 * t4e8)) \r\n        - 0.00220 * Math.sin(deg2rad * (13.1347 + 1331734.0404 * t + 58.906 * t2e4 \r\n        + 17.971 * t3e6 - 8.566 * t4e8)) \r\n        - 0.00202 * Math.sin(deg2rad * (355.0582 + 71998.1006 * t - 3.072 * t2e4 \r\n        + 0.082 * t3e6 + 0.000 * t4e8)) \r\n        + 0.00167 * Math.sin(deg2rad * (328.2445 - 99862.5625 * t - 211.005 * t2e4 \r\n        - 25.072 * t3e6 + 11.826 * t4e8)) \r\n        - 0.00143 * Math.sin(deg2rad * (173.5506 + 1335801.3346 * t - 48.901 * t2e4 \r\n        + 5.496 * t3e6 - 2.653 * t4e8)) \r\n        - 0.00121 * Math.sin(deg2rad * (98.2661 + 449334.4057 * t - 124.107 * t2e4 \r\n        - 10.643 * t3e6 + 5.028 * t4e8)) \r\n        - 0.00116 * Math.sin(deg2rad * (145.6272 + 1844931.9583 * t + 147.340 * t2e4 \r\n        + 32.359 * t3e6 - 15.363 * t4e8)) \r\n        + 0.00102 * Math.sin(deg2rad * (105.6788 + 341337.2548 * t - 119.499 * t2e4 \r\n        - 10.765 * t3e6 + 5.028 * t4e8)) \r\n        - 0.00090 * Math.sin(deg2rad * (184.1196 + 401329.0556 * t + 125.428 * t2e4 \r\n        + 18.579 * t3e6 - 8.798 * t4e8)) \r\n        - 0.00086 * Math.sin(deg2rad * (338.9083 + 1267870.5281 * t - 153.636 * t2e4 \r\n        - 7.061 * t3e6 + 3.259 * t4e8)) \r\n        - 0.00078 * Math.sin(deg2rad * (111.4008 + 1781068.4461 * t - 65.201 * t2e4 \r\n        + 7.328 * t3e6 - 3.538 * t4e8)) \r\n        + 0.00069 * Math.sin(deg2rad * (323.3027 - 27864.4619 * t - 214.077 * t2e4 \r\n        - 24.990 * t3e6 + 11.826 * t4e8)) \r\n        + 0.00066 * Math.sin(deg2rad * (51.6271 - 111868.8623 * t + 36.994 * t2e4 \r\n        + 4.190 * t3e6 - 2.001 * t4e8)) \r\n        + 0.00065 * Math.sin(deg2rad * (38.5872 + 858602.4669 * t - 138.871 * t2e4 \r\n        - 8.852 * t3e6 + 4.144 * t4e8)) \r\n        - 0.00060 * Math.sin(deg2rad * (83.3826 - 12006.2998 * t + 247.999 * t2e4 \r\n        + 29.262 * t3e6 - 13.826 * t4e8)) \r\n        + 0.00054 * Math.sin(deg2rad * (201.4740 + 826670.7108 * t - 245.142 * t2e4 \r\n        - 21.367 * t3e6 + 10.057 * t4e8)) \r\n        - 0.00052 * Math.sin(deg2rad * (308.4192 - 489205.1674 * t + 158.029 * t2e4 \r\n        + 14.915 * t3e6 - 7.029 * t4e8)) \r\n        + 0.00048 * Math.sin(deg2rad * (8.1929 + 1403732.1410 * t + 55.834 * t2e4 \r\n        + 18.052 * t3e6 - 8.566 * t4e8)) \r\n        - 0.00041 * Math.sin(deg2rad * (46.6853 - 39870.7617 * t + 33.922 * t2e4 \r\n        + 4.272 * t3e6 - 2.001 * t4e8)) \r\n        - 0.00033 * Math.sin(deg2rad * (274.1928 - 553068.6797 * t - 54.513 * t2e4 \r\n        - 10.116 * t3e6 + 4.797 * t4e8)) \r\n        + 0.00030 * Math.sin(deg2rad * (160.4159 + 4067.2942 * t - 107.806 * t2e4 \r\n        - 12.475 * t3e6 + 5.913 * t4e8));\r\n\r\n    var slp = 3.96 * Math.sin(deg2rad * (119.7 + 131.8 * t)) \r\n        + 1.96 * Math.sin(deg2rad * (125.0 - 1934.1 * t));\r\n\r\n    var slpp = 0.463 * Math.sin(deg2rad * (357.5 + 35999.1 * t)) \r\n        + 0.152 * Math.sin(deg2rad * (238.2 + 854535.2 * t)) \r\n        - 0.071 * Math.sin(deg2rad * (27.8 + 131.8 * t)) \r\n        - 0.055 * Math.sin(deg2rad * (103.2 + 377336.3 * t)) \r\n        - 0.026 * Math.sin(deg2rad * (233.2 + 926533.3 * t));\r\n\r\n    var slppp = 14 * Math.sin(deg2rad * (357.5 + 35999.1 * t)) \r\n        + 5 * Math.sin(deg2rad * (238.2 + 854535.2 * t));\r\n\r\n    var lambda = 218.31665 + 481267.88134 * t - 13.268 * t2e4 \r\n        + 1.856 * t3e6 - 1.534 * t4e8 + sl \r\n        + 1e-3 * (slp + slpp * t + slppp * t2e4);\r\n\r\n     dat.a = sma;\r\n     dat.e = ecc;\r\n     dat.i = 2.0 * Math.asin(gamma);\r\n     dat.w = Trig.normalize(deg2rad * (lp - raan));\r\n     dat.N = Trig.normalize(deg2rad * raan);\r\n     dat.M = Trig.normalize(deg2rad * (lambda - lp));\r\n     return dat;\r\n  },\r\n  corr: function(dat, sol) {\r\n    var M = Trig.normalize(sol.M + Math.PI),\r\n        w = Trig.normalize(sol.w + Math.PI),\r\n        L = dat.M + dat.w,     // Argument of latitude \r\n        E = L + dat.N - M - w; // Mean elongation\r\n    \r\n    var lon = \r\n      -0.022234 * Math.sin(dat.M - 2*E) +  // Evection\r\n       0.011494 * Math.sin(2*E) +          // Variation\r\n      -0.003246 * Math.sin(M) +        // Yearly Equation\r\n      -0.001029 * Math.sin(2*dat.M - 2*E) +\r\n      -9.94838e-4 * Math.sin(dat.M - 2*E + M) +\r\n       9.25025e-4 * Math.sin(dat.M + 2*E) +\r\n       8.02851e-4 * Math.sin(2*E - M) +\r\n       7.15585e-4 * Math.sin(dat.M - M) +\r\n      -6.10865e-4 * Math.sin(E) + \r\n      -5.41052e-4 * Math.sin(dat.M + M) +\r\n      -2.61799e-4 * Math.sin(2*L - 2*E) +\r\n       1.91986e-4 * Math.sin(dat.M - 4*E);\r\n    dat.ra += lon;\r\n    var lat =\r\n      -0.003019 * Math.sin(L - 2*E) +\r\n      -9.59931e-4 * Math.sin(dat.M - L - 2*E) +\r\n      -8.02851e-4 * Math.sin(dat.M + L - 2*E) +\r\n       5.75958e-4 * Math.sin(L + 2*E) +\r\n       2.96706e-4 * Math.sin(2*dat.M + L);  \r\n    dat.dec += lat;\r\n  \r\n    dat.age = Trig.normalize(dat.l - sol.l + Math.PI);   \r\n    dat.phase = 0.5 * (1 - Math.cos(dat.age));\r\n\r\n    return dat;\r\n  }\r\n\r\n};\r\nfunction exportSVG(fname) {\r\n  var doc = d3.select(\"body\").append(\"div\").attr(\"id\", \"d3-celestial-svg\").attr(\"style\", \"display: none\"),\r\n      svg = d3.select(\"#d3-celestial-svg\").append(\"svg\"), //.attr(\"style\", \"display: none\"),\r\n      m = Celestial.metrics(),\r\n      cfg = settings.set(),\r\n      path = cfg.datapath,\r\n      proj = projections[cfg.projection],\r\n      rotation = getAngles(cfg.center),\r\n      center = [-rotation[0], -rotation[1]],\r\n      scale0 = proj.scale * m.width/1024,\r\n      projection = Celestial.projection(cfg.projection).rotate(rotation).translate([m.width/2, m.height/2]).scale([m.scale]),\r\n      adapt = cfg.adaptable ? Math.sqrt(m.scale/scale0) : 1,\r\n      culture = (cfg.culture !== \"\" && cfg.culture !== \"iau\") ? cfg.culture : \"\",\r\n      circle, id;\r\n\r\n  svg.selectAll(\"*\").remove();\r\n\r\n  var defs = svg.append(\"defs\");\r\n\r\n  if (proj.clip) {\r\n    projection.clipAngle(90);\r\n  }\r\n  circle = d3.geo.circle().angle([179.95]).origin(center);\r\n\r\n  svg.attr(\"width\", m.width).attr(\"height\", m.height);\r\n  // .attr(\"viewBox\", \" 0 0 \" + (m.width) + \" \" + (m.height));\r\n\r\n  var groupNames = ['background', 'milkyWay', 'milkyWayBg', 'gridLines', 'constBoundaries', \r\n                    'planesequatorial', 'planesecliptic', 'planesgalactic', 'planessupergalactic',\r\n                    'constLines', 'mapBorder','stars', 'dsos', 'planets', 'gridvaluesLon', 'gridvaluesLat', \r\n                    'constNames', 'starDesignations', 'starNames', 'dsoNames', 'planetNames', 'horizon', 'daylight'],\r\n                groups = {}, styles = {};\r\n\r\n  for (var i=0; i<groupNames.length; i++) {\r\n     // inkscape:groupmode=\"layer\", inkscape:label=\"Ebene 1\" \r\n    groups[groupNames[i]] = svg.append('g').attr({\"id\": groupNames[i], \":inkscape:groupmode\": \"layer\", \":inkscape:label\": groupNames[i]});\r\n    styles[groupNames[i]] = {};\r\n  }\r\n\r\n  var graticule = d3.geo.graticule().minorStep([15,10]);\r\n  \r\n  var map = d3.geo.path().projection(projection);\r\n\r\n  var q = d3.queue(2);\r\n  \r\n  groups.background.append(\"path\").datum(circle).attr(\"class\", \"background\").attr(\"d\", map); \r\n  styles.background.fill = cfg.background.fill;\r\n\r\n  if (cfg.lines.graticule.show) {\r\n    if (cfg.transform === \"equatorial\") {\r\n      groups.gridLines.append(\"path\").datum(graticule)\r\n       .attr(\"class\", \"gridLines\")\r\n       .attr(\"d\", map);\r\n      styles.gridLines = svgStyle(cfg.lines.graticule);\r\n    } else {\r\n      Celestial.graticule(groups.gridLines, map, cfg.transform);\r\n      styles.gridLines = svgStyle(cfg.lines.graticule);\r\n    }\r\n    if (has(cfg.lines.graticule, \"lon\") && cfg.lines.graticule.lon.pos.length > 0) {\r\n      var jlon = {type: \"FeatureCollection\", features: getGridValues(\"lon\", cfg.lines.graticule.lon.pos)};      \r\n      groups.gridvaluesLon.selectAll(\".gridvalues_lon\")\r\n        .data(jlon.features)\r\n        .enter().append(\"text\")\r\n        .attr(\"transform\", function(d, i) { return point(d.geometry.coordinates); })\r\n        .text( function(d) { return d.properties.value; } )\r\n        .attr({dy: \".5em\", dx: \"-.75em\", class: \"gridvaluesLon\"});\r\n      styles.gridvaluesLon = svgTextStyle(cfg.lines.graticule.lon); \r\n    }\r\n    if (has(cfg.lines.graticule, \"lat\") && cfg.lines.graticule.lat.pos.length > 0) {\r\n      var jlat = {type: \"FeatureCollection\", features: getGridValues(\"lat\", cfg.lines.graticule.lat.pos)};\r\n      groups.gridvaluesLat.selectAll(\".gridvalues_lat\")\r\n        .data(jlat.features)\r\n        .enter().append(\"text\")\r\n        .attr(\"transform\", function(d, i) { return point(d.geometry.coordinates); })\r\n        .text( function(d) { return d.properties.value; } )\r\n        .attr({dy: \"-.5em\", dx: \"-.75em\", class: \"gridvaluesLat\"});\r\n       styles.gridvaluesLat = svgTextStyle(cfg.lines.graticule.lat); \r\n    }\r\n  }\r\n\r\n  //Celestial planes\r\n  for (var key in cfg.lines) {\r\n    if (has(cfg.lines, key) && key != \"graticule\" && cfg.lines[key].show !== false) { \r\n      id = \"planes\" + key;\r\n      groups[id].append(\"path\")\r\n         .datum(d3.geo.circle().angle([90]).origin(poles[key]) )\r\n         .attr(\"class\", id)\r\n         .attr(\"d\", map);\r\n      styles[id] = svgStyle(cfg.lines[key]);\r\n    }\r\n  }\r\n\r\n  //Milky way outline\r\n  if (cfg.mw.show) {\r\n    q.defer(function(callback) { \r\n      d3.json(path + \"mw.json\", function(error, json) {\r\n        if (error) callback(error);\r\n        var mw = getData(json, cfg.transform);\r\n        var mw_back = getMwbackground(mw);\r\n        \r\n        groups.milkyWay.selectAll(\".mway\")\r\n         .data(mw.features)\r\n         .enter().append(\"path\")\r\n         .attr(\"class\", \"milkyWay\")\r\n         .attr(\"d\", map);\r\n        styles.milkyWay = svgStyle(cfg.mw.style);\r\n        \r\n        if (!has(cfg.background, \"opacity\") || cfg.background.opacity > 0.95) {\r\n          groups.milkyWayBg.selectAll(\".mwaybg\")\r\n           .data(mw_back.features)\r\n           .enter().append(\"path\")\r\n           .attr(\"class\", \"milkyWayBg\")\r\n           .attr(\"d\", map);\r\n          styles.milkyWayBg = {\"fill\": cfg.background.fill, \r\n                   \"fill-opacity\": cfg.background.opacity };\r\n        }\r\n        callback(null);\r\n      });\r\n    });\r\n  }\r\n\r\n  //Constellation boundaries\r\n  if (cfg.constellations.bounds) { \r\n    q.defer(function(callback) { \r\n      d3.json(path + filename(\"constellations\", \"borders\"), function(error, json) {\r\n        if (error) callback(error);\r\n\r\n        var conb = getData(json, cfg.transform);\r\n        if (Celestial.constellation) {\r\n          var re = new RegExp(\"\\\\b\" + Celestial.constellation + \"\\\\b\");\r\n        }\r\n\r\n        groups.constBoundaries.selectAll(\".bounds\")\r\n         .data(conb.features)\r\n         .enter().append(\"path\")\r\n         .attr(\"class\", function(d) { return (Celestial.constellation && d.ids.search(re) !== -1) ? \"constBoundariesSel\" : \"constBoundaries\"; }) \r\n         .attr(\"d\", map);\r\n\r\n        styles.constBoundaries = svgStyle(cfg.constellations.boundStyle);\r\n        styles.constBoundariesSel = {\"fill\": \"none\",\r\n            \"stroke\": cfg.constellations.boundStyle.stroke, \r\n            \"stroke-width\": cfg.constellations.boundStyle.width * 1.5,\r\n            \"stroke-opacity\": 1,\r\n            \"stroke-dasharray\": \"none\"};\r\n        \r\n        callback(null);\r\n      });\r\n    });\r\n  }\r\n\r\n  //Constellation lines\r\n  if (cfg.constellations.lines) { \r\n    q.defer(function(callback) { \r\n      d3.json(path + filename(\"constellations\", \"lines\"), function(error, json) {\r\n        if (error) callback(error);\r\n\r\n        var conl = getData(json, cfg.transform);\r\n        groups.constLines.selectAll(\".lines\")\r\n         .data(conl.features)\r\n         .enter().append(\"path\")\r\n         .attr(\"class\", function(d) { return \"constLines\" + d.properties.rank; })\r\n         .attr(\"d\", map);\r\n\r\n        var dasharray = has(cfg.constellations.lineStyle, \"dash\") ? cfg.constellations.lineStyle.dash.join(\" \") : \"none\";\r\n         \r\n        styles.constLines1 = {\"fill\": \"none\", \"stroke\": cfg.constellations.lineStyle.stroke[0],\r\n                              \"stroke-width\": cfg.constellations.lineStyle.width[0],\r\n                              \"stroke-opacity\": cfg.constellations.lineStyle.opacity[0],\r\n                              \"stroke-dasharray\": dasharray};\r\n        styles.constLines2 = {\"fill\": \"none\", \"stroke\": cfg.constellations.lineStyle.stroke[1],\r\n                              \"stroke-width\": cfg.constellations.lineStyle.width[1],\r\n                              \"stroke-opacity\": cfg.constellations.lineStyle.opacity[1],\r\n                              \"stroke-dasharray\": dasharray};\r\n        styles.constLines3 = {\"fill\": \"none\", \"stroke\": cfg.constellations.lineStyle.stroke[2],\r\n                              \"stroke-width\": cfg.constellations.lineStyle.width[2],\r\n                              \"stroke-opacity\": cfg.constellations.lineStyle.opacity[2],\r\n                              \"stroke-dasharray\": dasharray};\r\n        callback(null);\r\n      });\r\n    });\r\n  }\r\n\r\n  // Map border\r\n  q.defer(function(callback) {\r\n    var rot = projection.rotate();\r\n    projection.rotate([0,0,0]);\r\n    groups.mapBorder.append(\"path\")\r\n     .datum(graticule.outline)\r\n     .attr(\"class\", \"mapBorder\")\r\n     .attr(\"d\", map);\r\n     \r\n    styles.mapBorder = {\"fill\": \"none\", \"stroke\": cfg.background.stroke, \"stroke-width\": cfg.background.width, \"stroke-opacity\": 1, \"stroke-dasharray\": \"none\" };\r\n\r\n    projection.rotate(rot);\r\n    callback(null);\r\n  });  \r\n  \r\n  //Constellation names or designation\r\n  if (cfg.constellations.names) { \r\n    q.defer(function(callback) { \r\n      d3.json(path + filename(\"constellations\"), function(error, json) {\r\n        if (error) callback(error);\r\n\r\n        var conn = getData(json, cfg.transform);\r\n        groups.constNames.selectAll(\".constnames\")\r\n         .data(conn.features.filter( function(d) {\r\n            return clip(d.geometry.coordinates) === 1; \r\n          }))\r\n         .enter().append(\"text\")\r\n         .attr(\"class\", function(d) { return \"constNames\" + d.properties.rank; })\r\n         .attr(\"transform\", function(d, i) { return point(d.geometry.coordinates); })\r\n         .text( function(d) { return constName(d); } ); \r\n \r\n        styles.constNames1 = {\"fill\": cfg.constellations.nameStyle.fill[0],\r\n                              \"fill-opacity\": cfg.constellations.nameStyle.opacity[0],\r\n                              \"font\": cfg.constellations.nameStyle.font[0],\r\n                              \"text-anchor\": svgAlign(cfg.constellations.nameStyle.align)};\r\n        styles.constNames2 = {\"fill\": cfg.constellations.nameStyle.fill[1],\r\n                              \"fill-opacity\": cfg.constellations.nameStyle.opacity[1],\r\n                              \"font\": cfg.constellations.nameStyle.font[1],\r\n                              \"text-anchor\": svgAlign(cfg.constellations.nameStyle.align)};\r\n        styles.constNames3 = {\"fill\": cfg.constellations.nameStyle.fill[2],\r\n                              \"fill-opacity\": cfg.constellations.nameStyle.opacity[2],\r\n                              \"font\": cfg.constellations.nameStyle.font[2],\r\n                              \"text-anchor\": svgAlign(cfg.constellations.nameStyle.align)};\r\n        callback(null);\r\n      });\r\n    });\r\n  }\r\n  \r\n  //Stars\r\n  if (cfg.stars.show) { \r\n    q.defer(function(callback) { \r\n      d3.json(path +  cfg.stars.data, function(error, json) {\r\n        if (error) callback(error);\r\n\r\n        var cons = getData(json, cfg.transform);\r\n        \r\n        groups.stars.selectAll(\".stars\")\r\n          .data(cons.features.filter( function(d) {\r\n            return d.properties.mag <= cfg.stars.limit; \r\n          }))\r\n          .enter().append(\"path\")\r\n          .attr(\"class\", function(d) { return \"stars\" + starColor(d.properties.bv); })\r\n          .attr(\"d\", map.pointRadius( function(d) {\r\n            return d.properties ? starSize(d.properties.mag) : 1;\r\n          }));\r\n\r\n        styles.stars = svgStyle(cfg.stars.style);\r\n        var range = bvcolor.domain();\r\n        for (i=Round(range[1],1); i<=Round(range[0],1); i+=0.1) {\r\n          styles[\"stars\" + Math.round(i*10).toString()] = {\"fill\": bvcolor(i)};\r\n        }\r\n          \r\n        if (cfg.stars.designation) { \r\n          groups.starDesignations.selectAll(\".stardesigs\")\r\n            .data(cons.features.filter( function(d) {\r\n              return d.properties.mag <= cfg.stars.designationLimit*adapt && clip(d.geometry.coordinates) === 1; \r\n            }))\r\n            .enter().append(\"text\")\r\n            .attr(\"transform\", function(d) { return point(d.geometry.coordinates); })\r\n            .text( function(d) { return starDesignation(d.id); })\r\n            .attr({dy: \".85em\", dx: \".35em\", class: \"starDesignations\"});\r\n          styles.starDesignations = svgTextStyle(cfg.stars.designationStyle);\r\n        }\r\n        if (cfg.stars.propername) { \r\n          groups.starNames.selectAll(\".starnames\")\r\n            .data(cons.features.filter( function(d) {\r\n              return d.properties.mag <= cfg.stars.propernameLimit*adapt && clip(d.geometry.coordinates) === 1; \r\n            }))\r\n            .enter().append(\"text\")\r\n            .attr(\"transform\", function(d) { return point(d.geometry.coordinates); })\r\n            .text( function(d) { return starPropername(d.id); })\r\n            .attr({dy: \"-.5em\", dx: \"-.35em\", class: \"starNames\"});\r\n\r\n          styles.starNames = svgTextStyle(cfg.stars.propernameStyle);\r\n        }\r\n        callback(null);\r\n      });\r\n    });\r\n  }\r\n\r\n  //Deep space objects\r\n  if (cfg.dsos.show) { \r\n    q.defer(function(callback) { \r\n      d3.json(path +  cfg.dsos.data, function(error, json) {\r\n        if (error) callback(error);\r\n\r\n        var cond = getData(json, cfg.transform);\r\n        \r\n        groups.dsos.selectAll(\".dsos\")\r\n          .data(cond.features.filter( function(d) {\r\n            return clip(d.geometry.coordinates) === 1 && \r\n                   (d.properties.mag === 999 && Math.sqrt(parseInt(d.properties.dim)) > cfg.dsos.limit*adapt ||\r\n                   d.properties.mag !== 999 && d.properties.mag <= cfg.dsos.limit); \r\n          }))\r\n          .enter().append(\"path\")\r\n          .attr(\"class\", function(d) { return \"dsos\" + d.properties.type; })\r\n          .attr(\"transform\", function(d) { return point(d.geometry.coordinates); })\r\n          .attr(\"d\", function(d) { return dsoSymbol(d.properties); });\r\n\r\n        styles.dsos = svgStyle(cfg.dsos.style);\r\n\r\n        for (key in cfg.dsos.symbols) {\r\n          if (!has(cfg.dsos.symbols, key)) continue;\r\n          id = \"dsos\" + key;\r\n          styles[id] = { \"fill-opacity\": cfg.dsos.style.opacity, \"stroke-opacity\": cfg.dsos.style.opacity };\r\n          if (has(cfg.dsos.symbols[key], \"stroke\")) {\r\n            styles[id].fill = \"none\"; \r\n            styles[id].stroke = cfg.dsos.colors ? cfg.dsos.symbols[key].stroke : cfg.dsos.style.stroke;\r\n            styles[id][\"stroke-width\"] = cfg.dsos.colors ? cfg.dsos.symbols[key].width : cfg.dsos.style.width;\r\n          } else {\r\n            styles[id].stroke = \"none\"; \r\n            styles[id].fill = cfg.dsos.colors ? cfg.dsos.symbols[key].fill : cfg.dsos.style.fill;\r\n          }\r\n        }\r\n        \r\n      \r\n        if (cfg.dsos.names) { \r\n          groups.dsoNames.selectAll(\".dsonames\")\r\n            .data(cond.features.filter( function(d) {\r\n              return clip(d.geometry.coordinates) === 1 && \r\n                   (d.properties.mag == 999 && Math.sqrt(parseInt(d.properties.dim)) > cfg.dsos.nameLimit ||\r\n                     d.properties.mag != 999 && d.properties.mag <= cfg.dsos.nameLimit); \r\n            }))\r\n            .enter().append(\"text\")\r\n            .attr(\"class\", function(d) { return \"dsoNames \" + d.properties.type; })\r\n            .attr(\"transform\", function(d) { return point(d.geometry.coordinates); })\r\n            .text( function(d) { return dsoName(d); })\r\n            .attr({dy: \"-.5em\", dx: \".35em\"});\r\n               \r\n          styles.dsoNames = {\"fill-opacity\": cfg.dsos.style.opacity,\r\n                    \"font\": cfg.dsos.nameStyle.font,\r\n                    \"text-anchor\": svgAlign(cfg.dsos.nameStyle.align)};\r\n          \r\n          for (key in cfg.dsos.symbols) {\r\n            if (!has(cfg.dsos.symbols, key)) continue;\r\n            styles[key] = {\"fill\": cfg.dsos.colors ? cfg.dsos.symbols[key].fill : cfg.dsos.style.fill };\r\n          }\r\n        }\r\n        callback(null);\r\n      });\r\n    });\r\n  }\r\n\r\n  //Planets\r\n  if ((cfg.location || cfg.formFields.location) && cfg.planets.show && Celestial.origin) {\r\n    q.defer(function(callback) {\r\n      var dt = Celestial.date(),\r\n          o = Celestial.origin(dt).spherical(),\r\n          jp = {type: \"FeatureCollection\", features: []},\r\n          jlun = {type: \"FeatureCollection\", features: []};\r\n      Celestial.container.selectAll(\".planet\").each(function(d) {\r\n        var id = d.id(), r = 12,\r\n            p = d(dt).equatorial(o);\r\n            \r\n        p.ephemeris.pos = transformDeg(p.ephemeris.pos, euler[cfg.transform]);  //transform; \r\n        if (clip(p.ephemeris.pos) === 1) {\r\n          if (id === \"lun\")\r\n            jlun.features.push(createEntry(p));\r\n          else\r\n            jp.features.push(createEntry(p));\r\n        }\r\n      });\r\n      if (cfg.planets.symbolType === \"disk\") {\r\n        groups.planets.selectAll(\".planets\")\r\n         .data(jp.features)\r\n         .enter().append(\"path\")\r\n         .attr(\"transform\", function(d) { return point(d.geometry.coordinates); })\r\n         .attr(\"d\", function(d) { \r\n           var r = (has(cfg.planets.symbols[d.id], \"size\")) ? (cfg.planets.symbols[d.id].size - 1) * adapt : null;\r\n           return planetSymbol(d.properties, r); \r\n         })\r\n         .attr(\"class\", function(d) { return \"planets \" + d.id; });\r\n      } else {\r\n        groups.planets.selectAll(\".planets\")\r\n         .data(jp.features)\r\n         .enter().append(\"text\")\r\n         .attr(\"transform\", function(d) { return point(d.geometry.coordinates); })\r\n         .text( function(d) { return d.properties.symbol; })\r\n         .attr(\"class\", function(d) { return \"planets \" + d.id; })\r\n         .attr({dy: \".35em\"});\r\n      }\r\n      // Special case for Moon crescent\r\n      if (jlun.features.length > 0) {\r\n        if (cfg.planets.symbolType === \"letter\") {\r\n          groups.planets.selectAll(\".moon\")\r\n           .data(jlun.features)\r\n           .enter().append(\"text\")\r\n           .attr(\"transform\", function(d) { return point(d.geometry.coordinates); })\r\n           .text( function(d) { return d.properties.symbol; })\r\n           .attr(\"class\", function(d) { return \"planets \" + d.id; })\r\n           .attr({dy: \".35em\"});\r\n        } else {\r\n          var rl = has(cfg.planets.symbols.lun, \"size\") ? (cfg.planets.symbols.lun.size - 1) * adapt : 11 * adapt; \r\n          groups.planets.selectAll(\".dmoon\")\r\n           .data(jlun.features)\r\n           .enter().append(\"path\")\r\n           .attr(\"class\", \"darkluna\" )\r\n           .attr(\"transform\", function(d) { return point(d.geometry.coordinates); })\r\n           .attr(\"d\", function(d) { return d3.svg.symbol().type(\"circle\").size(rl*rl)(); });\r\n          groups.planets.selectAll(\".moon\")\r\n           .data(jlun.features)\r\n           .enter().append(\"path\")\r\n           .attr(\"class\", function(d) { return \"planets \" + d.id; })\r\n           .attr(\"transform\", function(d) { return point(d.geometry.coordinates); })\r\n           .attr(\"d\", function(d) { return moonSymbol(d.properties, rl); });\r\n        }\r\n      } \r\n      \r\n      styles.planets = svgTextStyle(cfg.planets.symbolStyle);\r\n      styles.planets.font = planetFont(cfg.planets.symbolStyle.font);\r\n      styles.darkluna = {\"fill\": \"#557\"};\r\n      for (key in cfg.planets.symbols) {\r\n         if (!has(cfg.planets.symbols, key)) continue;\r\n         styles[key] = {\"fill\": cfg.planets.symbols[key].fill};\r\n      }\r\n        \r\n      //Planet names\r\n      if (cfg.planets.names) {\r\n        groups.planetNames.selectAll(\".planetnames\")\r\n         .data(jp.features)\r\n         .enter().append(\"text\")\r\n         .attr(\"transform\", function(d) { return point(d.geometry.coordinates); })\r\n         .text( function(d) { return d.properties.name; })\r\n         .attr({dy: \".85em\", dx: \"-.35em\"})\r\n         .attr(\"class\", function(d) { return \"planetNames \" + d.id; });\r\n        if (jlun.features.length > 0) {\r\n          groups.planetNames.selectAll(\".moonname\")\r\n           .data(jlun.features)\r\n           .enter().append(\"text\")\r\n           .attr(\"transform\", function(d) { return point(d.geometry.coordinates); })\r\n           .text( function(d) { return d.properties.name; })\r\n           .attr({dy: \".85em\", dx: \"-.35em\"})\r\n           .attr(\"class\", function(d) { return \"planetNames \" + d.id; });\r\n        }\r\n      }\r\n      styles.planetNames = svgTextStyle(cfg.planets.nameStyle);\r\n      \r\n      callback(null);\r\n    });  \r\n  }\r\n  \r\n  if ((cfg.location || cfg.formFields.location) && cfg.daylight.show && proj.clip) {\r\n    q.defer(function(callback) {\r\n      var sol = getPlanet(\"sol\");\r\n      if (sol) {\r\n        var up = Celestial.zenith(),\r\n            solpos = sol.ephemeris.pos,\r\n            dist = d3.geo.distance(up, solpos),\r\n            pt = projection(solpos),\r\n            daylight = d3.geo.circle().angle([179.95]).origin(solpos);\r\n\r\n        groups.daylight.append(\"path\").datum(daylight)\r\n         .attr(\"class\", \"daylight\")\r\n         .attr(\"d\", map);\r\n       \r\n        styles.daylight = svgSkyStyle(dist, pt);  \r\n\r\n        if (clip(solpos) === 1 && dist < halfπ) {\r\n          groups.daylight.append(\"circle\")\r\n           .attr(\"cx\", pt[0])\r\n           .attr(\"cy\", pt[1])\r\n           .attr(\"r\", 5)\r\n           .style(\"fill\", \"#fff\");\r\n        }\r\n      }\r\n      callback(null);\r\n    });  \r\n  }\r\n\r\n  if ((cfg.location || cfg.formFields.location) && cfg.horizon.show && !proj.clip) {\r\n    q.defer(function(callback) {\r\n      var horizon = d3.geo.circle().angle([90]).origin(Celestial.nadir());\r\n     \r\n      groups.horizon.append(\"path\").datum(horizon)\r\n       .attr(\"class\", \"horizon\")\r\n       .attr(\"d\", map);\r\n      styles.horizon =  svgStyle(cfg.horizon);  \r\n      callback(null);\r\n    });\r\n  }\r\n  \r\n  if (Celestial.data.length > 0) { \r\n    Celestial.data.forEach( function(d) {\r\n      if (has(d, \"save\")) {\r\n       q.defer(function(callback) { \r\n         d.save(); \r\n        callback(null);\r\n       });\r\n      }\r\n    });\r\n  }\r\n  \r\n  // Helper functions\r\n  \r\n  function clip(coords) {\r\n    return proj.clip && d3.geo.distance(center, coords) > halfπ ? 0 : 1;\r\n  }\r\n\r\n  function point(coords) {\r\n    return \"translate(\" + projection(coords) + \")\";\r\n  }\r\n    \r\n  function filename(what, sub, ext) {\r\n    var cult = (has(formats[what], culture)) ? \".\" + culture : \"\";\r\n    ext = ext ? \".\" + ext : \".json\";\r\n    sub = sub ? \".\" + sub : \"\";\r\n    return what + sub + cult + ext;\r\n  }\r\n\r\n  function svgStyle(s) {\r\n    var res = {};\r\n    res.fill = s.fill || \"none\";\r\n    res[\"fill-opacity\"] = s.opacity !== null ? s.opacity : 1;  \r\n    res.stroke = s.stroke || \"none\";\r\n    res[\"stroke-width\"] = s.width !== null ? s.width : 0;\r\n    res[\"stroke-opacity\"] = s.opacity !== null ? s.opacity : 1;  \r\n    if (has(s, \"dash\")) res[\"stroke-dasharray\"] = s.dash.join(\" \");\r\n    else res[\"stroke-dasharray\"] = \"none\";\r\n    res.font = s.font || null;\r\n    return res;\r\n  }\r\n\r\n  function svgTextStyle(s) {\r\n    var res = {};\r\n    res.stroke = \"none\";\r\n    res.fill = s.fill || \"none\";\r\n    res[\"fill-opacity\"] = s.opacity !== null ? s.opacity : 1;  \r\n    //res.textBaseline = s.baseline || \"bottom\";\r\n    res[\"text-anchor\"] = svgAlign(s.align);\r\n    res.font = s.font || null;\r\n    return res;\r\n  }\r\n\r\n  function svgStyleA(rank, s) {\r\n    var res = {};\r\n    rank = rank || 1;\r\n    res.fill = isArray(s.fill) ? s.fill[rank-1] : null;\r\n    res[\"fill-opacity\"] = isArray(s.opacity) ? s.opacity[rank-1] : 1;  \r\n    res.stroke = isArray(s.stroke) ? s.stroke[rank-1] : null;\r\n    res[\"stroke-width\"] = isArray(s.width) ? s.width[rank-1] : null;\r\n    res[\"stroke-opacity\"] = isArray(s.opacity) ? s.opacity[rank-1] : 1;  \r\n    res[\"text-anchor\"] = svgAlign(s.align);\r\n    res.font = isArray(s.font) ? s.font[rank-1] : null;\r\n    //res.textBaseline = s.baseline || \"bottom\";\r\n    return res;\r\n  }\r\n\r\n  function svgSkyStyle(dist, pt) {\r\n    var factor, color1, color2, color3,\r\n        upper = 1.36, \r\n        lower = 1.885;\r\n    \r\n    if (dist > lower) return {fill: \"transparent\"};\r\n    \r\n    if (dist <= upper) { \r\n      color1 = \"#daf1fa\";\r\n      color2 = \"#93d7f0\"; \r\n      color3 = \"#57c0e8\"; \r\n      factor = -(upper-dist) / 10; \r\n    } else {\r\n      factor = (dist - upper) / (lower - upper);\r\n      color1 = d3.interpolateLab(\"#daf1fa\", \"#e8c866\")(factor);\r\n      color2 = d3.interpolateLab(\"#93c7d0\", \"#ff854a\")(factor);\r\n      color3 = d3.interpolateLab(\"#57b0c8\", \"#6caae2\")(factor);\r\n    }\r\n\r\n    var gradient = groups.daylight.append(\"radialGradient\")\r\n     .attr(\"cx\", pt[0])\r\n     .attr(\"cy\", pt[1])\r\n     .attr(\"fr\", \"0\")\r\n     .attr(\"r\", \"300\")\r\n     .attr(\"id\", \"skygradient\")\r\n     .attr(\"gradientUnits\", \"userSpaceOnUse\");\r\n\r\n    gradient.append(\"stop\").attr(\"offset\", \"0\").attr(\"stop-color\", color1);\r\n    gradient.append(\"stop\").attr(\"offset\", 0.2+0.4*factor).attr(\"stop-color\", color2);\r\n    gradient.append(\"stop\").attr(\"offset\", \"1\").attr(\"stop-color\", color3);\r\n\r\n    return {\"fill\": \"url(#skygradient)\", \"fill-opacity\": skyTransparency(factor, 1.4)};\r\n  }\r\n\r\n  function skyTransparency(t, a) {\r\n    return 0.9 * (1 - ((Math.pow(Math.E, t*a) - 1) / (Math.pow(Math.E, a) - 1)));\r\n  }\r\n  \r\n\r\n\r\n  function svgAlign(s) {\r\n    if (!s) return \"start\";\r\n    if (s === \"center\") return \"middle\"; \r\n    if (s === \"right\") return \"end\";\r\n    return \"start\";\r\n  }\r\n\r\n  function dsoSymbol(p) {\r\n    var size = dsoSize(p.mag, p.dim) || 9,\r\n        type = dsoShape(p.type);\r\n    if (d3.svg.symbolTypes.indexOf(type) !== -1) {\r\n      return d3.svg.symbol().type(type).size(size)();\r\n    } else {\r\n      return d3.svg.customSymbol().type(type).size(size)();\r\n    }\r\n  }\r\n\r\n  function dsoShape(type) {\r\n    if (!type || !has(cfg.dsos.symbols, type)) return \"circle\"; \r\n    else return cfg.dsos.symbols[type].shape; \r\n  }\r\n\r\n  function dsoSize(mag, dim) {\r\n    if (!mag || mag === 999) return Math.pow(parseInt(dim) * cfg.dsos.size * adapt / 7, 0.5); \r\n    return Math.pow(2 * cfg.dsos.size * adapt - mag, cfg.dsos.exponent);\r\n  }\r\n \r\n  function dsoName(d) {\r\n    //return p[cfg.dsos.namesType]; \r\n    var lang = cfg.dsos.namesType, id = d.id;\r\n    if (lang === \"desig\" || !has(dsonames, id)) return d.properties.desig;\r\n    return has(dsonames[id], lang) ? dsonames[id][lang] : d.properties.desig; \r\n  }\r\n\r\n  function dsoColor(p) {\r\n    if (cfg.dsos.colors === true) return svgStyle(cfg.dsos.symbols[p.type]);\r\n    return svgStyle(cfg.dsos.style);\r\n  }\r\n \r\n  function starDesignation(id) {\r\n    if (!has(starnames, id)) return \"\";\r\n    return starnames[id][cfg.stars.designationType]; \r\n  }\r\n\r\n  function starPropername(id) {\r\n    var lang = cfg.stars.propernameType;\r\n    if (!has(starnames, id)) return \"\";\r\n    return has(starnames[id], lang) ? starnames[id][lang] : starnames[id].name; \r\n  }\r\n\r\n  function starSize(mag) {\r\n    if (mag === null) return 0.1; \r\n    var d = cfg.stars.size * adapt * Math.exp(cfg.stars.exponent * (mag + 2));\r\n    return Math.max(d, 0.1);\r\n  }\r\n  \r\n  function starColor(bv) {\r\n    if (!cfg.stars.colors || isNaN(bv)) return \"\"; \r\n    return Math.round(bv*10).toString();\r\n  }\r\n  \r\n  function constName(d) { \r\n    return d.properties[cfg.constellations.namesType]; \r\n  }\r\n\r\n  function moonSymbol(p, r) { \r\n    var size = r ? r*r : 121;\r\n    return d3.svg.customSymbol().type(\"crescent\").size(size).ratio(p.age)();\r\n  }\r\n\r\n  function planetSymbol(p, r) { \r\n    var size = r ? r*r : planetSize(p.mag);\r\n    return d3.svg.symbol().type(\"circle\").size(size)();\r\n  }\r\n\r\n  function planetFont(s) {\r\n    var size = s.replace(/(^\\D*)(\\d+)(\\D.+$)/i,'$2');\r\n    size = Math.round(adapt * size);\r\n    return s.replace(/(^\\D*)(\\d+)(\\D.+$)/i,'$1' + size + '$3');\r\n  }\r\n\r\n  function planetSize(m) {\r\n    var mag = m || 2; \r\n    var r = 4 * adapt * Math.exp(-0.05 * (mag+2));\r\n    return Math.max(r, 2);\r\n  }\r\n\r\n  function createEntry(o) {\r\n    var res = {type: \"Feature\", \"id\":o.id, properties: {}, geometry:{}};\r\n    res.properties.name = o[cfg.planets.namesType];\r\n    if (cfg.planets.symbolType === \"symbol\" || cfg.planets.symbolType === \"letter\")\r\n      res.properties.symbol = cfg.planets.symbols[res.id][cfg.planets.symbolType];\r\n    res.properties.mag = o.ephemeris.mag || 10;\r\n    if (res.id === \"lun\") {\r\n      res.properties.age = o.ephemeris.age;\r\n      res.properties.phase = o.ephemeris.phase;\r\n    }\r\n    res.geometry.type = \"Point\";\r\n    res.geometry.coordinates = o.ephemeris.pos;\r\n    return res;\r\n  }\r\n\r\n  function createStyles() {\r\n    var res = \"\";\r\n    for (var key in styles) {\r\n      if (!has(styles, key)) continue;\r\n      res += \" .\" + key + stringifyStyle(styles[key]);\r\n    }\r\n    return \"/*\\u003c![CDATA[*/\\n\" + res + \"\\n/*]]\\u003e*/\";\r\n  }\r\n\r\n  function stringifyStyle(s) {\r\n    var res = \" {\";\r\n    for (var key in s) {\r\n      if (!has(s, key)) continue;\r\n      res += key + \":\" + s[key] + \"; \";\r\n    }\r\n    return res + \"} \";\r\n  }\r\n\r\n  q.await(function(error) {\r\n    if (error) throw error;\r\n    var svg = d3.select(\"#d3-celestial-svg svg\")\r\n      .attr(\"title\", \"D3-Celestial\")\r\n      .attr(\"version\", 1.1)\r\n      .attr(\"encoding\", \"UTF-8\")\r\n      .attr(\"xmlns\", \"http://www.w3.org/2000/svg\")\r\n      .attr(\"xmlns:xlink\", \"http://www.w3.org/1999/xlink\")\r\n      .attr(\"xmlns:sodipodi\", \"http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd\")\r\n      .attr(\"xmlns:inkscape\", \"http://www.inkscape.org/namespaces/inkscape\")\r\n      .attr(\"viewBox\", \" 0 0 \" + (m.width) + \" \" + (m.height));\r\n\r\n    defs.append(\"style\")\r\n     .attr(\"type\", \"text\\/css\")\r\n     .text(createStyles());\r\n    /*defs.append(\":sodipodi:namedview\")\r\n     .attr(\":inkscape:window-width\", m.width+200)\r\n     .attr(\":inkscape:window-height\", m.height)\r\n     .attr(\":inkscape:window-maximized\", \"1\");*/\r\n    if (fname) {\r\n      var blob = new Blob([svg.node().outerHTML], {type:\"image/svg+xml;charset=utf-8\"});\r\n    \r\n      var a = d3.select(\"body\").append(\"a\").node(); \r\n      a.download = fname || \"d3-celestial.svg\";\r\n      a.rel = \"noopener\";\r\n      a.href = URL.createObjectURL(blob);\r\n      a.click();\r\n      d3.select(a).remove();\r\n    } else if (exportCallback !== null) {\r\n      exportCallback(svg.node().outerHTML);\r\n    }\r\n    d3.select(\"#d3-celestial-svg\").remove();\r\n  });\r\n\r\n}\r\n\r\nvar customSvgSymbols = d3.map({\r\n  'ellipse': function(size, ratio) {\r\n    var s = Math.sqrt(size), \r\n        rx = s*0.666, ry = s/3;\r\n    return 'M' + (-rx) + ',' + (-ry) +\r\n    ' m' + (-rx) + ',0' +\r\n    ' a' + rx + ',' + ry + ' 0 1,0' + (rx * 2) + ',0' +\r\n    ' a' + rx + ',' + ry + ' 0 1,0' + (-(rx * 2)) + ',0';\r\n  },\r\n  'marker': function(size, ratio) {\r\n    var s =  size > 48 ? size / 4 : 12,\r\n        r = s/2, l = r-3;\r\n    return 'M ' + (-r) + ' 0 h ' + l + \r\n           ' M 0 ' + (-r) + ' v ' + l + \r\n           ' M ' + r + ' 0 h ' + (-l) +  \r\n           ' M 0 ' + r + ' v ' + (-l);\r\n  },\r\n  'cross-circle': function(size, ratio) {\r\n    var s = Math.sqrt(size), \r\n        r = s/2;\r\n    return 'M' + (-r) + ',' + (-r) +\r\n    ' m' + (-r) + ',0' +\r\n    ' a' + r + ',' + r + ' 0 1,0' + (r * 2) + ',0' +\r\n    ' a' + r + ',' + r + ' 0 1,0' + (-(r * 2)) + ',0' +\r\n    ' M' + (-r) + ' 0 h ' + (s) + \r\n    ' M 0 ' + (-r) + ' v ' + (s);\r\n        \r\n  },\r\n  'stroke-circle': function(size, ratio) {\r\n    var s = Math.sqrt(size), \r\n        r = s/2;\r\n    return 'M' + (-r) + ',' + (-r) +\r\n    ' m' + (-r) + ',0' +\r\n    ' a' + r + ',' + r + ' 0 1,0' + (r * 2) + ',0' +\r\n    ' a' + r + ',' + r + ' 0 1,0' + (-(r * 2)) + ',0' +\r\n    ' M' + (-s-2) + ',' + (-s-2) + ' l' + (s+4) + ',' + (s+4);\r\n\r\n  }, \r\n  \"crescent\": function(size, ratio) {\r\n    var s = Math.sqrt(size), \r\n        r = s/2,\r\n        ph = 0.5 * (1 - Math.cos(ratio)),\r\n        e = 1.6 * Math.abs(ph - 0.5) + 0.01,\r\n        dir = ratio > Math.PI ? 0 : 1,\r\n        termdir = Math.abs(ph) > 0.5 ? dir : Math.abs(dir-1); \r\n    return 'M ' + (-1) + ',' + (-1) +\r\n    ' m 1,' + (-r+1) + \r\n    ' a' + r + ',' + r + ' 0 1 ' + dir + ' 0,' + (r * 2) +\r\n    ' a' + (r*e) + ',' + r + ' 0 1 ' + termdir + ' 0,' + (-(r * 2)) + 'z';\r\n  } \r\n});\r\n\r\nd3.svg.customSymbol = function() {\r\n  var type, size = 64, ratio = d3.functor(1);\r\n  \r\n  function symbol(d,i) {\r\n    return customSvgSymbols.get(type.call(this,d,i))(size.call(this,d,i), ratio.call(this,d,i));\r\n  }\r\n  symbol.type = function(_) {\r\n    if (!arguments.length) return type; \r\n    type = d3.functor(_);\r\n    return symbol;\r\n  };\r\n  symbol.size = function(_) {\r\n    if (!arguments.length) return size; \r\n    size = d3.functor(_);\r\n    return symbol;\r\n  };\r\n  symbol.ratio = function(_) {\r\n    if (!arguments.length) return ratio; \r\n    ratio = d3.functor(_);\r\n    return symbol;\r\n  };\r\n  return symbol;\r\n};\r\n\r\nvar exportCallback = null;\r\n\r\nCelestial.exportSVG = function(callback) {\r\n  if (!callback) return;\r\n  exportCallback = callback;\r\n  exportSVG();\r\n};\r\nvar datetimepicker = function(cfg, callback) {\r\n  var date = new Date(), \r\n      tzFormat = d3.time.format(\"%Z\"),\r\n      tz = [{\"−12:00\":-720}, {\"−11:00\":-660}, {\"−10:00\":-600}, {\"−09:30\":-570}, {\"−09:00\":-540}, {\"−08:00\":-480}, {\"−07:00\":-420}, {\"−06:00\":-360}, {\"−05:00\":-300}, {\"−04:30\":-270}, {\"−04:00\":-240}, {\"−03:30\":-210}, {\"−03:00\":-180}, {\"−02:30\":-150}, {\"−02:00\":-120}, {\"−01:00\":-60}, {\"±00:00\":0}, {\"+01:00\":60}, {\"+02:00\":120}, {\"+03:00\":180}, {\"+03:30\":210}, {\"+04:00\":240}, {\"+04:30\":270}, {\"+05:00\":300}, {\"+05:30\":330}, {\"+05:45\":345}, {\"+06:00\":360}, {\"+06:30\":390}, {\"+07:00\":420}, {\"+08:00\":480}, {\"+08:30\":510}, {\"+08:45\":525}, {\"+09:00\":540}, {\"+09:30\":570}, {\"+10:00\":600}, {\"+10:30\":630}, {\"+11:00\":660}, {\"+12:00\":720}, {\"+12:45\":765}, {\"+13:00\":780}, {\"+14:00\":840}],\r\n      months = [\"January\", \"February\", \"March\", \"April\", \"May\", \"June\", \"July\", \"August\", \"September\", \"October\", \"November\", \"December\"],\r\n      days = [\"Su\", \"M\", \"Tu\", \"W\", \"Th\", \"F\", \"Sa\"],\r\n      years = getYears(date),\r\n      dateFormat = d3.time.format(\"%Y-%m-%d\"),\r\n      dtrange = cfg.daterange || [];\r\n    \r\n  var picker = d3.select(parentElement + \" ~ #celestial-form\").append(\"div\").attr(\"id\", \"celestial-date\");\r\n  nav(\"left\");\r\n  monSel();\r\n  yrSel();\r\n  nav(\"right\");\r\n  \r\n  var cal = picker.append(\"div\").attr(\"id\", \"cal\");\r\n\r\n  daySel();\r\n  \r\n  timeSel();\r\n  tzSel();\r\n  \r\n  function daySel() {\r\n    var mo = $form(\"mon\").value, yr = $form(\"yr\").value,\r\n        curdt = new Date(yr, mo, 1),\r\n        cal = d3.select(parentElement + \" ~ #celestial-form\").select(\"#cal\"),\r\n        today = new Date();\r\n    yr = parseInt(yr);   \r\n    mo = parseInt(mo);   \r\n    curdt.setDate(curdt.getDate() - curdt.getDay());\r\n    var nd = cal.node();\r\n    while (nd.firstChild) nd.removeChild(nd.firstChild);\r\n    \r\n    for (var i=0; i<7; i++) {\r\n      cal.append(\"div\").classed({\"date\": true, \"weekday\": true}).html(days[i]);\r\n    }\r\n    for (i=0; i<42; i++) {\r\n      var curmon = curdt.getMonth(), curday = curdt.getDay(), curid = dateFormat(curdt);\r\n      cal.append(\"div\").classed({\r\n        \"date\": true, \r\n        \"grey\": curmon !== mo,\r\n        \"weekend\": curmon === mo && (curday === 0 || curday === 6),\r\n        \"today\": dateDiff(curdt, today) === 0,\r\n        \"selected\": dateDiff(curdt, date) === 0\r\n      }).attr(\"id\", curid)\r\n      .on(\"click\", pick)\r\n      .html(curdt.getDate().toString());\r\n      \r\n      curdt.setDate(curdt.getDate()+1);\r\n    }\r\n  }\r\n\r\n  function yrSel() {     \r\n    picker.append(\"select\").attr(\"title\", \"Year\").attr(\"id\", \"yr\").on(\"change\", daySel);   \r\n    \r\n    fillYrSel();\r\n  }\r\n\r\n  function fillYrSel() { \r\n    var sel = d3.select(parentElement + \" ~ #celestial-form\").select(\"select#yr\"),\r\n        year = date.getFullYear(),\r\n        selected = 0,\r\n        years = getYears(date);\r\n        \r\n    sel.selectAll(\"*\").remove();    \r\n    sel.selectAll('option').data(years).enter().append('option')\r\n       .text(function (d, i) { \r\n         if (d === year) selected = i; \r\n         return d.toString(); \r\n       });\r\n    sel.property(\"selectedIndex\", selected);\r\n  }\r\n  \r\n  function monSel() { \r\n    var sel = picker.append(\"select\").attr(\"title\", \"Month\").attr(\"id\", \"mon\").on(\"change\", daySel),\r\n        selected = 0,\r\n        month = date.getMonth();\r\n    \r\n    sel.selectAll('option').data(months).enter().append('option')\r\n       .attr(\"value\", function (d, i) { \r\n         if (i === month) selected = i; \r\n         return i; \r\n       })\r\n       .text(function (d) { return d; });\r\n    sel.property(\"selectedIndex\", selected);\r\n  }\r\n  \r\n  function nav(dir) {\r\n    var lnk = picker.append(\"div\").attr(\"id\", dir).on(\"click\", function () {\r\n      var mon = $form(\"mon\"), yr = $form(\"yr\");\r\n      \r\n      if (dir === \"left\") {\r\n        if (mon.selectedIndex === 0) {\r\n          mon.selectedIndex = 11;\r\n          yr.selectedIndex--;\r\n        } else mon.selectedIndex--;\r\n      } else {\r\n        if (mon.selectedIndex === 11) {\r\n          mon.selectedIndex = 0;\r\n          yr.selectedIndex++;\r\n        } else mon.selectedIndex++;\r\n      }\r\n      daySel();\r\n    });\r\n  }\r\n\r\n  function timeSel() { \r\n    picker.append(\"input\").attr(\"type\", \"number\").attr(\"id\", \"hr\").attr(\"title\", \"Hours\").attr(\"max\", \"24\").attr(\"min\", \"-1\").attr(\"step\", \"1\").attr(\"value\", date.getHours()).on(\"change\", function () { if (testNumber(this) === true) pick(); });\r\n\r\n    picker.append(\"input\").attr(\"type\", \"number\").attr(\"id\", \"min\").attr(\"title\", \"Minutes\").attr(\"max\", \"60\").attr(\"min\", \"-1\").attr(\"step\", \"1\").attr(\"value\", date.getMinutes()).on(\"change\", function () { if (testNumber(this) === true) pick(); });\r\n    \r\n    picker.append(\"input\").attr(\"type\", \"number\").attr(\"id\", \"sec\").attr(\"title\", \"Seconds\").attr(\"max\", \"60\").attr(\"min\", \"-1\").attr(\"step\", \"1\").attr(\"value\", date.getSeconds()).on(\"change\", function () { if (testNumber(this) === true) pick(); });\r\n  }\r\n  \r\n  function tzSel() { \r\n    var sel = picker.append(\"select\").attr(\"title\", \"Time zone offset from UTC\").attr(\"id\", \"tz\").on(\"change\", pick),\r\n        selected = 15,\r\n        tzOffset = -date.getTimezoneOffset();\r\n    sel.selectAll('option').data(tz).enter().append('option')\r\n       .attr(\"value\", function (d, i) { \r\n         var k = Object.keys(d)[0];\r\n         if (d[k] === tzOffset) selected = i; \r\n         return d[k]; \r\n       })\r\n       .text(function (d) { return Object.keys(d)[0]; });\r\n    sel.property(\"selectedIndex\", selected);\r\n  }\r\n  \r\n  function getYears(dt) {\r\n    var r = getDateRange(dt.getFullYear()), res = [];\r\n    for (var i = r[0]; i <= r[1]; i++) res.push(i);\r\n    return res;\r\n  }  \r\n  \r\n  function getDateRange(yr) {\r\n    if (!dtrange || dtrange.length < 1) return [yr - 10, yr + 10];\r\n    \r\n    if (dtrange.length === 1 && isNumber(dtrange[0])) {\r\n      if (dtrange[0] >= 100) return [dtrange[0] - 10, dtrange[0] + 10];\r\n      else return [yr - dtrange[0], yr + dtrange[0]];\r\n    }\r\n    if (dtrange.length === 2 && isNumber(dtrange[0])&& isNumber(dtrange[1])) {\r\n      if (dtrange[1] >= 100) return [dtrange[0], dtrange[1]];\r\n      else return [dtrange[0] - dtrange[1], dtrange[0] + dtrange[1]];\r\n    }      \r\n    return [yr - 10, yr + 10];\r\n  }\r\n\r\n  function select(id, val) {\r\n    var sel = $form(id);\r\n    for (var i=0; i<sel.childNodes.length; i++) {\r\n      if (sel.childNodes[i].value == val) {\r\n        sel.selectedIndex = i;\r\n        break;\r\n      }\r\n    }\r\n  }\r\n  \r\n  function set(dt) {\r\n     if (dt) date.setTime(dt.valueOf());\r\n     \r\n     select(\"yr\", date.getFullYear());\r\n     select(\"mon\", date.getMonth());\r\n     daySel();\r\n     $form(\"hr\").value = date.getHours();\r\n     $form(\"min\").value = date.getMinutes();\r\n     $form(\"sec\").value = date.getSeconds();\r\n  } \r\n  \r\n  this.show = function(dt, tz) {\r\n    var nd = $form(\"celestial-date\"),\r\n        src = $form(\"datepick\"),\r\n        left = src.offsetLeft + src.offsetWidth - nd.offsetWidth,\r\n        top = src.offsetTop - nd.offsetHeight - 1;\r\n  \r\n    if (nd.offsetTop === -9999) {\r\n      date.setTime(dt.valueOf());\r\n      select(\"tz\", tz);\r\n      set();\r\n      d3.select(parentElement + \" ~ #celestial-form\").select(\"#celestial-date\").style({\"top\": px(top), \"left\": px(left), \"opacity\": 1});  \r\n      d3.select(parentElement + \" ~ #celestial-form\").select(\"#datepick\").classed(\"active\", true);\r\n    } else {\r\n      vanish();\r\n    }\r\n  };\r\n  \r\n  this.isVisible = function () {\r\n    if (!document.getElementById(\"datepick\")) return false;\r\n    return d3.select(parentElement + \" ~ #celestial-form\").select(\"#datepick\").classed(\"active\") === true;\r\n  };\r\n\r\n  this.hide = function () {\r\n    vanish();\r\n  };\r\n  \r\n  function vanish() {\r\n    d3.select(parentElement + \" ~ #celestial-form\").select(\"#celestial-date\").style(\"opacity\", 0);\r\n    d3.select(\"#error\").style( {top:\"-9999px\", left:\"-9999px\", opacity:0} ); \r\n    d3.select(parentElement + \" ~ #celestial-form\").select(\"#datepick\").classed(\"active\", false);\r\n    setTimeout(function () { $form(\"celestial-date\").style.top = px(-9999); }, 600);    \r\n  }\r\n  \r\n  function pick() {\r\n    var h = $form(\"hr\").value, m = $form(\"min\").value,\r\n        s = $form(\"sec\").value, tz = $form(\"tz\").value;\r\n        \r\n    if (this.id && this.id.search(/^\\d/) !== -1) {\r\n      date = dateFormat.parse(this.id); \r\n    }\r\n    fillYrSel();\r\n    \r\n    date.setHours(h, m, s);\r\n    set();\r\n    \r\n    callback(date, tz);\r\n  } \r\n  \r\n  \r\n};// Copyright 2014, Jason Davies, http://www.jasondavies.com\r\n// See LICENSE.txt for details.\r\n(function() {\r\n\r\nvar radians = Math.PI / 180,\r\n    degrees = 180 / Math.PI;\r\n\r\n// TODO make incremental rotate optional\r\n\r\nd3.geo.zoom = function() {\r\n  var projection,\r\n      duration;\r\n\r\n  var zoomPoint,\r\n      zooming = 0,\r\n      event = d3_eventDispatch(zoom, \"zoomstart\", \"zoom\", \"zoomend\"),\r\n      zoom = d3.behavior.zoom()\r\n        .on(\"zoomstart\", function() {\r\n          var mouse0 = d3.mouse(this),\r\n              rotate = quaternionFromEuler(projection.rotate()),\r\n              point = position(projection, mouse0);\r\n          if (point) zoomPoint = point;\r\n\r\n          zoomOn.call(zoom, \"zoom\", function() {\r\n                projection.scale(view.k = d3.event.scale);\r\n                var mouse1 = d3.mouse(this),\r\n                    between = rotateBetween(zoomPoint, position(projection, mouse1));\r\n                projection.rotate(view.r = eulerFromQuaternion(rotate = between\r\n                    ? multiply(rotate, between)\r\n                    : multiply(bank(projection, mouse0, mouse1), rotate)));\r\n                mouse0 = mouse1;\r\n                zoomed(event.of(this, arguments));\r\n              });\r\n          zoomstarted(event.of(this, arguments));\r\n        })\r\n        .on(\"zoomend\", function() {\r\n          zoomOn.call(zoom, \"zoom\", null);\r\n          zoomended(event.of(this, arguments));\r\n        }),\r\n      zoomOn = zoom.on,\r\n      view = {r: [0, 0, 0], k: 1};\r\n\r\n  zoom.rotateTo = function(location) {\r\n    var between = rotateBetween(cartesian(location), cartesian([-view.r[0], -view.r[1]]));\r\n    return eulerFromQuaternion(multiply(quaternionFromEuler(view.r), between));\r\n  };\r\n\r\n  zoom.projection = function(_) {\r\n    if (!arguments.length) return projection;\r\n    projection = _;\r\n    view = {r: projection.rotate(), k: projection.scale()};\r\n    return zoom.scale(view.k);\r\n  };\r\n\r\n  zoom.duration = function(_) {\r\n    return arguments.length ? (duration = _, zoom) : duration;\r\n  };\r\n\r\n  zoom.event = function(g) {\r\n    g.each(function() {\r\n      var g = d3.select(this),\r\n          dispatch = event.of(this, arguments),\r\n          view1 = view,\r\n          transition = d3.transition(g);\r\n     \r\n      if (transition !== g) {\r\n        transition\r\n            .each(\"start.zoom\", function() {\r\n              if (this.__chart__) { // pre-transition state\r\n                view = this.__chart__;\r\n                if (!view.hasOwnProperty(\"r\")) view.r = projection.rotate();\r\n              } \r\n              projection.rotate(view.r).scale(view.k);\r\n              zoomstarted(dispatch);\r\n            })\r\n            .tween(\"zoom:zoom\", function() {\r\n              var width = zoom.size()[0],\r\n                  i = interpolateBetween(quaternionFromEuler(view.r), quaternionFromEuler(view1.r)),\r\n                  d = d3.geo.distance(view.r, view1.r),\r\n                  smooth = d3.interpolateZoom([0, 0, width / view.k], [d, 0, width / view1.k]);\r\n              if (duration) transition.duration(duration(smooth.duration * .001)); // see https://github.com/mbostock/d3/pull/2045\r\n              return function(t) {\r\n                var uw = smooth(t);\r\n                this.__chart__ = view = {r: eulerFromQuaternion(i(uw[0] / d)), k: width / uw[2]};\r\n                projection.rotate(view.r).scale(view.k);\r\n                zoom.scale(view.k);\r\n                zoomed(dispatch);\r\n              };\r\n            })\r\n            .each(\"end.zoom\", function() {\r\n              zoomended(dispatch);\r\n            });\r\n        try { // see https://github.com/mbostock/d3/pull/1983\r\n          transition\r\n              .each(\"interrupt.zoom\", function() {\r\n                zoomended(dispatch);\r\n              });\r\n        } catch (e) { console.log(e); }\r\n      } else {\r\n        this.__chart__ = view;\r\n        zoomstarted(dispatch);\r\n        zoomed(dispatch);\r\n        zoomended(dispatch);\r\n      }\r\n    });\r\n  };\r\n\r\n  function zoomstarted(dispatch) {\r\n    if (!zooming++) dispatch({type: \"zoomstart\"});\r\n  }\r\n\r\n  function zoomed(dispatch) {\r\n    dispatch({type: \"zoom\"});\r\n  }\r\n\r\n  function zoomended(dispatch) {\r\n    if (!--zooming) dispatch({type: \"zoomend\"});\r\n  }\r\n\r\n  return d3.rebind(zoom, event, \"on\");\r\n};\r\n\r\nfunction bank(projection, p0, p1) {\r\n  var t = projection.translate(),\r\n      angle = Math.atan2(p0[1] - t[1], p0[0] - t[0]) - Math.atan2(p1[1] - t[1], p1[0] - t[0]);\r\n  return [Math.cos(angle / 2), 0, 0, Math.sin(angle / 2)];\r\n}\r\n\r\nfunction position(projection, point) {\r\n  var spherical = projection.invert(point);\r\n  return spherical && isFinite(spherical[0]) && isFinite(spherical[1]) && cartesian(spherical);\r\n}\r\n\r\nfunction quaternionFromEuler(euler) {\r\n  var λ = .5 * euler[0] * radians,\r\n      φ = .5 * euler[1] * radians,\r\n      γ = .5 * euler[2] * radians,\r\n      sinλ = Math.sin(λ), cosλ = Math.cos(λ),\r\n      sinφ = Math.sin(φ), cosφ = Math.cos(φ),\r\n      sinγ = Math.sin(γ), cosγ = Math.cos(γ);\r\n  return [\r\n    cosλ * cosφ * cosγ + sinλ * sinφ * sinγ,\r\n    sinλ * cosφ * cosγ - cosλ * sinφ * sinγ,\r\n    cosλ * sinφ * cosγ + sinλ * cosφ * sinγ,\r\n    cosλ * cosφ * sinγ - sinλ * sinφ * cosγ\r\n  ];\r\n}\r\n\r\nfunction multiply(a, b) {\r\n  var a0 = a[0], a1 = a[1], a2 = a[2], a3 = a[3],\r\n      b0 = b[0], b1 = b[1], b2 = b[2], b3 = b[3];\r\n  return [\r\n    a0 * b0 - a1 * b1 - a2 * b2 - a3 * b3,\r\n    a0 * b1 + a1 * b0 + a2 * b3 - a3 * b2,\r\n    a0 * b2 - a1 * b3 + a2 * b0 + a3 * b1,\r\n    a0 * b3 + a1 * b2 - a2 * b1 + a3 * b0\r\n  ];\r\n}\r\n\r\nfunction rotateBetween(a, b) {\r\n  if (!a || !b) return;\r\n  var axis = cross(a, b),\r\n      norm = Math.sqrt(dot(axis, axis)),\r\n      halfγ = .5 * Math.acos(Math.max(-1, Math.min(1, dot(a, b)))),\r\n      k = Math.sin(halfγ) / norm;\r\n  return norm && [Math.cos(halfγ), axis[2] * k, -axis[1] * k, axis[0] * k];\r\n}\r\n\r\n// Interpolate between two quaternions (slerp).\r\nfunction interpolateBetween(a, b) {\r\n  var d = Math.max(-1, Math.min(1, dot(a, b))),\r\n      s = d < 0 ? -1 : 1,\r\n      θ = Math.acos(s * d),\r\n      sinθ = Math.sin(θ);\r\n  return sinθ ? function(t) {\r\n    var A = s * Math.sin((1 - t) * θ) / sinθ,\r\n        B = Math.sin(t * θ) / sinθ;\r\n    return [\r\n      a[0] * A + b[0] * B,\r\n      a[1] * A + b[1] * B,\r\n      a[2] * A + b[2] * B,\r\n      a[3] * A + b[3] * B\r\n    ];\r\n  } : function() { return a; };\r\n}\r\n\r\nfunction eulerFromQuaternion(q) {\r\n  return [\r\n    Math.atan2(2 * (q[0] * q[1] + q[2] * q[3]), 1 - 2 * (q[1] * q[1] + q[2] * q[2])) * degrees,\r\n    Math.asin(Math.max(-1, Math.min(1, 2 * (q[0] * q[2] - q[3] * q[1])))) * degrees,\r\n    Math.atan2(2 * (q[0] * q[3] + q[1] * q[2]), 1 - 2 * (q[2] * q[2] + q[3] * q[3])) * degrees\r\n  ];\r\n}\r\n\r\nfunction cartesian(spherical) {\r\n  var λ = spherical[0] * radians,\r\n      φ = spherical[1] * radians,\r\n      cosφ = Math.cos(φ);\r\n  return [\r\n    cosφ * Math.cos(λ),\r\n    cosφ * Math.sin(λ),\r\n    Math.sin(φ)\r\n  ];\r\n}\r\n\r\nfunction dot(a, b) {\r\n  for (var i = 0, n = a.length, s = 0; i < n; ++i) s += a[i] * b[i];\r\n  return s;\r\n}\r\n\r\nfunction cross(a, b) {\r\n  return [\r\n    a[1] * b[2] - a[2] * b[1],\r\n    a[2] * b[0] - a[0] * b[2],\r\n    a[0] * b[1] - a[1] * b[0]\r\n  ];\r\n}\r\n\r\n// Like d3.dispatch, but for custom events abstracting native UI events. These\r\n// events have a target component (such as a brush), a target element (such as\r\n// the svg:g element containing the brush) and the standard arguments `d` (the\r\n// target element's data) and `i` (the selection index of the target element).\r\nfunction d3_eventDispatch(target) {\r\n  var i = 0,\r\n      n = arguments.length,\r\n      argumentz = [];\r\n\r\n  while (++i < n) argumentz.push(arguments[i]);\r\n\r\n  var dispatch = d3.dispatch.apply(null, argumentz);\r\n\r\n  // Creates a dispatch context for the specified `thiz` (typically, the target\r\n  // DOM element that received the source event) and `argumentz` (typically, the\r\n  // data `d` and index `i` of the target element). The returned function can be\r\n  // used to dispatch an event to any registered listeners; the function takes a\r\n  // single argument as input, being the event to dispatch. The event must have\r\n  // a \"type\" attribute which corresponds to a type registered in the\r\n  // constructor. This context will automatically populate the \"sourceEvent\" and\r\n  // \"target\" attributes of the event, as well as setting the `d3.event` global\r\n  // for the duration of the notification.\r\n  dispatch.of = function(thiz, argumentz) {\r\n    return function(e1) {\r\n      try {\r\n        var e0 =\r\n        e1.sourceEvent = d3.event;\r\n        e1.target = target;\r\n        d3.event = e1;\r\n        dispatch[e1.type].apply(thiz, argumentz);\r\n      } finally {\r\n        d3.event = e0;\r\n      }\r\n    };\r\n  };\r\n\r\n  return dispatch;\r\n}\r\n\r\n})();\r\n// https://d3js.org/d3-queue/ Version 3.0.7. Copyright 2017 Mike Bostock.\r\n(function (global, factory) {\r\n\ttypeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\r\n\ttypeof define === 'function' && define.amd ? define(['exports'], factory) :\r\n\t(factory((global.d3 = global.d3 || {})));\r\n}(this, (function (exports) { 'use strict';\r\n\r\nvar slice = [].slice;\r\n\r\nvar noabort = {};\r\n\r\nfunction Queue(size) {\r\n  this._size = size;\r\n  this._call =\r\n  this._error = null;\r\n  this._tasks = [];\r\n  this._data = [];\r\n  this._waiting =\r\n  this._active =\r\n  this._ended =\r\n  this._start = 0; // inside a synchronous task callback?\r\n}\r\n\r\nQueue.prototype = queue.prototype = {\r\n  constructor: Queue,\r\n  defer: function(callback) {\r\n    if (typeof callback !== \"function\") throw new Error(\"invalid callback\");\r\n    if (this._call) throw new Error(\"defer after await\");\r\n    if (this._error != null) return this;\r\n    var t = slice.call(arguments, 1);\r\n    t.push(callback);\r\n    ++this._waiting, this._tasks.push(t);\r\n    poke(this);\r\n    return this;\r\n  },\r\n  abort: function() {\r\n    if (this._error == null) abort(this, new Error(\"abort\"));\r\n    return this;\r\n  },\r\n  await: function(callback) {\r\n    if (typeof callback !== \"function\") throw new Error(\"invalid callback\");\r\n    if (this._call) throw new Error(\"multiple await\");\r\n    this._call = function(error, results) { callback.apply(null, [error].concat(results)); };\r\n    maybeNotify(this);\r\n    return this;\r\n  },\r\n  awaitAll: function(callback) {\r\n    if (typeof callback !== \"function\") throw new Error(\"invalid callback\");\r\n    if (this._call) throw new Error(\"multiple await\");\r\n    this._call = callback;\r\n    maybeNotify(this);\r\n    return this;\r\n  }\r\n};\r\n\r\nfunction poke(q) {\r\n  if (!q._start) {\r\n    try { start(q); } // let the current task complete\r\n    catch (e) {\r\n      if (q._tasks[q._ended + q._active - 1]) abort(q, e); // task errored synchronously\r\n      else if (!q._data) throw e; // await callback errored synchronously\r\n    }\r\n  }\r\n}\r\n\r\nfunction start(q) {\r\n  while (q._start = q._waiting && q._active < q._size) {\r\n    var i = q._ended + q._active,\r\n        t = q._tasks[i],\r\n        j = t.length - 1,\r\n        c = t[j];\r\n    t[j] = end(q, i);\r\n    --q._waiting, ++q._active;\r\n    t = c.apply(null, t);\r\n    if (!q._tasks[i]) continue; // task finished synchronously\r\n    q._tasks[i] = t || noabort;\r\n  }\r\n}\r\n\r\nfunction end(q, i) {\r\n  return function(e, r) {\r\n    if (!q._tasks[i]) return; // ignore multiple callbacks\r\n    --q._active, ++q._ended;\r\n    q._tasks[i] = null;\r\n    if (q._error != null) return; // ignore secondary errors\r\n    if (e != null) {\r\n      abort(q, e);\r\n    } else {\r\n      q._data[i] = r;\r\n      if (q._waiting) poke(q);\r\n      else maybeNotify(q);\r\n    }\r\n  };\r\n}\r\n\r\nfunction abort(q, e) {\r\n  var i = q._tasks.length, t;\r\n  q._error = e; // ignore active callbacks\r\n  q._data = undefined; // allow gc\r\n  q._waiting = NaN; // prevent starting\r\n\r\n  while (--i >= 0) {\r\n    if (t = q._tasks[i]) {\r\n      q._tasks[i] = null;\r\n      if (t.abort) {\r\n        try { t.abort(); }\r\n        catch (e) { /* ignore */ }\r\n      }\r\n    }\r\n  }\r\n\r\n  q._active = NaN; // allow notification\r\n  maybeNotify(q);\r\n}\r\n\r\nfunction maybeNotify(q) {\r\n  if (!q._active && q._call) {\r\n    var d = q._data;\r\n    q._data = undefined; // allow gc\r\n    q._call(q._error, d);\r\n  }\r\n}\r\n\r\nfunction queue(concurrency) {\r\n  if (concurrency == null) concurrency = Infinity;\r\n  else if (!((concurrency = +concurrency) >= 1)) throw new Error(\"invalid concurrency\");\r\n  return new Queue(concurrency);\r\n}\r\n\r\nexports.queue = queue;\r\nd3.queue = queue;\r\n\r\nObject.defineProperty(exports, '__esModule', { value: true });\r\n\r\n})));\r\nthis.Celestial = Celestial;\n})();"],"mappings":"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vS,MAAM,EAAE,OAAOuL,GAAG;MACjCA,GAAG,GAAGhM,EAAE,CAAC0a,OAAO,CAACtT,CAAC,CAAC;MACnB,OAAOyT,aAAa;IACtB,CAAC;IACDA,aAAa,CAACF,IAAI,GAAG,UAASvT,CAAC,EAAE;MAC/B,IAAI,CAAC4L,SAAS,CAACvS,MAAM,EAAE,OAAOka,IAAI;MAClCA,IAAI,GAAG3a,EAAE,CAAC0a,OAAO,CAACtT,CAAC,CAAC;MACpB,OAAOyT,aAAa;IACtB,CAAC;IACDA,aAAa,CAAC5O,QAAQ,GAAG,UAAS7E,CAAC,EAAE;MACnC,IAAI,CAAC4L,SAAS,CAACvS,MAAM,EAAE;MACvBhC,GAAG,GAAG2I,CAAC;MACP,OAAOyT,aAAa;IACtB,CAAC;IAED,OAAOA,aAAa;EACtB,CAAC;EAED5f,SAAS,CAAC6Q,MAAM,GAAGA,MAAM;;EAGzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACA,SAASrK,CAACA,CAAC8I,EAAE,EAAE;IAAE,OAAOtN,QAAQ,CAACgf,aAAa,CAACngB,aAAa,GAAG,IAAI,GAAGyO,EAAE,CAAC;EAAE;EAC3E,SAAS9M,EAAEA,CAAC0c,CAAC,EAAE;IAAE,OAAOA,CAAC,GAAG,IAAI;EAAE;EAClC,SAAShU,KAAKA,CAACqM,CAAC,EAAE0J,EAAE,EAAE;IAAE,OAAOrd,IAAI,CAACC,K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"},"metadata":{},"sourceType":"script","externalDependencies":[]}